<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HOTEL MANAGEMENT SYSTEM</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root {
            --hotel-primary: #0d47a1;
            --hotel-secondary: #b71c1c;
            --hotel-accent: #ff8f00;
            --hotel-light: #fff8e1;
            --hotel-dark: #3e2723;
            --hotel-gradient: linear-gradient(135deg, var(--hotel-primary), var(--hotel-secondary));
            --shadow-sm: 0 2px 8px rgba(0,0,0,0.08);
            --shadow-md: 0 4px 16px rgba(0,0,0,0.12);
            --shadow-lg: 0 8px 28px rgba(0,0,0,0.15);
        }
        
        body {
            background: linear-gradient(135deg, #f5f9ff 0%, #e8f5e9 100%);
            font-family: 'Poppins', 'Segoe UI', sans-serif;
            min-height: 100vh;
            padding: 10px 0;
            overflow-x: hidden;
        }

        #loginOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(5px);
            z-index: 2000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .login-box {
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: var(--shadow-lg);
            width: 100%;
            max-width: 400px;
            text-align: center;
        }

        .login-box .app-logo {
            font-size: 3rem;
            color: var(--hotel-primary);
            margin-bottom: 15px;
        }

        .login-box h2 {
            margin-bottom: 25px;
            color: var(--hotel-dark);
            font-weight: 700;
        }
        
        .app-container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            box-shadow: var(--shadow-lg);
            border-radius: 12px;
            overflow: hidden;
            position: relative;
            z-index: 10;
        }
        
        .app-header {
            background: var(--hotel-gradient);
            color: white;
            padding: 20px 15px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .app-header::before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.15) 0%, transparent 70%);
            pointer-events: none;
        }
        
        .app-logo {
            font-size: 2.5rem;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }
        
        .app-title {
            font-size: 1.8rem;
            font-weight: 800;
            margin: 0;
            position: relative;
            z-index: 1;
            text-shadow: 1px 1px 4px rgba(0,0,0,0.3);
        }
        
        .app-subtitle {
            font-size: 1rem;
            opacity: 0.95;
            position: relative;
            z-index: 1;
            font-weight: 300;
            letter-spacing: 0.5px;
            margin-bottom: 5px;
        }
        
        .nav-pills .nav-link {
            border-radius: 8px;
            margin-bottom: 8px;
            padding: 12px 15px;
            font-weight: 500;
            color: #444;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            font-size: 0.9rem;
        }
        
        .nav-pills .nav-link:hover {
            background-color: #f0f7ff;
            transform: translateX(3px);
        }
        
        .nav-pills .nav-link.active {
            background: var(--hotel-gradient);
            font-weight: 600;
            box-shadow: var(--shadow-md);
            transform: translateX(3px);
            color: white;
        }
        
        .section-title {
            border-left: 4px solid var(--hotel-primary);
            padding-left: 12px;
            margin: 20px 0;
            font-weight: 700;
            color: var(--hotel-dark);
            font-size: 1.4rem;
            position: relative;
        }
        
        .section-title::after {
            content: "";
            position: absolute;
            bottom: -5px;
            left: 12px;
            width: 40px;
            height: 2px;
            background: var(--hotel-gradient);
            border-radius: 2px;
        }
        
        .btn-primary {
            background: var(--hotel-gradient);
            border: none;
            padding: 10px 20px;
            font-weight: 600;
            box-shadow: var(--shadow-md);
            border-radius: 8px;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #2e7d32, #1b5e20);
            border: none;
            padding: 10px 20px;
            font-weight: 600;
            box-shadow: var(--shadow-md);
            border-radius: 8px;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #ff8f00, #ef6c00);
            border: none;
            padding: 10px 20px;
            font-weight: 600;
            box-shadow: var(--shadow-md);
            border-radius: 8px;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #c62828, #b71c1c);
            border: none;
            padding: 10px 20px;
            font-weight: 600;
            box-shadow: var(--shadow-md);
            border-radius: 8px;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .form-label {
            font-weight: 600;
            color: #444;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            font-size: 0.9rem;
        }
        
        .form-label i {
            margin-right: 6px;
            color: var(--hotel-primary);
        }
        
        .form-control, .form-select {
            border-radius: 8px;
            padding: 12px 15px;
            border: 1px solid #ddd;
            transition: all 0.3s;
            box-shadow: var(--shadow-sm);
            font-size: 0.9rem;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: var(--hotel-primary);
            box-shadow: 0 0 0 3px rgba(13, 71, 161, 0.2);
            transform: translateY(-2px);
        }
        
        .copyright {
            text-align: center;
            padding: 20px;
            background-color: var(--hotel-light);
            color: var(--hotel-dark);
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .data-table {
            font-size: 0.85rem;
            border-collapse: separate;
            border-spacing: 0;
            box-shadow: var(--shadow-sm);
            border-radius: 8px;
            overflow: hidden;
        }
        
        .data-table th {
            background: var(--hotel-gradient);
            color: white;
            font-weight: 600;
            padding: 12px 10px;
            text-align: center;
            position: relative;
            font-size: 0.85rem;
        }
        
        .data-table th::after {
            content: "";
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 1px;
            background: rgba(255,255,255,0.3);
        }
        
        .data-table td {
            padding: 10px 8px;
            vertical-align: middle;
            border-bottom: 1px solid #eee;
            font-size: 0.85rem;
        }
        
        .data-table tr:nth-child(even) {
            background-color: #f9fbff;
        }
        
        .data-table tr:hover {
            background-color: #edf5ff;
        }
        
        .feature-icon {
            font-size: 1.1rem;
            margin-right: 8px;
            width: 24px;
            text-align: center;
        }
        
        .card {
            border-radius: 10px;
            border: none;
            box-shadow: var(--shadow-md);
            transition: all 0.3s ease;
            overflow: hidden;
            margin-bottom: 15px;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }
        
        .card-header {
            border-radius: 10px 10px 0 0 !important;
            font-weight: 600;
            padding: 15px 20px;
            background: var(--hotel-gradient);
            color: white;
            font-size: 0.95rem;
        }
        
        .stats-box {
            text-align: center;
            padding: 20px 15px;
            border-radius: 10px;
            background: white;
            box-shadow: var(--shadow-md);
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
            margin-bottom: 15px;
        }
        
        .stats-box::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--hotel-gradient);
            border-radius: 2px;
        }
        
        .stats-box:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }
        
        .stats-number {
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--hotel-primary);
            margin: 10px 0;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }
        
        .stats-label {
            font-size: 0.9rem;
            color: #666;
            font-weight: 500;
        }
        
        .notification-toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1050;
            min-width: 280px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            max-width: calc(100vw - 40px);
        }
        
        .input-error {
            border-color: #dc3545;
            box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.2);
        }
        
        .error-message {
            color: #dc3545;
            font-size: 0.8rem;
            margin-top: 5px;
            display: none;
            font-weight: 500;
        }
        
        .watermark {
            position: absolute;
            bottom: 10px;
            right: 15px;
            opacity: 0.8;
            font-size: 0.8rem;
            color: white;
            font-weight: 300;
        }
        
        .control-panel {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            box-shadow: var(--shadow-sm);
        }
        
        .control-title {
            font-size: 1rem;
            color: var(--hotel-primary);
            font-weight: 600;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--hotel-light);
        }
        
        .floating-action-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--hotel-gradient);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .floating-action-btn:hover {
            transform: scale(1.1) rotate(90deg);
        }
        
        .filter-section {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-sm);
        }
        
        .badge-custom {
            background: var(--hotel-gradient);
            color: white;
            padding: 6px 12px;
            border-radius: 16px;
            font-weight: 600;
            font-size: 0.8rem;
        }
        
        .mobile-menu-btn {
            display: none;
            position: fixed;
            top: 15px;
            left: 15px;
            z-index: 1050;
            background: var(--hotel-gradient);
            color: white;
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            box-shadow: var(--shadow-lg);
        }
        
        .sidebar-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1040;
        }

        .guest-search-results .list-group-item {
            cursor: pointer;
        }
        .guest-search-results .list-group-item:hover {
            background-color: #f0f0f0;
        }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .animate-fadeIn {
            animation: fadeIn 0.5s ease forwards;
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 8px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--hotel-primary);
            border-radius: 8px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--hotel-dark);
        }
        
        /* Responsive styles */
        @media (max-width: 991.98px) {
            .col-md-3.col-lg-2 {
                position: fixed;
                left: -300px;
                top: 0;
                bottom: 0;
                z-index: 1050;
                width: 280px;
                transition: left 0.3s ease;
                overflow-y: auto;
                padding-top: 60px;
            }
            
            .col-md-3.col-lg-2.mobile-show {
                left: 0;
            }
            
            .col-md-9.col-lg-10 {
                width: 100%;
                flex: 0 0 100%;
                max-width: 100%;
            }
            
            .mobile-menu-btn {
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            .sidebar-overlay.mobile-show {
                display: block;
            }
        }
        
        /* Print Styles */
        @media print {
            body * {
                visibility: hidden;
            }
            
            .printable-area, .printable-area * {
                visibility: visible;
            }
            
            .printable-area {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                padding: 0 !important;
                margin: 0 !important;
                box-shadow: none !important;
                border: none !important;
            }
            
            .no-print {
                display: none !important;
            }
        }

        /* Room status indicators */
        .room-status {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 5px;
        }
        
        .status-available {
            background-color: #28a745;
        }
        
        .status-occupied {
            background-color: #dc3545;
        }
        
        .status-maintenance {
            background-color: #ffc107;
        }
        
        .status-reserved {
            background-color: #17a2b8;
        }
        
        /* Invoice styles */
        .invoice-container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: var(--shadow-md);
        }
        
        .invoice-header {
            border-bottom: 2px solid var(--hotel-primary);
            padding-bottom: 20px;
            margin-bottom: 30px;
        }
        
        .invoice-logo-img {
            max-height: 60px;
            margin-bottom: 10px;
        }

        .invoice-logo {
            font-size: 2rem;
            color: var(--hotel-primary);
            font-weight: 700;
        }
        
        .invoice-details {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
        }
        
        .invoice-table th {
            background: var(--hotel-primary);
            color: white;
        }
        
        .invoice-footer {
            border-top: 2px solid var(--hotel-primary);
            padding-top: 20px;
            margin-top: 30px;
            font-style: italic;
            color: #6c757d;
        }

    </style>
</head>
<body>
    <div id="loginOverlay">
        <div class="login-box animate-fadeIn">
            <div class="app-logo">
                <i class="fas fa-hotel"></i>
            </div>
            <h2>Hotel Management System Login</h2>
            <form id="loginForm">
                <div class="form-floating mb-3">
                    <input type="text" class="form-control" id="username" placeholder="Username" required>
                    <label for="username">Username</label>
                </div>
                <div class="form-floating mb-3">
                    <input type="password" class="form-control" id="password" placeholder="Password" required>
                    <label for="password">Password</label>
                </div>
                <button type="submit" class="btn btn-primary w-100 btn-lg">Login</button>
                <div id="loginError" class="error-message mt-3" style="display: none;">Username atau password salah.</div>
            </form>
        </div>
    </div>

    <main id="mainApp" style="display: none;">
        <button class="mobile-menu-btn no-print" id="mobileMenuBtn">
            <i class="fas fa-bars"></i>
        </button>
        
        <div class="sidebar-overlay no-print" id="sidebarOverlay"></div>
        
        <div class="app-container">
            <div class="app-header no-print">
                <div class="app-logo">
                    <i class="fas fa-hotel"></i>
                </div>
                <h1 class="app-title">HOTEL MANAGEMENT SYSTEM</h1>
                <p class="app-subtitle">Sistem Manajemen Hotel Terintegrasi</p>
                <div class="watermark">v2.5 Secured</div>
            </div>
            
            <div class="row g-0">
                <div class="col-md-3 col-lg-2 bg-light p-3 no-print" id="sidebar">
                    <ul class="nav nav-pills flex-column" id="myTab" role="tablist">
                        <li class="nav-item">
                            <a class="nav-link active" id="dashboard-tab" data-bs-toggle="tab" href="#dashboard" role="tab">
                                <i class="fas fa-tachometer-alt feature-icon"></i>Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="reservation-tab" data-bs-toggle="tab" href="#reservation" role="tab">
                                <i class="fas fa-calendar-check feature-icon"></i>Reservasi
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="checkin-tab" data-bs-toggle="tab" href="#checkin" role="tab">
                                <i class="fas fa-sign-in-alt feature-icon"></i>Check-In
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="checkout-tab" data-bs-toggle="tab" href="#checkout" role="tab">
                                <i class="fas fa-sign-out-alt feature-icon"></i>Check-Out
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="history-tab" data-bs-toggle="tab" href="#history" role="tab">
                                <i class="fas fa-history feature-icon"></i>Histori Check-Out
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="room-tab" data-bs-toggle="tab" href="#room" role="tab">
                                <i class="fas fa-bed feature-icon"></i>Manajemen Kamar
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="guest-tab" data-bs-toggle="tab" href="#guest" role="tab">
                                <i class="fas fa-users feature-icon"></i>Data Tamu
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="report-tab" data-bs-toggle="tab" href="#report" role="tab">
                                <i class="fas fa-chart-bar feature-icon"></i>Laporan
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="settings-tab" data-bs-toggle="tab" href="#settings" role="tab">
                                <i class="fas fa-cog feature-icon"></i>Pengaturan
                            </a>
                        </li>
                    </ul>
                </div>
                
                <div class="col-md-9 col-lg-10 p-4">
                    <div class="tab-content" id="myTabContent">
                        <div class="tab-pane fade show active" id="dashboard" role="tabpanel">
                            <h3 class="section-title">Dashboard</h3>
                            
                            <div class="row mb-4">
                                <div class="col-md-3">
                                    <div class="stats-box">
                                        <i class="fas fa-users text-primary fa-2x"></i>
                                        <div class="stats-number" id="totalGuests">0</div>
                                        <div class="stats-label">Total Tamu</div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="stats-box">
                                        <i class="fas fa-bed text-success fa-2x"></i>
                                        <div class="stats-number" id="availableRooms">0</div>
                                        <div class="stats-label">Kamar Tersedia</div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="stats-box">
                                        <i class="fas fa-calendar-check text-warning fa-2x"></i>
                                        <div class="stats-number" id="todayCheckins">0</div>
                                        <div class="stats-label">Check-In Hari Ini</div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="stats-box">
                                        <i class="fas fa-sign-out-alt text-danger fa-2x"></i>
                                        <div class="stats-number" id="todayCheckouts">0</div>
                                        <div class="stats-label">Check-Out Hari Ini</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-8">
                                    <div class="card">
                                        <div class="card-header">
                                            <i class="fas fa-chart-line me-2"></i>Statistik Bulanan
                                        </div>
                                        <div class="card-body">
                                            <canvas id="monthlyStatsChart" height="250"></canvas>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="card">
                                        <div class="card-header">
                                            <i class="fas fa-bed me-2"></i>Status Kamar
                                        </div>
                                        <div class="card-body">
                                            <canvas id="roomStatusChart" height="250"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row mt-4">
                                <div class="col-12">
                                    <div class="card">
                                        <div class="card-header">
                                            <i class="fas fa-list me-2"></i>Aktivitas Terbaru
                                        </div>
                                        <div class="card-body">
                                            <div class="table-responsive">
                                                <table class="table table-hover data-table">
                                                    <thead>
                                                        <tr>
                                                            <th>Waktu</th>
                                                            <th>Tamu</th>
                                                            <th>Kamar</th>
                                                            <th>Aktivitas</th>
                                                            <th>Status</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="recentActivities">
                                                        </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="tab-pane fade" id="reservation" role="tabpanel">
                            <h3 class="section-title">Manajemen Reservasi</h3>
                            
                            <div class="row mb-4">
                                <div class="col-md-12">
                                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addReservationModal">
                                        <i class="fas fa-plus me-2"></i>Tambah Reservasi
                                    </button>
                                    <button class="btn btn-success" id="exportReservationsBtn">
                                        <i class="fas fa-file-excel me-2"></i>Ekspor Excel
                                    </button>
                                    <button class="btn btn-danger" id="printReservationPdfBtn">
                                        <i class="fas fa-file-pdf me-2"></i>Cetak PDF
                                    </button>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-12">
                                    <div class="card">
                                        <div class="card-header">
                                            <i class="fas fa-list me-2"></i>Daftar Reservasi
                                        </div>
                                        <div class="card-body">
                                            <div class="table-responsive">
                                                <table class="table table-hover data-table">
                                                    <thead>
                                                        <tr>
                                                            <th>ID</th>
                                                            <th>Nama Tamu</th>
                                                            <th>Kamar</th>
                                                            <th>Check-In</th>
                                                            <th>Check-Out</th>
                                                            <th>Status</th>
                                                            <th>Aksi</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="reservationList">
                                                        </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="tab-pane fade" id="checkin" role="tabpanel">
                            <h3 class="section-title">Proses Check-In</h3>
                            
                            <div class="row mb-4">
                                <div class="col-md-12">
                                    <div class="filter-section">
                                        <div class="row">
                                            <div class="col-md-4">
                                                <label class="form-label">Cari berdasarkan nama atau ID reservasi</label>
                                                <input type="text" class="form-control" id="searchReservation" placeholder="Masukkan nama atau ID...">
                                            </div>
                                            <div class="col-md-4">
                                                <label class="form-label">Tanggal Check-In</label>
                                                <input type="date" class="form-control" id="filterCheckinDate">
                                            </div>
                                            <div class="col-md-4">
                                                <label class="form-label">&nbsp;</label>
                                                <button class="btn btn-primary w-100" id="applyFilterBtn">
                                                    <i class="fas fa-filter me-2"></i>Terapkan Filter
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-12">
                                    <div class="card">
                                        <div class="card-header">
                                            <i class="fas fa-list me-2"></i>Daftar Reservasi untuk Check-In
                                        </div>
                                        <div class="card-body">
                                            <div class="table-responsive">
                                                <table class="table table-hover data-table">
                                                    <thead>
                                                        <tr>
                                                            <th>ID</th>
                                                            <th>Nama Tamu</th>
                                                            <th>Kamar</th>
                                                            <th>Check-In</th>
                                                            <th>Check-Out</th>
                                                            <th>Status</th>
                                                            <th>Aksi</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="checkinList">
                                                        </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="tab-pane fade" id="checkout" role="tabpanel">
                            <h3 class="section-title">Proses Check-Out</h3>
                            
                            <div class="row mb-4">
                                <div class="col-md-12">
                                    <div class="filter-section">
                                        <div class="row">
                                            <div class="col-md-4">
                                                <label class="form-label">Cari berdasarkan nama atau nomor kamar</label>
                                                <input type="text" class="form-control" id="searchCheckout" placeholder="Masukkan nama atau nomor kamar...">
                                            </div>
                                            <div class="col-md-4">
                                                <label class="form-label">Tanggal Check-Out</label>
                                                <input type="date" class="form-control" id="filterCheckoutDate">
                                            </div>
                                            <div class="col-md-4">
                                                <label class="form-label">&nbsp;</label>
                                                <button class="btn btn-primary w-100" id="applyCheckoutFilterBtn">
                                                    <i class="fas fa-filter me-2"></i>Terapkan Filter
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-12">
                                    <div class="card">
                                        <div class="card-header">
                                            <i class="fas fa-list me-2"></i>Daftar Tamu untuk Check-Out
                                        </div>
                                        <div class="card-body">
                                            <div class="table-responsive">
                                                <table class="table table-hover data-table">
                                                    <thead>
                                                        <tr>
                                                            <th>ID</th>
                                                            <th>Nama Tamu</th>
                                                            <th>Kamar</th>
                                                            <th>Check-In</th>
                                                            <th>Check-Out</th>
                                                            <th>Total</th>
                                                            <th>Aksi</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="checkoutList">
                                                        </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="tab-pane fade" id="history" role="tabpanel">
                            <h3 class="section-title">Histori Check-Out</h3>
                            
                            <div class="row">
                                <div class="col-12">
                                    <div class="card">
                                        <div class="card-header">
                                            <i class="fas fa-history me-2"></i>Daftar Tamu yang Sudah Check-Out
                                        </div>
                                        <div class="card-body">
                                            <div class="table-responsive">
                                                <table class="table table-hover data-table">
                                                    <thead>
                                                        <tr>
                                                            <th>ID Reservasi</th>
                                                            <th>Nama Tamu</th>
                                                            <th>Kamar</th>
                                                            <th>Waktu Check-Out</th>
                                                            <th>Total Tagihan</th>
                                                            <th>Status Bayar</th>
                                                            <th>Aksi</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="checkoutHistoryList">
                                                        </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="tab-pane fade" id="room" role="tabpanel">
                            <h3 class="section-title">Manajemen Kamar</h3>
                            
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <div>
                                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addRoomModal">
                                        <i class="fas fa-plus me-2"></i>Tambah Kamar
                                    </button>
                                    <button class="btn btn-success" id="exportRoomsBtn">
                                        <i class="fas fa-file-excel me-2"></i>Ekspor Data
                                    </button>
                                </div>
                                <div class="btn-group" role="group" id="roomStatusFilter">
                                    <button type="button" class="btn btn-outline-primary active" data-status="all">Semua</button>
                                    <button type="button" class="btn btn-outline-success" data-status="available">Tersedia</button>
                                    <button type="button" class="btn btn-outline-danger" data-status="occupied">Terisi</button>
                                    <button type="button" class="btn btn-outline-info" data-status="reserved">Dipesan</button>
                                    <button type="button" class="btn btn-outline-warning" data-status="maintenance">Pemeliharaan</button>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-12">
                                    <div class="card">
                                        <div class="card-header">
                                            <i class="fas fa-bed me-2"></i>Daftar Kamar
                                        </div>
                                        <div class="card-body">
                                            <div class="table-responsive">
                                                <table class="table table-hover data-table">
                                                    <thead>
                                                        <tr>
                                                            <th>No. Kamar</th>
                                                            <th>Tipe</th>
                                                            <th>Harga per Malam</th>
                                                            <th>Fasilitas</th>
                                                            <th>Status</th>
                                                            <th>Aksi</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="roomList">
                                                        </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="tab-pane fade" id="guest" role="tabpanel">
                            <h3 class="section-title">Manajemen Data Tamu</h3>
                            
                            <div class="row mb-4">
                                <div class="col-md-12">
                                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addGuestModal">
                                        <i class="fas fa-plus me-2"></i>Tambah Tamu
                                    </button>
                                    <button class="btn btn-success" id="exportGuestsBtn">
                                        <i class="fas fa-file-excel me-2"></i>Ekspor Data
                                    </button>
                                    <button class="btn btn-danger" id="printGuestPdfBtn">
                                        <i class="fas fa-file-pdf me-2"></i>Cetak PDF
                                    </button>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-12">
                                    <div class="card">
                                        <div class="card-header">
                                            <i class="fas fa-users me-2"></i>Daftar Tamu
                                        </div>
                                        <div class="card-body">
                                            <div class="table-responsive">
                                                <table class="table table-hover data-table">
                                                    <thead>
                                                        <tr>
                                                            <th>ID</th>
                                                            <th>Nama</th>
                                                            <th>Email</th>
                                                            <th>Telepon</th>
                                                            <th>Alamat</th>
                                                            <th>Aksi</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="guestList">
                                                        </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="tab-pane fade" id="report" role="tabpanel">
                            <h3 class="section-title">Laporan dan Analisis</h3>
                            
                            <div class="row mb-4">
                                <div class="col-md-12">
                                    <div class="filter-section">
                                        <div class="row">
                                            <div class="col-md-3">
                                                <label class="form-label">Jenis Laporan</label>
                                                <select class="form-select" id="reportType">
                                                    <option value="revenue">Pendapatan</option>
                                                    <option value="occupancy">Tingkat Okupansi</option>
                                                    <option value="guests">Registrasi Tamu</option>
                                                    <option value="reservations">Jumlah Reservasi</option>
                                                </select>
                                            </div>
                                            <div class="col-md-3">
                                                <label class="form-label">Periode Mulai</label>
                                                <input type="date" class="form-control" id="reportStartDate">
                                            </div>
                                            <div class="col-md-3">
                                                <label class="form-label">Periode Akhir</label>
                                                <input type="date" class="form-control" id="reportEndDate">
                                            </div>
                                            <div class="col-md-3">
                                                <label class="form-label">&nbsp;</label>
                                                <button class="btn btn-primary w-100" id="generateReportBtn">
                                                    <i class="fas fa-chart-bar me-2"></i>Generate Laporan
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-12">
                                    <div class="card">
                                        <div class="card-header">
                                            <i class="fas fa-chart-bar me-2"></i>Grafik Laporan
                                        </div>
                                        <div class="card-body">
                                            <canvas id="reportChart" height="300"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row mt-4">
                                <div class="col-12">
                                    <div class="card">
                                        <div class="card-header">
                                            <i class="fas fa-table me-2"></i>Data Laporan
                                        </div>
                                        <div class="card-body">
                                            <div class="table-responsive">
                                                <table class="table table-hover data-table">
                                                    <thead id="reportTableHeader">
                                                        </thead>
                                                    <tbody id="reportTableBody">
                                                        <tr><td colspan="4" class="text-center">Silakan generate laporan untuk melihat data.</td></tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="tab-pane fade" id="settings" role="tabpanel">
                            <h3 class="section-title">Pengaturan Sistem</h3>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-header">
                                            <i class="fas fa-cog me-2"></i>Pengaturan Umum
                                        </div>
                                        <div class="card-body">
                                            <form id="generalSettingsForm">
                                                <div class="mb-3">
                                                    <label class="form-label">Nama Hotel</label>
                                                    <input type="text" class="form-control" id="hotelName" placeholder="Masukkan nama hotel">
                                                </div>
                                                <div class="mb-3">
                                                    <label class="form-label">Alamat Hotel</label>
                                                    <textarea class="form-control" id="hotelAddress" rows="3" placeholder="Masukkan alamat hotel"></textarea>
                                                </div>
                                                <div class="mb-3">
                                                    <label class="form-label">Telepon Hotel</label>
                                                    <input type="text" class="form-control" id="hotelPhone" placeholder="Masukkan telepon hotel">
                                                </div>
                                                <div class="mb-3">
                                                    <label class="form-label">Email Hotel</label>
                                                    <input type="email" class="form-control" id="hotelEmail" placeholder="Masukkan email hotel">
                                                </div>
                                                <button type="submit" class="btn btn-primary">Simpan Pengaturan</button>
                                            </form>
                                        </div>
                                    </div>
                                    <div class="card mt-4">
                                        <div class="card-header">
                                            <i class="fas fa-user-circle me-2"></i>Akun
                                        </div>
                                        <div class="card-body">
                                            <p>Anda login sebagai <strong>Admin</strong>.</p>
                                            <button class="btn btn-danger" id="logoutBtn">
                                                <i class="fas fa-sign-out-alt me-2"></i>Logout
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-header">
                                            <i class="fas fa-sliders-h me-2"></i>Pengaturan Lainnya
                                        </div>
                                        <div class="card-body">
                                            <form id="otherSettingsForm">
                                                <div class="mb-3">
                                                    <label class="form-label">Mata Uang</label>
                                                    <select class="form-select" id="currency">
                                                        <option value="IDR">Rupiah (IDR)</option>
                                                        <option value="USD">Dollar (USD)</option>
                                                        <option value="EUR">Euro (EUR)</option>
                                                        <option value="SGD">Dollar Singapura (SGD)</option>
                                                    </select>
                                                </div>
                                                <div class="mb-3">
                                                    <label class="form-label">Pajak (%)</label>
                                                    <input type="number" class="form-control" id="taxRate" min="0" max="30" step="0.1" placeholder="Masukkan persentase pajak">
                                                </div>
                                                <div class="mb-3">
                                                    <label class="form-label">Waktu Check-In Default</label>
                                                    <input type="time" class="form-control" id="defaultCheckinTime" value="14:00">
                                                </div>
                                                <div class="mb-3">
                                                    <label class="form-label">Waktu Check-Out Default</label>
                                                    <input type="time" class="form-control" id="defaultCheckoutTime" value="12:00">
                                                </div>
                                                <button type="submit" class="btn btn-primary">Simpan Pengaturan</button>
                                            </form>
                                        </div>
                                    </div>
                                    
                                    <div class="card mt-4">
                                        <div class="card-header">
                                            <i class="fas fa-database me-2"></i>Manajemen Data
                                        </div>
                                        <div class="card-body">
                                            <div class="d-grid gap-2">
                                                <button class="btn btn-success" id="exportAllDataBtn">
                                                    <i class="fas fa-file-export me-2"></i>Ekspor Semua Data (Excel)
                                                </button>
                                                <button class="btn btn-warning" id="importDataBtn">
                                                    <i class="fas fa-file-import me-2"></i>Impor Data (JSON)
                                                </button>
                                                <button class="btn btn-danger" id="resetDataBtn">
                                                    <i class="fas fa-trash-alt me-2"></i>Reset Data
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="copyright no-print">
                &copy; 2023 Hotel Management System. All rights reserved.
            </div>
        </div>
        
        <div class="floating-action-btn no-print" data-bs-toggle="modal" data-bs-target="#quickActionModal">
            <i class="fas fa-plus"></i>
        </div>
    </main>
    
    <div class="toast-container position-fixed bottom-0 end-0 p-3" style="z-index: 2051">
        <div id="notificationToast" class="toast text-white" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <strong class="me-auto" id="toastTitle">System Notification</strong>
                <small>Just now</small>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body" id="toastMessage">
                Operation completed successfully.
            </div>
        </div>
    </div>
    
    <div class="modal fade" id="quickActionModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Aksi Cepat</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="d-grid gap-2">
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addReservationModal">
                            <i class="fas fa-calendar-plus me-2"></i>Tambah Reservasi
                        </button>
                        <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#addGuestModal">
                            <i class="fas fa-user-plus me-2"></i>Tambah Tamu
                        </button>
                        <button class="btn btn-info" data-bs-toggle="modal" data-bs-target="#addRoomModal">
                            <i class="fas fa-bed me-2"></i>Tambah Kamar
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal fade" id="addReservationModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Tambah Reservasi Baru</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addReservationForm">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Nama Tamu</label>
                                    <div class="position-relative">
                                        <input type="text" class="form-control" id="reservationGuestName" placeholder="Ketik untuk mencari nama tamu..." required autocomplete="off">
                                        <input type="hidden" id="reservationGuestId">
                                        <div class="list-group position-absolute w-100 guest-search-results" id="guestSearchResults" style="z-index: 1000;"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Kamar</label>
                                    <select class="form-select" id="reservationRoom" required>
                                        <option value="">Pilih Kamar</option>
                                        </select>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Tanggal Check-In</label>
                                    <input type="date" class="form-control" id="reservationCheckin" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Tanggal Check-Out</label>
                                    <input type="date" class="form-control" id="reservationCheckout" required>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Jumlah Tamu</label>
                                    <input type="number" class="form-control" id="reservationGuests" min="1" max="10" value="1" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Status</label>
                                    <select class="form-select" id="reservationStatus" required>
                                        <option value="confirmed">Dikonfirmasi</option>
                                        <option value="pending">Menunggu</option>
                                        <option value="cancelled">Dibatalkan</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Catatan Khusus</label>
                            <textarea class="form-control" id="reservationNotes" rows="3"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                    <button type="button" class="btn btn-primary" id="saveReservationBtn">Simpan Reservasi</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal fade" id="addGuestModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Tambah Tamu Baru</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addGuestForm">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Nama Depan</label>
                                    <input type="text" class="form-control" id="guestFirstName" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Nama Belakang</label>
                                    <input type="text" class="form-control" id="guestLastName" required>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Email</label>
                                    <input type="email" class="form-control" id="guestEmail" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Telepon</label>
                                    <input type="tel" class="form-control" id="guestPhone" required>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Alamat</label>
                            <textarea class="form-control" id="guestAddress" rows="3" required></textarea>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Kewarganegaraan</label>
                                    <input type="text" class="form-control" id="guestNationality" value="Indonesia">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Jenis Identitas</label>
                                    <select class="form-select" id="guestIdType">
                                        <option value="KTP">KTP</option>
                                        <option value="SIM">SIM</option>
                                        <option value="Passport">Passport</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Nomor Identitas</label>
                            <input type="text" class="form-control" id="guestIdNumber">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                    <button type="button" class="btn btn-primary" id="saveGuestBtn">Simpan Tamu</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal fade" id="addRoomModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Tambah Kamar Baru</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addRoomForm">
                        <div class="mb-3">
                            <label class="form-label">Nomor Kamar</label>
                            <input type="text" class="form-control" id="roomNumber" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Tipe Kamar</label>
                            <select class="form-select" id="roomType" required>
                                <option value="standard">Standard</option>
                                <option value="deluxe">Deluxe</option>
                                <option value="suite">Suite</option>
                                <option value="executive">Executive</option>
                                <option value="family">Family</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Harga per Malam</label>
                            <input type="number" class="form-control" id="roomPrice" min="0" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Fasilitas</label>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="AC" id="facilityAC" checked>
                                <label class="form-check-label" for="facilityAC">AC</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="TV" id="facilityTV" checked>
                                <label class="form-check-label" for="facilityTV">TV</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="WiFi" id="facilityWifi" checked>
                                <label class="form-check-label" for="facilityWifi">WiFi</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="Breakfast" id="facilityBreakfast">
                                <label class="form-check-label" for="facilityBreakfast">Sarapan</label>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Status</label>
                            <select class="form-select" id="roomStatus" required>
                                <option value="available">Tersedia</option>
                                <option value="maintenance">Pemeliharaan</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                    <button type="button" class="btn btn-primary" id="saveRoomBtn">Simpan Kamar</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal fade" id="editReservationModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Reservasi</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editReservationForm">
                        <input type="hidden" id="editReservationId">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Nama Tamu</label>
                                    <div class="position-relative">
                                        <input type="text" class="form-control" id="editReservationGuestName" placeholder="Ketik untuk mencari nama tamu..." required autocomplete="off">
                                        <input type="hidden" id="editReservationGuestId">
                                        <div class="list-group position-absolute w-100 guest-search-results" id="editGuestSearchResults" style="z-index: 1000;"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Kamar</label>
                                    <select class="form-select" id="editReservationRoom" required>
                                        </select>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Tanggal Check-In</label>
                                    <input type="date" class="form-control" id="editReservationCheckin" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Tanggal Check-Out</label>
                                    <input type="date" class="form-control" id="editReservationCheckout" required>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Jumlah Tamu</label>
                                    <input type="number" class="form-control" id="editReservationGuests" min="1" max="10" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Status</label>
                                    <select class="form-select" id="editReservationStatus" required>
                                        <option value="confirmed">Dikonfirmasi</option>
                                        <option value="pending">Menunggu</option>
                                        <option value="cancelled">Dibatalkan</option>
                                        <option value="checked-in">Check-In</option>
                                        <option value="checked-out">Check-Out</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Catatan Khusus</label>
                            <textarea class="form-control" id="editReservationNotes" rows="3"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                    <button type="button" class="btn btn-primary" id="updateReservationBtn">Perbarui Reservasi</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal fade" id="editGuestModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Data Tamu</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editGuestForm">
                        <input type="hidden" id="editGuestId">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Nama Depan</label>
                                    <input type="text" class="form-control" id="editGuestFirstName" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Nama Belakang</label>
                                    <input type="text" class="form-control" id="editGuestLastName" required>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Email</label>
                                    <input type="email" class="form-control" id="editGuestEmail" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Telepon</label>
                                    <input type="tel" class="form-control" id="editGuestPhone" required>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Alamat</label>
                            <textarea class="form-control" id="editGuestAddress" rows="3" required></textarea>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Kewarganegaraan</label>
                                    <input type="text" class="form-control" id="editGuestNationality">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Jenis Identitas</label>
                                    <select class="form-select" id="editGuestIdType">
                                        <option value="KTP">KTP</option>
                                        <option value="SIM">SIM</option>
                                        <option value="Passport">Passport</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Nomor Identitas</label>
                            <input type="text" class="form-control" id="editGuestIdNumber">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                    <button type="button" class="btn btn-primary" id="updateGuestBtn">Perbarui Tamu</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal fade" id="editRoomModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Data Kamar</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editRoomForm">
                        <input type="hidden" id="editRoomId">
                        <div class="mb-3">
                            <label class="form-label">Nomor Kamar</label>
                            <input type="text" class="form-control" id="editRoomNumber" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Tipe Kamar</label>
                            <select class="form-select" id="editRoomType" required>
                                <option value="standard">Standard</option>
                                <option value="deluxe">Deluxe</option>
                                <option value="suite">Suite</option>
                                <option value="executive">Executive</option>
                                <option value="family">Family</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Harga per Malam</label>
                            <input type="number" class="form-control" id="editRoomPrice" min="0" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Fasilitas</label>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="AC" id="editFacilityAC">
                                <label class="form-check-label" for="editFacilityAC">AC</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="TV" id="editFacilityTV">
                                <label class="form-check-label" for="editFacilityTV">TV</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="WiFi" id="editFacilityWifi">
                                <label class="form-check-label" for="editFacilityWifi">WiFi</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="Breakfast" id="editFacilityBreakfast">
                                <label class="form-check-label" for="editFacilityBreakfast">Sarapan</label>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Status</label>
                            <select class="form-select" id="editRoomStatus" required>
                                <option value="available">Tersedia</option>
                                <option value="occupied">Terisi</option>
                                <option value="maintenance">Pemeliharaan</option>
                                <option value="reserved">Dipesan</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                    <button type="button" class="btn btn-primary" id="updateRoomBtn">Perbarui Kamar</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal fade" id="checkinModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Proses Check-In</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="checkinForm">
                        <input type="hidden" id="checkinReservationId">
                        <div class="mb-3">
                            <label class="form-label">ID Reservasi</label>
                            <input type="text" class="form-control" id="checkinReservationCode" readonly>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Nama Tamu</label>
                            <input type="text" class="form-control" id="checkinGuestName" readonly>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Kamar</label>
                            <input type="text" class="form-control" id="checkinRoom" readonly>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Tanggal Check-In</label>
                            <input type="date" class="form-control" id="checkinDate" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Waktu Check-In</label>
                            <input type="time" class="form-control" id="checkinTime" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                    <button type="button" class="btn btn-primary" id="confirmCheckinBtn">Proses Check-In</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal fade" id="checkoutModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header no-print">
                    <h5 class="modal-title" id="checkoutModalTitle">Proses Check-Out & Invoice</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="invoice-container printable-area" id="checkoutInvoice">
                        <div class="invoice-header">
                            <div class="row">
                                <div class="col-md-6">
                                    <img src="https://raw.githubusercontent.com/LKS-88/hotel/refs/heads/main/logo-hotel.png" alt="Logo Hotel" class="invoice-logo-img">
                                    <div class="invoice-logo" id="invoiceHotelName" style="font-size: 1.5rem; line-height: 1.2;">HOTEL MANAGEMENT SYSTEM</div>
                                    <p id="invoiceHotelAddress" class="mb-0">Jl. Contoh No. 123, Jakarta</p>
                                    <p>Telp: <span id="invoiceHotelPhone">021-1234567</span></p>
                                </div>
                                <div class="col-md-6 text-end">
                                    <h4>INVOICE</h4>
                                    <p>No: <span id="invoiceNumber">INV-20230001</span></p>
                                    <p>Tanggal: <span id="invoiceDate">01/01/2023</span></p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mt-4">
                            <div class="col-md-6">
                                <h5>Detail Tamu</h5>
                                <p><strong id="invoiceGuestName">Nama Tamu</strong></p>
                                <p id="invoiceGuestPhone">Telepon: -</p>
                                <p id="invoiceGuestEmail">Email: -</p>
                            </div>
                            <div class="col-md-6 text-end">
                                <h5>Detail Reservasi</h5>
                                <p>Kamar: <span id="invoiceRoom">-</span></p>
                                <p>Check-In: <span id="invoiceCheckin">-</span></p>
                                <p>Check-Out: <span id="invoiceCheckout">-</span></p>
                                <p>Lama Menginap: <span id="invoiceNights">0</span> malam</p>
                            </div>
                        </div>
                        
                        <div class="row mt-4">
                            <div class="col-12">
                                <table class="table table-bordered invoice-table">
                                    <thead>
                                        <tr>
                                            <th>Deskripsi</th>
                                            <th>Jumlah</th>
                                            <th>Harga Satuan</th>
                                            <th>Subtotal</th>
                                        </tr>
                                    </thead>
                                    <tbody id="invoiceItems">
                                        </tbody>
                                    <tfoot>
                                        <tr>
                                            <th colspan="3" class="text-end">Subtotal</th>
                                            <th id="invoiceSubtotal">0</th>
                                        </tr>
                                        <tr>
                                            <th colspan="3" class="text-end">Pajak (<span id="invoiceTaxRate">0</span>%)</th>
                                            <th id="invoiceTax">0</th>
                                        </tr>
                                        <tr>
                                            <th colspan="3" class="text-end">Total</th>
                                            <th id="invoiceTotal" style="font-size: 1.2rem;">0</th>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                        </div>
                        
                        <div class="invoice-footer text-center">
                            <p>Terima kasih atas kunjungan Anda. Kami berharap dapat melayani Anda lagi!</p>
                        </div>
                    </div>
                    
                    <div class="mt-4 no-print" id="checkoutPaymentSection">
                        <form id="checkoutForm">
                            <input type="hidden" id="checkoutReservationId">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">Metode Pembayaran</label>
                                        <select class="form-select" id="checkoutPaymentMethod" required>
                                            <option value="cash">Tunai</option>
                                            <option value="credit_card">Kartu Kredit</option>
                                            <option value="debit_card">Kartu Debit</option>
                                            <option value="transfer">Transfer Bank</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">Status Pembayaran</label>
                                        <select class="form-select" id="checkoutPaymentStatus" required>
                                            <option value="paid">Lunas</option>
                                            <option value="pending">Menunggu</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </form>
                        <div class="mt-3 p-3 bg-light rounded">
                             <div class="row">
                                 <div class="col-md-4">
                                     <label for="checkoutTotalBill" class="form-label fw-bold">Total Tagihan</label>
                                     <input type="text" id="checkoutTotalBill" class="form-control form-control-lg" readonly style="font-weight: bold;">
                                 </div>
                                 <div class="col-md-4">
                                     <label for="amountPaid" class="form-label fw-bold">Jumlah Bayar</label>
                                     <input type="number" id="amountPaid" class="form-control form-control-lg" placeholder="0">
                                 </div>
                                 <div class="col-md-4">
                                     <label for="changeDue" class="form-label fw-bold">Kembalian</label>
                                     <input type="text" id="changeDue" class="form-control form-control-lg" readonly style="font-weight: bold; color: green;">
                                 </div>
                             </div>
                        </div>
                        </div>
                </div>
                <div class="modal-footer no-print">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                    <button type="button" class="btn btn-info" id="printInvoiceBtn"><i class="fas fa-print"></i> Cetak Invoice</button>
                    <button type="button" class="btn btn-success" id="downloadInvoicePdfBtn"><i class="fas fa-file-pdf"></i> Unduh PDF</button>
                    <button type="button" class="btn btn-primary" id="confirmCheckoutBtn">Proses & Selesaikan Check-Out</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal fade" id="deleteConfirmModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Konfirmasi Hapus</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Apakah Anda yakin ingin menghapus data ini? Tindakan ini tidak dapat dibatalkan.</p>
                    <input type="hidden" id="deleteItemId">
                    <input type="hidden" id="deleteItemType">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteBtn">Hapus</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal fade" id="importDataModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Impor Data</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="importDataForm">
                        <div class="mb-3">
                            <label class="form-label">File Data (JSON)</label>
                            <input type="file" class="form-control" id="importDataFile" accept=".json" required>
                            <div class="form-text">Impor data tamu, kamar, dan reservasi dari satu file JSON.</div>
                        </div>
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" id="importOverwrite">
                            <label class="form-check-label" for="importOverwrite">
                                Timpa semua data yang sudah ada
                            </label>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                    <button type="button" class="btn btn-primary" id="confirmImportBtn">Impor Data</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="settingsPasswordModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Konfirmasi Keamanan</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Untuk menyimpan perubahan, silakan masukkan kata sandi pengaturan.</p>
                    <form id="settingsPasswordForm">
                        <div class="form-floating mb-3">
                            <input type="password" class="form-control" id="settingsPassword" placeholder="Password" required>
                            <label for="settingsPassword">Password</label>
                        </div>
                         <div id="settingsPasswordError" class="error-message" style="display: none;">Password salah.</div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                    <button type="button" class="btn btn-primary" id="confirmSettingsSaveBtn">Konfirmasi & Simpan</button>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            initApp();
        });
        
        function initApp() {
            checkLoginState();
        }

        function checkLoginState() {
            if (sessionStorage.getItem('isLoggedIn') === 'true') {
                document.getElementById('loginOverlay').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                initializeAppCore();
            } else {
                document.getElementById('loginOverlay').style.display = 'flex';
                document.getElementById('mainApp').style.display = 'none';
                document.getElementById('loginForm').addEventListener('submit', handleLogin);
            }
        }
        
        function handleLogin(e) {
            e.preventDefault();
            const user = document.getElementById('username').value;
            const pass = document.getElementById('password').value;
            const errorEl = document.getElementById('loginError');

            if (user === 'Admin' && pass === 'Hotelku.1945') {
                sessionStorage.setItem('isLoggedIn', 'true');
                errorEl.style.display = 'none';
                checkLoginState();
            } else {
                errorEl.style.display = 'block';
            }
        }

        function handleLogout() {
            sessionStorage.removeItem('isLoggedIn');
            window.location.reload();
        }
        
        function initializeAppCore() {
            initStorage();
            loadInitialData();
            setupEventListeners();
            initCharts();
            updateDashboardStats();
            showNotification('Selamat Datang', 'Sistem Manajemen Hotel berhasil dimuat.', 'success');
        }
        
        function initStorage() {
            if (!localStorage.getItem('hotel_guests')) localStorage.setItem('hotel_guests', JSON.stringify([]));
            if (!localStorage.getItem('hotel_rooms')) localStorage.setItem('hotel_rooms', JSON.stringify([]));
            if (!localStorage.getItem('hotel_reservations')) localStorage.setItem('hotel_reservations', JSON.stringify([]));
            
            if (!localStorage.getItem('hotel_settings')) {
                const defaultSettings = {
                    hotelName: 'HOTEL GEMINI',
                    hotelAddress: 'Jl. Teknologi No. 1, Jakarta',
                    hotelPhone: '021-555-1234',
                    hotelEmail: 'info@hotelgemini.com',
                    currency: 'IDR',
                    taxRate: 10,
                    defaultCheckinTime: '14:00',
                    defaultCheckoutTime: '12:00'
                };
                localStorage.setItem('hotel_settings', JSON.stringify(defaultSettings));
            }
        }
        
        function loadInitialData() {
            loadGuests();
            loadRooms();
            loadReservations();
            loadSettings();
        }
        
        function setupEventListeners() {
            document.getElementById('logoutBtn').addEventListener('click', handleLogout);

            document.getElementById('mobileMenuBtn').addEventListener('click', toggleMobileMenu);
            document.getElementById('sidebarOverlay').addEventListener('click', toggleMobileMenu);
            
            document.getElementById('saveReservationBtn').addEventListener('click', saveReservation);
            document.getElementById('saveGuestBtn').addEventListener('click', saveGuest);
            document.getElementById('saveRoomBtn').addEventListener('click', saveRoom);
            
            document.getElementById('updateReservationBtn').addEventListener('click', updateReservation);
            document.getElementById('updateGuestBtn').addEventListener('click', updateGuest);
            document.getElementById('updateRoomBtn').addEventListener('click', updateRoom);
            
            document.getElementById('confirmCheckinBtn').addEventListener('click', processCheckin);
            document.getElementById('confirmCheckoutBtn').addEventListener('click', processCheckout);
            
            document.getElementById('confirmDeleteBtn').addEventListener('click', confirmDelete);
            
            document.getElementById('generalSettingsForm').addEventListener('submit', saveGeneralSettings);
            document.getElementById('otherSettingsForm').addEventListener('submit', saveOtherSettings);
            document.getElementById('confirmSettingsSaveBtn').addEventListener('click', executeSaveGeneralSettings);
            
            document.getElementById('exportReservationsBtn').addEventListener('click', exportReservations);
            document.getElementById('exportGuestsBtn').addEventListener('click', exportGuests);
            document.getElementById('exportRoomsBtn').addEventListener('click', exportRooms);
            document.getElementById('exportAllDataBtn').addEventListener('click', exportAllData);
            
            document.getElementById('importDataBtn').addEventListener('click', () => new bootstrap.Modal(document.getElementById('importDataModal')).show());
            document.getElementById('confirmImportBtn').addEventListener('click', importData);
            
            document.getElementById('resetDataBtn').addEventListener('click', resetData);
            
            document.getElementById('printInvoiceBtn').addEventListener('click', printInvoice);
            document.getElementById('downloadInvoicePdfBtn').addEventListener('click', downloadInvoicePdf);
            document.getElementById('amountPaid').addEventListener('input', calculateChange);
            
            document.getElementById('printReservationPdfBtn').addEventListener('click', printReservationPdf);
            document.getElementById('printGuestPdfBtn').addEventListener('click', printGuestPdf);
            
            document.getElementById('generateReportBtn').addEventListener('click', generateReport);
            
            document.getElementById('roomStatusFilter').addEventListener('click', function(e) {
                if (e.target.tagName === 'BUTTON') {
                    const status = e.target.dataset.status;
                    filterRoomsByStatus(status);
                    document.querySelectorAll('#roomStatusFilter button').forEach(btn => btn.classList.remove('active'));
                    e.target.classList.add('active');
                }
            });

            document.getElementById('reservationGuestName').addEventListener('input', handleGuestSearch);
            document.getElementById('editReservationGuestName').addEventListener('input', handleGuestSearch);

            document.addEventListener('click', (e) => {
                if (!e.target.closest('.position-relative')) {
                    document.getElementById('guestSearchResults').innerHTML = '';
                    document.getElementById('editGuestSearchResults').innerHTML = '';
                }
            });
        }
        
        function toggleMobileMenu() {
            document.getElementById('sidebar').classList.toggle('mobile-show');
            document.getElementById('sidebarOverlay').classList.toggle('mobile-show');
        }
        
        function showNotification(title, message, type = 'info') {
            const toastElement = document.getElementById('notificationToast');
            const toast = new bootstrap.Toast(toastElement);
            document.getElementById('toastTitle').textContent = title;
            document.getElementById('toastMessage').textContent = message;
            
            toastElement.classList.remove('bg-success', 'bg-danger', 'bg-warning', 'bg-info');
            
            switch (type) {
                case 'success': toastElement.classList.add('bg-success'); break;
                case 'error': toastElement.classList.add('bg-danger'); break;
                case 'warning': toastElement.classList.add('bg-warning'); break;
                default: toastElement.classList.add('bg-info');
            }
            
            toast.show();
        }
        
        function loadGuests() {
            const guests = JSON.parse(localStorage.getItem('hotel_guests') || '[]');
            const guestList = document.getElementById('guestList');
            guestList.innerHTML = '';
            
            guests.sort((a, b) => `${a.firstName} ${a.lastName}`.localeCompare(`${b.firstName} ${b.lastName}`));

            guests.forEach(guest => {
                const row = guestList.insertRow();
                row.innerHTML = `
                    <td>${guest.id}</td>
                    <td>${guest.firstName} ${guest.lastName}</td>
                    <td>${guest.email}</td>
                    <td>${guest.phone}</td>
                    <td>${guest.address}</td>
                    <td>
                        <button class="btn btn-sm btn-warning edit-guest" data-id="${guest.id}"><i class="fas fa-edit"></i></button>
                        <button class="btn btn-sm btn-danger delete-guest" data-id="${guest.id}"><i class="fas fa-trash"></i></button>
                    </td>
                `;
            });
            
            addDynamicEventListeners();
        }
        
        function renderRoomList(roomsToRender) {
            const roomList = document.getElementById('roomList');
            roomList.innerHTML = '';

            roomsToRender.sort((a,b) => a.number.localeCompare(b.number));

            roomsToRender.forEach(room => {
                const statusClass = getStatusClass(room.status);
                const facilities = Array.isArray(room.facilities) ? room.facilities.join(', ') : '';
                
                const row = roomList.insertRow();
                row.innerHTML = `
                    <td>${room.number}</td>
                    <td>${room.type}</td>
                    <td>${formatCurrency(room.price)}</td>
                    <td>${facilities}</td>
                    <td><span class="badge ${statusClass}">${getStatusText(room.status)}</span></td>
                    <td>
                        <button class="btn btn-sm btn-warning edit-room" data-id="${room.id}"><i class="fas fa-edit"></i></button>
                        <button class="btn btn-sm btn-danger delete-room" data-id="${room.id}"><i class="fas fa-trash"></i></button>
                    </td>
                `;
            });

             addDynamicEventListeners();
        }

        function filterRoomsByStatus(status) {
            const allRooms = JSON.parse(localStorage.getItem('hotel_rooms') || '[]');
            if (status === 'all') {
                renderRoomList(allRooms);
            } else {
                const filteredRooms = allRooms.filter(room => room.status === status);
                renderRoomList(filteredRooms);
            }
        }
        
        function loadRooms() {
            const rooms = JSON.parse(localStorage.getItem('hotel_rooms') || '[]');
            const reservationRoom = document.getElementById('reservationRoom');
            const editReservationRoom = document.getElementById('editReservationRoom');

            reservationRoom.innerHTML = '<option value="">Pilih Kamar</option>';
            editReservationRoom.innerHTML = '';

            rooms.forEach(room => {
                const option = document.createElement('option');
                option.value = room.id;
                option.textContent = `${room.number} (${room.type})`;
                reservationRoom.appendChild(option.cloneNode(true));
                editReservationRoom.appendChild(option.cloneNode(true));
            });

            renderRoomList(rooms);
            document.querySelector('#roomStatusFilter button[data-status="all"]').click();
        }
        
        function loadReservations() {
            const reservations = JSON.parse(localStorage.getItem('hotel_reservations') || '[]');
            const guests = JSON.parse(localStorage.getItem('hotel_guests') || '[]');
            const rooms = JSON.parse(localStorage.getItem('hotel_rooms') || '[]');
            
            const reservationList = document.getElementById('reservationList');
            const checkinList = document.getElementById('checkinList');
            const checkoutList = document.getElementById('checkoutList');
            const historyList = document.getElementById('checkoutHistoryList');
            
            reservationList.innerHTML = '';
            checkinList.innerHTML = '';
            checkoutList.innerHTML = '';
            historyList.innerHTML = '';
            
            reservations.sort((a,b) => new Date(b.createdAt) - new Date(a.createdAt));

            reservations.forEach(res => {
                const guest = guests.find(g => g.id === res.guestId) || {};
                const room = rooms.find(r => r.id === res.roomId) || {};
                
                const guestName = `${guest.firstName || ''} ${guest.lastName || ''}`.trim();
                const roomName = `${room.number || ''} (${room.type || ''})`;
                const statusClass = getStatusClass(res.status);
                const statusText = getStatusText(res.status);

                if (res.status !== 'checked-out') {
                    const resRow = reservationList.insertRow();
                    resRow.innerHTML = `
                        <td>${res.id}</td>
                        <td>${guestName}</td>
                        <td>${roomName}</td>
                        <td>${formatDate(res.checkinDate)}</td>
                        <td>${formatDate(res.checkoutDate)}</td>
                        <td><span class="badge ${statusClass}">${statusText}</span></td>
                        <td>
                            <button class="btn btn-sm btn-warning edit-reservation" data-id="${res.id}"><i class="fas fa-edit"></i></button>
                            <button class="btn btn-sm btn-danger delete-reservation" data-id="${res.id}"><i class="fas fa-trash"></i></button>
                        </td>
                    `;
                }

                if (res.status === 'confirmed') {
                    const checkinRow = checkinList.insertRow();
                    checkinRow.innerHTML = `
                        <td>${res.id}</td>
                        <td>${guestName}</td>
                        <td>${roomName}</td>
                        <td>${formatDate(res.checkinDate)}</td>
                        <td>${formatDate(res.checkoutDate)}</td>
                        <td><span class="badge ${statusClass}">${statusText}</span></td>
                        <td><button class="btn btn-sm btn-success checkin-btn" data-id="${res.id}"><i class="fas fa-sign-in-alt"></i> Check-In</button></td>
                    `;
                }

                if (res.status === 'checked-in') {
                    const checkoutRow = checkoutList.insertRow();
                    checkoutRow.innerHTML = `
                        <td>${res.id}</td>
                        <td>${guestName}</td>
                        <td>${roomName}</td>
                        <td>${formatDate(res.checkinDate)}</td>
                        <td>${formatDate(res.checkoutDate)}</td>
                        <td>${formatCurrency(calculateReservationTotal(res))}</td>
                        <td><button class="btn btn-sm btn-primary checkout-btn" data-id="${res.id}"><i class="fas fa-sign-out-alt"></i> Check-Out</button></td>
                    `;
                }

                if (res.status === 'checked-out') {
                    const historyRow = historyList.insertRow();
                    const paymentStatusText = res.paymentStatus === 'paid' ? 'Lunas' : 'Menunggu';
                    const paymentStatusClass = res.paymentStatus === 'paid' ? 'bg-success' : 'bg-warning';
                    historyRow.innerHTML = `
                        <td>${res.id}</td>
                        <td>${guestName}</td>
                        <td>${roomName}</td>
                        <td>${formatDateTime(res.actualCheckout)}</td>
                        <td>${formatCurrency(res.totalAmount)}</td>
                        <td><span class="badge ${paymentStatusClass}">${paymentStatusText}</span></td>
                        <td><button class="btn btn-sm btn-info reprint-invoice-btn" data-id="${res.id}"><i class="fas fa-print"></i> Cetak Ulang</button></td>
                    `;
                }
            });

            addDynamicEventListeners();
        }

        function addDynamicEventListeners() {
            document.querySelectorAll('.edit-guest, .delete-guest, .edit-room, .delete-room, .edit-reservation, .delete-reservation, .checkin-btn, .checkout-btn, .reprint-invoice-btn').forEach(btn => {
                btn.removeEventListener('click', handleDynamicButtonClick);
                btn.addEventListener('click', handleDynamicButtonClick);
            });
        }

        function handleDynamicButtonClick(e) {
            const target = e.currentTarget;
            const id = target.getAttribute('data-id');
            if (target.classList.contains('edit-guest')) editGuest(id);
            else if (target.classList.contains('delete-guest')) showDeleteConfirm(id, 'guest');
            else if (target.classList.contains('edit-room')) editRoom(id);
            else if (target.classList.contains('delete-room')) showDeleteConfirm(id, 'room');
            else if (target.classList.contains('edit-reservation')) editReservation(id);
            else if (target.classList.contains('delete-reservation')) showDeleteConfirm(id, 'reservation');
            else if (target.classList.contains('checkin-btn')) openCheckinModal(id);
            else if (target.classList.contains('checkout-btn')) openCheckoutModal(id);
            else if (target.classList.contains('reprint-invoice-btn')) reprintInvoice(id);
        }

        function loadSettings() {
            const settings = JSON.parse(localStorage.getItem('hotel_settings') || '{}');
            Object.keys(settings).forEach(key => {
                const el = document.getElementById(key);
                if (el) el.value = settings[key];
            });
        }
        
        function isRoomAvailableForPeriod(roomId, checkinDate, checkoutDate, excludeReservationId = null) {
            const allReservations = JSON.parse(localStorage.getItem('hotel_reservations') || '[]');
            const newStart = new Date(checkinDate);
            const newEnd = new Date(checkoutDate);

            const conflictingReservation = allReservations.find(res => {
                if (res.id === excludeReservationId) return false;
                
                if (res.roomId !== roomId || ['cancelled', 'checked-out'].includes(res.status)) {
                    return false;
                }

                const existingStart = new Date(res.checkinDate);
                const existingEnd = new Date(res.checkoutDate);
                
                return newStart < existingEnd && newEnd > existingStart;
            });

            return !conflictingReservation;
        }

        function saveReservation() {
            const guestId = document.getElementById('reservationGuestId').value;
            const roomId = document.getElementById('reservationRoom').value;
            const checkinDate = document.getElementById('reservationCheckin').value;
            const checkoutDate = document.getElementById('reservationCheckout').value;
            
            if (!guestId || !roomId || !checkinDate || !checkoutDate) {
                showNotification('Error', 'Harap lengkapi semua field yang wajib diisi.', 'error');
                return;
            }
            if (new Date(checkinDate) >= new Date(checkoutDate)) {
                showNotification('Error', 'Tanggal check-out harus setelah tanggal check-in.', 'error');
                return;
            }

            if (!isRoomAvailableForPeriod(roomId, checkinDate, checkoutDate)) {
                showNotification('Error', 'Kamar tidak tersedia untuk periode yang dipilih. Sudah ada reservasi lain.', 'error');
                return;
            }
            
            const reservations = JSON.parse(localStorage.getItem('hotel_reservations') || '[]');
            const newReservation = {
                id: generateId('RES'),
                guestId: guestId,
                roomId: roomId,
                checkinDate: checkinDate,
                checkoutDate: checkoutDate,
                guests: parseInt(document.getElementById('reservationGuests').value),
                status: document.getElementById('reservationStatus').value,
                notes: document.getElementById('reservationNotes').value,
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            
            reservations.push(newReservation);
            localStorage.setItem('hotel_reservations', JSON.stringify(reservations));
            
            if (newReservation.status === 'confirmed') updateRoomStatus(roomId, 'reserved');
            
            bootstrap.Modal.getInstance(document.getElementById('addReservationModal')).hide();
            document.getElementById('addReservationForm').reset();
            loadInitialData();
            updateDashboardStats();
            showNotification('Sukses', 'Reservasi berhasil ditambahkan.', 'success');
        }
        
        function saveGuest() {
            const firstName = document.getElementById('guestFirstName').value;
            const lastName = document.getElementById('guestLastName').value;
            const email = document.getElementById('guestEmail').value;

            if (!firstName || !lastName || !email) {
                showNotification('Error', 'Nama depan, nama belakang, dan email wajib diisi.', 'error');
                return;
            }
            
            const guests = JSON.parse(localStorage.getItem('hotel_guests') || '[]');
            if (guests.some(guest => guest.email.toLowerCase() === email.toLowerCase())) {
                showNotification('Error', 'Email sudah terdaftar.', 'error');
                return;
            }
            
            const newGuest = {
                id: generateId('GST'),
                firstName: firstName,
                lastName: lastName,
                email: email,
                phone: document.getElementById('guestPhone').value,
                address: document.getElementById('guestAddress').value,
                nationality: document.getElementById('guestNationality').value,
                idType: document.getElementById('guestIdType').value,
                idNumber: document.getElementById('guestIdNumber').value,
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            
            guests.push(newGuest);
            localStorage.setItem('hotel_guests', JSON.stringify(guests));
            
            bootstrap.Modal.getInstance(document.getElementById('addGuestModal')).hide();
            document.getElementById('addGuestForm').reset();
            loadInitialData();
            updateDashboardStats();
            showNotification('Sukses', 'Tamu berhasil ditambahkan.', 'success');
        }
        
        function saveRoom() {
            const number = document.getElementById('roomNumber').value;
            const price = document.getElementById('roomPrice').value;

            if (!number || !price) {
                showNotification('Error', 'Nomor kamar dan harga wajib diisi.', 'error');
                return;
            }
            
            const rooms = JSON.parse(localStorage.getItem('hotel_rooms') || '[]');
            if (rooms.some(room => room.number === number)) {
                showNotification('Error', 'Nomor kamar sudah ada.', 'error');
                return;
            }
            
            const facilities = Array.from(document.querySelectorAll('#addRoomForm .form-check-input:checked')).map(cb => cb.value);
            
            const newRoom = {
                id: generateId('ROM'),
                number: number,
                type: document.getElementById('roomType').value,
                price: parseFloat(price),
                facilities: facilities,
                status: document.getElementById('roomStatus').value,
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            
            rooms.push(newRoom);
            localStorage.setItem('hotel_rooms', JSON.stringify(rooms));
            
            bootstrap.Modal.getInstance(document.getElementById('addRoomModal')).hide();
            document.getElementById('addRoomForm').reset();
            loadInitialData();
            updateDashboardStats();
            showNotification('Sukses', 'Kamar berhasil ditambahkan.', 'success');
        }
        
        function editReservation(id) {
            const reservations = JSON.parse(localStorage.getItem('hotel_reservations') || '[]');
            const reservation = reservations.find(r => r.id === id);
            if (!reservation) return;
            
            const guests = JSON.parse(localStorage.getItem('hotel_guests') || '[]');
            const guest = guests.find(g => g.id === reservation.guestId);

            document.getElementById('editReservationId').value = reservation.id;
            document.getElementById('editReservationGuestName').value = guest ? `${guest.firstName} ${guest.lastName}` : '';
            document.getElementById('editReservationGuestId').value = reservation.guestId;
            document.getElementById('editReservationRoom').value = reservation.roomId;
            document.getElementById('editReservationCheckin').value = reservation.checkinDate;
            document.getElementById('editReservationCheckout').value = reservation.checkoutDate;
            document.getElementById('editReservationGuests').value = reservation.guests;
            document.getElementById('editReservationStatus').value = reservation.status;
            document.getElementById('editReservationNotes').value = reservation.notes;
            
            new bootstrap.Modal(document.getElementById('editReservationModal')).show();
        }
        
        function updateReservation() {
            const id = document.getElementById('editReservationId').value;
            const reservations = JSON.parse(localStorage.getItem('hotel_reservations') || '[]');
            const index = reservations.findIndex(r => r.id === id);
            if (index === -1) return;

            const roomId = document.getElementById('editReservationRoom').value;
            const checkinDate = document.getElementById('editReservationCheckin').value;
            const checkoutDate = document.getElementById('editReservationCheckout').value;

            if (!isRoomAvailableForPeriod(roomId, checkinDate, checkoutDate, id)) {
                showNotification('Error', 'Kamar tidak tersedia untuk periode yang dipilih. Sudah ada reservasi lain.', 'error');
                return;
            }
            
            const originalStatus = reservations[index].status;
            const newStatus = document.getElementById('editReservationStatus').value;

            reservations[index] = {
                ...reservations[index],
                guestId: document.getElementById('editReservationGuestId').value,
                roomId: roomId,
                checkinDate: checkinDate,
                checkoutDate: checkoutDate,
                guests: parseInt(document.getElementById('editReservationGuests').value),
                status: newStatus,
                notes: document.getElementById('editReservationNotes').value,
                updatedAt: new Date().toISOString()
            };

            localStorage.setItem('hotel_reservations', JSON.stringify(reservations));
            
            if(originalStatus !== newStatus) {
                if (newStatus === 'confirmed' || newStatus === 'reserved') updateRoomStatus(roomId, 'reserved');
                else if (newStatus === 'checked-in') updateRoomStatus(roomId, 'occupied');
                else if (newStatus === 'checked-out' || newStatus === 'cancelled') updateRoomStatus(roomId, 'available');
            }

            bootstrap.Modal.getInstance(document.getElementById('editReservationModal')).hide();
            loadInitialData();
            showNotification('Sukses', 'Reservasi berhasil diperbarui.', 'success');
        }

        function editGuest(id) {
            const guests = JSON.parse(localStorage.getItem('hotel_guests') || '[]');
            const guest = guests.find(g => g.id === id);
            if (!guest) return;

            Object.keys(guest).forEach(key => {
                const el = document.getElementById(`editGuest${key.charAt(0).toUpperCase() + key.slice(1)}`);
                if (el) el.value = guest[key];
            });
             document.getElementById('editGuestId').value = guest.id;

            new bootstrap.Modal(document.getElementById('editGuestModal')).show();
        }

        function updateGuest() {
            const id = document.getElementById('editGuestId').value;
            const guests = JSON.parse(localStorage.getItem('hotel_guests') || '[]');
            const index = guests.findIndex(g => g.id === id);
            if (index === -1) return;

            guests[index] = {
                ...guests[index],
                firstName: document.getElementById('editGuestFirstName').value,
                lastName: document.getElementById('editGuestLastName').value,
                email: document.getElementById('editGuestEmail').value,
                phone: document.getElementById('editGuestPhone').value,
                address: document.getElementById('editGuestAddress').value,
                nationality: document.getElementById('editGuestNationality').value,
                idType: document.getElementById('editGuestIdType').value,
                idNumber: document.getElementById('editGuestIdNumber').value,
                updatedAt: new Date().toISOString()
            };

            localStorage.setItem('hotel_guests', JSON.stringify(guests));
            bootstrap.Modal.getInstance(document.getElementById('editGuestModal')).hide();
            loadInitialData();
            showNotification('Sukses', 'Data tamu berhasil diperbarui.', 'success');
        }

        function editRoom(id) {
            const rooms = JSON.parse(localStorage.getItem('hotel_rooms') || '[]');
            const room = rooms.find(r => r.id === id);
            if (!room) return;

            document.getElementById('editRoomId').value = room.id;
            document.getElementById('editRoomNumber').value = room.number;
            document.getElementById('editRoomType').value = room.type;
            document.getElementById('editRoomPrice').value = room.price;
            document.getElementById('editRoomStatus').value = room.status;

            document.querySelectorAll('#editRoomForm .form-check-input').forEach(cb => cb.checked = false);
            if(Array.isArray(room.facilities)) {
                room.facilities.forEach(facility => {
                    const cb = document.getElementById(`editFacility${facility.replace(/\s+/g, '')}`);
                    if (cb) cb.checked = true;
                });
            }

            new bootstrap.Modal(document.getElementById('editRoomModal')).show();
        }

        function updateRoom() {
            const id = document.getElementById('editRoomId').value;
            const rooms = JSON.parse(localStorage.getItem('hotel_rooms') || '[]');
            const index = rooms.findIndex(r => r.id === id);
            if (index === -1) return;

            const facilities = Array.from(document.querySelectorAll('#editRoomForm .form-check-input:checked')).map(cb => cb.value);

            rooms[index] = {
                ...rooms[index],
                number: document.getElementById('editRoomNumber').value,
                type: document.getElementById('editRoomType').value,
                price: parseFloat(document.getElementById('editRoomPrice').value),
                status: document.getElementById('editRoomStatus').value,
                facilities: facilities,
                updatedAt: new Date().toISOString()
            };

            localStorage.setItem('hotel_rooms', JSON.stringify(rooms));
            bootstrap.Modal.getInstance(document.getElementById('editRoomModal')).hide();
            loadInitialData();
            showNotification('Sukses', 'Data kamar berhasil diperbarui.', 'success');
        }
        
        function openCheckinModal(id) {
            const reservation = JSON.parse(localStorage.getItem('hotel_reservations') || '[]').find(r => r.id === id);
            if (!reservation) return;
            
            const guest = JSON.parse(localStorage.getItem('hotel_guests') || '[]').find(g => g.id === reservation.guestId) || {};
            const room = JSON.parse(localStorage.getItem('hotel_rooms') || '[]').find(r => r.id === reservation.roomId) || {};
            
            document.getElementById('checkinReservationId').value = reservation.id;
            document.getElementById('checkinReservationCode').value = reservation.id;
            document.getElementById('checkinGuestName').value = `${guest.firstName} ${guest.lastName}`;
            document.getElementById('checkinRoom').value = `${room.number} (${room.type})`;
            document.getElementById('checkinDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('checkinTime').value = new Date().toTimeString().slice(0, 5);

            new bootstrap.Modal(document.getElementById('checkinModal')).show();
        }
        
        function processCheckin() {
            const reservationId = document.getElementById('checkinReservationId').value;
            const reservations = JSON.parse(localStorage.getItem('hotel_reservations') || '[]');
            const index = reservations.findIndex(r => r.id === reservationId);
            if (index === -1) return;
            
            reservations[index].status = 'checked-in';
            reservations[index].actualCheckin = `${document.getElementById('checkinDate').value}T${document.getElementById('checkinTime').value}:00`;
            reservations[index].updatedAt = new Date().toISOString();
            
            localStorage.setItem('hotel_reservations', JSON.stringify(reservations));
            updateRoomStatus(reservations[index].roomId, 'occupied');
            
            bootstrap.Modal.getInstance(document.getElementById('checkinModal')).hide();
            loadInitialData();
            updateDashboardStats();
            showNotification('Sukses', 'Check-in berhasil diproses.', 'success');
        }
        
        function populateInvoiceModal(reservation) {
            const guests = JSON.parse(localStorage.getItem('hotel_guests') || '[]');
            const rooms = JSON.parse(localStorage.getItem('hotel_rooms') || '[]');
            const settings = JSON.parse(localStorage.getItem('hotel_settings') || '{}');
            
            const guest = guests.find(g => g.id === reservation.guestId) || {};
            const room = rooms.find(r => r.id === reservation.roomId) || {};
            
            const checkinDate = new Date(reservation.checkinDate);
            let checkoutDate = new Date(reservation.checkoutDate);
            if (reservation.status === 'checked-out' && reservation.actualCheckout) {
                checkoutDate = new Date(reservation.actualCheckout);
            }
            const nights = Math.ceil((checkoutDate - checkinDate) / (1000 * 60 * 60 * 24)) || 1;
            
            const roomTotal = (room.price || 0) * nights;
            const taxAmount = roomTotal * ((settings.taxRate || 0) / 100);
            const totalAmount = roomTotal + taxAmount;
            
            document.getElementById('invoiceHotelName').textContent = settings.hotelName;
            document.getElementById('invoiceHotelAddress').textContent = settings.hotelAddress;
            document.getElementById('invoiceHotelPhone').textContent = settings.hotelPhone;
            document.getElementById('invoiceNumber').textContent = `INV-${reservation.id.slice(-6)}`;
            document.getElementById('invoiceDate').textContent = formatDate(reservation.actualCheckout || new Date().toISOString());
            document.getElementById('invoiceGuestName').textContent = `${guest.firstName} ${guest.lastName}`;
            document.getElementById('invoiceGuestPhone').textContent = `Telepon: ${guest.phone || '-'}`;
            document.getElementById('invoiceGuestEmail').textContent = `Email: ${guest.email || '-'}`;
            document.getElementById('invoiceRoom').textContent = `${room.number} (${room.type})`;
            document.getElementById('invoiceCheckin').textContent = formatDate(reservation.checkinDate);
            document.getElementById('invoiceCheckout').textContent = formatDate(reservation.checkoutDate);
            document.getElementById('invoiceNights').textContent = `${nights} malam`;

            document.getElementById('invoiceItems').innerHTML = `
                <tr>
                    <td>Menginap di Kamar ${room.number} (${room.type})</td>
                    <td>${nights} malam</td>
                    <td>${formatCurrency(room.price)}</td>
                    <td>${formatCurrency(roomTotal)}</td>
                </tr>
            `;

            document.getElementById('invoiceSubtotal').textContent = formatCurrency(roomTotal);
            document.getElementById('invoiceTaxRate').textContent = settings.taxRate;
            document.getElementById('invoiceTax').textContent = formatCurrency(taxAmount);
            document.getElementById('invoiceTotal').textContent = formatCurrency(totalAmount);
            
            return totalAmount;
        }

        function openCheckoutModal(id) {
            const reservation = JSON.parse(localStorage.getItem('hotel_reservations') || '[]').find(r => r.id === id);
            if (!reservation) return;

            document.getElementById('checkoutModalTitle').textContent = 'Proses Check-Out & Invoice';
            document.getElementById('checkoutPaymentSection').style.display = 'block';
            document.getElementById('confirmCheckoutBtn').style.display = 'inline-block';

            const totalAmount = populateInvoiceModal(reservation);
            
            document.getElementById('checkoutReservationId').value = reservation.id;
            
            const checkoutModal = document.getElementById('checkoutModal');
            checkoutModal.dataset.totalAmount = totalAmount;
            checkoutModal.dataset.reprintId = reservation.id; // Store for PDF download
            document.getElementById('checkoutTotalBill').value = formatCurrency(totalAmount);
            document.getElementById('amountPaid').value = '';
            document.getElementById('changeDue').value = '';

            new bootstrap.Modal(checkoutModal).show();
        }
        
        function reprintInvoice(id) {
            const reservation = JSON.parse(localStorage.getItem('hotel_reservations') || '[]').find(r => r.id === id);
            if (!reservation) return;

            document.getElementById('checkoutModalTitle').textContent = 'Histori Invoice';
            document.getElementById('checkoutPaymentSection').style.display = 'none';
            document.getElementById('confirmCheckoutBtn').style.display = 'none';

            populateInvoiceModal(reservation);
            
            const checkoutModal = document.getElementById('checkoutModal');
            checkoutModal.dataset.reprintId = reservation.id; // Store for PDF download
            new bootstrap.Modal(checkoutModal).show();
        }

        function processCheckout() {
            const reservationId = document.getElementById('checkoutReservationId').value;
            const reservations = JSON.parse(localStorage.getItem('hotel_reservations') || '[]');
            const index = reservations.findIndex(r => r.id === reservationId);
            if (index === -1) return;
            
            const totalAmount = parseFloat(document.getElementById('checkoutModal').dataset.totalAmount) || 0;
            const amountPaid = parseFloat(document.getElementById('amountPaid').value) || 0;
            const change = amountPaid >= totalAmount ? amountPaid - totalAmount : 0;

            reservations[index].status = 'checked-out';
            reservations[index].actualCheckout = new Date().toISOString();
            reservations[index].paymentMethod = document.getElementById('checkoutPaymentMethod').value;
            reservations[index].paymentStatus = document.getElementById('checkoutPaymentStatus').value;
            reservations[index].updatedAt = new Date().toISOString();
            reservations[index].totalAmount = totalAmount;
            reservations[index].amountPaid = amountPaid;
            reservations[index].change = change;
            
            localStorage.setItem('hotel_reservations', JSON.stringify(reservations));
            
            updateRoomStatus(reservations[index].roomId, 'available');
            
            bootstrap.Modal.getInstance(document.getElementById('checkoutModal')).hide();
            loadInitialData();
            updateDashboardStats();
            showNotification('Sukses', 'Check-out berhasil diproses.', 'success');
        }
        
        function showDeleteConfirm(id, type) {
            document.getElementById('deleteItemId').value = id;
            document.getElementById('deleteItemType').value = type;
            new bootstrap.Modal(document.getElementById('deleteConfirmModal')).show();
        }
        
        function confirmDelete() {
            const id = document.getElementById('deleteItemId').value;
            const type = document.getElementById('deleteItemType').value;
            
            let data = JSON.parse(localStorage.getItem(`hotel_${type}s`) || '[]');
            const index = data.findIndex(item => item.id === id);
            
            if (index === -1) {
                showNotification('Error', 'Data tidak ditemukan.', 'error');
                bootstrap.Modal.getInstance(document.getElementById('deleteConfirmModal')).hide();
                return;
            }
            
            const reservations = JSON.parse(localStorage.getItem('hotel_reservations') || '[]');
            if (type === 'guest' && reservations.some(r => r.guestId === id && ['confirmed', 'checked-in'].includes(r.status))) {
                showNotification('Error', 'Tidak dapat menghapus tamu dengan reservasi aktif.', 'error');
                bootstrap.Modal.getInstance(document.getElementById('deleteConfirmModal')).hide();
                return;
            }
            if (type === 'room' && reservations.some(r => r.roomId === id && ['confirmed', 'checked-in'].includes(r.status))) {
                showNotification('Error', 'Tidak dapat menghapus kamar dengan reservasi aktif.', 'error');
                bootstrap.Modal.getInstance(document.getElementById('deleteConfirmModal')).hide();
                return;
            }

            if (type === 'reservation' && ['confirmed', 'reserved'].includes(data[index].status)) {
                updateRoomStatus(data[index].roomId, 'available');
            }

            data.splice(index, 1);
            localStorage.setItem(`hotel_${type}s`, JSON.stringify(data));
            
            bootstrap.Modal.getInstance(document.getElementById('deleteConfirmModal')).hide();
            loadInitialData();
            updateDashboardStats();
            showNotification('Sukses', `Data ${type} berhasil dihapus.`, 'success');
        }
        
        function saveGeneralSettings(e) {
            e.preventDefault();
            const passwordModal = new bootstrap.Modal(document.getElementById('settingsPasswordModal'));
            document.getElementById('settingsPassword').value = '';
            document.getElementById('settingsPasswordError').style.display = 'none';
            passwordModal.show();
        }

        function executeSaveGeneralSettings() {
            const password = document.getElementById('settingsPassword').value;
            const errorEl = document.getElementById('settingsPasswordError');

            if (password !== 'LKS.1945') {
                errorEl.style.display = 'block';
                return;
            }

            const settings = JSON.parse(localStorage.getItem('hotel_settings') || '{}');
            const updatedSettings = { ...settings, 
                hotelName: document.getElementById('hotelName').value,
                hotelAddress: document.getElementById('hotelAddress').value,
                hotelPhone: document.getElementById('hotelPhone').value,
                hotelEmail: document.getElementById('hotelEmail').value
            };
            localStorage.setItem('hotel_settings', JSON.stringify(updatedSettings));
            
            bootstrap.Modal.getInstance(document.getElementById('settingsPasswordModal')).hide();
            showNotification('Sukses', 'Pengaturan umum berhasil disimpan.', 'success');
            loadSettings(); // Reload to show new settings
        }
        
        function saveOtherSettings(e) {
            e.preventDefault();
            const settings = JSON.parse(localStorage.getItem('hotel_settings') || '{}');
            const updatedSettings = { ...settings,
                currency: document.getElementById('currency').value,
                taxRate: parseFloat(document.getElementById('taxRate').value),
                defaultCheckinTime: document.getElementById('defaultCheckinTime').value,
                defaultCheckoutTime: document.getElementById('defaultCheckoutTime').value
            };
            localStorage.setItem('hotel_settings', JSON.stringify(updatedSettings));
            showNotification('Sukses', 'Pengaturan lainnya berhasil disimpan.', 'success');
        }
        
        function exportToExcel(data, filename, sheetname) {
            const worksheet = XLSX.utils.json_to_sheet(data);
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, sheetname);
            XLSX.writeFile(workbook, `${filename}_${new Date().toISOString().split('T')[0]}.xlsx`);
        }

        function exportReservations() {
            const reservations = JSON.parse(localStorage.getItem('hotel_reservations') || '[]');
            const guests = JSON.parse(localStorage.getItem('hotel_guests') || '[]');
            const rooms = JSON.parse(localStorage.getItem('hotel_rooms') || '[]');
            const data = reservations.map(res => {
                const guest = guests.find(g => g.id === res.guestId) || {};
                const room = rooms.find(r => r.id === res.roomId) || {};
                return {
                    'ID Reservasi': res.id, 'Nama Tamu': `${guest.firstName} ${guest.lastName}`, 'Email': guest.email,
                    'Kamar': room.number, 'Tipe Kamar': room.type, 'Check-In': res.checkinDate, 'Check-Out': res.checkoutDate,
                    'Status': getStatusText(res.status)
                };
            });
            exportToExcel(data, 'reservations', 'Reservasi');
            showNotification('Sukses', 'Data reservasi berhasil diekspor.', 'success');
        }

        function exportGuests() {
            const guests = JSON.parse(localStorage.getItem('hotel_guests') || '[]');
            exportToExcel(guests, 'guests', 'Tamu');
            showNotification('Sukses', 'Data tamu berhasil diekspor.', 'success');
        }

        function exportRooms() {
            const rooms = JSON.parse(localStorage.getItem('hotel_rooms') || '[]');
            exportToExcel(rooms, 'rooms', 'Kamar');
            showNotification('Sukses', 'Data kamar berhasil diekspor.', 'success');
        }

        function exportAllData() {
            const guests = JSON.parse(localStorage.getItem('hotel_guests') || '[]');
            const rooms = JSON.parse(localStorage.getItem('hotel_rooms') || '[]');
            const reservations = JSON.parse(localStorage.getItem('hotel_reservations') || '[]');
            const settings = JSON.parse(localStorage.getItem('hotel_settings') || '{}');
            
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, XLSX.utils.json_to_sheet(guests), 'Tamu');
            XLSX.utils.book_append_sheet(workbook, XLSX.utils.json_to_sheet(rooms), 'Kamar');
            XLSX.utils.book_append_sheet(workbook, XLSX.utils.json_to_sheet(reservations), 'Reservasi');
            XLSX.utils.book_append_sheet(workbook, XLSX.utils.json_to_sheet([settings]), 'Pengaturan');
            
            XLSX.writeFile(workbook, `hotel_backup_${new Date().toISOString().split('T')[0]}.xlsx`);
            showNotification('Sukses', 'Semua data berhasil diekspor.', 'success');
        }
        
        function importData() {
            const file = document.getElementById('importDataFile').files[0];
            if (!file) {
                showNotification('Error', 'Pilih file JSON untuk diimpor.', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    const overwrite = document.getElementById('importOverwrite').checked;

                    if (overwrite) {
                        localStorage.setItem('hotel_guests', JSON.stringify(data.guests || []));
                        localStorage.setItem('hotel_rooms', JSON.stringify(data.rooms || []));
                        localStorage.setItem('hotel_reservations', JSON.stringify(data.reservations || []));
                    } else {
                        const existingGuests = JSON.parse(localStorage.getItem('hotel_guests'));
                        const existingRooms = JSON.parse(localStorage.getItem('hotel_rooms'));
                        const existingReservations = JSON.parse(localStorage.getItem('hotel_reservations'));
                        localStorage.setItem('hotel_guests', JSON.stringify([...existingGuests, ...(data.guests || [])]));
                        localStorage.setItem('hotel_rooms', JSON.stringify([...existingRooms, ...(data.rooms || [])]));
                        localStorage.setItem('hotel_reservations', JSON.stringify([...existingReservations, ...(data.reservations || [])]));
                    }
                    
                    loadInitialData();
                    updateDashboardStats();
                    bootstrap.Modal.getInstance(document.getElementById('importDataModal')).hide();
                    showNotification('Sukses', 'Data berhasil diimpor.', 'success');
                } catch (error) {
                    showNotification('Error', 'Format file JSON tidak valid.', 'error');
                }
            };
            reader.readAsText(file);
        }
        
        function resetData() {
            if (confirm('PERINGATAN: Anda akan menghapus SEMUA data (tamu, kamar, reservasi). Tindakan ini tidak dapat dibatalkan. Lanjutkan?')) {
                localStorage.removeItem('hotel_guests');
                localStorage.removeItem('hotel_rooms');
                localStorage.removeItem('hotel_reservations');
                initStorage();
                loadInitialData();
                updateDashboardStats();
                showNotification('Sukses', 'Semua data telah direset.', 'success');
            }
        }
        
        function printInvoice() {
            window.print();
        }

        async function urlToBas64(url) {
            const response = await fetch(url);
            const blob = await response.blob();
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onloadend = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(blob);
            });
        }

        async function downloadInvoicePdf() {
            const checkoutModal = document.getElementById('checkoutModal');
            const reservationId = checkoutModal.dataset.reprintId;

            if (!reservationId) {
                showNotification('Error', 'Tidak ada data reservasi untuk diunduh.', 'error');
                return;
            }

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            const reservations = JSON.parse(localStorage.getItem('hotel_reservations') || '[]');
            const guests = JSON.parse(localStorage.getItem('hotel_guests') || '[]');
            const rooms = JSON.parse(localStorage.getItem('hotel_rooms') || '[]');
            const settings = JSON.parse(localStorage.getItem('hotel_settings') || '{}');
            const reservation = reservations.find(r => r.id === reservationId);
            const guest = guests.find(g => g.id === reservation.guestId) || {};
            const room = rooms.find(r => r.id === reservation.roomId) || {};

            let currentY = 15; // Starting Y position

            try {
                const logoUrl = 'https://raw.githubusercontent.com/LKS-88/hotel/refs/heads/main/logo-hotel.png';
                const logoBase64 = await urlToBas64(logoUrl);
                
                const img = new Image();
                img.src = logoBase64;
                await new Promise(resolve => img.onload = resolve);
                
                const imgWidth = 40;
                const imgHeight = (img.height * imgWidth) / img.width;
                doc.addImage(logoBase64, 'PNG', 14, currentY, imgWidth, imgHeight);
                currentY += imgHeight + 5; // Update Y position after adding logo + margin

            } catch (error) {
                console.error("Gagal memuat logo:", error);
                showNotification('Warning', 'Gagal memuat logo hotel, PDF akan dibuat tanpa logo.', 'warning');
                currentY += 15; // Add space if logo fails
            }

            doc.setFont('Helvetica', 'bold');
            doc.setFontSize(16);
            doc.text(settings.hotelName || 'Hotel Management System', 14, currentY);
            currentY += 5;

            doc.setFont('Helvetica', 'normal');
            doc.setFontSize(10);
            doc.text(settings.hotelAddress || 'Alamat Hotel', 14, currentY);
            currentY += 5;
            doc.text(`Telp: ${settings.hotelPhone || '-'}`, 14, currentY);


            doc.setFont('Helvetica', 'bold');
            doc.setFontSize(14);
            doc.text('INVOICE', 200, 20, { align: 'right' });
            
            doc.setFont('Helvetica', 'normal');
            doc.setFontSize(10);
            doc.text(`No: INV-${reservation.id.slice(-6)}`, 200, 27, { align: 'right' });
            doc.text(`Tanggal: ${formatDate(reservation.actualCheckout || new Date().toISOString())}`, 200, 34, { align: 'right' });

            currentY = Math.max(currentY, 50) + 10; // Ensure we start below header details
            doc.setLineWidth(0.5);
            doc.line(14, currentY, 200, currentY);
            currentY += 10;

            const guestDetailsY = currentY;
            doc.setFont('Helvetica', 'bold');
            doc.setFontSize(12);
            doc.text('Detail Tamu', 14, guestDetailsY);
            doc.setFont('Helvetica', 'normal');
            doc.setFontSize(10);
            doc.text(guest ? `${guest.firstName} ${guest.lastName}` : 'Nama Tamu', 14, guestDetailsY + 7);
            doc.text(`Telepon: ${guest.phone || '-'}`, 14, guestDetailsY + 12);
            doc.text(`Email: ${guest.email || '-'}`, 14, guestDetailsY + 17);

            doc.setFont('Helvetica', 'bold');
            doc.setFontSize(12);
            doc.text('Detail Reservasi', 200, guestDetailsY, { align: 'right' });
            doc.setFont('Helvetica', 'normal');
            doc.setFontSize(10);
            const checkinDate = new Date(reservation.checkinDate);
            const checkoutDate = new Date(reservation.checkoutDate);
            const nights = Math.ceil((checkoutDate - checkinDate) / (1000 * 60 * 60 * 24)) || 1;
            doc.text(`Kamar: ${room.number || '-'} (${room.type || '-'})`, 200, guestDetailsY + 7, { align: 'right' });
            doc.text(`Check-In: ${formatDate(reservation.checkinDate)}`, 200, guestDetailsY + 12, { align: 'right' });
            doc.text(`Check-Out: ${formatDate(reservation.checkoutDate)}`, 200, guestDetailsY + 17, { align: 'right' });
            doc.text(`Lama Menginap: ${nights} malam`, 200, guestDetailsY + 22, { align: 'right' });

            const roomTotal = (room.price || 0) * nights;
            const taxAmount = roomTotal * ((settings.taxRate || 0) / 100);
            const totalAmount = reservation.totalAmount || (roomTotal + taxAmount);

            const tableColumn = ["Deskripsi", "Jumlah", "Harga Satuan", "Subtotal"];
            const tableRows = [];
            const itemData = [
                `Menginap di Kamar ${room.number || '-'} (${room.type || '-'})`,
                `${nights} malam`,
                formatCurrency(room.price || 0),
                formatCurrency(roomTotal)
            ];
            tableRows.push(itemData);

            doc.autoTable({
                head: [tableColumn],
                body: tableRows,
                startY: guestDetailsY + 30,
                theme: 'grid',
                headStyles: { fillColor: [13, 71, 161] }
            });

            const finalY = doc.autoTable.previous.finalY;
            doc.setFont('Helvetica', 'normal');
            doc.setFontSize(10);
            doc.text('Subtotal', 150, finalY + 10, { align: 'right' });
            doc.text(formatCurrency(roomTotal), 200, finalY + 10, { align: 'right' });
            doc.text(`Pajak (${settings.taxRate || 0}%)`, 150, finalY + 15, { align: 'right' });
            doc.text(formatCurrency(taxAmount), 200, finalY + 15, { align: 'right' });
            
            doc.setFont('Helvetica', 'bold');
            doc.setFontSize(12);
            doc.text('Total', 150, finalY + 22, { align: 'right' });
            doc.text(formatCurrency(totalAmount), 200, finalY + 22, { align: 'right' });

            doc.setFont('Helvetica', 'italic');
            doc.setFontSize(10);
            doc.text('Terima kasih atas kunjungan Anda. Kami berharap dapat melayani Anda lagi!', 105, finalY + 40, { align: 'center' });

            doc.save(`invoice-${reservation.id}.pdf`);
            showNotification('Sukses', 'Invoice PDF berhasil diunduh.', 'success');
        }
        
        function printReservationPdf() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            const reservations = JSON.parse(localStorage.getItem('hotel_reservations') || '[]');
            const guests = JSON.parse(localStorage.getItem('hotel_guests') || '[]');
            const rooms = JSON.parse(localStorage.getItem('hotel_rooms') || '[]');
            const settings = JSON.parse(localStorage.getItem('hotel_settings') || '{}');

            doc.setFontSize(18);
            doc.text(`${settings.hotelName} - Laporan Reservasi`, 14, 22);
            doc.setFontSize(11);
            doc.text(`Tanggal Cetak: ${formatDate(new Date().toISOString())}`, 14, 30);

            const tableColumn = ["ID", "Nama Tamu", "Kamar", "Check-In", "Check-Out", "Status"];
            const tableRows = [];

            reservations.forEach(res => {
                const guest = guests.find(g => g.id === res.guestId) || {};
                const room = rooms.find(r => r.id === res.roomId) || {};
                const reservationData = [
                    res.id,
                    `${guest.firstName} ${guest.lastName}`,
                    room.number,
                    formatDate(res.checkinDate),
                    formatDate(res.checkoutDate),
                    getStatusText(res.status)
                ];
                tableRows.push(reservationData);
            });

            doc.autoTable({
                head: [tableColumn],
                body: tableRows,
                startY: 35
            });
            doc.save(`reservasi_${new Date().toISOString().split('T')[0]}.pdf`);
            showNotification('Sukses', 'PDF Laporan Reservasi berhasil dibuat.', 'success');
        }
        
        function printGuestPdf() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            const guests = JSON.parse(localStorage.getItem('hotel_guests') || '[]');
            const settings = JSON.parse(localStorage.getItem('hotel_settings') || '{}');

            doc.setFontSize(18);
            doc.text(`${settings.hotelName} - Laporan Data Tamu`, 14, 22);
            doc.setFontSize(11);
            doc.text(`Tanggal Cetak: ${formatDate(new Date().toISOString())}`, 14, 30);

            const tableColumn = ["ID", "Nama Lengkap", "Email", "Telepon", "Alamat"];
            const tableRows = [];

            guests.forEach(guest => {
                const guestData = [
                    guest.id,
                    `${guest.firstName} ${guest.lastName}`,
                    guest.email,
                    guest.phone,
                    guest.address.replace(/\n/g, ', ')
                ];
                tableRows.push(guestData);
            });

            doc.autoTable({
                head: [tableColumn],
                body: tableRows,
                startY: 35
            });
            doc.save(`data-tamu_${new Date().toISOString().split('T')[0]}.pdf`);
            showNotification('Sukses', 'PDF Laporan Tamu berhasil dibuat.', 'success');
        }
        
        function updateRoomStatus(roomId, status) {
            const rooms = JSON.parse(localStorage.getItem('hotel_rooms') || '[]');
            const index = rooms.findIndex(r => r.id === roomId);
            if (index !== -1) {
                if(rooms[index].status !== 'maintenance') {
                    rooms[index].status = status;
                    rooms[index].updatedAt = new Date().toISOString();
                    localStorage.setItem('hotel_rooms', JSON.stringify(rooms));
                }
            }
        }
        
        function calculateReservationTotal(reservation) {
            const rooms = JSON.parse(localStorage.getItem('hotel_rooms') || '[]');
            const room = rooms.find(r => r.id === reservation.roomId);
            if (!room) return 0;
            
            const checkinDate = new Date(reservation.checkinDate);
            const checkoutDate = new Date(reservation.checkoutDate);
            const nights = Math.ceil((checkoutDate - checkinDate) / (1000 * 60 * 60 * 24)) || 1;
            
            const settings = JSON.parse(localStorage.getItem('hotel_settings') || '{}');
            const roomTotal = room.price * nights;
            const taxAmount = roomTotal * (settings.taxRate / 100);
            return roomTotal + taxAmount;
        }

        function calculateChange() {
            const checkoutModal = document.getElementById('checkoutModal');
            const totalAmount = parseFloat(checkoutModal.dataset.totalAmount) || 0;
            const amountPaid = parseFloat(document.getElementById('amountPaid').value) || 0;
            const changeDueEl = document.getElementById('changeDue');

            if (amountPaid > 0 && amountPaid >= totalAmount) {
                const change = amountPaid - totalAmount;
                changeDueEl.value = formatCurrency(change);
            } else {
                changeDueEl.value = '';
            }
        }
        
        function updateDashboardStats() {
            const guests = JSON.parse(localStorage.getItem('hotel_guests') || '[]');
            const rooms = JSON.parse(localStorage.getItem('hotel_rooms') || '[]');
            const reservations = JSON.parse(localStorage.getItem('hotel_reservations') || '[]');
            
            document.getElementById('totalGuests').textContent = guests.length;
            document.getElementById('availableRooms').textContent = rooms.filter(r => r.status === 'available').length;
            
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('todayCheckins').textContent = reservations.filter(r => r.status === 'checked-in' && r.actualCheckin && r.actualCheckin.startsWith(today)).length;
            document.getElementById('todayCheckouts').textContent = reservations.filter(r => r.status === 'checked-out' && r.actualCheckout && r.actualCheckout.startsWith(today)).length;
            
            updateRecentActivities(reservations, guests, rooms);
            initCharts();
        }
        
        function updateRecentActivities(reservations, guests, rooms) {
            const recent = reservations.sort((a, b) => new Date(b.updatedAt) - new Date(a.updatedAt)).slice(0, 5);
            const activitiesList = document.getElementById('recentActivities');
            activitiesList.innerHTML = '';
            
            recent.forEach(res => {
                const guest = guests.find(g => g.id === res.guestId) || {};
                const room = rooms.find(r => r.id === res.roomId) || {};
                const row = activitiesList.insertRow();
                row.innerHTML = `
                    <td>${formatDateTime(res.updatedAt)}</td>
                    <td>${guest.firstName || ''} ${guest.lastName || ''}</td>
                    <td>${room.number || '-'}</td>
                    <td>${getActivityText(res.status)}</td>
                    <td><span class="badge ${getStatusClass(res.status)}">${getStatusText(res.status)}</span></td>
                `;
            });
        }
        
        let monthlyStatsChart, roomStatusChart, reportChart;
        function initCharts() {
            const monthlyCtx = document.getElementById('monthlyStatsChart').getContext('2d');
            if(monthlyStatsChart) monthlyStatsChart.destroy();
            
            const reservations = JSON.parse(localStorage.getItem('hotel_reservations') || '[]');
            const monthlyRevenue = new Array(12).fill(0);
            const monthlyGuests = new Array(12).fill(0);
            reservations.forEach(res => {
                if (res.status === 'checked-out' && res.actualCheckout) {
                    const month = new Date(res.actualCheckout).getMonth();
                    monthlyRevenue[month] += res.totalAmount || 0;
                    monthlyGuests[month]++;
                }
            });

            monthlyStatsChart = new Chart(monthlyCtx, {
                type: 'bar',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'Mei', 'Jun', 'Jul', 'Agu', 'Sep', 'Okt', 'Nov', 'Des'],
                    datasets: [{
                        label: 'Pendapatan', data: monthlyRevenue,
                        backgroundColor: 'rgba(13, 71, 161, 0.7)',
                    }, {
                        label: 'Tamu Check-Out', data: monthlyGuests,
                        type: 'line', yAxisID: 'y1', borderColor: '#b71c1c', backgroundColor: '#b71c1c'
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true }, y1: { position: 'right', grid: { drawOnChartArea: false } } } }
            });
            
            const roomCtx = document.getElementById('roomStatusChart').getContext('2d');
            const rooms = JSON.parse(localStorage.getItem('hotel_rooms') || '[]');
            const statusCounts = rooms.reduce((acc, room) => {
                acc[room.status] = (acc[room.status] || 0) + 1;
                return acc;
            }, {});

            if(roomStatusChart) roomStatusChart.destroy();
            roomStatusChart = new Chart(roomCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Tersedia', 'Terisi', 'Pemeliharaan', 'Dipesan'],
                    datasets: [{
                        data: [ statusCounts.available || 0, statusCounts.occupied || 0, statusCounts.maintenance || 0, statusCounts.reserved || 0 ],
                        backgroundColor: ['#28a745', '#dc3545', '#ffc107', '#17a2b8']
                    }]
                },
                 options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } } }
            });
        }
        
        function generateReport() {
            const reportType = document.getElementById('reportType').value;
            const startDateStr = document.getElementById('reportStartDate').value;
            const endDateStr = document.getElementById('reportEndDate').value;

            if (!startDateStr || !endDateStr) {
                showNotification('Error', 'Silakan pilih periode mulai dan akhir.', 'error');
                return;
            }

            const startDate = new Date(startDateStr);
            startDate.setHours(0, 0, 0, 0);
            const endDate = new Date(endDateStr);
            endDate.setHours(23, 59, 59, 999);

            if (startDate > endDate) {
                showNotification('Error', 'Tanggal mulai tidak boleh melebihi tanggal akhir.', 'error');
                return;
            }

            const reservations = JSON.parse(localStorage.getItem('hotel_reservations') || '[]');
            const guests = JSON.parse(localStorage.getItem('hotel_guests') || '[]');
            const rooms = JSON.parse(localStorage.getItem('hotel_rooms') || '[]');
            
            let data = {};
            let tableHeaders = [];
            let tableRows = [];
            let chartLabel = '';

            const dateMap = new Map();
            for (let d = new Date(startDate); d <= endDate; d.setDate(d.getDate() + 1)) {
                dateMap.set(d.toISOString().split('T')[0], 0);
            }

            switch(reportType) {
                case 'revenue':
                    chartLabel = 'Total Pendapatan';
                    reservations.filter(r => r.status === 'checked-out' && new Date(r.actualCheckout) >= startDate && new Date(r.actualCheckout) <= endDate)
                        .forEach(r => {
                            const date = new Date(r.actualCheckout).toISOString().split('T')[0];
                            if(dateMap.has(date)) {
                                dateMap.set(date, dateMap.get(date) + r.totalAmount);
                            }
                        });
                    tableHeaders = ['Tanggal', 'Pendapatan'];
                    dateMap.forEach((value, key) => tableRows.push([formatDate(key), formatCurrency(value)]));
                    break;
                
                case 'occupancy':
                    chartLabel = 'Tingkat Okupansi (%)';
                    const totalRooms = rooms.length;
                    if (totalRooms === 0) {
                        showNotification('Warning', 'Tidak ada kamar terdaftar. Okupansi selalu 0%.', 'warning');
                        return;
                    }
                    dateMap.forEach((value, key) => {
                        const currentDate = new Date(key);
                        const occupiedCount = reservations.filter(r => {
                            const checkin = new Date(r.checkinDate);
                            checkin.setHours(0,0,0,0);
                            const checkout = new Date(r.checkoutDate);
                            checkout.setHours(0,0,0,0);
                            return ['checked-in', 'confirmed', 'reserved'].includes(r.status) && currentDate >= checkin && currentDate < checkout;
                        }).length;
                        const occupancyRate = (occupiedCount / totalRooms) * 100;
                        dateMap.set(key, occupancyRate.toFixed(2));
                    });
                    tableHeaders = ['Tanggal', 'Kamar Terisi', 'Tingkat Okupansi (%)'];
                    dateMap.forEach((value, key) => tableRows.push([formatDate(key), Math.round(value/100 * totalRooms), `${value}%` ]));
                    break;

                case 'guests':
                    chartLabel = 'Tamu Baru';
                    guests.filter(g => new Date(g.createdAt) >= startDate && new Date(g.createdAt) <= endDate)
                        .forEach(g => {
                            const date = new Date(g.createdAt).toISOString().split('T')[0];
                            if (dateMap.has(date)) {
                                dateMap.set(date, dateMap.get(date) + 1);
                            }
                        });
                    tableHeaders = ['Tanggal Registrasi', 'Jumlah Tamu Baru'];
                    dateMap.forEach((value, key) => tableRows.push([formatDate(key), value]));
                    break;

                case 'reservations':
                    chartLabel = 'Reservasi Baru';
                    reservations.filter(r => new Date(r.createdAt) >= startDate && new Date(r.createdAt) <= endDate)
                        .forEach(r => {
                            const date = new Date(r.createdAt).toISOString().split('T')[0];
                            if(dateMap.has(date)) {
                                dateMap.set(date, dateMap.get(date) + 1);
                            }
                        });
                    tableHeaders = ['Tanggal Reservasi', 'Jumlah Reservasi Baru'];
                    dateMap.forEach((value, key) => tableRows.push([formatDate(key), value]));
                    break;
            }

            const chartData = {
                labels: Array.from(dateMap.keys()).map(d => formatDate(d)),
                datasets: [{
                    label: chartLabel,
                    data: Array.from(dateMap.values()),
                    borderColor: 'var(--hotel-primary)',
                    backgroundColor: 'rgba(13, 71, 161, 0.2)',
                    fill: true,
                    tension: 0.1
                }]
            };

            updateReportView(chartData, tableHeaders, tableRows);
            showNotification('Sukses', `Laporan ${reportType} berhasil dibuat.`, 'success');
        }

        function updateReportView(chartData, tableHeaders, tableRows) {
            const ctx = document.getElementById('reportChart').getContext('2d');
            if (reportChart) {
                reportChart.destroy();
            }
            reportChart = new Chart(ctx, { type: 'line', data: chartData, options: { responsive: true, maintainAspectRatio: false } });

            const header = document.getElementById('reportTableHeader');
            const body = document.getElementById('reportTableBody');
            header.innerHTML = `<tr>${tableHeaders.map(h => `<th>${h}</th>`).join('')}</tr>`;
            body.innerHTML = tableRows.map(row => `<tr>${row.map(cell => `<td>${cell}</td>`).join('')}</tr>`).join('');
            if (tableRows.length === 0) {
                body.innerHTML = `<tr><td colspan="${tableHeaders.length}" class="text-center">Tidak ada data untuk periode yang dipilih.</td></tr>`;
            }
        }
        
        function handleGuestSearch(e) {
            const searchTerm = e.target.value.toLowerCase();
            const isEdit = e.target.id === 'editReservationGuestName';
            const resultsContainer = document.getElementById(isEdit ? 'editGuestSearchResults' : 'guestSearchResults');
            const hiddenInput = document.getElementById(isEdit ? 'editReservationGuestId' : 'reservationGuestId');

            resultsContainer.innerHTML = '';
            if (searchTerm.length < 1) {
                hiddenInput.value = '';
                return;
            }

            const guests = JSON.parse(localStorage.getItem('hotel_guests') || '[]');
            const filteredGuests = guests.filter(guest => 
                `${guest.firstName} ${guest.lastName}`.toLowerCase().includes(searchTerm)
            ).slice(0, 5);

            filteredGuests.forEach(guest => {
                const item = document.createElement('a');
                item.href = '#';
                item.className = 'list-group-item list-group-item-action';
                item.textContent = `${guest.firstName} ${guest.lastName} (${guest.email})`;
                item.onclick = (event) => {
                    event.preventDefault();
                    selectGuest(guest, e.target.id);
                };
                resultsContainer.appendChild(item);
            });
        }

        function selectGuest(guest, inputId) {
            const isEdit = inputId === 'editReservationGuestName';
            const nameInput = document.getElementById(inputId);
            const idInput = document.getElementById(isEdit ? 'editReservationGuestId' : 'reservationGuestId');
            const resultsContainer = document.getElementById(isEdit ? 'editGuestSearchResults' : 'guestSearchResults');

            nameInput.value = `${guest.firstName} ${guest.lastName}`;
            idInput.value = guest.id;
            resultsContainer.innerHTML = '';
        }
        
        // --- Helper Functions ---
        const generateId = (prefix) => `${prefix}-${Date.now()}-${Math.floor(Math.random() * 1000)}`;
        const formatCurrency = (amount) => new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 }).format(amount || 0);
        const formatDate = (dateString) => dateString ? new Date(dateString).toLocaleDateString('id-ID', { year: 'numeric', month: 'short', day: 'numeric' }) : '-';
        const formatDateTime = (dateString) => dateString ? new Date(dateString).toLocaleString('id-ID') : '-';
        
        const getStatusText = (status) => ({ available: 'Tersedia', occupied: 'Terisi', maintenance: 'Pemeliharaan', reserved: 'Dipesan', confirmed: 'Dikonfirmasi', pending: 'Menunggu', cancelled: 'Dibatalkan', 'checked-in': 'Check-In', 'checked-out': 'Check-Out' }[status] || status);
        const getStatusClass = (status) => ({ available: 'bg-success', occupied: 'bg-danger', maintenance: 'bg-warning', reserved: 'bg-info', confirmed: 'bg-success', pending: 'bg-warning', cancelled: 'bg-danger', 'checked-in': 'bg-primary', 'checked-out': 'bg-secondary' }[status] || 'bg-dark');
        const getActivityText = (status) => ({ confirmed: 'Reservasi Dikonfirmasi', pending: 'Reservasi Menunggu', cancelled: 'Reservasi Dibatalkan', 'checked-in': 'Tamu Check-In', 'checked-out': 'Tamu Check-Out' }[status] || 'Aktivitas');
    </script>
</body>
</html>
