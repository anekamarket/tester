<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SISMAT - Sistem Manajemen Surat</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root {
            --primary-color: #0d47a1;
            --secondary-color: #00695c;
            --accent-color: #ff8f00;
            --light-blue: #e3f2fd;
            --dark-blue: #082e5c;
            --gradient-primary: linear-gradient(135deg, var(--primary-color), var(--dark-blue));
            --gradient-secondary: linear-gradient(135deg, var(--secondary-color), #004d40);
            --gradient-accent: linear-gradient(135deg, var(--accent-color), #e65100);
            --shadow-sm: 0 2px 8px rgba(0,0,0,0.08);
            --shadow-md: 0 4px 16px rgba(0,0,0,0.12);
            --shadow-lg: 0 8px 28px rgba(0,0,0,0.15);
            --login-gradient: linear-gradient(135deg, #0d47a1, #00695c, #ff8f00);
        }
        
        body {
            background: linear-gradient(135deg, #f5f9ff 0%, #e8f5e9 100%);
            font-family: 'Poppins', 'Segoe UI', sans-serif;
            min-height: 100vh;
            padding: 10px 0;
            overflow-x: hidden;
        }
        
        .app-container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            box-shadow: var(--shadow-lg);
            border-radius: 12px;
            overflow: hidden;
            position: relative;
            z-index: 10;
        }
        
        .app-header {
            background: var(--gradient-primary);
            color: white;
            padding: 20px 15px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .app-header::before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.15) 0%, transparent 70%);
            pointer-events: none;
        }
        
        .app-logo {
            font-size: 2.5rem;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }
        
        .app-title {
            font-size: 1.8rem;
            font-weight: 800;
            margin: 0;
            position: relative;
            z-index: 1;
            text-shadow: 1px 1px 4px rgba(0,0,0,0.3);
        }
        
        .app-subtitle {
            font-size: 1rem;
            opacity: 0.95;
            position: relative;
            z-index: 1;
            font-weight: 300;
            letter-spacing: 0.5px;
            margin-bottom: 5px;
        }
        
        .nav-pills .nav-link {
            border-radius: 8px;
            margin-bottom: 8px;
            padding: 12px 15px;
            font-weight: 500;
            color: #444;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            font-size: 0.9rem;
        }
        
        .nav-pills .nav-link:hover {
            background-color: #f0f7ff;
            transform: translateX(3px);
        }
        
        .nav-pills .nav-link.active {
            background: var(--gradient-primary);
            font-weight: 600;
            box-shadow: var(--shadow-md);
            transform: translateX(3px);
            color: white;
        }
        
        .section-title {
            border-left: 4px solid var(--primary-color);
            padding-left: 12px;
            margin: 20px 0;
            font-weight: 700;
            color: var(--dark-blue);
            font-size: 1.4rem;
            position: relative;
        }
        
        .section-title::after {
            content: "";
            position: absolute;
            bottom: -5px;
            left: 12px;
            width: 40px;
            height: 2px;
            background: var(--gradient-primary);
            border-radius: 2px;
        }
        
        .btn-primary {
            background: var(--gradient-primary);
            border: none;
            padding: 10px 20px;
            font-weight: 600;
            box-shadow: var(--shadow-md);
            border-radius: 8px;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .btn-success {
            background: var(--gradient-secondary);
            border: none;
            padding: 10px 20px;
            font-weight: 600;
            box-shadow: var(--shadow-md);
            border-radius: 8px;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .btn-warning {
            background: var(--gradient-accent);
            border: none;
            padding: 10px 20px;
            font-weight: 600;
            box-shadow: var(--shadow-md);
            border-radius: 8px;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .form-label {
            font-weight: 600;
            color: #444;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            font-size: 0.9rem;
        }
        
        .form-label i {
            margin-right: 6px;
            color: var(--primary-color);
        }
        
        .form-control, .form-select {
            border-radius: 8px;
            padding: 12px 15px;
            border: 1px solid #ddd;
            transition: all 0.3s;
            box-shadow: var(--shadow-sm);
            font-size: 0.9rem;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(13, 71, 161, 0.2);
            transform: translateY(-2px);
        }
        
        .copyright {
            text-align: center;
            padding: 20px;
            background-color: var(--light-blue);
            color: var(--dark-blue);
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .data-table {
            font-size: 0.85rem;
            border-collapse: separate;
            border-spacing: 0;
            box-shadow: var(--shadow-sm);
            border-radius: 8px;
            overflow: hidden;
        }
        
        .data-table th {
            background: var(--gradient-primary);
            color: white;
            font-weight: 600;
            padding: 12px 10px;
            text-align: center;
            position: relative;
            font-size: 0.85rem;
        }
        
        .data-table th::after {
            content: "";
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 1px;
            background: rgba(255,255,255,0.3);
        }
        
        .data-table td {
            padding: 10px 8px;
            vertical-align: middle;
            border-bottom: 1px solid #eee;
            font-size: 0.85rem;
        }
        
        .data-table tr:nth-child(even) {
            background-color: #f9fbff;
        }
        
        .data-table tr:hover {
            background-color: #edf5ff;
        }
        
        .feature-icon {
            font-size: 1.1rem;
            margin-right: 8px;
            width: 24px;
            text-align: center;
        }
        
        .card {
            border-radius: 10px;
            border: none;
            box-shadow: var(--shadow-md);
            transition: all 0.3s ease;
            overflow: hidden;
            margin-bottom: 15px;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }
        
        .card-header {
            border-radius: 10px 10px 0 0 !important;
            font-weight: 600;
            padding: 15px 20px;
            background: var(--gradient-primary);
            color: white;
            font-size: 0.95rem;
        }
        
        .stats-box {
            text-align: center;
            padding: 20px 15px;
            border-radius: 10px;
            background: white;
            box-shadow: var(--shadow-md);
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
            margin-bottom: 15px;
        }
        
        .stats-box::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--gradient-primary);
            border-radius: 2px;
        }
        
        .stats-box:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }
        
        .stats-number {
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--primary-color);
            margin: 10px 0;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }
        
        .stats-label {
            font-size: 0.9rem;
            color: #666;
            font-weight: 500;
        }
        
        .notification-toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1050;
            min-width: 280px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            max-width: calc(100vw - 40px);
        }
        
        .input-error {
            border-color: #dc3545;
            box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.2);
        }
        
        .error-message {
            color: #dc3545;
            font-size: 0.8rem;
            margin-top: 5px;
            display: none;
            font-weight: 500;
        }
        
        .watermark {
            position: absolute;
            bottom: 10px;
            right: 15px;
            opacity: 0.8;
            font-size: 0.8rem;
            color: white;
            font-weight: 300;
        }
        
        .control-panel {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            box-shadow: var(--shadow-sm);
        }
        
        .control-title {
            font-size: 1rem;
            color: var(--primary-color);
            font-weight: 600;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--light-blue);
        }
        
        .floating-action-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--gradient-primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .floating-action-btn:hover {
            transform: scale(1.1) rotate(90deg);
        }
        
        .filter-section {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-sm);
        }
        
        .badge-custom {
            background: var(--gradient-primary);
            color: white;
            padding: 6px 12px;
            border-radius: 16px;
            font-weight: 600;
            font-size: 0.8rem;
        }
        
        .mobile-menu-btn {
            display: none;
            position: fixed;
            top: 15px;
            left: 15px;
            z-index: 1050;
            background: var(--gradient-primary);
            color: white;
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            box-shadow: var(--shadow-lg);
        }
        
        .sidebar-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1040;
        }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .animate-fadeIn {
            animation: fadeIn 0.5s ease forwards;
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 8px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 8px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--dark-blue);
        }
        
        /* Responsive styles */
        @media (max-width: 991.98px) {
            .col-md-3.col-lg-2 {
                position: fixed;
                left: -300px;
                top: 0;
                bottom: 0;
                z-index: 1050;
                width: 280px;
                transition: left 0.3s ease;
                overflow-y: auto;
                padding-top: 60px;
            }
            
            .col-md-3.col-lg-2.mobile-show {
                left: 0;
            }
            
            .col-md-9.col-lg-10 {
                width: 100%;
                flex: 0 0 100%;
                max-width: 100%;
            }
            
            .mobile-menu-btn {
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            .sidebar-overlay.mobile-show {
                display: block;
            }
        }
        
        /* Print Styles - IMPROVED FOR LANDSCAPE */
        @media print {
            @page {
                size: landscape;
                margin: 0.5cm;
            }
            
            body * {
                visibility: hidden;
            }
            
            .app-container, .app-container * {
                visibility: visible;
            }
            
            .app-container {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                box-shadow: none;
            }
            
            .nav-pills, .mobile-menu-btn, .sidebar-overlay, .floating-action-btn,
            .btn-group, .filter-section, .toast {
                display: none !important;
            }
            
            .col-md-3.col-lg-2.p-4.bg-light {
                display: none !important;
            }
            
            .col-md-9.col-lg-10.p-5 {
                width: 100%;
                flex: 0 0 100%;
                max-width: 100%;
                padding: 0 !important;
            }
            
            .copyright {
                display: none;
            }
            
            .data-table {
                font-size: 10px;
                width: 100% !important;
            }
            
            .data-table th, .data-table td {
                padding: 4px 2px;
            }
            
            /* Sembunyikan kolom aksi dan link Google Drive saat mencetak */
            .data-table th:nth-last-child(-n+2),
            .data-table td:nth-last-child(-n+2) {
                display: none !important;
            }
            
            /* Judul untuk laporan cetak */
            .print-header {
                display: block !important;
                text-align: center;
                margin-bottom: 15px;
            }
            
            .print-title {
                font-size: 18px;
                font-weight: bold;
                margin-bottom: 5px;
            }
            
            .print-subtitle {
                font-size: 14px;
                margin-bottom: 10px;
            }
            
            .print-date {
                font-size: 12px;
                text-align: right;
                margin-bottom: 10px;
            }
        }

        /* WhatsApp link style */
        .whatsapp-link {
            color: #25D366;
            text-decoration: none;
        }
        
        .whatsapp-link:hover {
            text-decoration: underline;
        }
        
        /* View Link Button */
        .btn-view {
            background: linear-gradient(135deg, #17a2b8, #138496);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.8rem;
        }
        
        .btn-view:hover {
            background: linear-gradient(135deg, #138496, #117a8b);
            color: white;
        }
        
        /* Undo Button */
        .btn-undo {
            background: linear-gradient(135deg, #6c757d, #5a6268);
            color: white;
            border: none;
        }
        
        .btn-undo:hover {
            background: linear-gradient(135deg, #5a6268, #4e555b);
            color: white;
        }
        
        /* WhatsApp number link in table */
        .whatsapp-number {
            color: #25D366;
            cursor: pointer;
            text-decoration: underline;
        }
        
        /* Welcome Modal Styles */
        .welcome-modal .modal-content {
            border-radius: 15px;
            overflow: hidden;
            border: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .welcome-header {
            background: var(--gradient-primary);
            color: white;
            text-align: center;
            padding: 25px;
        }
        
        .welcome-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            color: white;
        }
        
        .welcome-body {
            padding: 25px;
            text-align: center;
        }
        
        .welcome-footer {
            background: #f8f9fa;
            padding: 15px;
            text-align: center;
            border-top: 1px solid #eee;
        }
        
        .countdown-timer {
            font-size: 0.9rem;
            color: #6c757d;
            margin-top: 10px;
        }
        
        /* Button untuk cetak per data */
        .btn-print-individual {
            background: linear-gradient(135deg, #6f42c1, #5a2d95);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.8rem;
        }
        
        .btn-print-individual:hover {
            background: linear-gradient(135deg, #5a2d95, #4a2479);
            color: white;
        }
        
        /* Developer Info Styles */
        .developer-info {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            box-shadow: var(--shadow-sm);
        }
        
        .developer-info h6 {
            color: var(--primary-color);
            font-weight: 600;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid #ddd;
        }
        
        .developer-contact p {
            margin-bottom: 8px;
            font-size: 0.85rem;
        }
        
        .developer-contact a {
            color: var(--primary-color);
            text-decoration: none;
            transition: all 0.3s;
        }
        
        .developer-contact a:hover {
            color: var(--dark-blue);
            text-decoration: underline;
        }
        
        /* Loading spinner */
        .spinner-border-sm {
            width: 1rem;
            height: 1rem;
        }

        /* Login Modal Styles */
        .login-modal .modal-content {
            border-radius: 15px;
            overflow: hidden;
            border: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .login-header {
            background: var(--login-gradient);
            color: white;
            text-align: center;
            padding: 25px 20px;
            position: relative;
        }

        .login-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            color: white;
        }

        .login-title {
            font-size: 1.8rem;
            font-weight: 700;
            margin: 0;
        }

        .login-subtitle {
            font-size: 1rem;
            opacity: 0.9;
            margin: 5px 0 0;
        }

        .login-body {
            padding: 25px;
            position: relative;
            z-index: 1;
        }

        .login-form-group {
            margin-bottom: 20px;
        }

        .login-form-label {
            font-weight: 600;
            color: var(--dark-blue);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
        }

        .login-form-label i {
            margin-right: 10px;
            color: var(--dark-blue);
        }

        .login-form-control {
            border-radius: 8px;
            padding: 12px 15px;
            border: 2px solid #ddd;
            transition: all 0.3s;
        }

        .login-form-control:focus {
            border-color: var(--dark-blue);
            box-shadow: 0 0 0 3px rgba(13, 71, 161, 0.2);
        }

        .login-input-group-text {
            background: var(--light-blue);
            border: 2px solid #ddd;
            border-left: none;
        }

        .btn-login {
            background: var(--gradient-secondary);
            color: white;
            border: none;
            padding: 12px;
            font-weight: 600;
            border-radius: 8px;
            width: 100%;
            transition: all 0.3s;
            margin-top: 10px;
        }

        .btn-login:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 105, 92, 0.4);
        }

        .btn-login:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .login-security-notice {
            text-align: center;
            margin-top: 20px;
            font-size: 0.85rem;
            color: #666;
        }

        .login-attempts-count {
            text-align: center;
            font-size: 0.9rem;
            color: #ff8f00;
            font-weight: 500;
            margin-top: 5px;
        }

        .login-blocked-message {
            text-align: center;
            background: rgba(220, 53, 69, 0.1);
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            color: #dc3545;
            font-weight: 500;
        }

        .login-countdown {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--dark-blue);
        }

        .login-developer-info {
            background: var(--light-blue);
            border-radius: 10px;
            padding: 20px;
            margin-top: 25px;
            text-align: center;
        }

        .login-developer-logo {
            max-width: 180px;
            margin-bottom: 15px;
            border-radius: 8px;
        }

        .login-developer-contact a {
            color: var(--dark-blue);
            text-decoration: none;
            transition: all 0.3s;
            display: inline-block;
            margin: 5px 0;
        }

        .login-developer-contact a:hover {
            color: var(--primary-color);
            text-decoration: underline;
            transform: translateY(-2px);
        }

        .login-copyright {
            text-align: center;
            margin-top: 20px;
            color: #666;
            font-size: 0.9rem;
            opacity: 0.9;
        }

        /* Animations */
        @keyframes login-shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-10px); }
            20%, 40%, 60%, 80% { transform: translateX(10px); }
        }

        .login-shake {
            animation: login-shake 0.6s cubic-bezier(.36,.07,.19,.97) both;
        }

        /* Login particle background */
        #login-particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1040; /* Higher than modal backdrop */
            display: none;
        }

        /* Link Google Drive dalam tabel */
        .drive-link {
            color: #0d47a1;
            text-decoration: none;
            cursor: pointer;
        }

        .drive-link:hover {
            text-decoration: underline;
        }

        /* Modal untuk menambah link */
        .link-modal .modal-dialog {
            max-width: 600px;
        }
        
        /* App content when not authenticated */
        .app-content-unauthenticated {
            display: none;
        }

        /* Search box for dropdown */
        .dropdown-search-container {
            position: relative;
        }

        .dropdown-search {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 8px;
            display: none;
        }

        .dropdown-search input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        /* Kode Validasi Styles */
        .kode-validasi-container {
            display: flex;
            align-items: center;
        }
        
        .kode-validasi-input {
            flex: 1;
            margin-right: 10px;
        }
        
        .btn-generate-kode {
            white-space: nowrap;
        }

        /* Auto-fill button styles */
        .btn-auto-fill {
            background: linear-gradient(135deg, #6c757d, #5a6268);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 0.85rem;
            margin-top: 8px;
        }
        
        .btn-auto-fill:hover {
            background: linear-gradient(135deg, #5a6268, #4e555b);
            color: white;
        }

        .login-hint {
            font-size: 0.85rem;
            color: #0d6efd;
            margin-top: 5px;
            text-align: center;
            background-color: #f8f9fa;
            padding: 8px;
            border-radius: 4px;
            border-left: 3px solid #0d6efd;
        }

        /* Status badge styles */
        .status-badge {
            padding: 5px 10px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .status-masuk {
            background-color: #d4edda;
            color: #155724;
        }
        
        .status-keluar {
            background-color: #d1ecf1;
            color: #0c5460;
        }
        
        .status-pending {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .status-selesai {
            background-color: #d4edda;
            color: #155724;
        }

        /* Jenis surat container */
        .jenis-surat-container {
            display: flex;
            gap: 10px;
        }

        .jenis-surat-container select,
        .jenis-surat-container input {
            flex: 1;
        }

        /* Prioritas indicator */
        .prioritas-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 5px;
        }
        
        .prioritas-tinggi {
            background-color: #dc3545;
        }
        
        .prioritas-sedang {
            background-color: #ffc107;
        }
        
        .prioritas-rendah {
            background-color: #28a745;
        }
        
        /* Kategori Badge Styles */
        .badge-kategori {
            font-size: 0.75rem;
            padding: 5px 10px;
            border-radius: 12px;
        }
        
        .kategori-pemerintah {
            background-color: #e3f2fd;
            color: #0d47a1;
        }
        
        .kategori-perusahaan {
            background-color: #e8f5e9;
            color: #2e7d32;
        }
        
        .kategori-lembaga {
            background-color: #fbe9e7;
            color: #d84315;
        }
        
        .kategori-opd {
            background-color: #fff3e0;
            color: #ef6c00;
        }
        
        .kategori-upt {
            background-color: #e8eaf6;
            color: #283593;
        }
        
        .kategori-perorangan {
            background-color: #f3e5f5;
            color: #7b1fa2;
        }
        
        .kategori-lainnya {
            background-color: #e0e0e0;
            color: #424242;
        }
    </style>
</head>
<body>
     <!-- Login Modal -->
    <div class="modal fade login-modal" id="loginModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="login-header">
                    <div class="login-icon">
                        <i class="fas fa-lock"></i>
                    </div>
                    <h5 class="login-title">SISMAT</h5>
                    <p class="login-subtitle">Sistem Manajemen Surat</p>
                </div>
                <div class="login-body">
                    <form id="loginForm">
                        <div class="login-form-group">
                            <label class="login-form-label" for="securityCode">
                                <i class="fas fa-key"></i> Kode Keamanan
                            </label>
                            <div class="input-group">
                                <input type="password" class="form-control login-form-control" id="securityCode" placeholder="Masukkan kode keamanan" required>
                                <button class="btn btn-outline-secondary toggle-password" type="button">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>
                        
                        <button type="submit" class="btn btn-login" id="loginButton">
                            <span class="login-button-text">Masuk ke Aplikasi</span>
                            <span class="spinner-border spinner-border-sm d-none" id="loginSpinner" role="status" aria-hidden="true"></span>
                        </button>
                    </form>
                    
                    <div class="login-attempts-count" id="attemptsCount"></div>
                    
                    <div class="login-blocked-message d-none" id="blockedMessage">
                        <p>Terlalu banyak percobaan login gagal. Silakan coba lagi dalam <span id="countdown" class="login-countdown">30</span> detik.</p>
                    </div>
                    
                    <div class="login-hint">
                        <p>Kode keamanan default: <strong>1234</strong></p>
                    </div>
                    
                    <div class="login-security-notice">
                        <p><i class="fas fa-shield-alt me-1"></i> Data Anda terlindungi dengan aman</p>
                    </div>
                    
                    <div class="login-developer-info">
                        <h6>Developer Information</h6>
                        <div class="login-developer-contact">
                            <p><i class="fas fa-user me-2"></i> Lentera Karya Situbondo</p>
                            <p><i class="fas fa-envelope me-2"></i> <a href="mailto:admin@anekamarket.my.id">admin@anekamarket.my.id</a></p>
                            <p><i class="fab fa-whatsapp me-2"></i> <a href="https://wa.me/6285156332074" class="whatsapp-link">+62 851-5633-2074</a></p>
                        </div>
                    </div>
                    
                    <div class="login-copyright">
                        <p>&copy; 2024 SISMAT v1.0.0 - All rights reserved</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Particle Background for Login -->
    <canvas id="login-particles"></canvas>
    
    <!-- Main App Container (Initially Hidden) -->
    <div class="app-container app-content-unauthenticated">
        <!-- Header -->
        <div class="app-header">
            <div class="app-logo">
                <i class="fas fa-mail-bulk"></i>
            </div>
            <h1 class="app-title">SISMAT</h1>
            <p class="app-subtitle">Sistem Manajemen Surat</p>
            <div class="watermark">v1.0.0</div>
        </div>
        
        <!-- Mobile Menu Button -->
        <button class="mobile-menu-btn" id="mobileMenuBtn">
            <i class="fas fa-bars"></i>
        </button>
        
        <!-- Sidebar Overlay -->
        <div class="sidebar-overlay" id="sidebarOverlay"></div>
        
        <div class="row g-0">
            <!-- Sidebar -->
            <div class="col-md-3 col-lg-2 p-4 bg-light" id="sidebar">
                <ul class="nav nav-pills flex-column">
                    <li class="nav-item">
                        <a class="nav-link active" href="#" data-section="dashboard">
                            <span class="feature-icon"><i class="fas fa-home"></i></span>
                            Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-section="surat-masuk">
                            <span class="feature-icon"><i class="fas fa-envelope"></i></span>
                            Surat Masuk
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-section="surat-keluar">
                            <span class="feature-icon"><i class="fas fa-paper-plane"></i></span>
                            Surat Keluar
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-section="arsip-surat">
                            <span class="feature-icon"><i class="fas fa-archive"></i></span>
                            Arsip Surat
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-section="laporan">
                            <span class="feature-icon"><i class="fas fa-chart-bar"></i></span>
                            Laporan
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-section="pengaturan">
                            <span class="feature-icon"><i class="fas fa-cog"></i></span>
                            Pengaturan
                        </a>
                    </li>
                    <li class="nav-item mt-4">
                        <a class="nav-link text-danger" href="#" id="logoutButton">
                            <span class="feature-icon"><i class="fas fa-sign-out-alt"></i></span>
                            Keluar
                        </a>
                    </li>
                </ul>
                
                <!-- Developer Info -->
                <div class="developer-info">
                    <h6>Developer Information</h6>
                    <div class="developer-contact">
                        <p><i class="fas fa-user me-2"></i> Lentera Karya Situbondo</p>
                        <p><i class="fas fa-envelope me-2"></i> <a href="mailto:admin@anekamarket.my.id">admin@anekamarket.my.id</a></p>
                        <p><i class="fab fa-whatsapp me-2"></i> <a href="https://wa.me/6285156332074" class="whatsapp-link">+62 851-5633-2074</a></p>
                    </div>
                </div>
            </div>
            
            <!-- Main Content -->
            <div class="col-md-9 col-lg-10 p-5">
                <!-- Dashboard Section -->
                <div class="content-section" id="dashboard-section">
                    <h3 class="section-title">Dashboard</h3>
                    
                    <!-- Stats Overview -->
                    <div class="row">
                        <div class="col-md-3">
                            <div class="stats-box">
                                <div class="stats-icon text-primary">
                                    <i class="fas fa-envelope fa-2x"></i>
                                </div>
                                <div class="stats-number" id="total-surat-masuk">0</div>
                                <div class="stats-label">Surat Masuk</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stats-box">
                                <div class="stats-icon text-success">
                                    <i class="fas fa-paper-plane fa-2x"></i>
                                </div>
                                <div class="stats-number" id="total-surat-keluar">0</div>
                                <div class="stats-label">Surat Keluar</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stats-box">
                                <div class="stats-icon text-warning">
                                    <i class="fas fa-archive fa-2x"></i>
                                </div>
                                <div class="stats-number" id="total-arsip">0</div>
                                <div class="stats-label">Arsip Surat</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stats-box">
                                <div class="stats-icon text-info">
                                    <i class="fas fa-chart-line fa-2x"></i>
                                </div>
                                <div class="stats-number" id="total-keseluruhan">0</div>
                                <div class="stats-label">Total Keseluruhan</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Charts and Recent Activities -->
                    <div class="row mt-4">
                        <div class="col-md-8">
                            <div class="card">
                                <div class="card-header">
                                    <i class="fas fa-chart-bar me-2"></i> Statistik Surat Bulanan
                                </div>
                                <div class="card-body">
                                    <canvas id="suratChart" height="250"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-header">
                                    <i class="fas fa-history me-2"></i> Aktivitas Terbaru
                                </div>
                                <div class="card-body p-0">
                                    <ul class="list-group list-group-flush" id="recent-activities">
                                        <li class="list-group-item">
                                            <div class="d-flex justify-content-between">
                                                <span>Surat masuk baru</span>
                                                <small class="text-muted">2 jam lalu</small>
                                            </div>
                                        </li>
                                        <li class="list-group-item">
                                            <div class="d-flex justify-content-between">
                                                <span>Surat keluar ditambahkan</span>
                                                <small class="text-muted">5 jam lalu</small>
                                            </div>
                                        </li>
                                        <li class="list-group-item">
                                            <div class="d-flex justify-content-between">
                                                <span>Arsip diperbarui</span>
                                                <small class="text-muted">1 hari lalu</small>
                                            </div>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Surat Masuk Section -->
                <div class="content-section d-none" id="surat-masuk-section">
                    <h3 class="section-title">Surat Masuk</h3>
                    
                    <!-- Filter and Controls -->
                    <div class="filter-section">
                        <div class="row">
                            <div class="col-md-3">
                                <div class="mb-3">
                                    <label class="form-label"><i class="fas fa-filter"></i> Filter Tanggal</label>
                                    <input type="text" class="form-control datepicker" id="filterTanggalMasuk" placeholder="Pilih tanggal">
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="mb-3">
                                    <label class="form-label"><i class="fas fa-search"></i> Pencarian</label>
                                    <input type="text" class="form-control" id="searchSuratMasuk" placeholder="Cari surat masuk...">
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="mb-3">
                                    <label class="form-label"><i class="fas fa-sort"></i> Urutkan</label>
                                    <select class="form-select" id="sortSuratMasuk">
                                        <option value="terbaru">Terbaru</option>
                                        <option value="terlama">Terlama</option>
                                        <option value="a-z">A-Z (Perihal)</option>
                                        <option value="z-a">Z-A (Perihal)</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="mb-3">
                                    <label class="form-label"><i class="fas fa-download"></i> Ekspor Data</label>
                                    <div class="d-grid gap-2">
                                        <button class="btn btn-success" id="exportExcelMasuk">
                                            <i class="fas fa-file-excel me-2"></i> Excel
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Table -->
                    <div class="table-responsive">
                        <table class="table table-hover data-table" id="tableSuratMasuk">
                            <thead>
                                <tr>
                                    <th>No</th>
                                    <th>Tanggal</th>
                                    <th>No. Surat</th>
                                    <th>Asal</th>
                                    <th>Perihal</th>
                                    <th>Kategori</th>
                                    <th>Status</th>
                                    <th>Link</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td colspan="9" class="text-center">Tidak ada data surat masuk</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Add New Button -->
                    <div class="d-grid gap-2 mt-3">
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#tambahSuratMasukModal">
                            <i class="fas fa-plus-circle me-2"></i> Tambah Surat Masuk Baru
                        </button>
                    </div>
                </div>
                
                <!-- Surat Keluar Section -->
                <div class="content-section d-none" id="surat-keluar-section">
                    <h3 class="section-title">Surat Keluar</h3>
                    
                    <!-- Filter and Controls -->
                    <div class="filter-section">
                        <div class="row">
                            <div class="col-md-3">
                                <div class="mb-3">
                                    <label class="form-label"><i class="fas fa-filter"></i> Filter Tanggal</label>
                                    <input type="text" class="form-control datepicker" id="filterTanggalKeluar" placeholder="Pilih tanggal">
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="mb-3">
                                    <label class="form-label"><i class="fas fa-search"></i> Pencarian</label>
                                    <input type="text" class="form-control" id="searchSuratKeluar" placeholder="Cari surat keluar...">
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="mb-3">
                                    <label class="form-label"><i class="fas fa-sort"></i> Urutkan</label>
                                    <select class="form-select" id="sortSuratKeluar">
                                        <option value="terbaru">Terbaru</option>
                                        <option value="terlama">Terlama</option>
                                        <option value="a-z">A-Z (Perihal)</option>
                                        <option value="z-a">Z-A (Perihal)</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="mb-3">
                                    <label class="form-label"><i class="fas fa-download"></i> Ekspor Data</label>
                                    <div class="d-grid gap-2">
                                        <button class="btn btn-success" id="exportExcelKeluar">
                                            <i class="fas fa-file-excel me-2"></i> Excel
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Table -->
                    <div class="table-responsive">
                        <table class="table table-hover data-table" id="tableSuratKeluar">
                            <thead>
                                <tr>
                                    <th>No</th>
                                    <th>Tanggal</th>
                                    <th>No. Surat</th>
                                    <th>Tujuan</th>
                                    <th>Perihal</th>
                                    <th>Kategori</th>
                                    <th>Status</th>
                                    <th>Link</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td colspan="9" class="text-center">Tidak ada data surat keluar</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Add New Button -->
                    <div class="d-grid gap-2 mt-3">
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#tambahSuratKeluarModal">
                            <i class="fas fa-plus-circle me-2"></i> Tambah Surat Keluar Baru
                        </button>
                    </div>
                </div>
                
                <!-- Arsip Surat Section -->
                <div class="content-section d-none" id="arsip-surat-section">
                    <h3 class="section-title">Arsip Surat</h3>
                    
                    <!-- Filter and Controls -->
                    <div class="filter-section">
                        <div class="row">
                            <div class="col-md-3">
                                <div class="mb-3">
                                    <label class="form-label"><i class="fas fa-filter"></i> Jenis Surat</label>
                                    <select class="form-select" id="filterJenisArsip">
                                        <option value="semua">Semua Jenis</option>
                                        <option value="masuk">Surat Masuk</option>
                                        <option value="keluar">Surat Keluar</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="mb-3">
                                    <label class="form-label"><i class="fas fa-filter"></i> Filter Tanggal</label>
                                    <input type="text" class="form-control datepicker" id="filterTanggalArsip" placeholder="Pilih tanggal">
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="mb-3">
                                    <label class="form-label"><i class="fas fa-search"></i> Pencarian</label>
                                    <input type="text" class="form-control" id="searchArsip" placeholder="Cari arsip...">
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="mb-3">
                                    <label class="form-label"><i class="fas fa-download"></i> Ekspor Data</label>
                                    <div class="d-grid gap-2">
                                        <button class="btn btn-success" id="exportExcelArsip">
                                            <i class="fas fa-file-excel me-2"></i> Excel
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Table -->
                    <div class="table-responsive">
                        <table class="table table-hover data-table" id="tableArsip">
                            <thead>
                                <tr>
                                    <th>No</th>
                                    <th>Tanggal</th>
                                    <th>Jenis</th>
                                    <th>No. Surat</th>
                                    <th>Asal/Tujuan</th>
                                    <th>Perihal</th>
                                    <th>Kategori</th>
                                    <th>Link</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td colspan="9" class="text-center">Tidak ada data arsip</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Control Panel -->
                    <div class="control-panel">
                        <h6 class="control-title">Kelola Arsip</h6>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="d-grid gap-2">
                                    <button class="btn btn-warning" id="backupArsip">
                                        <i class="fas fa-download me-2"></i> Backup Arsip
                                    </button>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="d-grid gap-2">
                                    <button class="btn btn-success" id="restoreArsip">
                                        <i class="fas fa-upload me-2"></i> Restore Arsip
                                    </button>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="d-grid gap-2">
                                    <button class="btn btn-danger" id="hapusSemuaArsip">
                                        <i class="fas fa-trash-alt me-2"></i> Hapus Semua Arsip
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Laporan Section -->
                <div class="content-section d-none" id="laporan-section">
                    <h3 class="section-title">Laporan</h3>
                    
                    <!-- Filter Options -->
                    <div class="filter-section">
                        <div class="row">
                            <div class="col-md-3">
                                <div class="mb-3">
                                    <label class="form-label"><i class="fas fa-filter"></i> Jenis Laporan</label>
                                    <select class="form-select" id="jenisLaporan">
                                        <option value="semua">Semua Jenis Surat</option>
                                        <option value="masuk">Surat Masuk</option>
                                        <option value="keluar">Surat Keluar</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="mb-3">
                                    <label class="form-label"><i class="fas fa-calendar"></i> Periode Awal</label>
                                    <input type="text" class="form-control datepicker" id="periodeAwal" placeholder="Tanggal awal">
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="mb-3">
                                    <label class="form-label"><i class="fas fa-calendar"></i> Periode Akhir</label>
                                    <input type="text" class="form-control datepicker" id="periodeAkhir" placeholder="Tanggal akhir">
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="mb-3">
                                    <label class="form-label"><i class="fas fa-download"></i> Ekspor Laporan</label>
                                    <div class="d-grid gap-2">
                                        <button class="btn btn-success" id="exportPdfLaporan">
                                            <i class="fas fa-file-pdf me-2"></i> PDF
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Laporan Table -->
                    <div class="table-responsive">
                        <table class="table table-hover data-table" id="tableLaporan">
                            <thead>
                                <tr>
                                    <th>No</th>
                                    <th>Tanggal</th>
                                    <th>Jenis</th>
                                    <th>No. Surat</th>
                                    <th>Asal/Tujuan</th>
                                    <th>Perihal</th>
                                    <th>Kategori</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td colspan="8" class="text-center">Pilih filter untuk menampilkan laporan</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Print Button -->
                    <div class="d-grid gap-2 mt-3">
                        <button class="btn btn-primary" id="printLaporan">
                            <i class="fas fa-print me-2"></i> Cetak Laporan
                        </button>
                    </div>
                </div>
                
                <!-- Pengaturan Section -->
                <div class="content-section d-none" id="pengaturan-section">
                    <h3 class="section-title">Pengaturan</h3>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <!-- Kode Keamanan -->
                            <div class="card mb-4">
                                <div class="card-header">
                                    <i class="fas fa-shield-alt me-2"></i> Kode Keamanan
                                </div>
                                <div class="card-body">
                                    <form id="securityCodeForm">
                                        <div class="mb-3">
                                            <label class="form-label"><i class="fas fa-key"></i> Kode Keamanan Saat Ini</label>
                                            <div class="input-group">
                                                <input type="password" class="form-control" id="currentSecurityCode" placeholder="Kode keamanan saat ini" readonly>
                                                <button class="btn btn-outline-secondary toggle-password" type="button">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label"><i class="fas fa-key"></i> Kode Keamanan Baru</label>
                                            <div class="input-group">
                                                <input type="password" class="form-control" id="newSecurityCode" placeholder="Masukkan kode keamanan baru">
                                                <button class="btn btn-outside-secondary toggle-password" type="button">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                            </div>
                                            <div class="error-message" id="securityCodeError"></div>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label"><i class="fas fa-key"></i> Konfirmasi Kode Keamanan Baru</label>
                                            <div class="input-group">
                                                <input type="password" class="form-control" id="confirmSecurityCode" placeholder="Konfirmasi kode keamanan baru">
                                                <button class="btn btn-outside-secondary toggle-password" type="button">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                            </div>
                                            <div class="error-message" id="confirmSecurityCodeError"></div>
                                        </div>
                                        <div class="d-grid">
                                            <button type="submit" class="btn btn-primary">
                                                <i class="fas fa-save me-2"></i> Simpan Perubahan
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <!-- Pengaturan Umum -->
                            <div class="card mb-4">
                                <div class="card-header">
                                    <i class="fas fa-cog me-2"></i> Pengaturan Umum
                                </div>
                                <div class="card-body">
                                    <form id="generalSettingsForm">
                                        <div class="mb-3">
                                            <label class="form-label"><i class="fas fa-building me-2"></i> Nama Instansi</label>
                                            <input type="text" class="form-control" id="institutionName" placeholder="Masukkan nama instansi">
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label"><i class="fas fa-user me-2"></i> Nama Admin</label>
                                            <input type="text" class="form-control" id="adminName" placeholder="Masukkan nama admin">
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label"><i class="fas fa-database me-2"></i> Otomatis Backup Data</label>
                                            <select class="form-select" id="autoBackup">
                                                <option value="7">Setiap Minggu</option>
                                                <option value="30">Setiap Bulan</option>
                                                <option value="0">Tidak Pernah</option>
                                            </select>
                                        </div>
                                        <div class="d-grid">
                                            <button type="submit" class="btn btn-primary">
                                                <i class="fas fa-save me-2"></i> Simpan Pengaturan
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                            
                            <!-- Reset Data -->
                            <div class="card">
                                <div class="card-header">
                                    <i class="fas fa-trash-alt me-2"></i> Reset Data
                                </div>
                                <div class="card-body">
                                    <p class="card-text">Hati-hati! Tindakan ini akan menghapus semua data dan tidak dapat dibatalkan.</p>
                                    <div class="d-grid gap-2">
                                        <button class="btn btn-danger" id="resetAllData">
                                            <i class="fas fa-exclamation-triangle me-2"></i> Reset Semua Data
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <div class="copyright">
            &copy; 2024 SISMAT - Sistem Manajemen Surat. Hak Cipta Dilindungi.
        </div>
    </div>
    
    <!-- Floating Action Button -->
    <div class="floating-action-btn" id="fab">
        <i class="fas fa-plus"></i>
    </div>
    
    <!-- Toast Notification -->
    <div class="toast notification-toast" role="alert" aria-live="assertive" aria-atomic="true" id="notificationToast">
        <div class="toast-header">
            <strong class="me-auto" id="toastTitle">SISMAT</strong>
            <small>Baru saja</small>
            <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
        <div class="toast-body" id="toastMessage">
            Operasi berhasil dilakukan.
        </div>
    </div>
    
    <!-- Modal untuk Tambah Surat Masuk -->
    <div class="modal fade" id="tambahSuratMasukModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-envelope me-2"></i> Tambah Surat Masuk Baru</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="tambahSuratMasukForm">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label"><i class="fas fa-calendar-alt"></i> Tanggal Surat</label>
                                    <input type="text" class="form-control datepicker" id="tanggalSuratMasuk" required>
                                    <div class="error-message" id="tanggalSuratMasukError"></div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label"><i class="fas fa-hashtag"></i> Nomor Surat</label>
                                    <input type="text" class="form-control" id="nomorSuratMasuk" placeholder="Masukkan nomor surat" required>
                                    <div class="error-message" id="nomorSuratMasukError"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label"><i class="fas fa-building"></i> Asal Surat</label>
                            <input type="text" class="form-control" id="asalSurat" placeholder="Masukkan asal surat" required>
                            <div class="error-message" id="asalSuratError"></div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label"><i class="fas fa-tag"></i> Perihal</label>
                            <input type="text" class="form-control" id="perihalSuratMasuk" placeholder="Masukkan perihal surat" required>
                            <div class="error-message" id="perihalSuratMasukError"></div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label"><i class="fas fa-folder"></i> Kategori</label>
                                    <select class="form-select" id="kategoriSuratMasuk">
                                        <option value="Pemerintah">Pemerintah</option>
                                        <option value="Perusahaan">Perusahaan</option>
                                        <option value="Lembaga">Lembaga</option>
                                        <option value="OPD">OPD</option>
                                        <option value="UPT">UPT</option>
                                        <option value="Perorangan">Perorangan</option>
                                        <option value="Lainnya">Lainnya</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label"><i class="fas fa-check-circle"></i> Status</label>
                                    <select class="form-select" id="statusSuratMasuk">
                                        <option value="Pending">Pending</option>
                                        <option value="Diterima">Diterima</option>
                                        <option value="Ditolak">Ditolak</option>
                                        <option value="Selesai">Selesai</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label"><i class="fas fa-link"></i> Link Google Drive</label>
                            <div class="input-group">
                                <input type="text" class="form-control" id="linkSuratMasuk" placeholder="Masukkan link Google Drive">
                                <button class="btn btn-outside-secondary" type="button" id="generateDriveLinkMasuk">
                                    <i class="fas fa-sync-alt"></i> Generate
                                </button>
                            </div>
                            <small class="form-text text-muted">Kosongkan jika tidak ada</small>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label"><i class="fas fa-sticky-note"></i> Catatan (Opsional)</label>
                            <textarea class="form-control" id="catatanSuratMasuk" rows="3" placeholder="Tambahkan catatan jika diperlukan"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                    <button type="button" class="btn btn-primary" id="simpanSuratMasuk">Simpan</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal untuk Tambah Surat Keluar -->
    <div class="modal fade" id="tambahSuratKeluarModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-paper-plane me-2"></i> Tambah Surat Keluar Baru</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="tambahSuratKeluarForm">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label"><i class="fas fa-calendar-alt"></i> Tanggal Surat</label>
                                    <input type="text" class="form-control datepicker" id="tanggalSuratKeluar" required>
                                    <div class="error-message" id="tanggalSuratKeluarError"></div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label"><i class="fas fa-hashtag"></i> Nomor Surat</label>
                                    <input type="text" class="form-control" id="nomorSuratKeluar" placeholder="Masukkan nomor surat" required>
                                    <div class="error-message" id="nomorSuratKeluarError"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label"><i class="fas fa-building"></i> Tujuan Surat</label>
                            <input type="text" class="form-control" id="tujuanSurat" placeholder="Masukkan tujuan surat" required>
                            <div class="error-message" id="tujuanSuratError"></div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label"><i class="fas fa-tag"></i> Perihal</label>
                            <input type="text" class="form-control" id="perihalSuratKeluar" placeholder="Masukkan perihal surat" required>
                            <div class="error-message" id="perihalSuratKeluarError"></div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label"><i class="fas fa-folder"></i> Kategori</label>
                                    <select class="form-select" id="kategoriSuratKeluar">
                                        <option value="Pemerintah">Pemerintah</option>
                                        <option value="Perusahaan">Perusahaan</option>
                                        <option value="Lembaga">Lembaga</option>
                                        <option value="OPD">OPD</option>
                                        <option value="UPT">UPT</option>
                                        <option value="Perorangan">Perorangan</option>
                                        <option value="Lainnya">Lainnya</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label"><i class="fas fa-check-circle"></i> Status</label>
                                    <select class="form-select" id="statusSuratKeluar">
                                        <option value="Pending">Pending</option>
                                        <option value="Terkirim">Terkirim</option>
                                        <option value="Ditolak">Ditolak</option>
                                        <option value="Selesai">Selesai</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label"><i class="fas fa-link"></i> Link Google Drive</label>
                            <div class="input-group">
                                <input type="text" class="form-control" id="linkSuratKeluar" placeholder="Masukkan link Google Drive">
                                <button class="btn btn-outside-secondary" type="button" id="generateDriveLinkKeluar">
                                    <i class="fas fa-sync-alt"></i> Generate
                                </button>
                            </div>
                            <small class="form-text text-muted">Kosongkan jika tidak ada</small>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label"><i class="fas fa-sticky-note"></i> Catatan (Opsional)</label>
                            <textarea class="form-control" id="catatanSuratKeluar" rows="3" placeholder="Tambahkan catatan jika diperlukan"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                    <button type="button" class="btn btn-primary" id="simpanSuratKeluar">Simpan</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal untuk Edit Surat -->
    <div class="modal fade" id="editSuratModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-edit me-2"></i> Edit Data Surat</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editSuratForm">
                        <input type="hidden" id="editId">
                        <input type="hidden" id="editJenis">
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label"><i class="fas fa-calendar-alt"></i> Tanggal Surat</label>
                                    <input type="text" class="form-control datepicker" id="editTanggal" required>
                                    <div class="error-message" id="editTanggalError"></div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label"><i class="fas fa-hashtag"></i> Nomor Surat</label>
                                    <input type="text" class="form-control" id="editNomor" placeholder="Masukkan nomor surat" required>
                                    <div class="error-message" id="editNomorError"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label" id="editAsalTujuanLabel"><i class="fas fa-building"></i> Asal/Tujuan Surat</label>
                            <input type="text" class="form-control" id="editAsalTujuan" placeholder="Masukkan asal/tujuan surat" required>
                            <div class="error-message" id="editAsalTujuanError"></div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label"><i class="fas fa-tag"></i> Perihal</label>
                            <input type="text" class="form-control" id="editPerihal" placeholder="Masukkan perihal surat" required>
                            <div class="error-message" id="editPerihalError"></div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label"><i class="fas fa-folder"></i> Kategori</label>
                                    <select class="form-select" id="editKategori">
                                        <option value="Pemerintah">Pemerintah</option>
                                        <option value="Perusahaan">Perusahaan</option>
                                        <option value="Lembaga">Lembaga</option>
                                        <option value="OPD">OPD</option>
                                        <option value="UPT">UPT</option>
                                        <option value="Perorangan">Perorangan</option>
                                        <option value="Lainnya">Lainnya</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label"><i class="fas fa-check-circle"></i> Status</label>
                                    <select class="form-select" id="editStatus">
                                        <option value="Pending">Pending</option>
                                        <option value="Diterima">Diterima</option>
                                        <option value="Terkirim">Terkirim</option>
                                        <option value="Ditolak">Ditolak</option>
                                        <option value="Selesai">Selesai</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label"><i class="fas fa-link"></i> Link Google Drive</label>
                            <div class="input-group">
                                <input type="text" class="form-control" id="editLink" placeholder="Masukkan link Google Drive">
                                <button class="btn btn-outside-secondary" type="button" id="generateEditDriveLink">
                                    <i class="fas fa-sync-alt"></i> Generate
                                </button>
                            </div>
                            <small class="form-text text-muted">Kosongkan jika tidak ada</small>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label"><i class="fas fa-sticky-note"></i> Catatan (Opsional)</label>
                            <textarea class="form-control" id="editCatatan" rows="3" placeholder="Tambahkan catatan jika diperlukan"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                    <button type="button" class="btn btn-primary" id="simpanEditSurat">Simpan Perubahan</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal untuk Konfirmasi Hapus -->
    <div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-exclamation-triangle me-2 text-warning"></i> Konfirmasi Hapus</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Apakah Anda yakin ingin menghapus data ini? Tindakan ini tidak dapat dibatalkan.</p>
                    <input type="hidden" id="deleteId">
                    <input type="hidden" id="deleteJenis">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteButton">Hapus</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal untuk Konfirmasi Reset Data -->
    <div class="modal fade" id="confirmResetModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-exclamation-triangle me-2 text-danger"></i> Konfirmasi Reset Data</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p class="text-danger"><strong>Peringatan!</strong> Tindakan ini akan menghapus semua data surat masuk, surat keluar, dan arsip. Data yang dihapus tidak dapat dikembalikan.</p>
                    <p>Apakah Anda yakin ingin melanjutkan?</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                    <button type="button" class="btn btn-danger" id="confirmResetButton">Reset Semua Data</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal untuk Konfirmasi Hapus Semua Arsip -->
    <div class="modal fade" id="confirmHapusSemuaArsipModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-exclamation-triangle me-2 text-danger"></i> Konfirmasi Hapus Semua Arsip</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p class="text-danger"><strong>Peringatan!</strong> Tindakan ini akan menghapus semua data arsip. Data yang dihapus tidak dapat dikembalikan.</p>
                    <p>Apakah Anda yakin ingin melanjutkan?</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                    <button type="button" class="btn btn-danger" id="confirmHapusSemuaArsipButton">Hapus Semua Arsip</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal untuk Preview Data -->
    <div class="modal fade" id="previewModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-eye me-2"></i> Preview Data</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="previewContent">
                    <!-- Preview content will be inserted here -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>
                    <button type="button" class="btn btn-primary" id="printPreviewData">Cetak</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal untuk Backup/Restore -->
    <div class="modal fade" id="backupRestoreModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="backupRestoreModalTitle"><i class="fas fa-database me-2"></i> Backup Data</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="backupRestoreModalBody">
                    <p>Klik tombol di bawah ini untuk memulai proses backup data.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                    <button type="button" class="btn btn-primary" id="confirmBackupRestore">Lanjutkan</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Welcome Modal -->
    <div class="modal fade welcome-modal" id="welcomeModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="welcome-header">
                    <div class="welcome-icon">
                        <i class="fas fa-mail-bulk"></i>
                    </div>
                    <h5 class="modal-title">SISMAT</h5>
                    <p>Sistem Manajemen Surat</p>
                </div>
                <div class="welcome-body">
                    <h5>Selamat Datang!</h5>
                    <p>Aplikasi SISMAT siap membantu Anda mengelola surat masuk dan keluar dengan lebih efisien.</p>
                    <div class="countdown-timer">
                        Aplikasi akan dimulai dalam <span id="welcomeCountdown">5</span> detik...
                    </div>
                </div>
                <div class="welcome-footer">
                    <button type="button" class="btn btn-primary" id="skipWelcomeCountdown">
                        Mulai Sekarang
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/locales/bootstrap-datepicker.id.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
    
    <script>
        // Inisialisasi variabel global
        let suratMasukData = [];
        let suratKeluarData = [];
        let arsipData = [];
        let loginAttempts = 0;
        let isBlocked = false;
        let blockTimeout;
        let securityCode = "1234"; // Kode default
        let welcomeCountdown;
        
        // Konfigurasi particles.js untuk background login
        const particlesConfig = {
            particles: {
                number: { value: 80, density: { enable: true, value_area: 800 } },
                color: { value: "#0d47a1" },
                shape: { type: "circle" },
                opacity: { value: 0.5, random: true },
                size: { value: 3, random: true },
                line_linked: {
                    enable: true,
                    distance: 150,
                    color: "#0d47a1",
                    opacity: 0.4,
                    width: 1
                },
                move: {
                    enable: true,
                    speed: 2,
                    direction: "none",
                    random: true,
                    straight: false,
                    out_mode: "out",
                    bounce: false
                }
            },
            interactivity: {
                detect_on: "canvas",
                events: {
                    onhover: { enable: true, mode: "grab" },
                    onclick: { enable: true, mode: "push" },
                    resize: true
                }
            },
            retina_detect: true
        };
        
        // Inisialisasi aplikasi saat dokumen siap
        $(document).ready(function() {
            // Inisialisasi datepicker
            $('.datepicker').datepicker({
                format: 'dd-mm-yyyy',
                language: 'id',
                autoclose: true,
                todayHighlight: true
            });
            
            // Inisialisasi particles.js untuk background login
            particlesJS('login-particles', particlesConfig);
            
            // Tampilkan modal login saat aplikasi pertama kali dijalankan
            $('#loginModal').modal('show');
            
            // Tampilkan modal welcome setelah login berhasil
            // $('#welcomeModal').modal('show');
            // startWelcomeCountdown();
            
            // Event listener untuk toggle password visibility
            $('.toggle-password').click(function() {
                const input = $(this).closest('.input-group').find('input');
                const icon = $(this).find('i');
                
                if (input.attr('type') === 'password') {
                    input.attr('type', 'text');
                    icon.removeClass('fa-eye').addClass('fa-eye-slash');
                } else {
                    input.attr('type', 'password');
                    icon.removeClass('fa-eye-slash').addClass('fa-eye');
                }
            });
            
            // Event listener untuk form login
            $('#loginForm').on('submit', function(e) {
                e.preventDefault();
                handleLogin();
            });
            
            // Event listener untuk tombol logout
            $('#logoutButton').on('click', function(e) {
                e.preventDefault();
                handleLogout();
            });
            
            // Event listener untuk navigasi menu
            $('.nav-link').on('click', function(e) {
                e.preventDefault();
                const section = $(this).data('section');
                showSection(section);
                
                // Untuk tampilan mobile, tutup sidebar setelah memilih menu
                if ($(window).width() < 992) {
                    $('#sidebar').removeClass('mobile-show');
                    $('#sidebarOverlay').removeClass('mobile-show');
                }
            });
            
            // Event listener untuk mobile menu button
            $('#mobileMenuBtn').on('click', function() {
                $('#sidebar').addClass('mobile-show');
                $('#sidebarOverlay').addClass('mobile-show');
            });
            
            // Event listener untuk sidebar overlay
            $('#sidebarOverlay').on('click', function() {
                $('#sidebar').removeClass('mobile-show');
                $(this).removeClass('mobile-show');
            });
            
            // Event listener untuk tombol simpan surat masuk
            $('#simpanSuratMasuk').on('click', function() {
                tambahSuratMasuk();
            });
            
            // Event listener untuk tombol simpan surat keluar
            $('#simpanSuratKeluar').on('click', function() {
                tambahSuratKeluar();
            });
            
            // Event listener untuk tombol simpan edit surat
            $('#simpanEditSurat').on('click', function() {
                simpanEditSurat();
            });
            
            // Event listener untuk tombol konfirmasi hapus
            $('#confirmDeleteButton').on('click', function() {
                hapusSurat();
            });
            
            // Event listener untuk tombol konfirmasi reset data
            $('#confirmResetButton').on('click', function() {
                resetAllData();
            });
            
            // Event listener untuk tombol konfirmasi hapus semua arsip
            $('#confirmHapusSemuaArsipButton').on('click', function() {
                hapusSemuaArsip();
            });
            
            // Event listener untuk tombol reset data di pengaturan
            $('#resetAllData').on('click', function() {
                $('#confirmResetModal').modal('show');
            });
            
            // Event listener untuk tombol hapus semua arsip
            $('#hapusSemuaArsip').on('click', function() {
                $('#confirmHapusSemuaArsipModal').modal('show');
            });
            
            // Event listener untuk form security code
            $('#securityCodeForm').on('submit', function(e) {
                e.preventDefault();
                updateSecurityCode();
            });
            
            // Event listener untuk form general settings
            $('#generalSettingsForm').on('submit', function(e) {
                e.preventDefault();
                simpanPengaturanUmum();
            });
            
            // Event listener untuk tombol generate drive link
            $('#generateDriveLinkMasuk').on('click', function() {
                generateDriveLink('linkSuratMasuk');
            });
            
            $('#generateDriveLinkKeluar').on('click', function() {
                generateDriveLink('linkSuratKeluar');
            });
            
            $('#generateEditDriveLink').on('click', function() {
                generateDriveLink('editLink');
            });
            
            // Event listener untuk tombol export excel
            $('#exportExcelMasuk').on('click', function() {
                exportToExcel(suratMasukData, 'surat_masuk');
            });
            
            $('#exportExcelKeluar').on('click', function() {
                exportToExcel(suratKeluarData, 'surat_keluar');
            });
            
            $('#exportExcelArsip').on('click', function() {
                exportToExcel(arsipData, 'arsip_surat');
            });
            
            $('#exportPdfLaporan').on('click', function() {
                exportToPdf();
            });
            
            // Event listener untuk tombol print laporan
            $('#printLaporan').on('click', function() {
                printLaporan();
            });
            
            // Event listener untuk tombol print preview
            $('#printPreviewData').on('click', function() {
                printPreviewData();
            });
            
            // Event listener untuk tombol backup dan restore arsip
            $('#backupArsip').on('click', function() {
                showBackupModal();
            });
            
            $('#restoreArsip').on('click', function() {
                showRestoreModal();
            });
            
            $('#confirmBackupRestore').on('click', function() {
                const modalTitle = $('#backupRestoreModalTitle').text();
                if (modalTitle.includes('Backup')) {
                    backupData();
                } else {
                    restoreData();
                }
            });
            
            // Event listener untuk skip welcome countdown
            $('#skipWelcomeCountdown').on('click', function() {
                clearInterval(welcomeCountdown);
                $('#welcomeModal').modal('hide');
            });
            
            // Event listener untuk FAB (Floating Action Button)
            $('#fab').on('click', function() {
                const activeSection = $('.content-section:not(.d-none)').attr('id');
                
                if (activeSection === 'surat-masuk-section') {
                    $('#tambahSuratMasukModal').modal('show');
                } else if (activeSection === 'surat-keluar-section') {
                    $('#tambahSuratKeluarModal').modal('show');
                } else if (activeSection === 'arsip-surat-section') {
                    // Tidak ada action untuk arsip
                    showNotification('Info', 'Tidak ada aksi cepat untuk bagian arsip', 'info');
                } else if (activeSection === 'laporan-section') {
                    printLaporan();
                } else if (activeSection === 'pengaturan-section') {
                    // Scroll ke atas
                    $('html, body').animate({ scrollTop: 0 }, 'slow');
                } else {
                    // Default action untuk dashboard
                    refreshDashboard();
                }
            });
            
            // Muat data dari localStorage jika ada
            loadDataFromStorage();
            
            // Inisialisasi dashboard
            refreshDashboard();
        });
        
        // Fungsi untuk menangani login
        function handleLogin() {
            if (isBlocked) {
                showNotification('Error', 'Anda telah melebihi batas percobaan login. Silakan coba lagi nanti.', 'error');
                return;
            }
            
            const enteredCode = $('#securityCode').val();
            const loginButton = $('#loginButton');
            const loginSpinner = $('#loginSpinner');
            const loginButtonText = $('.login-button-text');
            
            // Tampilkan spinner dan nonaktifkan tombol
            loginButton.prop('disabled', true);
            loginSpinner.removeClass('d-none');
            loginButtonText.text('Memproses...');
            
            // Simulasi proses login (dalam aplikasi nyata, ini akan berupa request ke server)
            setTimeout(function() {
                if (enteredCode === securityCode) {
                    // Login berhasil
                    loginAttempts = 0;
                    $('#attemptsCount').text('');
                    $('#blockedMessage').addClass('d-none');
                    
                    // Sembunyikan modal login
                    $('#loginModal').modal('hide');
                    
                    // Tampilkan aplikasi utama
                    $('.app-content-unauthenticated').show();
                    
                    // Tampilkan modal welcome
                    $('#welcomeModal').modal('show');
                    startWelcomeCountdown();
                    
                    showNotification('Berhasil', 'Login berhasil! Selamat datang di SISMAT.', 'success');
                } else {
                    // Login gagal
                    loginAttempts++;
                    
                    if (loginAttempts >= 3) {
                        // Blokir login sementara
                        isBlocked = true;
                        $('#blockedMessage').removeClass('d-none');
                        let countdown = 30;
                        
                        $('#countdown').text(countdown);
                        
                        blockTimeout = setInterval(function() {
                            countdown--;
                            $('#countdown').text(countdown);
                            
                            if (countdown <= 0) {
                                clearInterval(blockTimeout);
                                isBlocked = false;
                                loginAttempts = 0;
                                $('#blockedMessage').addClass('d-none');
                                $('#attemptsCount').text('');
                            }
                        }, 1000);
                        
                        showNotification('Error', 'Terlalu banyak percobaan login gagal. Silakan coba lagi dalam 30 detik.', 'error');
                    } else {
                        $('#attemptsCount').text(`Percobaan login gagal: ${loginAttempts} dari 3`);
                        $('#securityCode').addClass('input-error');
                        showNotification('Error', 'Kode keamanan salah! Silakan coba lagi.', 'error');
                    }
                }
                
                // Sembunyikan spinner dan aktifkan tombol
                loginButton.prop('disabled', false);
                loginSpinner.addClass('d-none');
                loginButtonText.text('Masuk ke Aplikasi');
            }, 1000); // Simulasi delay jaringan
        }
        
        // Fungsi untuk menangani logout
        function handleLogout() {
            // Sembunyikan aplikasi utama
            $('.app-content-unauthenticated').hide();
            
            // Tampilkan modal login
            $('#loginModal').modal('show');
            
            // Reset form login
            $('#securityCode').val('');
            
            showNotification('Info', 'Anda telah logout dari aplikasi.', 'info');
        }
        
        // Fungsi untuk memulai hitung mundur welcome modal
        function startWelcomeCountdown() {
            let countdown = 5;
            $('#welcomeCountdown').text(countdown);
            
            welcomeCountdown = setInterval(function() {
                countdown--;
                $('#welcomeCountdown').text(countdown);
                
                if (countdown <= 0) {
                    clearInterval(welcomeCountdown);
                    $('#welcomeModal').modal('hide');
                }
            }, 1000);
        }
        
        // Fungsi untuk menampilkan section tertentu
        function showSection(section) {
            // Sembunyikan semua section
            $('.content-section').addClass('d-none');
            
            // Tampilkan section yang dipilih
            $(`#${section}-section`).removeClass('d-none');
            
            // Update menu aktif
            $('.nav-link').removeClass('active');
            $(`.nav-link[data-section="${section}"]`).addClass('active');
            
            // Jika section adalah dashboard, refresh data
            if (section === 'dashboard') {
                refreshDashboard();
            }
            
            // Jika section adalah surat masuk, refresh tabel
            if (section === 'surat-masuk') {
                refreshSuratMasukTable();
            }
            
            // Jika section adalah surat keluar, refresh tabel
            if (section === 'surat-keluar') {
                refreshSuratKeluarTable();
            }
            
            // Jika section adalah arsip, refresh tabel
            if (section === 'arsip-surat') {
                refreshArsipTable();
            }
            
            // Jika section adalah laporan, refresh tabel
            if (section === 'laporan') {
                refreshLaporanTable();
            }
        }
        
        // Fungsi untuk memuat data dari localStorage
        function loadDataFromStorage() {
            // Muat data surat masuk
            const storedSuratMasuk = localStorage.getItem('suratMasukData');
            if (storedSuratMasuk) {
                suratMasukData = JSON.parse(storedSuratMasuk);
            }
            
            // Muat data surat keluar
            const storedSuratKeluar = localStorage.getItem('suratKeluarData');
            if (storedSuratKeluar) {
                suratKeluarData = JSON.parse(storedSuratKeluar);
            }
            
            // Muat data arsip
            const storedArsip = localStorage.getItem('arsipData');
            if (storedArsip) {
                arsipData = JSON.parse(storedArsip);
            }
            
            // Muat pengaturan
            const storedSettings = localStorage.getItem('appSettings');
            if (storedSettings) {
                const settings = JSON.parse(storedSettings);
                securityCode = settings.securityCode || '1234';
                $('#currentSecurityCode').val(securityCode);
                
                if (settings.institutionName) {
                    $('#institutionName').val(settings.institutionName);
                }
                
                if (settings.adminName) {
                    $('#adminName').val(settings.adminName);
                }
                
                if (settings.autoBackup) {
                    $('#autoBackup').val(settings.autoBackup);
                }
            } else {
                // Set default value untuk security code
                $('#currentSecurityCode').val(securityCode);
            }
        }
        
        // Fungsi untuk menyimpan data ke localStorage
        function saveDataToStorage() {
            localStorage.setItem('suratMasukData', JSON.stringify(suratMasukData));
            localStorage.setItem('suratKeluarData', JSON.stringify(suratKeluarData));
            localStorage.setItem('arsipData', JSON.stringify(arsipData));
            
            // Simpan pengaturan
            const settings = {
                securityCode: securityCode,
                institutionName: $('#institutionName').val(),
                adminName: $('#adminName').val(),
                autoBackup: $('#autoBackup').val()
            };
            
            localStorage.setItem('appSettings', JSON.stringify(settings));
        }
        
        // Fungsi untuk refresh dashboard
        function refreshDashboard() {
            // Update statistik
            $('#total-surat-masuk').text(suratMasukData.length);
            $('#total-surat-keluar').text(suratKeluarData.length);
            $('#total-arsip').text(arsipData.length);
            $('#total-keseluruhan').text(suratMasukData.length + suratKeluarData.length);
            
            // Update chart
            updateSuratChart();
            
            // Update aktivitas terbaru
            updateRecentActivities();
        }
        
        // Fungsi untuk update chart surat
        function updateSuratChart() {
            const ctx = document.getElementById('suratChart').getContext('2d');
            
            // Siapkan data untuk chart (contoh data)
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'Mei', 'Jun', 'Jul', 'Agu', 'Sep', 'Okt', 'Nov', 'Des'];
            const masukData = [5, 8, 6, 10, 15, 12, 8, 14, 10, 7, 9, 11];
            const keluarData = [3, 5, 7, 9, 11, 8, 6, 10, 12, 9, 7, 5];
            
            // Hancurkan chart sebelumnya jika ada
            if (window.suratChartInstance) {
                window.suratChartInstance.destroy();
            }
            
            // Buat chart baru
            window.suratChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: months,
                    datasets: [
                        {
                            label: 'Surat Masuk',
                            data: masukData,
                            backgroundColor: 'rgba(13, 71, 161, 0.7)',
                            borderColor: 'rgba(13, 71, 161, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'Surat Keluar',
                            data: keluarData,
                            backgroundColor: 'rgba(0, 105, 92, 0.7)',
                            borderColor: 'rgba(0, 105, 92, 1)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }
        
        // Fungsi untuk update aktivitas terbaru
        function updateRecentActivities() {
            const activitiesList = $('#recent-activities');
            activitiesList.empty();
            
            // Gabungkan semua data surat
            const allData = [...suratMasukData, ...suratKeluarData];
            
            // Urutkan berdasarkan tanggal (terbaru pertama)
            allData.sort((a, b) => new Date(b.tanggal) - new Date(a.tanggal));
            
            // Ambil 5 aktivitas terbaru
            const recentActivities = allData.slice(0, 5);
            
            if (recentActivities.length === 0) {
                activitiesList.append('<li class="list-group-item text-center">Tidak ada aktivitas terbaru</li>');
                return;
            }
            
            recentActivities.forEach(activity => {
                const isMasuk = activity.hasOwnProperty('asal');
                const type = isMasuk ? 'masuk' : 'keluar';
                const icon = isMasuk ? 'envelope' : 'paper-plane';
                const title = isMasuk ? 'Surat masuk baru' : 'Surat keluar ditambahkan';
                
                // Format tanggal
                const tanggal = new Date(activity.tanggal);
                const now = new Date();
                const diffTime = Math.abs(now - tanggal);
                const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
                const diffHours = Math.floor(diffTime / (1000 * 60 * 60));
                const diffMinutes = Math.floor(diffTime / (1000 * 60));
                
                let timeText;
                if (diffDays > 0) {
                    timeText = `${diffDays} hari lalu`;
                } else if (diffHours > 0) {
                    timeText = `${diffHours} jam lalu`;
                } else {
                    timeText = `${diffMinutes} menit lalu`;
                }
                
                activitiesList.append(`
                    <li class="list-group-item">
                        <div class="d-flex justify-content-between">
                            <span><i class="fas fa-${icon} me-2"></i> ${title}</span>
                            <small class="text-muted">${timeText}</small>
                        </div>
                        <small class="text-muted">${activity.nomor} - ${activity.perihal}</small>
                    </li>
                `);
            });
        }
        
        // Fungsi untuk menambah surat masuk
        function tambahSuratMasuk() {
            // Validasi form
            if (!validateForm('tambahSuratMasukForm')) {
                return;
            }
            
            const newSurat = {
                id: Date.now(), // ID unik berdasarkan timestamp
                tanggal: $('#tanggalSuratMasuk').val(),
                nomor: $('#nomorSuratMasuk').val(),
                asal: $('#asalSurat').val(),
                perihal: $('#perihalSuratMasuk').val(),
                kategori: $('#kategoriSuratMasuk').val(),
                status: $('#statusSuratMasuk').val(),
                link: $('#linkSuratMasuk').val(),
                catatan: $('#catatanSuratMasuk').val(),
                jenis: 'masuk'
            };
            
            // Tambahkan ke data surat masuk
            suratMasukData.push(newSurat);
            
            // Simpan ke localStorage
            saveDataToStorage();
            
            // Refresh tabel surat masuk
            refreshSuratMasukTable();
            
            // Tutup modal
            $('#tambahSuratMasukModal').modal('hide');
            
            // Reset form
            $('#tambahSuratMasukForm')[0].reset();
            
            // Tampilkan notifikasi
            showNotification('Berhasil', 'Surat masuk berhasil ditambahkan', 'success');
            
            // Refresh dashboard
            refreshDashboard();
        }
        
        // Fungsi untuk menambah surat keluar
        function tambahSuratKeluar() {
            // Validasi form
            if (!validateForm('tambahSuratKeluarForm')) {
                return;
            }
            
            const newSurat = {
                id: Date.now(), // ID unik berdasarkan timestamp
                tanggal: $('#tanggalSuratKeluar').val(),
                nomor: $('#nomorSuratKeluar').val(),
                tujuan: $('#tujuanSurat').val(),
                perihal: $('#perihalSuratKeluar').val(),
                kategori: $('#kategoriSuratKeluar').val(),
                status: $('#statusSuratKeluar').val(),
                link: $('#linkSuratKeluar').val(),
                catatan: $('#catatanSuratKeluar').val(),
                jenis: 'keluar'
            };
            
            // Tambahkan ke data surat keluar
            suratKeluarData.push(newSurat);
            
            // Simpan ke localStorage
            saveDataToStorage();
            
            // Refresh tabel surat keluar
            refreshSuratKeluarTable();
            
            // Tutup modal
            $('#tambahSuratKeluarModal').modal('hide');
            
            // Reset form
            $('#tambahSuratKeluarForm')[0].reset();
            
            // Tampilkan notifikasi
            showNotification('Berhasil', 'Surat keluar berhasil ditambahkan', 'success');
            
            // Refresh dashboard
            refreshDashboard();
        }
        
        // Fungsi untuk refresh tabel surat masuk
        function refreshSuratMasukTable() {
            const table = $('#tableSuratMasuk tbody');
            table.empty();
            
            if (suratMasukData.length === 0) {
                table.append('<tr><td colspan="9" class="text-center">Tidak ada data surat masuk</td></tr>');
                return;
            }
            
            // Urutkan data berdasarkan tanggal (terbaru pertama)
            const sortedData = [...suratMasukData].sort((a, b) => {
                return new Date(b.tanggal.split('-').reverse().join('-')) - new Date(a.tanggal.split('-').reverse().join('-'));
            });
            
            sortedData.forEach((surat, index) => {
                const row = `
                    <tr>
                        <td class="text-center">${index + 1}</td>
                        <td>${surat.tanggal}</td>
                        <td>${surat.nomor}</td>
                        <td>${surat.asal}</td>
                        <td>${surat.perihal}</td>
                        <td><span class="badge badge-kategori kategori-${surat.kategori.toLowerCase()}">${surat.kategori}</span></td>
                        <td><span class="badge status-${surat.status.toLowerCase()}">${surat.status}</span></td>
                        <td>
                            ${surat.link ? `<a href="${surat.link}" target="_blank" class="drive-link">Lihat</a>` : '-'}
                        </td>
                        <td class="text-center">
                            <button class="btn btn-sm btn-primary view-surat" data-id="${surat.id}" data-jenis="masuk" title="Lihat Detail">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-sm btn-warning edit-surat" data-id="${surat.id}" data-jenis="masuk" title="Edit">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-danger delete-surat" data-id="${surat.id}" data-jenis="masuk" title="Hapus">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
                table.append(row);
            });
            
            // Tambahkan event listener untuk tombol aksi
            $('.view-surat').on('click', function() {
                const id = $(this).data('id');
                const jenis = $(this).data('jenis');
                viewSurat(id, jenis);
            });
            
            $('.edit-surat').on('click', function() {
                const id = $(this).data('id');
                const jenis = $(this).data('jenis');
                editSurat(id, jenis);
            });
            
            $('.delete-surat').on('click', function() {
                const id = $(this).data('id');
                const jenis = $(this).data('jenis');
                confirmDeleteSurat(id, jenis);
            });
        }
        
        // Fungsi untuk refresh tabel surat keluar
        function refreshSuratKeluarTable() {
            const table = $('#tableSuratKeluar tbody');
            table.empty();
            
            if (suratKeluarData.length === 0) {
                table.append('<tr><td colspan="9" class="text-center">Tidak ada data surat keluar</td></tr>');
                return;
            }
            
            // Urutkan data berdasarkan tanggal (terbaru pertama)
            const sortedData = [...suratKeluarData].sort((a, b) => {
                return new Date(b.tanggal.split('-').reverse().join('-')) - new Date(a.tanggal.split('-').reverse().join('-'));
            });
            
            sortedData.forEach((surat, index) => {
                const row = `
                    <tr>
                        <td class="text-center">${index + 1}</td>
                        <td>${surat.tanggal}</td>
                        <td>${surat.nomor}</td>
                        <td>${surat.tujuan}</td>
                        <td>${surat.perihal}</td>
                        <td><span class="badge badge-kategori kategori-${surat.kategori.toLowerCase()}">${surat.kategori}</span></td>
                        <td><span class="badge status-${surat.status.toLowerCase()}">${surat.status}</span></td>
                        <td>
                            ${surat.link ? `<a href="${surat.link}" target="_blank" class="drive-link">Lihat</a>` : '-'}
                        </td>
                        <td class="text-center">
                            <button class="btn btn-sm btn-primary view-surat" data-id="${surat.id}" data-jenis="keluar" title="Lihat Detail">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-sm btn-warning edit-surat" data-id="${surat.id}" data-jenis="keluar" title="Edit">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-danger delete-surat" data-id="${surat.id}" data-jenis="keluar" title="Hapus">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
                table.append(row);
            });
            
            // Tambahkan event listener untuk tombol aksi
            $('.view-surat').on('click', function() {
                const id = $(this).data('id');
                const jenis = $(this).data('jenis');
                viewSurat(id, jenis);
            });
            
            $('.edit-surat').on('click', function() {
                const id = $(this).data('id');
                const jenis = $(this).data('jenis');
                editSurat(id, jenis);
            });
            
            $('.delete-surat').on('click', function() {
                const id = $(this).data('id');
                const jenis = $(this).data('jenis');
                confirmDeleteSurat(id, jenis);
            });
        }
        
        // Fungsi untuk melihat detail surat
        function viewSurat(id, jenis) {
            let surat;
            
            if (jenis === 'masuk') {
                surat = suratMasukData.find(item => item.id === id);
            } else {
                surat = suratKeluarData.find(item => item.id === id);
            }
            
            if (!surat) {
                showNotification('Error', 'Data surat tidak ditemukan', 'error');
                return;
            }
            
            const previewContent = `
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label"><strong>Tanggal Surat:</strong></label>
                            <p>${surat.tanggal}</p>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label"><strong>Nomor Surat:</strong></label>
                            <p>${surat.nomor}</p>
                        </div>
                    </div>
                </div>
                
                <div class="mb-3">
                    <label class="form-label"><strong>${jenis === 'masuk' ? 'Asal Surat:' : 'Tujuan Surat:'}</strong></label>
                    <p>${jenis === 'masuk' ? surat.asal : surat.tujuan}</p>
                </div>
                
                <div class="mb-3">
                    <label class="form-label"><strong>Perihal:</strong></label>
                    <p>${surat.perihal}</p>
                </div>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label"><strong>Kategori:</strong></label>
                            <p><span class="badge badge-kategori kategori-${surat.kategori.toLowerCase()}">${surat.kategori}</span></p>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label"><strong>Status:</strong></label>
                            <p><span class="badge status-${surat.status.toLowerCase()}">${surat.status}</span></p>
                        </div>
                    </div>
                </div>
                
                <div class="mb-3">
                    <label class="form-label"><strong>Link Google Drive:</strong></label>
                    <p>${surat.link ? `<a href="${surat.link}" target="_blank">${surat.link}</a>` : 'Tidak ada'}</p>
                </div>
                
                <div class="mb-3">
                    <label class="form-label"><strong>Catatan:</strong></label>
                    <p>${surat.catatan || 'Tidak ada catatan'}</p>
                </div>
            `;
            
            $('#previewContent').html(previewContent);
            $('#previewModal').modal('show');
        }
        
        // Fungsi untuk mengedit surat
        function editSurat(id, jenis) {
            let surat;
            
            if (jenis === 'masuk') {
                surat = suratMasukData.find(item => item.id === id);
            } else {
                surat = suratKeluarData.find(item => item.id === id);
            }
            
            if (!surat) {
                showNotification('Error', 'Data surat tidak ditemukan', 'error');
                return;
            }
            
            // Isi form edit dengan data surat
            $('#editId').val(surat.id);
            $('#editJenis').val(jenis);
            $('#editTanggal').val(surat.tanggal);
            $('#editNomor').val(surat.nomor);
            
            if (jenis === 'masuk') {
                $('#editAsalTujuanLabel').html('<i class="fas fa-building"></i> Asal Surat');
                $('#editAsalTujuan').val(surat.asal);
            } else {
                $('#editAsalTujuanLabel').html('<i class="fas fa-building"></i> Tujuan Surat');
                $('#editAsalTujuan').val(surat.tujuan);
            }
            
            $('#editPerihal').val(surat.perihal);
            $('#editKategori').val(surat.kategori);
            $('#editStatus').val(surat.status);
            $('#editLink').val(surat.link);
            $('#editCatatan').val(surat.catatan || '');
            
            // Tampilkan modal edit
            $('#editSuratModal').modal('show');
        }
        
        // Fungsi untuk menyimpan edit surat
        function simpanEditSurat() {
            // Validasi form
            if (!validateForm('editSuratForm')) {
                return;
            }
            
            const id = $('#editId').val();
            const jenis = $('#editJenis').val();
            
            let dataArray;
            if (jenis === 'masuk') {
                dataArray = suratMasukData;
            } else {
                dataArray = suratKeluarData;
            }
            
            // Cari index surat yang akan diedit
            const index = dataArray.findIndex(item => item.id === parseInt(id));
            
            if (index === -1) {
                showNotification('Error', 'Data surat tidak ditemukan', 'error');
                return;
            }
            
            // Update data surat
            dataArray[index].tanggal = $('#editTanggal').val();
            dataArray[index].nomor = $('#editNomor').val();
            
            if (jenis === 'masuk') {
                dataArray[index].asal = $('#editAsalTujuan').val();
            } else {
                dataArray[index].tujuan = $('#editAsalTujuan').val();
            }
            
            dataArray[index].perihal = $('#editPerihal').val();
            dataArray[index].kategori = $('#editKategori').val();
            dataArray[index].status = $('#editStatus').val();
            dataArray[index].link = $('#editLink').val();
            dataArray[index].catatan = $('#editCatatan').val();
            
            // Simpan ke localStorage
            saveDataToStorage();
            
            // Refresh tabel yang sesuai
            if (jenis === 'masuk') {
                refreshSuratMasukTable();
            } else {
                refreshSuratKeluarTable();
            }
            
            // Tutup modal
            $('#editSuratModal').modal('hide');
            
            // Tampilkan notifikasi
            showNotification('Berhasil', 'Data surat berhasil diperbarui', 'success');
        }
        
        // Fungsi untuk konfirmasi hapus surat
        function confirmDeleteSurat(id, jenis) {
            $('#deleteId').val(id);
            $('#deleteJenis').val(jenis);
            $('#confirmDeleteModal').modal('show');
        }
        
        // Fungsi untuk menghapus surat
        function hapusSurat() {
            const id = $('#deleteId').val();
            const jenis = $('#deleteJenis').val();
            
            let dataArray;
            if (jenis === 'masuk') {
                dataArray = suratMasukData;
            } else {
                dataArray = suratKeluarData;
            }
            
            // Cari index surat yang akan dihapus
            const index = dataArray.findIndex(item => item.id === parseInt(id));
            
            if (index === -1) {
                showNotification('Error', 'Data surat tidak ditemukan', 'error');
                return;
            }
            
            // Pindahkan ke arsip sebelum dihapus
            const suratToArchive = dataArray[index];
            suratToArchive.dihapusPada = new Date().toLocaleDateString('id-ID');
            arsipData.push(suratToArchive);
            
            // Hapus dari array data
            dataArray.splice(index, 1);
            
            // Simpan ke localStorage
            saveDataToStorage();
            
            // Refresh tabel yang sesuai
            if (jenis === 'masuk') {
                refreshSuratMasukTable();
            } else {
                refreshSuratKeluarTable();
            }
            
            // Tutup modal
            $('#confirmDeleteModal').modal('hide');
            
            // Tampilkan notifikasi
            showNotification('Berhasil', 'Data surat berhasil dihapus dan dipindahkan ke arsip', 'success');
            
            // Refresh dashboard
            refreshDashboard();
        }
        
        // Fungsi untuk refresh tabel arsip
        function refreshArsipTable() {
            const table = $('#tableArsip tbody');
            table.empty();
            
            if (arsipData.length === 0) {
                table.append('<tr><td colspan="9" class="text-center">Tidak ada data arsip</td></tr>');
                return;
            }
            
            // Urutkan data berdasarkan tanggal dihapus (terbaru pertama)
            const sortedData = [...arsipData].sort((a, b) => {
                return new Date(b.dihapusPada.split('-').reverse().join('-')) - new Date(a.dihapusPada.split('-').reverse().join('-'));
            });
            
            sortedData.forEach((arsip, index) => {
                const isMasuk = arsip.hasOwnProperty('asal');
                const asalTujuan = isMasuk ? arsip.asal : arsip.tujuan;
                
                const row = `
                    <tr>
                        <td class="text-center">${index + 1}</td>
                        <td>${arsip.tanggal}</td>
                        <td><span class="badge ${isMasuk ? 'bg-primary' : 'bg-success'}">${isMasuk ? 'Masuk' : 'Keluar'}</span></td>
                        <td>${arsip.nomor}</td>
                        <td>${asalTujuan}</td>
                        <td>${arsip.perihal}</td>
                        <td><span class="badge badge-kategori kategori-${arsip.kategori.toLowerCase()}">${arsip.kategori}</span></td>
                        <td>
                            ${arsip.link ? `<a href="${arsip.link}" target="_blank" class="drive-link">Lihat</a>` : '-'}
                        </td>
                        <td class="text-center">
                            <button class="btn btn-sm btn-primary view-arsip" data-id="${arsip.id}" data-jenis="${isMasuk ? 'masuk' : 'keluar'}" title="Lihat Detail">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-sm btn-warning restore-arsip" data-id="${arsip.id}" data-jenis="${isMasuk ? 'masuk' : 'keluar'}" title="Pulihkan">
                                <i class="fas fa-undo"></i>
                            </button>
                            <button class="btn btn-sm btn-danger delete-arsip" data-id="${arsip.id}" data-jenis="${isMasuk ? 'masuk' : 'keluar'}" title="Hapus Permanen">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
                table.append(row);
            });
            
            // Tambahkan event listener untuk tombol aksi
            $('.view-arsip').on('click', function() {
                const id = $(this).data('id');
                const jenis = $(this).data('jenis');
                viewSurat(id, jenis);
            });
            
            $('.restore-arsip').on('click', function() {
                const id = $(this).data('id');
                const jenis = $(this).data('jenis');
                restoreArsip(id, jenis);
            });
            
            $('.delete-arsip').on('click', function() {
                const id = $(this).data('id');
                const jenis = $(this).data('jenis');
                confirmDeleteArsip(id, jenis);
            });
        }
        
        // Fungsi untuk memulihkan arsip
        function restoreArsip(id, jenis) {
            // Cari index arsip yang akan dipulihkan
            const index = arsipData.findIndex(item => item.id === parseInt(id));
            
            if (index === -1) {
                showNotification('Error', 'Data arsip tidak ditemukan', 'error');
                return;
            }
            
            // Ambil data arsip
            const arsipToRestore = arsipData[index];
            
            // Hapus properti dihapusPada
            delete arsipToRestore.dihapusPada;
            
            // Kembalikan ke data asal
            if (jenis === 'masuk') {
                suratMasukData.push(arsipToRestore);
            } else {
                suratKeluarData.push(arsipToRestore);
            }
            
            // Hapus dari arsip
            arsipData.splice(index, 1);
            
            // Simpan ke localStorage
            saveDataToStorage();
            
            // Refresh tabel arsip
            refreshArsipTable();
            
            // Refresh tabel asal
            if (jenis === 'masuk') {
                refreshSuratMasukTable();
            } else {
                refreshSuratKeluarTable();
            }
            
            // Tampilkan notifikasi
            showNotification('Berhasil', 'Data berhasil dipulihkan', 'success');
            
            // Refresh dashboard
            refreshDashboard();
        }
        
        // Fungsi untuk konfirmasi hapus arsip permanen
        function confirmDeleteArsip(id, jenis) {
            $('#deleteId').val(id);
            $('#deleteJenis').val(jenis);
            $('#confirmDeleteModal').modal('show');
        }
        
        // Fungsi untuk menghapus arsip permanen
        function hapusArsipPermanen() {
            const id = $('#deleteId').val();
            const jenis = $('#deleteJenis').val();
            
            // Cari index arsip yang akan dihapus
            const index = arsipData.findIndex(item => item.id === parseInt(id));
            
            if (index === -1) {
                showNotification('Error', 'Data arsip tidak ditemukan', 'error');
                return;
            }
            
            // Hapus dari arsip
            arsipData.splice(index, 1);
            
            // Simpan ke localStorage
            saveDataToStorage();
            
            // Refresh tabel arsip
            refreshArsipTable();
            
            // Tutup modal
            $('#confirmDeleteModal').modal('hide');
            
            // Tampilkan notifikasi
            showNotification('Berhasil', 'Data arsip berhasil dihapus permanen', 'success');
            
            // Refresh dashboard
            refreshDashboard();
        }
        
        // Fungsi untuk menghapus semua arsip
        function hapusSemuaArsip() {
            // Konfirmasi sekali lagi
            if (!confirm('Apakah Anda yakin ingin menghapus semua arsip? Tindakan ini tidak dapat dibatalkan!')) {
                return;
            }
            
            // Hapus semua arsip
            arsipData = [];
            
            // Simpan ke localStorage
            saveDataToStorage();
            
            // Refresh tabel arsip
            refreshArsipTable();
            
            // Tutup modal
            $('#confirmHapusSemuaArsipModal').modal('hide');
            
            // Tampilkan notifikasi
            showNotification('Berhasil', 'Semua data arsip berhasil dihapus', 'success');
            
            // Refresh dashboard
            refreshDashboard();
        }
        
        // Fungsi untuk refresh tabel laporan
        function refreshLaporanTable() {
            const table = $('#tableLaporan tbody');
            table.empty();
            
            // Gabungkan semua data
            const allData = [
                ...suratMasukData.map(item => ({ ...item, jenis: 'Masuk' })),
                ...suratKeluarData.map(item => ({ ...item, jenis: 'Keluar' }))
            ];
            
            if (allData.length === 0) {
                table.append('<tr><td colspan="8" class="text-center">Tidak ada data laporan</td></tr>');
                return;
            }
            
            // Urutkan data berdasarkan tanggal (terbaru pertama)
            const sortedData = allData.sort((a, b) => {
                return new Date(b.tanggal.split('-').reverse().join('-')) - new Date(a.tanggal.split('-').reverse().join('-'));
            });
            
            sortedData.forEach((data, index) => {
                const asalTujuan = data.jenis === 'Masuk' ? data.asal : data.tujuan;
                
                const row = `
                    <tr>
                        <td class="text-center">${index + 1}</td>
                        <td>${data.tanggal}</td>
                        <td><span class="badge ${data.jenis === 'Masuk' ? 'bg-primary' : 'bg-success'}">${data.jenis}</span></td>
                        <td>${data.nomor}</td>
                        <td>${asalTujuan}</td>
                        <td>${data.perihal}</td>
                        <td><span class="badge badge-kategori kategori-${data.kategori.toLowerCase()}">${data.kategori}</span></td>
                        <td><span class="badge status-${data.status.toLowerCase()}">${data.status}</span></td>
                    </tr>
                `;
                table.append(row);
            });
        }
        
        // Fungsi untuk mencetak laporan
        function printLaporan() {
            window.print();
        }
        
        // Fungsi untuk mencetak preview data
        function printPreviewData() {
            const printContent = $('#previewContent').html();
            const printWindow = window.open('', '_blank');
            
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Cetak Data Surat</title>
                    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
                    <style>
                        body { font-family: Arial, sans-serif; padding: 20px; }
                        .badge { padding: 5px 10px; border-radius: 4px; }
                        .bg-primary { background-color: #0d6efd !important; }
                        .bg-success { background-color: #198754 !important; }
                    </style>
                </head>
                <body>
                    <h2 class="text-center mb-4">Detail Surat</h2>
                    ${printContent}
                    <script>
                        window.onload = function() {
                            window.print();
                        }
                    <\/script>
                </body>
                </html>
            `);
            
            printWindow.document.close();
        }
        
        // Fungsi untuk mengupdate kode keamanan
        function updateSecurityCode() {
            const newCode = $('#newSecurityCode').val();
            const confirmCode = $('#confirmSecurityCode').val();
            
            // Validasi
            if (!newCode) {
                $('#securityCodeError').text('Kode keamanan baru harus diisi').show();
                return;
            }
            
            if (newCode.length < 4) {
                $('#securityCodeError').text('Kode keamanan minimal 4 karakter').show();
                return;
            }
            
            if (newCode !== confirmCode) {
                $('#confirmSecurityCodeError').text('Konfirmasi kode keamanan tidak cocok').show();
                return;
            }
            
            // Update kode keamanan
            securityCode = newCode;
            
            // Simpan ke localStorage
            saveDataToStorage();
            
            // Update tampilan
            $('#currentSecurityCode').val(securityCode);
            $('#newSecurityCode').val('');
            $('#confirmSecurityCode').val('');
            
            // Sembunyikan pesan error
            $('#securityCodeError').hide();
            $('#confirmSecurityCodeError').hide();
            
            // Tampilkan notifikasi
            showNotification('Berhasil', 'Kode keamanan berhasil diperbarui', 'success');
        }
        
        // Fungsi untuk menyimpan pengaturan umum
        function simpanPengaturanUmum() {
            // Simpan ke localStorage
            saveDataToStorage();
            
            // Tampilkan notifikasi
            showNotification('Berhasil', 'Pengaturan berhasil disimpan', 'success');
        }
        
        // Fungsi untuk reset semua data
        function resetAllData() {
            // Konfirmasi sekali lagi
            if (!confirm('Apakah Anda yakin ingin menghapus SEMUA DATA? Tindakan ini tidak dapat dibatalkan!')) {
                return;
            }
            
            // Hapus semua data
            suratMasukData = [];
            suratKeluarData = [];
            arsipData = [];
            
            // Simpan ke localStorage
            saveDataToStorage();
            
            // Refresh semua tabel
            refreshSuratMasukTable();
            refreshSuratKeluarTable();
            refreshArsipTable();
            refreshLaporanTable();
            
            // Tutup modal
            $('#confirmResetModal').modal('hide');
            
            // Tampilkan notifikasi
            showNotification('Berhasil', 'Semua data berhasil direset', 'success');
            
            // Refresh dashboard
            refreshDashboard();
        }
        
        // Fungsi untuk menampilkan modal backup
        function showBackupModal() {
            $('#backupRestoreModalTitle').html('<i class="fas fa-download me-2"></i> Backup Data');
            $('#backupRestoreModalBody').html(`
                <p>Backup data akan mengekspor semua data surat masuk, surat keluar, dan arsip ke file JSON.</p>
                <div class="alert alert-info">
                    <i class="fas fa-info-circle me-2"></i> Simpan file backup di lokasi yang aman untuk mengembalikan data di kemudian hari.
                </div>
            `);
            $('#confirmBackupRestore').text('Backup Sekarang');
            $('#backupRestoreModal').modal('show');
        }
        
        // Fungsi untuk menampilkan modal restore
        function showRestoreModal() {
            $('#backupRestoreModalTitle').html('<i class="fas fa-upload me-2"></i> Restore Data');
            $('#backupRestoreModalBody').html(`
                <p>Restore data akan mengimpor data dari file backup JSON. Semua data yang ada akan digantikan dengan data dari file backup.</p>
                <div class="alert alert-warning">
                    <i class="fas fa-exclamation-triangle me-2"></i> <strong>Peringatan:</strong> Tindakan ini akan menimpa semua data yang ada. Pastikan Anda telah membackup data terbaru jika diperlukan.
                </div>
                <div class="mb-3">
                    <label class="form-label">Pilih File Backup</label>
                    <input type="file" class="form-control" id="backupFile" accept=".json">
                </div>
            `);
            $('#confirmBackupRestore').text('Restore Sekarang');
            $('#backupRestoreModal').modal('show');
        }
        
        // Fungsi untuk backup data
        function backupData() {
            // Siapkan data untuk di backup
            const backupData = {
                suratMasuk: suratMasukData,
                suratKeluar: suratKeluarData,
                arsip: arsipData,
                settings: {
                    securityCode: securityCode,
                    institutionName: $('#institutionName').val(),
                    adminName: $('#adminName').val(),
                    autoBackup: $('#autoBackup').val()
                },
                backupDate: new Date().toLocaleString('id-ID')
            };
            
            // Konversi ke JSON
            const jsonData = JSON.stringify(backupData);
            const blob = new Blob([jsonData], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            // Buat link untuk download
            const a = document.createElement('a');
            a.href = url;
            a.download = `sismat-backup-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            
            // Bersihkan
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            // Tutup modal
            $('#backupRestoreModal').modal('hide');
            
            // Tampilkan notifikasi
            showNotification('Berhasil', 'Backup data berhasil dilakukan', 'success');
        }
        
        // Fungsi untuk restore data
        function restoreData() {
            const fileInput = $('#backupFile')[0];
            
            if (!fileInput.files.length) {
                showNotification('Error', 'Pilih file backup terlebih dahulu', 'error');
                return;
            }
            
            const file = fileInput.files[0];
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const backupData = JSON.parse(e.target.result);
                    
                    // Validasi data backup
                    if (!backupData.suratMasuk || !backupData.suratKeluar || !backupData.arsip) {
                        throw new Error('Format file backup tidak valid');
                    }
                    
                    // Konfirmasi restore
                    if (!confirm('Apakah Anda yakin ingin merestore data? Semua data yang ada akan digantikan dengan data dari backup.')) {
                        return;
                    }
                    
                    // Restore data
                    suratMasukData = backupData.suratMasuk;
                    suratKeluarData = backupData.suratKeluar;
                    arsipData = backupData.arsip;
                    
                    // Restore pengaturan jika ada
                    if (backupData.settings) {
                        securityCode = backupData.settings.securityCode || '1234';
                        
                        if (backupData.settings.institutionName) {
                            $('#institutionName').val(backupData.settings.institutionName);
                        }
                        
                        if (backupData.settings.adminName) {
                            $('#adminName').val(backupData.settings.adminName);
                        }
                        
                        if (backupData.settings.autoBackup) {
                            $('#autoBackup').val(backupData.settings.autoBackup);
                        }
                    }
                    
                    // Simpan ke localStorage
                    saveDataToStorage();
                    
                    // Refresh semua tabel
                    refreshSuratMasukTable();
                    refreshSuratKeluarTable();
                    refreshArsipTable();
                    refreshLaporanTable();
                    
                    // Tutup modal
                    $('#backupRestoreModal').modal('hide');
                    
                    // Tampilkan notifikasi
                    showNotification('Berhasil', 'Restore data berhasil dilakukan', 'success');
                    
                    // Refresh dashboard
                    refreshDashboard();
                } catch (error) {
                    showNotification('Error', 'Gagal memproses file backup: ' + error.message, 'error');
                }
            };
            
            reader.onerror = function() {
                showNotification('Error', 'Gagal membaca file backup', 'error');
            };
            
            reader.readAsText(file);
        }
        
        // Fungsi untuk generate link Google Drive
        function generateDriveLink(inputId) {
            const baseUrl = 'https://drive.google.com/file/d/';
            const documentId = generateRandomId();
            const link = baseUrl + documentId + '/view';
            
            $(`#${inputId}`).val(link);
            
            showNotification('Info', 'Link Google Drive berhasil digenerate', 'info');
        }
        
        // Fungsi untuk generate random ID (simulasi ID dokumen Google Drive)
        function generateRandomId() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
            let result = '';
            
            for (let i = 0; i < 20; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            
            return result;
        }
        
        // Fungsi untuk validasi form
        function validateForm(formId) {
            let isValid = true;
            const form = document.getElementById(formId);
            
            // Sembunyikan semua pesan error
            $(`#${formId} .error-message`).hide();
            $(`#${formId} .form-control`).removeClass('input-error');
            
            // Validasi setiap field yang required
            $(`#${formId} [required]`).each(function() {
                if (!$(this).val().trim()) {
                    const errorId = `${$(this).attr('id')}Error`;
                    $(`#${errorId}`).text('Field ini harus diisi').show();
                    $(this).addClass('input-error');
                    isValid = false;
                }
            });
            
            return isValid;
        }
        
        // Fungsi untuk menampilkan notifikasi
        function showNotification(title, message, type = 'info') {
            const toast = $('#notificationToast');
            const toastTitle = $('#toastTitle');
            const toastMessage = $('#toastMessage');
            
            // Set judul dan pesan
            toastTitle.text(title);
            toastMessage.text(message);
            
            // Set warna berdasarkan jenis notifikasi
            switch (type) {
                case 'success':
                    toast.find('.toast-header').removeClass('bg-danger bg-warning').addClass('bg-success');
                    break;
                case 'error':
                    toast.find('.toast-header').removeClass('bg-success bg-warning').addClass('bg-danger');
                    break;
                case 'warning':
                    toast.find('.toast-header').removeClass('bg-success bg-danger').addClass('bg-warning');
                    break;
                default:
                    toast.find('.toast-header').removeClass('bg-success bg-danger bg-warning');
            }
            
            // Tampilkan notifikasi
            const bsToast = new bootstrap.Toast(toast);
            bsToast.show();
        }
        
        // Fungsi untuk ekspor data ke Excel
        function exportToExcel(data, fileName) {
            if (data.length === 0) {
                showNotification('Info', 'Tidak ada data untuk diekspor', 'info');
                return;
            }
            
            try {
                // Siapkan data untuk Excel
                let excelData = [];
                
                // Tentukan header berdasarkan jenis data
                if (fileName === 'surat_masuk') {
                    excelData = data.map(item => ({
                        'Tanggal': item.tanggal,
                        'Nomor Surat': item.nomor,
                        'Asal Surat': item.asal,
                        'Perihal': item.perihal,
                        'Kategori': item.kategori,
                        'Status': item.status,
                        'Link': item.link || '',
                        'Catatan': item.catatan || ''
                    }));
                } else if (fileName === 'surat_keluar') {
                    excelData = data.map(item => ({
                        'Tanggal': item.tanggal,
                        'Nomor Surat': item.nomor,
                        'Tujuan Surat': item.tujuan,
                        'Perihal': item.perihal,
                        'Kategori': item.kategori,
                        'Status': item.status,
                        'Link': item.link || '',
                        'Catatan': item.catatan || ''
                    }));
                } else if (fileName === 'arsip_surat') {
                    excelData = data.map(item => ({
                        'Tanggal': item.tanggal,
                        'Jenis': item.asal ? 'Masuk' : 'Keluar',
                        'Nomor Surat': item.nomor,
                        'Asal/Tujuan': item.asal || item.tujuan,
                        'Perihal': item.perihal,
                        'Kategori': item.kategori,
                        'Status': item.status,
                        'Link': item.link || '',
                        'Dihapus Pada': item.dihapusPada || ''
                    }));
                }
                
                // Buat worksheet
                const ws = XLSX.utils.json_to_sheet(excelData);
                
                // Buat workbook
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, 'Data');
                
                // Export ke file
                XLSX.writeFile(wb, `${fileName}-${new Date().toISOString().split('T')[0]}.xlsx`);
                
                showNotification('Berhasil', 'Data berhasil diekspor ke Excel', 'success');
            } catch (error) {
                showNotification('Error', 'Gagal mengekspor data: ' + error.message, 'error');
            }
        }
        
        // Fungsi untuk ekspor data ke PDF
        function exportToPdf() {
            // Dalam implementasi nyata, ini akan menggunakan jsPDF dengan autotable
            showNotification('Info', 'Fitur ekspor PDF akan segera hadir', 'info');
        }
    </script>
</body>
</html>
