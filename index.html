<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APLIKASI BARJAS - SISTEM BANTUAN</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root {
            --primary-color: #0d47a1;
            --secondary-color: #00695c;
            --accent-color: #ff8f00;
            --light-blue: #e3f2fd;
            --dark-blue: #082e5c;
            --gradient-primary: linear-gradient(135deg, var(--primary-color), var(--dark-blue));
            --gradient-secondary: linear-gradient(135deg, var(--secondary-color), #004d40);
            --gradient-accent: linear-gradient(135deg, var(--accent-color), #e65100);
            --shadow-sm: 0 2px 8px rgba(0,0,0,0.08);
            --shadow-md: 0 4px 16px rgba(0,0,0,0.12);
            --shadow-lg: 0 8px 28px rgba(0,0,0,0.15);
            --login-gradient: linear-gradient(135deg, #0d47a1, #00695c, #ff8f00);
        }
        
        body {
            background: linear-gradient(135deg, #f5f9ff 0%, #e8f5e9 100%);
            font-family: 'Poppins', 'Segoe UI', sans-serif;
            min-height: 100vh;
            padding: 10px 0;
            overflow-x: hidden;
        }
        
        .app-container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            box-shadow: var(--shadow-lg);
            border-radius: 12px;
            overflow: hidden;
            position: relative;
            z-index: 10;
        }
        
        .app-header {
            background: var(--gradient-primary);
            color: white;
            padding: 20px 15px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .app-header::before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.15) 0%, transparent 70%);
            pointer-events: none;
        }
        
        .app-logo {
            font-size: 2.5rem;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }
        
        .app-title {
            font-size: 1.8rem;
            font-weight: 800;
            margin: 0;
            position: relative;
            z-index: 1;
            text-shadow: 1px 1px 4px rgba(0,0,0,0.3);
        }
        
        .app-subtitle {
            font-size: 1rem;
            opacity: 0.95;
            position: relative;
            z-index: 1;
            font-weight: 300;
            letter-spacing: 0.5px;
            margin-bottom: 5px;
        }
        
        .nav-pills .nav-link {
            border-radius: 8px;
            margin-bottom: 8px;
            padding: 12px 15px;
            font-weight: 500;
            color: #444;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            font-size: 0.9rem;
        }
        
        .nav-pills .nav-link:hover {
            background-color: #f0f7ff;
            transform: translateX(3px);
        }
        
        .nav-pills .nav-link.active {
            background: var(--gradient-primary);
            font-weight: 600;
            box-shadow: var(--shadow-md);
            transform: translateX(3px);
            color: white;
        }
        
        .section-title {
            border-left: 4px solid var(--primary-color);
            padding-left: 12px;
            margin: 20px 0;
            font-weight: 700;
            color: var(--dark-blue);
            font-size: 1.4rem;
            position: relative;
        }
        
        .section-title::after {
            content: "";
            position: absolute;
            bottom: -5px;
            left: 12px;
            width: 40px;
            height: 2px;
            background: var(--gradient-primary);
            border-radius: 2px;
        }
        
        .btn-primary {
            background: var(--gradient-primary);
            border: none;
            padding: 10px 20px;
            font-weight: 600;
            box-shadow: var(--shadow-md);
            border-radius: 8px;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .btn-success {
            background: var(--gradient-secondary);
            border: none;
            padding: 10px 20px;
            font-weight: 600;
            box-shadow: var(--shadow-md);
            border-radius: 8px;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .btn-warning {
            background: var(--gradient-accent);
            border: none;
            padding: 10px 20px;
            font-weight: 600;
            box-shadow: var(--shadow-md);
            border-radius: 8px;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .form-label {
            font-weight: 600;
            color: #444;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            font-size: 0.9rem;
        }
        
        .form-label i {
            margin-right: 6px;
            color: var(--primary-color);
        }
        
        .form-control, .form-select {
            border-radius: 8px;
            padding: 12px 15px;
            border: 1px solid #ddd;
            transition: all 0.3s;
            box-shadow: var(--shadow-sm);
            font-size: 0.9rem;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(13, 71, 161, 0.2);
            transform: translateY(-2px);
        }
        
        .copyright {
            text-align: center;
            padding: 20px;
            background-color: var(--light-blue);
            color: var(--dark-blue);
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .data-table {
            font-size: 0.85rem;
            border-collapse: separate;
            border-spacing: 0;
            box-shadow: var(--shadow-sm);
            border-radius: 8px;
            overflow: hidden;
        }
        
        .data-table th {
            background: var(--gradient-primary);
            color: white;
            font-weight: 600;
            padding: 12px 10px;
            text-align: center;
            position: relative;
            font-size: 0.85rem;
        }
        
        .data-table th::after {
            content: "";
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 1px;
            background: rgba(255,255,255,0.3);
        }
        
        .data-table td {
            padding: 10px 8px;
            vertical-align: middle;
            border-bottom: 1px solid #eee;
            font-size: 0.85rem;
        }
        
        .data-table tr:nth-child(even) {
            background-color: #f9fbff;
        }
        
        .data-table tr:hover {
            background-color: #edf5ff;
        }
        
        .feature-icon {
            font-size: 1.1rem;
            margin-right: 8px;
            width: 24px;
            text-align: center;
        }
        
        .card {
            border-radius: 10px;
            border: none;
            box-shadow: var(--shadow-md);
            transition: all 0.3s ease;
            overflow: hidden;
            margin-bottom: 15px;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }
        
        .card-header {
            border-radius: 10px 10px 0 0 !important;
            font-weight: 600;
            padding: 15px 20px;
            background: var(--gradient-primary);
            color: white;
            font-size: 0.95rem;
        }
        
        .stats-box {
            text-align: center;
            padding: 20px 15px;
            border-radius: 10px;
            background: white;
            box-shadow: var(--shadow-md);
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
            margin-bottom: 15px;
        }
        
        .stats-box::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--gradient-primary);
            border-radius: 2px;
        }
        
        .stats-box:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }
        
        .stats-number {
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--primary-color);
            margin: 10px 0;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }
        
        .stats-label {
            font-size: 0.9rem;
            color: #666;
            font-weight: 500;
        }
        
        .notification-toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1050;
            min-width: 280px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            max-width: calc(100vw - 40px);
        }
        
        .input-error {
            border-color: #dc3545;
            box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.2);
        }
        
        .error-message {
            color: #dc3545;
            font-size: 0.8rem;
            margin-top: 5px;
            display: none;
            font-weight: 500;
        }
        
        .watermark {
            position: absolute;
            bottom: 10px;
            right: 15px;
            opacity: 0.8;
            font-size: 0.8rem;
            color: white;
            font-weight: 300;
        }
        
        .control-panel {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            box-shadow: var(--shadow-sm);
        }
        
        .control-title {
            font-size: 1rem;
            color: var(--primary-color);
            font-weight: 600;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--light-blue);
        }
        
        .floating-action-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--gradient-primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .floating-action-btn:hover {
            transform: scale(1.1) rotate(90deg);
        }
        
        .filter-section {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-sm);
        }
        
        .badge-custom {
            background: var(--gradient-primary);
            color: white;
            padding: 6px 12px;
            border-radius: 16px;
            font-weight: 600;
            font-size: 0.8rem;
        }
        
        .mobile-menu-btn {
            display: none;
            position: fixed;
            top: 15px;
            left: 15px;
            z-index: 1050;
            background: var(--gradient-primary);
            color: white;
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            box-shadow: var(--shadow-lg);
        }
        
        .sidebar-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1040;
        }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .animate-fadeIn {
            animation: fadeIn 0.5s ease forwards;
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 8px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 8px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--dark-blue);
        }
        
        /* Responsive styles */
        @media (max-width: 991.98px) {
            .col-md-3.col-lg-2 {
                position: fixed;
                left: -300px;
                top: 0;
                bottom: 0;
                z-index: 1050;
                width: 280px;
                transition: left 0.3s ease;
                overflow-y: auto;
                padding-top: 60px;
            }
            
            .col-md-3.col-lg-2.mobile-show {
                left: 0;
            }
            
            .col-md-9.col-lg-10 {
                width: 100%;
                flex: 0 0 100%;
                max-width: 100%;
            }
            
            .mobile-menu-btn {
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            .sidebar-overlay.mobile-show {
                display: block;
            }
        }
        
        /* Print Styles - IMPROVED FOR LANDSCAPE */
        @media print {
            @page {
                size: landscape;
                margin: 0.5cm;
            }
            
            body * {
                visibility: hidden;
            }
            
            .app-container, .app-container * {
                visibility: visible;
            }
            
            .app-container {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                box-shadow: none;
            }
            
            .nav-pills, .mobile-menu-btn, .sidebar-overlay, .floating-action-btn,
            .btn-group, .filter-section, .toast {
                display: none !important;
            }
            
            .col-md-3.col-lg-2.p-4.bg-light {
                display: none !important;
            }
            
            .col-md-9.col-lg-10.p-5 {
                width: 100%;
                flex: 0 0 100%;
                max-width: 100%;
                padding: 0 !important;
            }
            
            .copyright {
                display: none;
            }
            
            .data-table {
                font-size: 10px;
                width: 100% !important;
            }
            
            .data-table th, .data-table td {
                padding: 4px 2px;
            }
            
            /* Sembunyikan kolom aksi dan link Google Drive saat mencetak */
            .data-table th:last-child,
            .data-table td:last-child {
                display: none !important;
            }
            
            /* Judul untuk laporan cetak */
            .print-header {
                display: block !important;
                text-align: center;
                margin-bottom: 15px;
            }
            
            .print-title {
                font-size: 18px;
                font-weight: bold;
                margin-bottom: 5px;
            }
            
            .print-subtitle {
                font-size: 14px;
                margin-bottom: 10px;
            }
            
            .print-date {
                font-size: 12px;
                text-align: right;
                margin-bottom: 10px;
            }
        }

        /* WhatsApp link style */
        .whatsapp-link {
            color: #25D366;
            text-decoration: none;
        }
        
        .whatsapp-link:hover {
            text-decoration: underline;
        }
        
        /* View Link Button */
        .btn-view {
            background: linear-gradient(135deg, #17a2b8, #138496);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.8rem;
        }
        
        .btn-view:hover {
            background: linear-gradient(135deg, #138496, #117a8b);
            color: white;
        }
        
        /* Undo Button */
        .btn-undo {
            background: linear-gradient(135deg, #6c757d, #5a6268);
            color: white;
            border: none;
        }
        
        .btn-undo:hover {
            background: linear-gradient(135deg, #5a6268, #4e555b);
            color: white;
        }
        
        /* WhatsApp number link in table */
        .whatsapp-number {
            color: #25D366;
            cursor: pointer;
            text-decoration: underline;
        }
        
        /* Welcome Modal Styles */
        .welcome-modal .modal-content {
            border-radius: 15px;
            overflow: hidden;
            border: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .welcome-header {
            background: var(--gradient-primary);
            color: white;
            text-align: center;
            padding: 25px;
        }
        
        .welcome-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            color: white;
        }
        
        .welcome-body {
            padding: 25px;
            text-align: center;
        }
        
        .welcome-footer {
            background: #f8f9fa;
            padding: 15px;
            text-align: center;
            border-top: 1px solid #eee;
        }
        
        .countdown-timer {
            font-size: 0.9rem;
            color: #6c757d;
            margin-top: 10px;
        }
        
        /* Button untuk cetak per data */
        .btn-print-individual {
            background: linear-gradient(135deg, #6f42c1, #5a2d95);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.8rem;
        }
        
        .btn-print-individual:hover {
            background: linear-gradient(135deg, #5a2d95, #4a2479);
            color: white;
        }
        
        /* Developer Info Styles */
        .developer-info {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            box-shadow: var(--shadow-sm);
        }
        
        .developer-info h6 {
            color: var(--primary-color);
            font-weight: 600;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid #ddd;
        }
        
        .developer-contact p {
            margin-bottom: 8px;
            font-size: 0.85rem;
        }
        
        .developer-contact a {
            color: var(--primary-color);
            text-decoration: none;
            transition: all 0.3s;
        }
        
        .developer-contact a:hover {
            color: var(--dark-blue);
            text-decoration: underline;
        }
        
        /* Loading spinner */
        .spinner-border-sm {
            width: 1rem;
            height: 1rem;
        }

        /* Login Modal Styles */
        .login-modal .modal-content {
            border-radius: 15px;
            overflow: hidden;
            border: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .login-header {
            background: var(--login-gradient);
            color: white;
            text-align: center;
            padding: 25px 20px;
            position: relative;
        }

        .login-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            color: white;
        }

        .login-title {
            font-size: 1.8rem;
            font-weight: 700;
            margin: 0;
        }

        .login-subtitle {
            font-size: 1rem;
            opacity: 0.9;
            margin: 5px 0 0;
        }

        .login-body {
            padding: 25px;
            position: relative;
            z-index: 1;
        }

        .login-form-group {
            margin-bottom: 20px;
        }

        .login-form-label {
            font-weight: 600;
            color: var(--dark-blue);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
        }

        .login-form-label i {
            margin-right: 10px;
            color: var(--dark-blue);
        }

        .login-form-control {
            border-radius: 8px;
            padding: 12px 15px;
            border: 2px solid #ddd;
            transition: all 0.3s;
        }

        .login-form-control:focus {
            border-color: var(--dark-blue);
            box-shadow: 0 0 0 3px rgba(13, 71, 161, 0.2);
        }

        .login-input-group-text {
            background: var(--light-blue);
            border: 2px solid #ddd;
            border-left: none;
        }

        .btn-login {
            background: var(--gradient-secondary);
            color: white;
            border: none;
            padding: 12px;
            font-weight: 600;
            border-radius: 8px;
            width: 100%;
            transition: all 0.3s;
            margin-top: 10px;
        }

        .btn-login:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 105, 92, 0.4);
        }

        .btn-login:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .login-security-notice {
            text-align: center;
            margin-top: 20px;
            font-size: 0.85rem;
            color: #666;
        }

        .login-attempts-count {
            text-align: center;
            font-size: 0.9rem;
            color: #ff8f00;
            font-weight: 500;
            margin-top: 5px;
        }

        .login-blocked-message {
            text-align: center;
            background: rgba(220, 53, 69, 0.1);
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            color: #dc3545;
            font-weight: 500;
        }

        .login-countdown {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--dark-blue);
        }

        .login-developer-info {
            background: var(--light-blue);
            border-radius: 10px;
            padding: 20px;
            margin-top: 25px;
            text-align: center;
        }

        .login-developer-logo {
            max-width: 180px;
            margin-bottom: 15px;
            border-radius: 8px;
        }

        .login-developer-contact a {
            color: var(--dark-blue);
            text-decoration: none;
            transition: all 0.3s;
            display: inline-block;
            margin: 5px 0;
        }

        .login-developer-contact a:hover {
            color: var(--primary-color);
            text-decoration: underline;
            transform: translateY(-2px);
        }

        .login-copyright {
            text-align: center;
            margin-top: 20px;
            color: #666;
            font-size: 0.9rem;
            opacity: 0.9;
        }

        /* Animations */
        @keyframes login-shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-10px); }
            20%, 40%, 60%, 80% { transform: translateX(10px); }
        }

        .login-shake {
            animation: login-shake 0.6s cubic-bezier(.36,.07,.19,.97) both;
        }

        /* Login particle background */
        #login-particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1040; /* Higher than modal backdrop */
            display: none;
        }

        /* Link Google Drive dalam tabel */
        .drive-link {
            color: #0d47a1;
            text-decoration: none;
            cursor: pointer;
        }

        .drive-link:hover {
            text-decoration: underline;
        }

        /* Modal untuk menambah link */
        .link-modal .modal-dialog {
            max-width: 600px;
        }
        
        /* App content when not authenticated */
        .app-content-unauthenticated {
            display: none;
        }

        /* Search box for desa dropdown */
        .dropdown-search-container {
            position: relative;
        }

        .dropdown-search {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 8px;
            display: none;
        }

        .dropdown-search input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        /* Kode Validasi Styles */
        .kode-validasi-container {
            display: flex;
            align-items: center;
        }
        
        .kode-validasi-input {
            flex: 1;
            margin-right: 10px;
        }
        
        .btn-generate-kode {
            white-space: nowrap;
        }

        /* Auto-fill button styles */
        .btn-auto-fill {
            background: linear-gradient(135deg, #6c757d, #5a6268);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 0.85rem;
            margin-top: 8px;
        }
        
        .btn-auto-fill:hover {
            background: linear-gradient(135deg, #5a6268, #4e555b);
            color: white;
        }

        .login-hint {
            font-size: 0.85rem;
            color: #0d6efd;
            margin-top: 5px;
            text-align: center;
            background-color: #f8f9fa;
            padding: 8px;
            border-radius: 4px;
            border-left: 3px solid #0d6efd;
        }

        /* New styles for additional fields */
        .btn-not-group {
            background: linear-gradient(135deg, #6c757d, #5a6268);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 0.85rem;
            margin-top: 8px;
        }
        
        .btn-not-group:hover {
            background: linear-gradient(135deg, #5a6268, #4e555b);
            color: white;
        }

        .jenis-bantuan-container {
            display: flex;
            gap: 10px;
        }

        .jenis-bantuan-container select,
        .jenis-bantuan-container input {
            flex: 1;
        }

        /* WhatsApp input styling */
        .whatsapp-input-container {
            position: relative;
        }

        .whatsapp-prefix {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: #25D366;
            font-weight: bold;
        }

        .whatsapp-input {
            padding-left: 30px;
        }

        /* Preview modal styles */
        .preview-container {
            max-height: 70vh;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            background-color: #f9f9f9;
        }

        .preview-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        .preview-table th, 
        .preview-table td {
            padding: 8px;
            border: 1px solid #ddd;
            text-align: left;
        }

        .preview-table th {
            background-color: #f0f0f0;
            font-weight: bold;
        }

        .preview-table tr:nth-child(even) {
            background-color: #f8f8f8;
        }

        .preview-table tr:hover {
            background-color: #eaeaea;
        }
    </style>
</head>
<body>
    <!-- Login Modal -->
    <div class="modal fade login-modal" id="loginModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="login-header">
                    <div class="login-icon">
                        <i class="fas fa-lock"></i>
                    </div>
                    <h2 class="login-title">AUTHENTICATION REQUIRED</h2>
                    <p class="login-subtitle">Masukkan Kode Keamanan untuk Mengakses Aplikasi</p>
                </div>
                <div class="login-body">
                    <form id="loginForm">
                        <div class="mb-3 login-form-group">
                            <label class="form-label login-form-label">
                                <i class="fas fa-key"></i> Kode Keamanan
                            </label>
                            <div class="input-group">
                                <input type="password" class="form-control login-form-control" id="securityCode" placeholder="Masukkan kode akses aplikasi">
                                <button class="btn btn-outline-secondary toggle-password" type="button">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                            <div class="form-text text-danger login-attempts-count" id="attemptsCount"></div>
                            <div class="login-hint">
                                <i class="fas fa-lightbulb"></i> Kode default: 1234
                            </div>
                        </div>
                        <button type="submit" class="btn btn-login" id="loginButton">
                            <span class="login-button-text">Masuk ke Aplikasi</span>
                            <span class="spinner-border spinner-border-sm d-none" id="loginSpinner"></span>
                        </button>
                    </form>
                    
                    <div class="login-blocked-message d-none" id="blockedMessage">
                        <i class="fas fa-ban me-2"></i>
                        <span id="blockedText">Terlalu banyak percobaan gagal. Silakan coba lagi dalam </span>
                        <span class="login-countdown" id="countdown">30</span> detik.
                    </div>
                    
                    <div class="login-security-notice">
                        <i class="fas fa-shield-alt me-2"></i>Data Anda terlindungi dengan sistem keamanan terenkripsi
                    </div>
                    
                    <div class="login-developer-info">
                        <h6>Informasi Pengembang</h6>
                        <p class="mb-2">Untuk bantuan teknis atau pertanyaan, hubungi:</p>
                        <div class="login-developer-contact">
                            <p class="mb-1"><i class="fas fa-user me-2"></i>Admin BARJAS</p>
                            <p class="mb-1"><i class="fab fa-whatsapp me-2"></i><a href="https://wa.me/628123456789" target="_blank">+62 812-3456-789</a></p>
                            <p class="mb-0"><i class="fas fa-envelope me-2"></i><a href="mailto:admin@barjas.com">admin@barjas.com</a></p>
                        </div>
                    </div>
                    
                    <div class="login-copyright">
                        &copy; 2023 BARJAS - Sistem Bantuan Terpadu. All rights reserved.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Particles container for login background -->
    <div id="login-particles"></div>

    <!-- Mobile Menu Button -->
    <button class="mobile-menu-btn" id="mobileMenuBtn">
        <i class="fas fa-bars"></i>
    </button>

    <!-- Sidebar Overlay -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <div class="container-fluid app-container">
        <div class="row">
            <!-- Sidebar Menu -->
            <div class="col-md-3 col-lg-2 p-4 bg-light">
                <div class="position-sticky top-0">
                    <div class="text-center mb-4">
                        <div class="app-logo">
                            <i class="fas fa-hands-helping"></i>
                        </div>
                        <h1 class="app-title">BARJAS</h1>
                        <p class="app-subtitle">Sistem Bantuan Terpadu</p>
                    </div>

                    <ul class="nav nav-pills flex-column mb-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link active" data-bs-target="dashboard">
                                <i class="fas fa-tachometer-alt feature-icon"></i>
                                Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-target="inputData">
                                <i class="fas fa-pen-to-square feature-icon"></i>
                                Input Data Bantuan
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-target="dataTable">
                                <i class="fas fa-table feature-icon"></i>
                                Tabel Data Bantuan
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-target="statistik">
                                <i class="fas fa-chart-pie feature-icon"></i>
                                Statistik
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-target="pengaturan">
                                <i class="fas fa-cog feature-icon"></i>
                                Pengaturan
                            </a>
                        </li>
                    </ul>

                    <div class="developer-info mt-4">
                        <h6>Informasi Pengembang</h6>
                        <div class="developer-contact">
                            <p><i class="fab fa-whatsapp me-2"></i><a href="https://wa.me/628123456789" target="_blank" class="whatsapp-link">+62 812-3456-789</a></p>
                            <p><i class="fas fa-envelope me-2"></i><a href="mailto:admin@barjas.com">admin@barjas.com</a></p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Content -->
            <div class="col-md-9 col-lg-10 p-5">
                <!-- Dashboard Section -->
                <div class="app-content" id="dashboard">
                    <h2 class="section-title">Dashboard</h2>
                    
                    <div class="row mb-4">
                        <div class="col-md-4">
                            <div class="stats-box">
                                <i class="fas fa-users fa-2x text-primary"></i>
                                <div class="stats-number" id="totalPenerima">0</div>
                                <div class="stats-label">Total Penerima Bantuan</div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="stats-box">
                                <i class="fas fa-hand-holding-usd fa-2x text-success"></i>
                                <div class="stats-number" id="totalBantuan">0</div>
                                <div class="stats-label">Total Dana Bantuan</div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="stats-box">
                                <i class="fas fa-map-marker-alt fa-2x text-warning"></i>
                                <div class="stats-number" id="totalDesa">0</div>
                                <div class="stats-label">Desa Terjangkau</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-8">
                            <div class="card mb-4">
                                <div class="card-header">
                                    <i class="fas fa-chart-line me-2"></i>Statistik Bantuan per Bulan
                                </div>
                                <div class="card-body">
                                    <canvas id="monthlyChart" height="250"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card mb-4">
                                <div class="card-header">
                                    <i class="fas fa-chart-pie me-2"></i>Distribusi per Jenis Bantuan
                                </div>
                                <div class="card-body">
                                    <canvas id="typeChart" height="250"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <i class="fas fa-history me-2"></i>Aktivitas Terbaru
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover data-table">
                                    <thead>
                                        <tr>
                                            <th>Tanggal</th>
                                            <th>Nama Penerima</th>
                                            <th>Desa</th>
                                            <th>Jenis Bantuan</th>
                                            <th>Jumlah</th>
                                        </tr>
                                    </thead>
                                    <tbody id="recentActivities">
                                        <tr>
                                            <td colspan="5" class="text-center">Tidak ada data</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Input Data Section -->
                <div class="app-content d-none" id="inputData">
                    <h2 class="section-title">Input Data Bantuan</h2>
                    
                    <form id="bantuanForm">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="card mb-4">
                                    <div class="card-header">Data Penerima</div>
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <label class="form-label"><i class="fas fa-id-card"></i> Nama Lengkap</label>
                                            <input type="text" class="form-control" id="nama" name="nama" required>
                                            <div class="error-message" id="namaError">Nama harus diisi</div>
                                        </div>
                                        
                                        <div class="mb-3">
                                            <label class="form-label"><i class="fas fa-venus-mars"></i> Jenis Kelamin</label>
                                            <select class="form-select" id="jenisKelamin" name="jenisKelamin" required>
                                                <option value="">Pilih Jenis Kelamin</option>
                                                <option value="Laki-laki">Laki-laki</option>
                                                <option value="Perempuan">Perempuan</option>
                                            </select>
                                            <div class="error-message" id="jenisKelaminError">Jenis kelamin harus dipilih</div>
                                        </div>
                                        
                                        <div class="mb-3">
                                            <label class="form-label"><i class="fas fa-phone"></i> Nomor WhatsApp</label>
                                            <div class="whatsapp-input-container">
                                                <span class="whatsapp-prefix">+62</span>
                                                <input type="text" class="form-control whatsapp-input" id="whatsapp" name="whatsapp" placeholder="8123456789" required>
                                            </div>
                                            <div class="error-message" id="whatsappError">Nomor WhatsApp harus diisi dengan benar</div>
                                        </div>
                                        
                                        <div class="mb-3">
                                            <label class="form-label"><i class="fas fa-map-marker-alt"></i> Desa</label>
                                            <div class="dropdown-search-container">
                                                <select class="form-select" id="desa" name="desa" required>
                                                    <option value="">Pilih Desa</option>
                                                    <option value="Desa A">Desa A</option>
                                                    <option value="Desa B">Desa B</option>
                                                    <option value="Desa C">Desa C</option>
                                                    <option value="Desa D">Desa D</option>
                                                    <option value="Desa E">Desa E</option>
                                                </select>
                                                <div class="dropdown-search" id="desaSearch">
                                                    <input type="text" placeholder="Cari desa..." id="searchDesa">
                                                </div>
                                            </div>
                                            <div class="error-message" id="desaError">Desa harus dipilih</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="card mb-4">
                                    <div class="card-header">Detail Bantuan</div>
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <label class="form-label"><i class="fas fa-calendar"></i> Tanggal Penerimaan</label>
                                            <input type="text" class="form-control datepicker" id="tanggal" name="tanggal" required>
                                            <div class="error-message" id="tanggalError">Tanggal harus diisi</div>
                                        </div>
                                        
                                        <div class="mb-3">
                                            <label class="form-label"><i class="fas fa-gift"></i> Jenis Bantuan</label>
                                            <div class="jenis-bantuan-container">
                                                <select class="form-select" id="jenisBantuan" name="jenisBantuan" required>
                                                    <option value="">Pilih Jenis</option>
                                                    <option value="Tunai">Tunai</option>
                                                    <option value="Sembako">Sembako</option>
                                                    <option value="Pakaian">Pakaian</option>
                                                    <option value="Lainnya">Lainnya</option>
                                                </select>
                                                <input type="text" class="form-control d-none" id="jenisBantuanLainnya" name="jenisBantuanLainnya" placeholder="Jenis lainnya">
                                            </div>
                                            <div class="error-message" id="jenisBantuanError">Jenis bantuan harus dipilih</div>
                                        </div>
                                        
                                        <div class="mb-3">
                                            <label class="form-label"><i class="fas fa-money-bill-wave"></i> Jumlah Bantuan (Rp)</label>
                                            <input type="text" class="form-control" id="jumlah" name="jumlah" required>
                                            <div class="error-message" id="jumlahError">Jumlah bantuan harus diisi dengan angka</div>
                                        </div>
                                        
                                        <div class="mb-3">
                                            <label class="form-label"><i class="fas fa-link"></i> Link Google Drive</label>
                                            <input type="url" class="form-control" id="driveLink" name="driveLink" placeholder="https://drive.google.com/...">
                                            <div class="error-message" id="driveLinkError">Format URL tidak valid</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-12">
                                <div class="card mb-4">
                                    <div class="card-header">Kode Validasi</div>
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <label class="form-label"><i class="fas fa-shield-alt"></i> Kode Validasi Data</label>
                                            <div class="kode-validasi-container">
                                                <input type="text" class="form-control kode-validasi-input" id="kodeValidasi" name="kodeValidasi" required>
                                                <button type="button" class="btn btn-secondary btn-generate-kode" id="generateKode">Generate Kode</button>
                                            </div>
                                            <div class="form-text">Kode validasi digunakan untuk memverifikasi keaslian data</div>
                                            <div class="error-message" id="kodeValidasiError">Kode validasi harus diisi</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="d-flex justify-content-between">
                            <button type="button" class="btn btn-secondary btn-undo" id="resetForm">
                                <i class="fas fa-undo me-2"></i>Reset Form
                            </button>
                            <div>
                                <button type="button" class="btn btn-info me-2" id="previewData">
                                    <i class="fas fa-eye me-2"></i>Preview
                                </button>
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save me-2"></i>Simpan Data
                                </button>
                            </div>
                        </div>
                    </form>
                </div>

                <!-- Data Table Section -->
                <div class="app-content d-none" id="dataTable">
                    <h2 class="section-title">Tabel Data Bantuan</h2>
                    
                    <div class="filter-section mb-4">
                        <div class="row">
                            <div class="col-md-3">
                                <label class="form-label">Filter Berdasarkan Desa</label>
                                <select class="form-select" id="filterDesa">
                                    <option value="">Semua Desa</option>
                                    <option value="Desa A">Desa A</option>
                                    <option value="Desa B">Desa B</option>
                                    <option value="Desa C">Desa C</option>
                                    <option value="Desa D">Desa D</option>
                                    <option value="Desa E">Desa E</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Filter Berdasarkan Jenis Bantuan</label>
                                <select class="form-select" id="filterJenis">
                                    <option value="">Semua Jenis</option>
                                    <option value="Tunai">Tunai</option>
                                    <option value="Sembako">Sembako</option>
                                    <option value="Pakaian">Pakaian</option>
                                    <option value="Lainnya">Lainnya</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Filter Berdasarkan Tanggal</label>
                                <input type="text" class="form-control datepicker" id="filterTanggal" placeholder="Pilih tanggal">
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Pencarian</label>
                                <div class="input-group">
                                    <input type="text" class="form-control" id="searchInput" placeholder="Cari data...">
                                    <button class="btn btn-outline-secondary" type="button" id="clearSearch">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="control-panel mb-4">
                        <h6 class="control-title">Kontrol Data</h6>
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <button class="btn btn-success me-2" id="exportExcel">
                                    <i class="fas fa-file-excel me-2"></i>Export Excel
                                </button>
                                <button class="btn btn-danger" id="exportPDF">
                                    <i class="fas fa-file-pdf me-2"></i>Export PDF
                                </button>
                            </div>
                            <div>
                                <button class="btn btn-warning me-2" id="printSelected">
                                    <i class="fas fa-print me-2"></i>Cetak Terpilih
                                </button>
                                <button class="btn btn-info" id="printAll">
                                    <i class="fas fa-print me-2"></i>Cetak Semua
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="table-responsive">
                        <table class="table table-striped table-bordered data-table" id="bantuanTable">
                            <thead>
                                <tr>
                                    <th width="50">
                                        <input type="checkbox" id="selectAll">
                                    </th>
                                    <th>No</th>
                                    <th>Tanggal</th>
                                    <th>Nama Penerima</th>
                                    <th>WhatsApp</th>
                                    <th>Desa</th>
                                    <th>Jenis Bantuan</th>
                                    <th>Jumlah (Rp)</th>
                                    <th>Link Drive</th>
                                    <th width="120">Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="tableBody">
                                <tr>
                                    <td colspan="10" class="text-center">Tidak ada data</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="d-flex justify-content-between align-items-center mt-3">
                        <div class="form-text">
                            Menampilkan <span id="rowsCount">0</span> dari <span id="totalRows">0</span> data
                        </div>
                        <nav>
                            <ul class="pagination justify-content-end" id="pagination">
                                <li class="page-item disabled">
                                    <a class="page-link" href="#" tabindex="-1">Previous</a>
                                </li>
                                <li class="page-item active"><a class="page-link" href="#">1</a></li>
                                <li class="page-item disabled">
                                    <a class="page-link" href="#">Next</a>
                                </li>
                            </ul>
                        </nav>
                    </div>
                </div>

                <!-- Statistik Section -->
                <div class="app-content d-none" id="statistik">
                    <h2 class="section-title">Statistik Bantuan</h2>
                    
                    <div class="row mb-4">
                        <div class="col-md-8">
                            <div class="card">
                                <div class="card-header">Grafik Distribusi per Desa</div>
                                <div class="card-body">
                                    <canvas id="desaChart" height="250"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-header">Ringkasan Statistik</div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <h6>Total Penerima</h6>
                                        <div class="d-flex justify-content-between">
                                            <span>Laki-laki</span>
                                            <span id="statLaki">0</span>
                                        </div>
                                        <div class="d-flex justify-content-between">
                                            <span>Perempuan</span>
                                            <span id="statPerempuan">0</span>
                                        </div>
                                        <hr>
                                        <div class="d-flex justify-content-between fw-bold">
                                            <span>Total</span>
                                            <span id="statTotal">0</span>
                                        </div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <h6>Total Dana</h6>
                                        <div class="d-flex justify-content-between">
                                            <span>Tunai</span>
                                            <span id="statTunai">Rp 0</span>
                                        </div>
                                        <div class="d-flex justify-content-between">
                                            <span>Non-Tunai</span>
                                            <span id="statNonTunai">Rp 0</span>
                                        </div>
                                        <hr>
                                        <div class="d-flex justify-content-between fw-bold">
                                            <span>Total</span>
                                            <span id="statTotalDana">Rp 0</span>
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <h6>Desa Terbanyak</h6>
                                        <ol id="topDesa">
                                            <li>Tidak ada data</li>
                                        </ol>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">Data Statistik per Jenis Bantuan</div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-bordered data-table">
                                    <thead>
                                        <tr>
                                            <th>Jenis Bantuan</th>
                                            <th>Jumlah Penerima</th>
                                            <th>Total Dana</th>
                                            <th>Rata-rata per Penerima</th>
                                            <th>Persentase</th>
                                        </tr>
                                    </thead>
                                    <tbody id="statistikTable">
                                        <tr>
                                            <td colspan="5" class="text-center">Tidak ada data</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Pengaturan Section -->
                <div class="app-content d-none" id="pengaturan">
                    <h2 class="section-title">Pengaturan Aplikasi</h2>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card mb-4">
                                <div class="card-header">Pengaturan Umum</div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <label class="form-label">Nama Aplikasi</label>
                                        <input type="text" class="form-control" value="BARJAS - Sistem Bantuan Terpadu" disabled>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label class="form-label">Versi Aplikasi</label>
                                        <input type="text" class="form-control" value="v2.1.0" disabled>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label class="form-label">Kode Keamanan</label>
                                        <input type="password" class="form-control" id="adminPassword" placeholder="Masukkan kode keamanan">
                                    </div>
                                    
                                    <div class="form-check form-switch mb-3">
                                        <input class="form-check-input" type="checkbox" id="notifikasiSwitch" checked>
                                        <label class="form-check-label" for="notifikasiSwitch">Aktifkan Notifikasi</label>
                                    </div>
                                    
                                    <div class="form-check form-switch mb-3">
                                        <input class="form-check-input" type="checkbox" id="backupSwitch" checked>
                                        <label class="form-check-label" for="backupSwitch">Backup Otomatis</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="card mb-4">
                                <div class="card-header">Manajemen Data</div>
                                <div class="card-body">
                                    <div class="d-grid gap-2">
                                        <button class="btn btn-success mb-2" id="backupData">
                                            <i class="fas fa-download me-2"></i>Backup Data
                                        </button>
                                        
                                        <button class="btn btn-primary mb-2" id="restoreData">
                                            <i class="fas fa-upload me-2"></i>Restore Data
                                        </button>
                                        
                                        <button class="btn btn-warning mb-2" id="resetData">
                                            <i class="fas fa-trash-restore me-2"></i>Reset Data
                                        </button>
                                        
                                        <button class="btn btn-danger mb-2" id="clearAllData">
                                            <i class="fas fa-trash me-2"></i>Hapus Semua Data
                                        </button>
                                    </div>
                                    
                                    <div class="mt-4">
                                        <label class="form-label">Import Data dari File Excel</label>
                                        <input type="file" class="form-control" id="importFile" accept=".xlsx, .xls">
                                        <div class="form-text">File harus dalam format Excel (.xlsx atau .xls)</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">Informasi Sistem</div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">Browser</label>
                                        <input type="text" class="form-control" id="browserInfo" disabled>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label class="form-label">Ukuran Layar</label>
                                        <input type="text" class="form-control" id="screenInfo" disabled>
                                    </div>
                                </div>
                                
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">Local Storage</label>
                                        <input type="text" class="form-control" id="storageInfo" disabled>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label class="form-label">Status Koneksi</label>
                                        <input type="text" class="form-control" id="connectionInfo" disabled>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="copyright">
            &copy; 2023 BARJAS - Sistem Bantuan Terpadu. All rights reserved.
            <div class="watermark">v2.1.0</div>
        </div>
    </div>

    <!-- Floating Action Button -->
    <div class="floating-action-btn" id="fab">
        <i class="fas fa-plus"></i>
    </div>

    <!-- Toast Notification -->
    <div class="toast notification-toast" id="notificationToast" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="toast-header">
            <i class="fas fa-bell text-primary me-2"></i>
            <strong class="me-auto">BARJAS Notification</strong>
            <small>Just now</small>
            <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
        <div class="toast-body" id="toastMessage">
            Hello, world! This is a toast message.
        </div>
    </div>

    <!-- Preview Modal -->
    <div class="modal fade" id="previewModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Preview Data</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="preview-container">
                        <table class="preview-table">
                            <tr>
                                <th>Nama Lengkap</th>
                                <td id="previewNama"></td>
                            </tr>
                            <tr>
                                <th>Jenis Kelamin</th>
                                <td id="previewJenisKelamin"></td>
                            </tr>
                            <tr>
                                <th>WhatsApp</th>
                                <td id="previewWhatsApp"></td>
                            </tr>
                            <tr>
                                <th>Desa</th>
                                <td id="previewDesa"></td>
                            </tr>
                            <tr>
                                <th>Tanggal Penerimaan</th>
                                <td id="previewTanggal"></td>
                            </tr>
                            <tr>
                                <th>Jenis Bantuan</th>
                                <td id="previewJenisBantuan"></td>
                            </tr>
                            <tr>
                                <th>Jumlah Bantuan</th>
                                <td id="previewJumlah"></td>
                            </tr>
                            <tr>
                                <th>Link Google Drive</th>
                                <td id="previewDriveLink"></td>
                            </tr>
                            <tr>
                                <th>Kode Validasi</th>
                                <td id="previewKodeValidasi"></td>
                            </tr>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Link Modal -->
    <div class="modal fade link-modal" id="addLinkModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Tambah Link Google Drive</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Link Google Drive</label>
                        <input type="url" class="form-control" id="modalDriveLink" placeholder="https://drive.google.com/...">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                    <button type="button" class="btn btn-primary" id="saveLink">Simpan</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/particles.js/2.0.0/particles.min.js"></script>
    
    <script>
        // Inisialisasi variabel global
        let bantuanData = [];
        let currentEditId = null;
        let loginAttempts = 0;
        let isBlocked = false;
        let blockTime = 30; // Waktu blokir dalam detik
        let blockTimer = null;
        let currentPage = 1;
        const rowsPerPage = 10;

        // DOM Ready
        $(document).ready(function() {
            // Inisialisasi komponen
            initializeComponents();
            
            // Load data dari localStorage
            loadData();
            
            // Tampilkan modal login
            $('#loginModal').modal('show');
            
            // Setup event listeners
            setupEventListeners();
            
            // Update informasi sistem
            updateSystemInfo();
        });

        // Inisialisasi komponen
        function initializeComponents() {
            // Inisialisasi datepicker
            $('.datepicker').datepicker({
                format: 'dd-mm-yyyy',
                autoclose: true,
                todayHighlight: true
            });
            
            // Set tanggal hari ini sebagai default
            $('#tanggal').datepicker('setDate', new Date());
            
            // Inisialisasi toast
            const toastEl = document.getElementById('notificationToast');
            const toast = new bootstrap.Toast(toastEl, {
                autohide: true,
                delay: 3000
            });
            
            // Toggle password visibility
            $('.toggle-password').click(function() {
                const input = $('#securityCode');
                const icon = $(this).find('i');
                
                if (input.attr('type') === 'password') {
                    input.attr('type', 'text');
                    icon.removeClass('fa-eye').addClass('fa-eye-slash');
                } else {
                    input.attr('type', 'password');
                    icon.removeClass('fa-eye-slash').addClass('fa-eye');
                }
            });
            
            // Toggle jenis bantuan lainnya
            $('#jenisBantuan').change(function() {
                if ($(this).val() === 'Lainnya') {
                    $('#jenisBantuanLainnya').removeClass('d-none');
                    $('#jenisBantuanLainnya').prop('required', true);
                } else {
                    $('#jenisBantuanLainnya').addClass('d-none');
                    $('#jenisBantuanLainnya').prop('required', false);
                }
            });
            
            // Dropdown search untuk desa
            $('#desa').focus(function() {
                $('#desaSearch').show();
            });
            
            $('#searchDesa').on('keyup', function() {
                const value = $(this).val().toLowerCase();
                $('#desa option').each(function() {
                    const text = $(this).text().toLowerCase();
                    if (text.indexOf(value) > -1) {
                        $(this).show();
                    } else {
                        $(this).hide();
                    }
                });
            });
            
            $(document).on('click', function(e) {
                if (!$(e.target).closest('#desa, #desaSearch').length) {
                    $('#desaSearch').hide();
                }
            });
        }

        // Setup event listeners
        function setupEventListeners() {
            // Login form submission
            $('#loginForm').on('submit', function(e) {
                e.preventDefault();
                handleLogin();
            });
            
            // Navigation menu
            $('.nav-link').on('click', function(e) {
                e.preventDefault();
                const target = $(this).data('bs-target');
                showSection(target);
                
                // Update active class
                $('.nav-link').removeClass('active');
                $(this).addClass('active');
                
                // Hide sidebar on mobile after selection
                if ($(window).width() < 992) {
                    $('.col-md-3.col-lg-2').removeClass('mobile-show');
                    $('#sidebarOverlay').removeClass('mobile-show');
                }
            });
            
            // Mobile menu button
            $('#mobileMenuBtn').on('click', function() {
                $('.col-md-3.col-lg-2').addClass('mobile-show');
                $('#sidebarOverlay').addClass('mobile-show');
            });
            
            // Sidebar overlay
            $('#sidebarOverlay').on('click', function() {
                $('.col-md-3.col-lg-2').removeClass('mobile-show');
                $(this).removeClass('mobile-show');
            });
            
            // Form submission
            $('#bantuanForm').on('submit', function(e) {
                e.preventDefault();
                handleFormSubmit();
            });
            
            // Reset form
            $('#resetForm').on('click', function() {
                resetForm();
            });
            
            // Generate kode validasi
            $('#generateKode').on('click', function() {
                generateKodeValidasi();
            });
            
            // Preview data
            $('#previewData').on('click', function() {
                previewData();
            });
            
            // Filter data
            $('#filterDesa, #filterJenis, #filterTanggal, #searchInput').on('change keyup', function() {
                filterData();
            });
            
            // Clear search
            $('#clearSearch').on('click', function() {
                $('#searchInput').val('');
                filterData();
            });
            
            // Export buttons
            $('#exportExcel').on('click', function() {
                exportToExcel();
            });
            
            $('#exportPDF').on('click', function() {
                exportToPDF();
            });
            
            // Print buttons
            $('#printSelected').on('click', function() {
                printSelected();
            });
            
            $('#printAll').on('click', function() {
                printAll();
            });
            
            // Select all checkbox
            $('#selectAll').on('change', function() {
                const isChecked = $(this).prop('checked');
                $('.row-checkbox').prop('checked', isChecked);
            });
            
            // Pengaturan buttons
            $('#backupData').on('click', function() {
                backupData();
            });
            
            $('#restoreData').on('click', function() {
                restoreData();
            });
            
            $('#resetData').on('click', function() {
                resetData();
            });
            
            $('#clearAllData').on('click', function() {
                clearAllData();
            });
            
            // Import file
            $('#importFile').on('change', function(e) {
                importData(e);
            });
            
            // FAB button
            $('#fab').on('click', function() {
                showSection('inputData');
                $('.nav-link').removeClass('active');
                $('.nav-link[data-bs-target="inputData"]').addClass('active');
            });
        }

        // Handle login
        function handleLogin() {
            const securityCode = $('#securityCode').val();
            const loginButton = $('#loginButton');
            const loginSpinner = $('#loginSpinner');
            const loginButtonText = $('.login-button-text');
            
            // Tampilkan spinner, sembunyikan teks
            loginButton.prop('disabled', true);
            loginSpinner.removeClass('d-none');
            loginButtonText.text('Memverifikasi...');
            
            // Simulasi proses login (dalam aplikasi nyata, ini akan memverifikasi dengan backend)
            setTimeout(function() {
                if (isBlocked) {
                    showNotification('Anda masih dalam masa blokir. Silakan coba lagi nanti.', 'error');
                    loginSpinner.addClass('d-none');
                    loginButtonText.text('Masuk ke Aplikasi');
                    loginButton.prop('disabled', false);
                    return;
                }
                
                // Kode default: 1234
                if (securityCode === '1234') {
                    // Login berhasil
                    loginAttempts = 0;
                    $('#attemptsCount').text('');
                    $('#loginModal').modal('hide');
                    $('.app-content-unauthenticated').show();
                    showNotification('Login berhasil! Selamat datang di BARJAS.', 'success');
                    
                    // Update dashboard
                    updateDashboard();
                } else {
                    // Login gagal
                    loginAttempts++;
                    
                    if (loginAttempts >= 3) {
                        // Blokir setelah 3 kali percobaan gagal
                        isBlocked = true;
                        $('#blockedMessage').removeClass('d-none');
                        $('#attemptsCount').text('');
                        
                        // Mulai countdown
                        startBlockCountdown();
                    } else {
                        $('#attemptsCount').text(`Percobaan login gagal: ${loginAttempts} dari 3`);
                        showNotification('Kode keamanan salah. Silakan coba lagi.', 'error');
                    }
                }
                
                // Sembunyikan spinner, tampilkan teks
                loginSpinner.addClass('d-none');
                loginButtonText.text('Masuk ke Aplikasi');
                loginButton.prop('disabled', false);
            }, 1000);
        }

        // Start block countdown
        function startBlockCountdown() {
            let seconds = blockTime;
            
            $('#countdown').text(seconds);
            
            blockTimer = setInterval(function() {
                seconds--;
                
                if (seconds <= 0) {
                    clearInterval(blockTimer);
                    isBlocked = false;
                    loginAttempts = 0;
                    $('#blockedMessage').addClass('d-none');
                    $('#attemptsCount').text('');
                } else {
                    $('#countdown').text(seconds);
                }
            }, 1000);
        }

        // Show section
        function showSection(sectionId) {
            $('.app-content').addClass('d-none');
            $(`#${sectionId}`).removeClass('d-none');
            
            // Jika section adalah dashboard, update data
            if (sectionId === 'dashboard') {
                updateDashboard();
            }
            
            // Jika section adalah statistik, update chart
            if (sectionId === 'statistik') {
                updateStatistik();
            }
            
            // Jika section adalah dataTable, refresh tabel
            if (sectionId === 'dataTable') {
                renderTable();
            }
        }

        // Load data from localStorage
        function loadData() {
            const savedData = localStorage.getItem('bantuanData');
            if (savedData) {
                bantuanData = JSON.parse(savedData);
            }
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('bantuanData', JSON.stringify(bantuanData));
        }

        // Handle form submission
        function handleFormSubmit() {
            // Validasi form
            if (!validateForm()) {
                showNotification('Harap periksa kembali form input. Terdapat data yang tidak valid.', 'error');
                return;
            }
            
            // Ambil data dari form
            const formData = {
                id: currentEditId || Date.now().toString(),
                nama: $('#nama').val(),
                jenisKelamin: $('#jenisKelamin').val(),
                whatsapp: $('#whatsapp').val(),
                desa: $('#desa').val(),
                tanggal: $('#tanggal').val(),
                jenisBantuan: $('#jenisBantuan').val() === 'Lainnya' ? $('#jenisBantuanLainnya').val() : $('#jenisBantuan').val(),
                jumlah: $('#jumlah').val().replace(/\./g, ''),
                driveLink: $('#driveLink').val(),
                kodeValidasi: $('#kodeValidasi').val(),
                timestamp: new Date().toISOString()
            };
            
            // Jika sedang edit, update data. Jika tidak, tambah data baru
            if (currentEditId) {
                const index = bantuanData.findIndex(item => item.id === currentEditId);
                if (index !== -1) {
                    bantuanData[index] = formData;
                    showNotification('Data berhasil diperbarui.', 'success');
                }
                currentEditId = null;
            } else {
                bantuanData.push(formData);
                showNotification('Data berhasil disimpan.', 'success');
            }
            
            // Simpan ke localStorage
            saveData();
            
            // Reset form
            resetForm();
            
            // Update dashboard
            updateDashboard();
            
            // Jika di section dataTable, refresh tabel
            if ($('#dataTable').is(':visible')) {
                renderTable();
            }
        }

        // Validate form
        function validateForm() {
            let isValid = true;
            
            // Reset error messages
            $('.error-message').hide();
            $('.form-control, .form-select').removeClass('input-error');
            
            // Validasi nama
            if ($('#nama').val().trim() === '') {
                $('#namaError').show();
                $('#nama').addClass('input-error');
                isValid = false;
            }
            
            // Validasi jenis kelamin
            if ($('#jenisKelamin').val() === '') {
                $('#jenisKelaminError').show();
                $('#jenisKelamin').addClass('input-error');
                isValid = false;
            }
            
            // Validasi WhatsApp
            const whatsapp = $('#whatsapp').val();
            if (whatsapp.trim() === '' || !/^[0-9]{9,12}$/.test(whatsapp)) {
                $('#whatsappError').show();
                $('#whatsapp').addClass('input-error');
                isValid = false;
            }
            
            // Validasi desa
            if ($('#desa').val() === '') {
                $('#desaError').show();
                $('#desa').addClass('input-error');
                isValid = false;
            }
            
            // Validasi tanggal
            if ($('#tanggal').val() === '') {
                $('#tanggalError').show();
                $('#tanggal').addClass('input-error');
                isValid = false;
            }
            
            // Validasi jenis bantuan
            if ($('#jenisBantuan').val() === '') {
                $('#jenisBantuanError').show();
                $('#jenisBantuan').addClass('input-error');
                isValid = false;
            } else if ($('#jenisBantuan').val() === 'Lainnya' && $('#jenisBantuanLainnya').val().trim() === '') {
                $('#jenisBantuanError').show();
                $('#jenisBantuanLainnya').addClass('input-error');
                isValid = false;
            }
            
            // Validasi jumlah
            const jumlah = $('#jumlah').val().replace(/\./g, '');
            if (jumlah === '' || isNaN(jumlah) || parseInt(jumlah) <= 0) {
                $('#jumlahError').show();
                $('#jumlah').addClass('input-error');
                isValid = false;
            }
            
            // Validasi drive link (jika diisi)
            const driveLink = $('#driveLink').val();
            if (driveLink !== '' && !isValidUrl(driveLink)) {
                $('#driveLinkError').show();
                $('#driveLink').addClass('input-error');
                isValid = false;
            }
            
            // Validasi kode validasi
            if ($('#kodeValidasi').val().trim() === '') {
                $('#kodeValidasiError').show();
                $('#kodeValidasi').addClass('input-error');
                isValid = false;
            }
            
            return isValid;
        }

        // Check if URL is valid
        function isValidUrl(string) {
            try {
                new URL(string);
                return true;
            } catch (_) {
                return false;
            }
        }

        // Reset form
        function resetForm() {
            $('#bantuanForm')[0].reset();
            $('#jenisBantuanLainnya').addClass('d-none');
            $('#jenisBantuanLainnya').prop('required', false);
            $('.error-message').hide();
            $('.form-control, .form-select').removeClass('input-error');
            currentEditId = null;
            $('#tanggal').datepicker('setDate', new Date());
        }

        // Generate kode validasi
        function generateKodeValidasi() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let result = '';
            for (let i = 0; i < 6; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            $('#kodeValidasi').val(result);
        }

        // Preview data
        function previewData() {
            // Validasi form terlebih dahulu
            if (!validateForm()) {
                showNotification('Harap periksa kembali form input. Terdapat data yang tidak valid.', 'error');
                return;
            }
            
            // Isi data preview
            $('#previewNama').text($('#nama').val());
            $('#previewJenisKelamin').text($('#jenisKelamin').val());
            $('#previewWhatsApp').text('+62' + $('#whatsapp').val());
            $('#previewDesa').text($('#desa').val());
            $('#previewTanggal').text($('#tanggal').val());
            
            const jenisBantuan = $('#jenisBantuan').val() === 'Lainnya' ? $('#jenisBantuanLainnya').val() : $('#jenisBantuan').val();
            $('#previewJenisBantuan').text(jenisBantuan);
            
            $('#previewJumlah').text(formatRupiah($('#jumlah').val()));
            $('#previewDriveLink').text($('#driveLink').val() || '-');
            $('#previewKodeValidasi').text($('#kodeValidasi').val());
            
            // Tampilkan modal preview
            $('#previewModal').modal('show');
        }

        // Format number to Rupiah
        function formatRupiah(angka) {
            if (!angka) return 'Rp 0';
            
            // Hapus semua karakter non-digit
            const number_string = angka.toString().replace(/[^,\d]/g, '');
            
            // Format dengan titik sebagai pemisah ribuan
            const split = number_string.split(',');
            const sisa = split[0].length % 3;
            let rupiah = split[0].substr(0, sisa);
            const ribuan = split[0].substr(sisa).match(/\d{3}/gi);
            
            if (ribuan) {
                const separator = sisa ? '.' : '';
                rupiah += separator + ribuan.join('.');
            }
            
            rupiah = split[1] !== undefined ? rupiah + ',' + split[1] : rupiah;
            return 'Rp ' + rupiah;
        }

        // Render table
        function renderTable() {
            const tableBody = $('#tableBody');
            tableBody.empty();
            
            if (bantuanData.length === 0) {
                tableBody.append('<tr><td colspan="10" class="text-center">Tidak ada data</td></tr>');
                return;
            }
            
            // Filter data
            const filteredData = filterData();
            
            // Pagination
            const totalPages = Math.ceil(filteredData.length / rowsPerPage);
            updatePagination(totalPages);
            
            const startIndex = (currentPage - 1) * rowsPerPage;
            const endIndex = Math.min(startIndex + rowsPerPage, filteredData.length);
            
            // Update rows count
            $('#rowsCount').text(`${startIndex + 1}-${endIndex}`);
            $('#totalRows').text(filteredData.length);
            
            // Render rows
            for (let i = startIndex; i < endIndex; i++) {
                const item = filteredData[i];
                const row = `
                    <tr>
                        <td class="text-center">
                            <input type="checkbox" class="row-checkbox" data-id="${item.id}">
                        </td>
                        <td class="text-center">${i + 1}</td>
                        <td>${item.tanggal}</td>
                        <td>${item.nama}</td>
                        <td>
                            <a href="https://wa.me/62${item.whatsapp}" target="_blank" class="whatsapp-number">+62${item.whatsapp}</a>
                        </td>
                        <td>${item.desa}</td>
                        <td>${item.jenisBantuan}</td>
                        <td>${formatRupiah(item.jumlah)}</td>
                        <td>
                            ${item.driveLink ? `<a href="${item.driveLink}" target="_blank" class="drive-link">Lihat Dokumen</a>` : '-'}
                        </td>
                        <td class="text-center">
                            <button class="btn btn-sm btn-primary me-1 edit-btn" data-id="${item.id}">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-danger delete-btn" data-id="${item.id}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
                tableBody.append(row);
            }
            
            // Add event listeners to edit and delete buttons
            $('.edit-btn').on('click', function() {
                const id = $(this).data('id');
                editData(id);
            });
            
            $('.delete-btn').on('click', function() {
                const id = $(this).data('id');
                deleteData(id);
            });
        }

        // Filter data
        function filterData() {
            const desaFilter = $('#filterDesa').val();
            const jenisFilter = $('#filterJenis').val();
            const tanggalFilter = $('#filterTanggal').val();
            const searchText = $('#searchInput').val().toLowerCase();
            
            let filteredData = bantuanData;
            
            // Apply filters
            if (desaFilter) {
                filteredData = filteredData.filter(item => item.desa === desaFilter);
            }
            
            if (jenisFilter) {
                filteredData = filteredData.filter(item => item.jenisBantuan === jenisFilter);
            }
            
            if (tanggalFilter) {
                filteredData = filteredData.filter(item => item.tanggal === tanggalFilter);
            }
            
            if (searchText) {
                filteredData = filteredData.filter(item => 
                    item.nama.toLowerCase().includes(searchText) ||
                    item.desa.toLowerCase().includes(searchText) ||
                    item.jenisBantuan.toLowerCase().includes(searchText) ||
                    item.whatsapp.includes(searchText)
                );
            }
            
            return filteredData;
        }

        // Update pagination
        function updatePagination(totalPages) {
            const pagination = $('#pagination');
            pagination.empty();
            
            if (totalPages <= 1) {
                pagination.append(`
                    <li class="page-item disabled">
                        <a class="page-link" href="#" tabindex="-1">Previous</a>
                    </li>
                    <li class="page-item active"><a class="page-link" href="#">1</a></li>
                    <li class="page-item disabled">
                        <a class="page-link" href="#">Next</a>
                    </li>
                `);
                return;
            }
            
            // Previous button
            const prevDisabled = currentPage === 1 ? 'disabled' : '';
            pagination.append(`
                <li class="page-item ${prevDisabled}">
                    <a class="page-link" href="#" data-page="${currentPage - 1}">Previous</a>
                </li>
            `);
            
            // Page numbers
            const maxVisiblePages = 5;
            let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
            let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
            
            if (endPage - startPage + 1 < maxVisiblePages) {
                startPage = Math.max(1, endPage - maxVisiblePages + 1);
            }
            
            for (let i = startPage; i <= endPage; i++) {
                const active = i === currentPage ? 'active' : '';
                pagination.append(`
                    <li class="page-item ${active}">
                        <a class="page-link" href="#" data-page="${i}">${i}</a>
                    </li>
                `);
            }
            
            // Next button
            const nextDisabled = currentPage === totalPages ? 'disabled' : '';
            pagination.append(`
                <li class="page-item ${nextDisabled}">
                    <a class="page-link" href="#" data-page="${currentPage + 1}">Next</a>
                </li>
            `);
            
            // Add event listeners to page links
            $('.page-link').on('click', function(e) {
                e.preventDefault();
                const page = $(this).data('page');
                if (page) {
                    currentPage = page;
                    renderTable();
                }
            });
        }

        // Edit data
        function editData(id) {
            const data = bantuanData.find(item => item.id === id);
            if (!data) return;
            
            // Isi form dengan data
            $('#nama').val(data.nama);
            $('#jenisKelamin').val(data.jenisKelamin);
            $('#whatsapp').val(data.whatsapp);
            $('#desa').val(data.desa);
            $('#tanggal').val(data.tanggal);
            
            // Handle jenis bantuan
            const isLainnya = !['Tunai', 'Sembako', 'Pakaian'].includes(data.jenisBantuan);
            if (isLainnya) {
                $('#jenisBantuan').val('Lainnya');
                $('#jenisBantuanLainnya').val(data.jenisBantuan);
                $('#jenisBantuanLainnya').removeClass('d-none');
                $('#jenisBantuanLainnya').prop('required', true);
            } else {
                $('#jenisBantuan').val(data.jenisBantuan);
                $('#jenisBantuanLainnya').addClass('d-none');
                $('#jenisBantuanLainnya').prop('required', false);
            }
            
            $('#jumlah').val(data.jumlah);
            $('#driveLink').val(data.driveLink || '');
            $('#kodeValidasi').val(data.kodeValidasi);
            
            // Set current edit ID
            currentEditId = id;
            
            // Scroll ke form
            showSection('inputData');
            $('.nav-link').removeClass('active');
            $('.nav-link[data-bs-target="inputData"]').addClass('active');
            
            // Scroll to top
            window.scrollTo(0, 0);
            
            showNotification('Sedang mengedit data. Silakan perbarui data yang diperlukan.', 'info');
        }

        // Delete data
        function deleteData(id) {
            if (!confirm('Apakah Anda yakin ingin menghapus data ini?')) return;
            
            const index = bantuanData.findIndex(item => item.id === id);
            if (index !== -1) {
                bantuanData.splice(index, 1);
                saveData();
                renderTable();
                updateDashboard();
                showNotification('Data berhasil dihapus.', 'success');
            }
        }

        // Update dashboard
        function updateDashboard() {
            // Update stats boxes
            $('#totalPenerima').text(bantuanData.length);
            
            const totalBantuan = bantuanData.reduce((sum, item) => sum + parseInt(item.jumlah || 0), 0);
            $('#totalBantuan').text(formatRupiah(totalBantuan.toString()));
            
            const uniqueDesa = [...new Set(bantuanData.map(item => item.desa))];
            $('#totalDesa').text(uniqueDesa.length);
            
            // Update recent activities
            const recentActivities = $('#recentActivities');
            recentActivities.empty();
            
            if (bantuanData.length === 0) {
                recentActivities.append('<tr><td colspan="5" class="text-center">Tidak ada data</td></tr>');
            } else {
                // Ambil 5 data terbaru
                const sortedData = [...bantuanData].sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp)).slice(0, 5);
                
                sortedData.forEach(item => {
                    const row = `
                        <tr>
                            <td>${item.tanggal}</td>
                            <td>${item.nama}</td>
                            <td>${item.desa}</td>
                            <td>${item.jenisBantuan}</td>
                            <td>${formatRupiah(item.jumlah)}</td>
                        </tr>
                    `;
                    recentActivities.append(row);
                });
            }
            
            // Update charts
            updateCharts();
        }

        // Update charts
        function updateCharts() {
            // Monthly chart
            const monthlyCtx = document.getElementById('monthlyChart').getContext('2d');
            
            // Group data by month
            const monthlyData = {};
            bantuanData.forEach(item => {
                // Extract month and year from tanggal (format: dd-mm-yyyy)
                const [day, month, year] = item.tanggal.split('-');
                const monthYear = `${month}/${year}`;
                
                if (!monthlyData[monthYear]) {
                    monthlyData[monthYear] = 0;
                }
                
                monthlyData[monthYear] += parseInt(item.jumlah || 0);
            });
            
            const monthlyLabels = Object.keys(monthlyData).sort();
            const monthlyValues = monthlyLabels.map(label => monthlyData[label]);
            
            if (window.monthlyChartInstance) {
                window.monthlyChartInstance.destroy();
            }
            
            window.monthlyChartInstance = new Chart(monthlyCtx, {
                type: 'bar',
                data: {
                    labels: monthlyLabels,
                    datasets: [{
                        label: 'Total Bantuan per Bulan',
                        data: monthlyValues,
                        backgroundColor: 'rgba(13, 71, 161, 0.7)',
                        borderColor: 'rgba(13, 71, 161, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return 'Rp ' + value.toLocaleString();
                                }
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return 'Total: Rp ' + context.raw.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });
            
            // Type chart
            const typeCtx = document.getElementById('typeChart').getContext('2d');
            
            // Group data by type
            const typeData = {};
            bantuanData.forEach(item => {
                if (!typeData[item.jenisBantuan]) {
                    typeData[item.jenisBantuan] = 0;
                }
                
                typeData[item.jenisBantuan]++;
            });
            
            const typeLabels = Object.keys(typeData);
            const typeValues = Object.values(typeData);
            
            // Generate colors for each type
            const backgroundColors = [
                'rgba(13, 71, 161, 0.7)',
                'rgba(0, 105, 92, 0.7)',
                'rgba(255, 143, 0, 0.7)',
                'rgba(108, 117, 125, 0.7)',
                'rgba(220, 53, 69, 0.7)'
            ];
            
            if (window.typeChartInstance) {
                window.typeChartInstance.destroy();
            }
            
            window.typeChartInstance = new Chart(typeCtx, {
                type: 'pie',
                data: {
                    labels: typeLabels,
                    datasets: [{
                        data: typeValues,
                        backgroundColor: backgroundColors.slice(0, typeLabels.length),
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = Math.round((value / total) * 100);
                                    return `${label}: ${value} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        // Update statistik
        function updateStatistik() {
            // Desa chart
            const desaCtx = document.getElementById('desaChart').getContext('2d');
            
            // Group data by desa
            const desaData = {};
            bantuanData.forEach(item => {
                if (!desaData[item.desa]) {
                    desaData[item.desa] = 0;
                }
                
                desaData[item.desa] += parseInt(item.jumlah || 0);
            });
            
            const desaLabels = Object.keys(desaData);
            const desaValues = Object.values(desaData);
            
            if (window.desaChartInstance) {
                window.desaChartInstance.destroy();
            }
            
            window.desaChartInstance = new Chart(desaCtx, {
                type: 'bar',
                data: {
                    labels: desaLabels,
                    datasets: [{
                        label: 'Total Bantuan per Desa',
                        data: desaValues,
                        backgroundColor: 'rgba(255, 143, 0, 0.7)',
                        borderColor: 'rgba(255, 143, 0, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    scales: {
                        x: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return 'Rp ' + value.toLocaleString();
                                }
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return 'Total: Rp ' + context.raw.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });
            
            // Update statistik numbers
            const laki = bantuanData.filter(item => item.jenisKelamin === 'Laki-laki').length;
            const perempuan = bantuanData.filter(item => item.jenisKelamin === 'Perempuan').length;
            
            $('#statLaki').text(laki);
            $('#statPerempuan').text(perempuan);
            $('#statTotal').text(laki + perempuan);
            
            const tunai = bantuanData
                .filter(item => item.jenisBantuan === 'Tunai')
                .reduce((sum, item) => sum + parseInt(item.jumlah || 0), 0);
                
            const nonTunai = bantuanData
                .filter(item => item.jenisBantuan !== 'Tunai')
                .reduce((sum, item) => sum + parseInt(item.jumlah || 0), 0);
                
            $('#statTunai').text(formatRupiah(tunai.toString()));
            $('#statNonTunai').text(formatRupiah(nonTunai.toString()));
            $('#statTotalDana').text(formatRupiah((tunai + nonTunai).toString()));
            
            // Top desa
            const desaCount = {};
            bantuanData.forEach(item => {
                if (!desaCount[item.desa]) {
                    desaCount[item.desa] = 0;
                }
                
                desaCount[item.desa]++;
            });
            
            const topDesa = Object.entries(desaCount)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5);
                
            const topDesaList = $('#topDesa');
            topDesaList.empty();
            
            if (topDesa.length === 0) {
                topDesaList.append('<li>Tidak ada data</li>');
            } else {
                topDesa.forEach(([desa, count], index) => {
                    topDesaList.append(`<li>${desa} (${count} penerima)</li>`);
                });
            }
            
            // Update statistik table
            const statistikTable = $('#statistikTable');
            statistikTable.empty();
            
            if (bantuanData.length === 0) {
                statistikTable.append('<tr><td colspan="5" class="text-center">Tidak ada data</td></tr>');
                return;
            }
            
            // Group by jenis bantuan
            const jenisData = {};
            bantuanData.forEach(item => {
                if (!jenisData[item.jenisBantuan]) {
                    jenisData[item.jenisBantuan] = {
                        count: 0,
                        total: 0
                    };
                }
                
                jenisData[item.jenisBantuan].count++;
                jenisData[item.jenisBantuan].total += parseInt(item.jumlah || 0);
            });
            
            const totalPenerima = bantuanData.length;
            const totalDana = bantuanData.reduce((sum, item) => sum + parseInt(item.jumlah || 0), 0);
            
            Object.entries(jenisData).forEach(([jenis, data]) => {
                const percentage = ((data.count / totalPenerima) * 100).toFixed(1);
                const average = Math.round(data.total / data.count);
                
                const row = `
                    <tr>
                        <td>${jenis}</td>
                        <td>${data.count}</td>
                        <td>${formatRupiah(data.total.toString())}</td>
                        <td>${formatRupiah(average.toString())}</td>
                        <td>${percentage}%</td>
                    </tr>
                `;
                statistikTable.append(row);
            });
        }

        // Export to Excel
        function exportToExcel() {
            if (bantuanData.length === 0) {
                showNotification('Tidak ada data untuk diexport.', 'warning');
                return;
            }
            
            // Prepare data for export
            const dataForExport = bantuanData.map(item => ({
                'Tanggal': item.tanggal,
                'Nama Penerima': item.nama,
                'Jenis Kelamin': item.jenisKelamin,
                'WhatsApp': '+62' + item.whatsapp,
                'Desa': item.desa,
                'Jenis Bantuan': item.jenisBantuan,
                'Jumlah Bantuan': parseInt(item.jumlah),
                'Link Google Drive': item.driveLink || '',
                'Kode Validasi': item.kodeValidasi
            }));
            
            // Create worksheet
            const ws = XLSX.utils.json_to_sheet(dataForExport);
            
            // Create workbook
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Data Bantuan');
            
            // Export to file
            XLSX.writeFile(wb, 'data_bantuan.xlsx');
            
            showNotification('Data berhasil diexport ke Excel.', 'success');
        }

        // Export to PDF
        function exportToPDF() {
            if (bantuanData.length === 0) {
                showNotification('Tidak ada data untuk diexport.', 'warning');
                return;
            }
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Add title
            doc.setFontSize(16);
            doc.text('DATA BANTUAN - BARJAS', 105, 15, { align: 'center' });
            doc.setFontSize(10);
            doc.text(`Tanggal Export: ${new Date().toLocaleDateString('id-ID')}`, 105, 22, { align: 'center' });
            
            // Prepare data for table
            const tableData = bantuanData.map(item => [
                item.tanggal,
                item.nama,
                item.jenisKelamin,
                '+62' + item.whatsapp,
                item.desa,
                item.jenisBantuan,
                formatRupiah(item.jumlah),
                item.driveLink || '-'
            ]);
            
            // Add table
            doc.autoTable({
                head: [['Tanggal', 'Nama', 'JK', 'WhatsApp', 'Desa', 'Jenis', 'Jumlah', 'Link Drive']],
                body: tableData,
                startY: 30,
                theme: 'grid',
                headStyles: {
                    fillColor: [13, 71, 161],
                    textColor: 255
                },
                alternateRowStyles: {
                    fillColor: [240, 240, 240]
                },
                styles: {
                    fontSize: 8,
                    cellPadding: 1
                },
                margin: { left: 10, right: 10 }
            });
            
            // Save PDF
            doc.save('data_bantuan.pdf');
            
            showNotification('Data berhasil diexport ke PDF.', 'success');
        }

        // Print selected
        function printSelected() {
            const selectedIds = [];
            $('.row-checkbox:checked').each(function() {
                selectedIds.push($(this).data('id'));
            });
            
            if (selectedIds.length === 0) {
                showNotification('Pilih setidaknya satu data untuk dicetak.', 'warning');
                return;
            }
            
            const selectedData = bantuanData.filter(item => selectedIds.includes(item.id));
            printData(selectedData, 'selected');
        }

        // Print all
        function printAll() {
            if (bantuanData.length === 0) {
                showNotification('Tidak ada data untuk dicetak.', 'warning');
                return;
            }
            
            printData(bantuanData, 'all');
        }

        // Print data
        function printData(data, type) {
            // Create print window
            const printWindow = window.open('', '_blank');
            
            // Prepare HTML content
            let content = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Cetak Data Bantuan - BARJAS</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        .print-header { text-align: center; margin-bottom: 20px; }
                        .print-title { font-size: 18px; font-weight: bold; }
                        .print-subtitle { font-size: 14px; }
                        .print-date { text-align: right; margin-bottom: 10px; font-size: 12px; }
                        table { width: 100%; border-collapse: collapse; font-size: 12px; }
                        th, td { border: 1px solid #ddd; padding: 6px; text-align: left; }
                        th { background-color: #f0f0f0; }
                        tr:nth-child(even) { background-color: #f9f9f9; }
                        @media print {
                            @page { size: landscape; margin: 0.5cm; }
                            body { margin: 0; }
                        }
                    </style>
                </head>
                <body>
                    <div class="print-header">
                        <div class="print-title">DATA BANTUAN - BARJAS</div>
                        <div class="print-subtitle">Sistem Bantuan Terpadu</div>
                    </div>
                    <div class="print-date">Dicetak pada: ${new Date().toLocaleDateString('id-ID')} ${new Date().toLocaleTimeString('id-ID')}</div>
                    <table>
                        <thead>
                            <tr>
                                <th>No</th>
                                <th>Tanggal</th>
                                <th>Nama Penerima</th>
                                <th>Jenis Kelamin</th>
                                <th>WhatsApp</th>
                                <th>Desa</th>
                                <th>Jenis Bantuan</th>
                                <th>Jumlah Bantuan</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            // Add data rows
            data.forEach((item, index) => {
                content += `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${item.tanggal}</td>
                        <td>${item.nama}</td>
                        <td>${item.jenisKelamin}</td>
                        <td>+62${item.whatsapp}</td>
                        <td>${item.desa}</td>
                        <td>${item.jenisBantuan}</td>
                        <td>${formatRupiah(item.jumlah)}</td>
                    </tr>
                `;
            });
            
            content += `
                        </tbody>
                    </table>
                    <div style="margin-top: 20px; font-size: 11px; text-align: center;">
                        Dicetak dari Aplikasi BARJAS - ${type === 'selected' ? 'Data Terpilih' : 'Semua Data'}
                    </div>
                </body>
                </html>
            `;
            
            // Write content to print window
            printWindow.document.open();
            printWindow.document.write(content);
            printWindow.document.close();
            
            // Print after content is loaded
            printWindow.onload = function() {
                printWindow.print();
                printWindow.close();
            };
            
            showNotification(`Data berhasil disiapkan untuk dicetak.`, 'success');
        }

        // Backup data
        function backupData() {
            if (bantuanData.length === 0) {
                showNotification('Tidak ada data untuk dibackup.', 'warning');
                return;
            }
            
            const dataStr = JSON.stringify(bantuanData);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = 'backup_bantuan.json';
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showNotification('Backup data berhasil dilakukan.', 'success');
        }

        // Restore data
        function restoreData() {
            // Create file input element
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = e => {
                const file = e.target.files[0];
                const reader = new FileReader();
                
                reader.onload = function(event) {
                    try {
                        const restoredData = JSON.parse(event.target.result);
                        
                        if (!Array.isArray(restoredData)) {
                            throw new Error('Format file tidak valid');
                        }
                        
                        // Validate data structure
                        const requiredFields = ['nama', 'jenisKelamin', 'whatsapp', 'desa', 'tanggal', 'jenisBantuan', 'jumlah'];
                        const isValid = restoredData.every(item => {
                            return requiredFields.every(field => item.hasOwnProperty(field));
                        });
                        
                        if (!isValid) {
                            throw new Error('Struktur data tidak valid');
                        }
                        
                        // Replace current data with restored data
                        bantuanData = restoredData;
                        saveData();
                        
                        // Update UI
                        renderTable();
                        updateDashboard();
                        
                        showNotification('Data berhasil dipulihkan dari backup.', 'success');
                    } catch (error) {
                        showNotification('Gagal memulihkan data: ' + error.message, 'error');
                    }
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        }

        // Reset data
        function resetData() {
            if (!confirm('Apakah Anda yakin ingin mereset data? Data saat ini akan diganti dengan data contoh.')) return;
            
            // Load sample data
            bantuanData = [
                {
                    id: '1',
                    nama: 'Ahmad Sutisna',
                    jenisKelamin: 'Laki-laki',
                    whatsapp: '81234567890',
                    desa: 'Desa A',
                    tanggal: '01-09-2023',
                    jenisBantuan: 'Tunai',
                    jumlah: '1000000',
                    driveLink: 'https://drive.google.com/sample-link-1',
                    kodeValidasi: 'ABC123',
                    timestamp: '2023-09-01T08:00:00.000Z'
                },
                {
                    id: '2',
                    nama: 'Siti Rahayu',
                    jenisKelamin: 'Perempuan',
                    whatsapp: '81234567891',
                    desa: 'Desa B',
                    tanggal: '05-09-2023',
                    jenisBantuan: 'Sembako',
                    jumlah: '750000',
                    driveLink: 'https://drive.google.com/sample-link-2',
                    kodeValidasi: 'DEF456',
                    timestamp: '2023-09-05T10:30:00.000Z'
                },
                {
                    id: '3',
                    nama: 'Budi Santoso',
                    jenisKelamin: 'Laki-laki',
                    whatsapp: '81234567892',
                    desa: 'Desa C',
                    tanggal: '10-09-2023',
                    jenisBantuan: 'Pakaian',
                    jumlah: '500000',
                    driveLink: '',
                    kodeValidasi: 'GHI789',
                    timestamp: '2023-09-10T14:15:00.000Z'
                }
            ];
            
            saveData();
            renderTable();
            updateDashboard();
            
            showNotification('Data telah direset dengan data contoh.', 'success');
        }

        // Clear all data
        function clearAllData() {
            if (!confirm('Apakah Anda yakin ingin menghapus semua data? Tindakan ini tidak dapat dibatalkan.')) return;
            
            bantuanData = [];
            saveData();
            renderTable();
            updateDashboard();
            
            showNotification('Semua data telah dihapus.', 'success');
        }

        // Import data from Excel
        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    
                    // Get first worksheet
                    const worksheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(worksheet);
                    
                    if (jsonData.length === 0) {
                        showNotification('File Excel tidak mengandung data.', 'warning');
                        return;
                    }
                    
                    // Map Excel data to our format
                    const importedData = jsonData.map(item => {
                        return {
                            id: Date.now().toString() + Math.random().toString(36).substr(2, 9),
                            nama: item['Nama Penerima'] || '',
                            jenisKelamin: item['Jenis Kelamin'] || '',
                            whatsapp: (item['WhatsApp'] || '').toString().replace('+62', '').replace(/\D/g, ''),
                            desa: item['Desa'] || '',
                            tanggal: item['Tanggal'] || '',
                            jenisBantuan: item['Jenis Bantuan'] || '',
                            jumlah: (item['Jumlah Bantuan'] || 0).toString(),
                            driveLink: item['Link Google Drive'] || '',
                            kodeValidasi: item['Kode Validasi'] || '',
                            timestamp: new Date().toISOString()
                        };
                    });
                    
                    // Validate imported data
                    const validData = importedData.filter(item => {
                        return item.nama && item.jenisKelamin && item.whatsapp && item.desa && 
                               item.tanggal && item.jenisBantuan && item.jumlah;
                    });
                    
                    if (validData.length === 0) {
                        showNotification('Tidak ada data yang valid dalam file Excel.', 'error');
                        return;
                    }
                    
                    // Add imported data to existing data
                    bantuanData = [...bantuanData, ...validData];
                    saveData();
                    
                    // Update UI
                    renderTable();
                    updateDashboard();
                    
                    showNotification(`Berhasil mengimpor ${validData.length} data dari Excel.`, 'success');
                    
                } catch (error) {
                    showNotification('Gagal mengimpor data: ' + error.message, 'error');
                }
            };
            
            reader.readAsArrayBuffer(file);
        }

        // Update system info
        function updateSystemInfo() {
            // Browser info
            $('#browserInfo').val(navigator.userAgent);
            
            // Screen info
            $('#screenInfo').val(`${window.screen.width} x ${window.screen.height}`);
            
            // Local storage info
            const storage = JSON.stringify(localStorage).length / 1024;
            $('#storageInfo').val(`${storage.toFixed(2)} KB digunakan`);
            
            // Connection info
            const connection = navigator.onLine ? 'Online' : 'Offline';
            $('#connectionInfo').val(connection);
            
            // Update connection status on change
            window.addEventListener('online', () => {
                $('#connectionInfo').val('Online');
            });
            
            window.addEventListener('offline', () => {
                $('#connectionInfo').val('Offline');
            });
        }

        // Show notification
        function showNotification(message, type = 'info') {
            const toast = new bootstrap.Toast(document.getElementById('notificationToast'));
            const toastMessage = document.getElementById('toastMessage');
            
            // Set message and style based on type
            toastMessage.textContent = message;
            
            const toastHeader = document.querySelector('#notificationToast .toast-header');
            toastHeader.className = 'toast-header';
            
            switch (type) {
                case 'success':
                    toastHeader.classList.add('bg-success', 'text-white');
                    break;
                case 'error':
                    toastHeader.classList.add('bg-danger', 'text-white');
                    break;
                case 'warning':
                    toastHeader.classList.add('bg-warning');
                    break;
                default:
                    toastHeader.classList.add('bg-info', 'text-white');
            }
            
            toast.show();
        }

        // Auto format jumlah input
        $('#jumlah').on('keyup', function(e) {
            // Skip for arrow keys, tab, etc.
            if ([37, 38, 39, 40, 9].includes(e.keyCode)) return;
            
            // Get current value
            let value = $(this).val().replace(/\./g, '');
            
            // Check if value is a valid number
            if (!isNaN(value) && value !== '') {
                // Format with thousand separators
                $(this).val(formatNumber(value));
            }
        });

        // Format number with thousand separators
        function formatNumber(number) {
            return number.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
        }

        // Auto format WhatsApp input
        $('#whatsapp').on('keyup', function() {
            let value = $(this).val().replace(/\D/g, '');
            $(this).val(value);
        });

        // Initialize particles.js for login background
        function initParticles() {
            particlesJS('login-particles', {
                particles: {
                    number: { value: 80, density: { enable: true, value_area: 800 } },
                    color: { value: "#ffffff" },
                    shape: { type: "circle" },
                    opacity: { value: 0.5, random: true },
                    size: { value: 3, random: true },
                    line_linked: {
                        enable: true,
                        distance: 150,
                        color: "#ffffff",
                        opacity: 0.4,
                        width: 1
                    },
                    move: {
                        enable: true,
                        speed: 2,
                        direction: "none",
                        random: true,
                        straight: false,
                        out_mode: "out",
                        bounce: false
                    }
                },
                interactivity: {
                    detect_on: "canvas",
                    events: {
                        onhover: { enable: true, mode: "repulse" },
                        onclick: { enable: true, mode: "push" },
                        resize: true
                    },
                    modes: {
                        repulse: { distance: 100, duration: 0.4 },
                        push: { particles_nb: 4 }
                    }
                },
                retina_detect: true
            });
        }

        // Show login particles when modal is shown
        $('#loginModal').on('shown.bs.modal', function() {
            document.getElementById('login-particles').style.display = 'block';
            initParticles();
        });

        // Hide login particles when modal is hidden
        $('#loginModal').on('hidden.bs.modal', function() {
            document.getElementById('login-particles').style.display = 'none';
        });

        // Auto-fill form with sample data for testing
        function autoFillForm() {
            $('#nama').val('Budi Santoso');
            $('#jenisKelamin').val('Laki-laki');
            $('#whatsapp').val('8123456789');
            $('#desa').val('Desa A');
            $('#tanggal').datepicker('setDate', new Date());
            $('#jenisBantuan').val('Tunai');
            $('#jumlah').val('1000000');
            $('#driveLink').val('https://drive.google.com/sample-data');
            generateKodeValidasi();
            
            showNotification('Form telah diisi dengan data contoh untuk testing.', 'info');
        }

        // Add auto-fill button for testing
        $(document).ready(function() {
            $('#bantuanForm').append(`
                <div class="text-center mt-3">
                    <button type="button" class="btn btn-secondary btn-auto-fill" id="autoFillBtn">
                        <i class="fas fa-magic me-2"></i>Auto Fill (Testing)
                    </button>
                </div>
            `);
            
            $('#autoFillBtn').on('click', autoFillForm);
        });

        // Handle window resize
        $(window).on('resize', function() {
            // Update screen info
            $('#screenInfo').val(`${window.screen.width} x ${window.screen.height}`);
            
            // Update charts on resize
            if ($('#dashboard').is(':visible')) {
                updateCharts();
            }
            
            if ($('#statistik').is(':visible')) {
                updateStatistik();
            }
        });

        // Handle beforeunload event
        $(window).on('beforeunload', function() {
            if (bantuanData.length > 0) {
                return 'Anda memiliki data yang belum disimpan. Yakin ingin meninggalkan halaman?';
            }
        });

        // Initialize app when document is ready
        $(document).ready(function() {
            // Check if user is already logged in (for demo purposes)
            const isLoggedIn = localStorage.getItem('isLoggedIn');
            if (isLoggedIn === 'true') {
                $('#loginModal').modal('hide');
                $('.app-content-unauthenticated').show();
                updateDashboard();
            }
            
            // Handle login success
            $('#loginForm').on('submit', function(e) {
                e.preventDefault();
                // ... existing login logic
                localStorage.setItem('isLoggedIn', 'true');
            });
            
            // Handle logout (for demo purposes)
            $(document).on('click', '#logoutBtn', function() {
                localStorage.setItem('isLoggedIn', 'false');
                $('#loginModal').modal('show');
                $('.app-content-unauthenticated').hide();
            });
        });

        // Add logout button to navbar (for demo purposes)
        $(document).ready(function() {
            $('.nav-pills').append(`
                <li class="nav-item">
                    <a href="#" class="nav-link" id="logoutBtn">
                        <i class="fas fa-sign-out-alt feature-icon"></i>
                        Logout
                    </a>
                </li>
            `);
        });

        // Handle form input validation on blur
        $('input, select').on('blur', function() {
            validateField($(this));
        });

        // Validate individual field
        function validateField(field) {
            const fieldId = field.attr('id');
            const value = field.val();
            
            // Reset error state
            field.removeClass('input-error');
            $(`#${fieldId}Error`).hide();
            
            let isValid = true;
            
            switch (fieldId) {
                case 'nama':
                    isValid = value.trim() !== '';
                    break;
                case 'jenisKelamin':
                    isValid = value !== '';
                    break;
                case 'whatsapp':
                    isValid = /^[0-9]{9,12}$/.test(value);
                    break;
                case 'desa':
                    isValid = value !== '';
                    break;
                case 'tanggal':
                    isValid = value !== '';
                    break;
                case 'jenisBantuan':
                    isValid = value !== '';
                    if (value === 'Lainnya') {
                        const lainnyaValue = $('#jenisBantuanLainnya').val();
                        isValid = lainnyaValue.trim() !== '';
                        if (!isValid) {
                            $('#jenisBantuanLainnya').addClass('input-error');
                            $('#jenisBantuanError').show();
                        }
                    }
                    break;
                case 'jumlah':
                    const numValue = value.replace(/\./g, '');
                    isValid = !isNaN(numValue) && parseInt(numValue) > 0;
                    break;
                case 'driveLink':
                    isValid = value === '' || isValidUrl(value);
                    break;
                case 'kodeValidasi':
                    isValid = value.trim() !== '';
                    break;
            }
            
            if (!isValid) {
                field.addClass('input-error');
                $(`#${fieldId}Error`).show();
            }
            
            return isValid;
        }

        // Handle real-time validation for WhatsApp field
        $('#whatsapp').on('input', function() {
            const value = $(this).val();
            const numericValue = value.replace(/\D/g, '');
            $(this).val(numericValue);
            
            validateField($(this));
        });

        // Handle real-time validation for jumlah field
        $('#jumlah').on('input', function() {
            let value = $(this).val().replace(/\./g, '');
            
            // Allow only numbers
            if (isNaN(value)) {
                value = value.slice(0, -1);
            }
            
            // Format with thousand separators
            if (value !== '') {
                $(this).val(formatNumber(value));
            }
            
            validateField($(this));
        });

        // Add input mask for tanggal field
        $('#tanggal').on('input', function() {
            let value = $(this).val().replace(/\D/g, '');
            
            if (value.length > 2 && value.length <= 4) {
                value = value.slice(0, 2) + '-' + value.slice(2);
            } else if (value.length > 4) {
                value = value.slice(0, 2) + '-' + value.slice(2, 4) + '-' + value.slice(4, 8);
            }
            
            $(this).val(value);
        });

        // Handle enter key in form
        $('#bantuanForm').on('keypress', function(e) {
            if (e.which === 13) {
                e.preventDefault();
                
                // Find all required fields
                const requiredFields = $(this).find('[required]');
                const currentField = $(e.target);
                let currentIndex = requiredFields.index(currentField);
                
                // If not found, try to find in parent
                if (currentIndex === -1) {
                    currentIndex = requiredFields.index(currentField.parents('.form-control, .form-select'));
                }
                
                // Focus on next field or submit form
                if (currentIndex < requiredFields.length - 1) {
                    requiredFields.eq(currentIndex + 1).focus();
                } else {
                    handleFormSubmit();
                }
            }
        });

        // Add help tooltips
        $(document).ready(function() {
            $('[data-bs-toggle="tooltip"]').tooltip();
        });

        // Add help icons to form labels
        $(document).ready(function() {
            $('.form-label').each(function() {
                const fieldId = $(this).attr('for');
                if (fieldId) {
                    $(this).append(`<i class="fas fa-question-circle ms-2 text-muted" data-bs-toggle="tooltip" title="${getFieldHelpText(fieldId)}"></i>`);
                }
            });
        });

        // Get help text for field
        function getFieldHelpText(fieldId) {
            const helpTexts = {
                'nama': 'Masukkan nama lengkap penerima bantuan',
                'jenisKelamin': 'Pilih jenis kelamin penerima bantuan',
                'whatsapp': 'Masukkan nomor WhatsApp tanpa kode negara (+62)',
                'desa': 'Pilih desa tempat tinggal penerima bantuan',
                'tanggal': 'Pilih tanggal penerimaan bantuan',
                'jenisBantuan': 'Pilih jenis bantuan yang diberikan',
                'jumlah': 'Masukkan jumlah bantuan dalam Rupiah',
                'driveLink': 'Masukkan link Google Drive untuk dokumentasi (opsional)',
                'kodeValidasi': 'Kode unik untuk validasi data, generate otomatis atau masukkan manual'
            };
            
            return helpTexts[fieldId] || 'Field informasi';
        }

        // Handle form reset confirmation
        $('#resetForm').on('click', function() {
            if ($('#bantuanForm')[0].checkValidity()) {
                if (!confirm('Anda yakin ingin mengosongkan form? Semua data yang telah diisi akan hilang.')) {
                    return;
                }
            }
            
            resetForm();
        });

        // Handle generate kode validasi with animation
        $('#generateKode').on('click', function() {
            generateKodeValidasi();
            
            // Add animation
            const button = $(this);
            button.html('<i class="fas fa-cog fa-spin"></i> Generating...');
            button.prop('disabled', true);
            
            setTimeout(function() {
                button.html('Generate Kode');
                button.prop('disabled', false);
                
                // Add checkmark animation
                $('#kodeValidasi').addClass('input-success');
                setTimeout(function() {
                    $('#kodeValidasi').removeClass('input-success');
                }, 2000);
            }, 1000);
        });

        // Add input success class
        const style = document.createElement('style');
        style.innerHTML = `
            .input-success {
                border-color: #28a745 !important;
                box-shadow: 0 0 0 0.2rem rgba(40, 167, 69, 0.25) !important;
            }
        `;
        document.head.appendChild(style);

        // Handle dashboard refresh
        function refreshDashboard() {
            updateDashboard();
            showNotification('Dashboard diperbarui.', 'info');
        }

        // Add refresh button to dashboard
        $(document).ready(function() {
            $('#dashboard .section-title').append(`
                <button class="btn btn-sm btn-outline-primary ms-3" id="refreshDashboard">
                    <i class="fas fa-sync-alt"></i> Refresh
                </button>
            `);
            
            $('#refreshDashboard').on('click', refreshDashboard);
        });

        // Handle data table refresh
        function refreshDataTable() {
            renderTable();
            showNotification('Tabel data diperbarui.', 'info');
        }

        // Add refresh button to data table
        $(document).ready(function() {
            $('#dataTable .section-title').append(`
                <button class="btn btn-sm btn-outline-primary ms-3" id="refreshDataTable">
                    <i class="fas fa-sync-alt"></i> Refresh
                </button>
            `);
            
            $('#refreshDataTable').on('click', refreshDataTable);
        });

        // Handle statistik refresh
        function refreshStatistik() {
            updateStatistik();
            showNotification('Statistik diperbarui.', 'info');
        }

        // Add refresh button to statistik
        $(document).ready(function() {
            $('#statistik .section-title').append(`
                <button class="btn btn-sm btn-outline-primary ms-3" id="refreshStatistik">
                    <i class="fas fa-sync-alt"></i> Refresh
                </button>
            `);
            
            $('#refreshStatistik').on('click', refreshStatistik);
        });

        // Handle offline/online status
        function updateOnlineStatus() {
            const status = navigator.onLine ? 'online' : 'offline';
            const statusElement = $('#connectionStatus');
            
            if (statusElement.length === 0) {
                $('body').append(`
                    <div id="connectionStatus" class="position-fixed bottom-0 end-0 m-3 p-2 rounded-3 bg-secondary text-white">
                        <i class="fas fa-wifi"></i> <span>${status}</span>
                    </div>
                `);
            } else {
                statusElement.html(`<i class="fas fa-wifi"></i> <span>${status}</span>`);
                statusElement.toggleClass('bg-success', navigator.onLine);
                statusElement.toggleClass('bg-secondary', !navigator.onLine);
            }
            
            if (!navigator.onLine) {
                showNotification('Anda sedang offline. Beberapa fitur mungkin terbatas.', 'warning');
            }
        }

        // Initialize online status
        $(document).ready(function() {
            updateOnlineStatus();
            window.addEventListener('online', updateOnlineStatus);
            window.addEventListener('offline', updateOnlineStatus);
        });

        // Handle service worker for PWA (optional)
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/sw.js').then(function(registration) {
                    console.log('ServiceWorker registration successful with scope: ', registration.scope);
                }, function(err) {
                    console.log('ServiceWorker registration failed: ', err);
                });
            });
        }

        // Handle app install prompt (optional)
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            
            // Show install button
            $('#installApp').removeClass('d-none');
        });

        // Handle install button click
        $(document).on('click', '#installApp', function() {
            if (!deferredPrompt) return;
            
            deferredPrompt.prompt();
            deferredPrompt.userChoice.then((choiceResult) => {
                if (choiceResult.outcome === 'accepted') {
                    console.log('User accepted the install prompt');
                } else {
                    console.log('User dismissed the install prompt');
                }
                deferredPrompt = null;
            });
        });

        // Add install button to navbar
        $(document).ready(function() {
            $('.nav-pills').prepend(`
                <li class="nav-item">
                    <a href="#" class="nav-link d-none" id="installApp">
                        <i class="fas fa-download feature-icon"></i>
                        Install App
                    </a>
                </li>
            `);
        });

        // Handle data export with progress
        function exportWithProgress(format) {
            if (bantuanData.length === 0) {
                showNotification('Tidak ada data untuk diexport.', 'warning');
                return;
            }
            
            // Show progress modal
            const progressModal = new bootstrap.Modal(document.getElementById('progressModal'));
            progressModal.show();
            
            const progressBar = document.getElementById('exportProgress');
            const progressText = document.getElementById('exportProgressText');
            
            let progress = 0;
            const total = bantuanData.length;
            
            const interval = setInterval(() => {
                progress += 1;
                const percentage = Math.min(Math.round((progress / total) * 100), 100);
                
                progressBar.style.width = `${percentage}%`;
                progressBar.setAttribute('aria-valuenow', percentage);
                progressText.textContent = `Memproses ${progress} dari ${total} data (${percentage}%)`;
                
                if (progress >= total) {
                    clearInterval(interval);
                    
                    setTimeout(() => {
                        progressModal.hide();
                        
                        if (format === 'excel') {
                            exportToExcel();
                        } else if (format === 'pdf') {
                            exportToPDF();
                        }
                    }, 500);
                }
            }, 10);
        }

        // Add progress modal to DOM
        $(document).ready(function() {
            $('body').append(`
                <div class="modal fade" id="progressModal" tabindex="-1" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Mengekspor Data</h5>
                            </div>
                            <div class="modal-body">
                                <div class="progress mb-3">
                                    <div id="exportProgress" class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                                <p id="exportProgressText" class="text-center mb-0">Memulai proses export...</p>
                            </div>
                        </div>
                    </div>
                </div>
            `);
        });

        // Update export buttons to use progress
        $(document).ready(function() {
            $('#exportExcel').on('click', function() {
                exportWithProgress('excel');
            });
            
            $('#exportPDF').on('click', function() {
                exportWithProgress('pdf');
            });
        });

        // Handle data import with progress
        $('#importFile').on('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            // Show progress modal
            const progressModal = new bootstrap.Modal(document.getElementById('progressModal'));
            progressModal.show();
            
            const progressBar = document.getElementById('exportProgress');
            const progressText = document.getElementById('exportProgressText');
            
            progressBar.style.width = `0%`;
            progressBar.setAttribute('aria-valuenow', 0);
            progressText.textContent = 'Membaca file...';
            
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    progressText.textContent = 'Memproses data...';
                    
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    
                    // Get first worksheet
                    const worksheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(worksheet);
                    
                    if (jsonData.length === 0) {
                        progressModal.hide();
                        showNotification('File Excel tidak mengandung data.', 'warning');
                        return;
                    }
                    
                    let processed = 0;
                    const total = jsonData.length;
                    
                    const processInterval = setInterval(() => {
                        processed += 1;
                        const percentage = Math.min(Math.round((processed / total) * 100), 100);
                        
                        progressBar.style.width = `${percentage}%`;
                        progressBar.setAttribute('aria-valuenow', percentage);
                        progressText.textContent = `Memproses ${processed} dari ${total} data (${percentage}%)`;
                        
                        if (processed >= total) {
                            clearInterval(processInterval);
                            
                            // Map Excel data to our format
                            const importedData = jsonData.map(item => {
                                return {
                                    id: Date.now().toString() + Math.random().toString(36).substr(2, 9),
                                    nama: item['Nama Penerima'] || '',
                                    jenisKelamin: item['Jenis Kelamin'] || '',
                                    whatsapp: (item['WhatsApp'] || '').toString().replace('+62', '').replace(/\D/g, ''),
                                    desa: item['Desa'] || '',
                                    tanggal: item['Tanggal'] || '',
                                    jenisBantuan: item['Jenis Bantuan'] || '',
                                    jumlah: (item['Jumlah Bantuan'] || 0).toString(),
                                    driveLink: item['Link Google Drive'] || '',
                                    kodeValidasi: item['Kode Validasi'] || '',
                                    timestamp: new Date().toISOString()
                                };
                            });
                            
                            // Validate imported data
                            const validData = importedData.filter(item => {
                                return item.nama && item.jenisKelamin && item.whatsapp && item.desa && 
                                       item.tanggal && item.jenisBantuan && item.jumlah;
                            });
                            
                            if (validData.length === 0) {
                                progressModal.hide();
                                showNotification('Tidak ada data yang valid dalam file Excel.', 'error');
                                return;
                            }
                            
                            // Add imported data to existing data
                            bantuanData = [...bantuanData, ...validData];
                            saveData();
                            
                            // Update UI
                            renderTable();
                            updateDashboard();
                            
                            progressModal.hide();
                            showNotification(`Berhasil mengimpor ${validData.length} data dari Excel.`, 'success');
                        }
                    }, 10);
                    
                } catch (error) {
                    progressModal.hide();
                    showNotification('Gagal mengimpor data: ' + error.message, 'error');
                }
            };
            
            reader.readAsArrayBuffer(file);
        });

        // Handle keyboard shortcuts
        $(document).on('keydown', function(e) {
            // Ctrl + S untuk menyimpan form
            if (e.ctrlKey && e.key === 's') {
                e.preventDefault();
                if ($('#bantuanForm').is(':visible')) {
                    handleFormSubmit();
                }
            }
            
            // Ctrl + F untuk focus pada pencarian
            if (e.ctrlKey && e.key === 'f') {
                e.preventDefault();
                if ($('#dataTable').is(':visible')) {
                    $('#searchInput').focus();
                }
            }
            
            // Ctrl + N untuk form baru
            if (e.ctrlKey && e.key === 'n') {
                e.preventDefault();
                if ($('#inputData').is(':visible')) {
                    resetForm();
                }
            }
            
            // Ctrl + D untuk dashboard
            if (e.ctrlKey && e.key === 'd') {
                e.preventDefault();
                showSection('dashboard');
                $('.nav-link').removeClass('active');
                $('.nav-link[data-bs-target="dashboard"]').addClass('active');
            }
            
            // Ctrl + T untuk tabel data
            if (e.ctrlKey && e.key === 't') {
                e.preventDefault();
                showSection('dataTable');
                $('.nav-link').removeClass('active');
                $('.nav-link[data-bs-target="dataTable"]').addClass('active');
            }
        });

        // Show keyboard shortcuts help
        function showKeyboardShortcuts() {
            const shortcuts = `
                <div class="mb-2">
                    <kbd>Ctrl</kbd> + <kbd>S</kbd> - Simpan form
                </div>
                <div class="mb-2">
                    <kbd>Ctrl</kbd> + <kbd>F</kbd> - Focus pencarian
                </div>
                <div class="mb-2">
                    <kbd>Ctrl</kbd> + <kbd>N</kbd> - Form baru
                </div>
                <div class="mb-2">
                    <kbd>Ctrl</kbd> + <kbd>D</kbd> - Ke dashboard
                </div>
                <div class="mb-2">
                    <kbd>Ctrl</kbd> + <kbd>T</kbd> - Ke tabel data
                </div>
            `;
            
            // Show in a modal or toast
            showNotification(shortcuts, 'info');
        }

        // Add keyboard shortcuts help button
        $(document).ready(function() {
            $('body').append(`
                <button id="keyboardHelp" class="btn btn-sm btn-outline-secondary position-fixed bottom-0 start-0 m-3">
                    <i class="fas fa-keyboard"></i>
                </button>
            `);
            
            $('#keyboardHelp').on('click', showKeyboardShortcuts);
        });

        // Handle form auto-save (draft)
        let autoSaveTimer;
        function setupAutoSave() {
            $('#bantuanForm input, #bantuanForm select, #bantuanForm textarea').on('input change', function() {
                clearTimeout(autoSaveTimer);
                autoSaveTimer = setTimeout(saveDraft, 2000);
            });
        }

        function saveDraft() {
            const formData = {
                nama: $('#nama').val(),
                jenisKelamin: $('#jenisKelamin').val(),
                whatsapp: $('#whatsapp').val(),
                desa: $('#desa').val(),
                tanggal: $('#tanggal').val(),
                jenisBantuan: $('#jenisBantuan').val(),
                jenisBantuanLainnya: $('#jenisBantuanLainnya').val(),
                jumlah: $('#jumlah').val(),
                driveLink: $('#driveLink').val(),
                kodeValidasi: $('#kodeValidasi').val()
            };
            
            localStorage.setItem('bantuanDraft', JSON.stringify(formData));
            
            // Show auto-save indicator
            const indicator = $('#autoSaveIndicator');
            if (indicator.length === 0) {
                $('#bantuanForm').append(`
                    <div id="autoSaveIndicator" class="text-end text-muted small mt-2">
                        <i class="fas fa-save"></i> Disimpan otomatis
                    </div>
                `);
                
                setTimeout(() => {
                    $('#autoSaveIndicator').fadeOut();
                }, 2000);
            } else {
                indicator.show();
                setTimeout(() => {
                    indicator.fadeOut();
                }, 2000);
            }
        }

        function loadDraft() {
            const draft = localStorage.getItem('bantuanDraft');
            if (draft) {
                const formData = JSON.parse(draft);
                
                $('#nama').val(formData.nama);
                $('#jenisKelamin').val(formData.jenisKelamin);
                $('#whatsapp').val(formData.whatsapp);
                $('#desa').val(formData.desa);
                $('#tanggal').val(formData.tanggal);
                $('#jenisBantuan').val(formData.jenisBantuan);
                
                if (formData.jenisBantuan === 'Lainnya') {
                    $('#jenisBantuanLainnya').val(formData.jenisBantuanLainnya);
                    $('#jenisBantuanLainnya').removeClass('d-none');
                    $('#jenisBantuanLainnya').prop('required', true);
                }
                
                $('#jumlah').val(formData.jumlah);
                $('#driveLink').val(formData.driveLink);
                $('#kodeValidasi').val(formData.kodeValidasi);
                
                showNotification('Draft form telah dimuat.', 'info');
            }
        }

        function clearDraft() {
            localStorage.removeItem('bantuanDraft');
        }

        // Setup auto-save when document is ready
        $(document).ready(function() {
            setupAutoSave();
            
            // Load draft when inputData section is shown
            $('.nav-link[data-bs-target="inputData"]').on('click', function() {
                setTimeout(loadDraft, 100);
            });
            
            // Clear draft when form is submitted or reset
            $('#bantuanForm').on('submit', clearDraft);
            $('#resetForm').on('click', clearDraft);
        });

        // Handle data validation before submission
        function validateDataBeforeSubmit() {
            const errors = [];
            
            // Check for duplicate WhatsApp numbers
            const whatsapp = $('#whatsapp').val();
            const duplicates = bantuanData.filter(item => 
                item.whatsapp === whatsapp && item.id !== currentEditId
            );
            
            if (duplicates.length > 0) {
                errors.push('Nomor WhatsApp sudah terdaftar untuk penerima lain.');
            }
            
            // Check for duplicate names in the same village on the same date
            const nama = $('#nama').val();
            const desa = $('#desa').val();
            const tanggal = $('#tanggal').val();
            
            const sameDayDuplicates = bantuanData.filter(item => 
                item.nama.toLowerCase() === nama.toLowerCase() && 
                item.desa === desa && 
                item.tanggal === tanggal &&
                item.id !== currentEditId
            );
            
            if (sameDayDuplicates.length > 0) {
                errors.push('Penerima dengan nama yang sama sudah menerima bantuan di desa ini pada tanggal yang sama.');
            }
            
            return errors;
        }

        // Update form submission to include validation
        function handleFormSubmit() {
            // Validasi form
            if (!validateForm()) {
                showNotification('Harap periksa kembali form input. Terdapat data yang tidak valid.', 'error');
                return;
            }
            
            // Validasi data sebelum submit
            const validationErrors = validateDataBeforeSubmit();
            if (validationErrors.length > 0) {
                const errorMessage = validationErrors.join('\n');
                if (!confirm(`${errorMessage}\n\nLanjutkan penyimpanan?`)) {
                    return;
                }
            }
            
            // ... rest of the form submission logic
            // [Kode yang sudah ada sebelumnya]
        }

        // Handle data search with advanced options
        function setupAdvancedSearch() {
            $('#searchInput').on('keyup', function() {
                const searchText = $(this).val().toLowerCase();
                
                if (searchText.length >= 2) {
                    // Show advanced search options
                    $('#advancedSearchOptions').removeClass('d-none');
                } else {
                    $('#advancedSearchOptions').addClass('d-none');
                }
                
                filterData();
            });
        }

        // Add advanced search options to DOM
        $(document).ready(function() {
            $('#searchInput').after(`
                <div id="advancedSearchOptions" class="d-none mt-2 p-2 border rounded bg-light">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="searchName" checked>
                        <label class="form-check-label" for="searchName">
                            Cari dalam nama
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="searchVillage" checked>
                        <label class="form-check-label" for="searchVillage">
                            Cari dalam desa
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="searchType" checked>
                        <label class="form-check-label" for="searchType">
                            Cari dalam jenis bantuan
                        </label>
                    </div>
                </div>
            `);
            
            setupAdvancedSearch();
        });

        // Update filterData function to include advanced search options
        function filterData() {
            const desaFilter = $('#filterDesa').val();
            const jenisFilter = $('#filterJenis').val();
            const tanggalFilter = $('#filterTanggal').val();
            const searchText = $('#searchInput').val().toLowerCase();
            
            let filteredData = bantuanData;
            
            // Apply filters
            if (desaFilter) {
                filteredData = filteredData.filter(item => item.desa === desaFilter);
            }
            
            if (jenisFilter) {
                filteredData = filteredData.filter(item => item.jenisBantuan === jenisFilter);
            }
            
            if (tanggalFilter) {
                filteredData = filteredData.filter(item => item.tanggal === tanggalFilter);
            }
            
            if (searchText) {
                const searchName = $('#searchName').is(':checked');
                const searchVillage = $('#searchVillage').is(':checked');
                const searchType = $('#searchType').is(':checked');
                
                filteredData = filteredData.filter(item => {
                    let match = false;
                    
                    if (searchName && item.nama.toLowerCase().includes(searchText)) {
                        match = true;
                    }
                    
                    if (searchVillage && item.desa.toLowerCase().includes(searchText)) {
                        match = true;
                    }
                    
                    if (searchType && item.jenisBantuan.toLowerCase().includes(searchText)) {
                        match = true;
                    }
                    
                    if (!searchName && !searchVillage && !searchType) {
                        // Jika tidak ada opsi yang dipilih, cari di semua field
                        match = (
                            item.nama.toLowerCase().includes(searchText) ||
                            item.desa.toLowerCase().includes(searchText) ||
                            item.jenisBantuan.toLowerCase().includes(searchText) ||
                            item.whatsapp.includes(searchText)
                        );
                    }
                    
                    return match;
                });
            }
            
            return filteredData;
        }

        // Handle responsive table with horizontal scroll
        function setupResponsiveTable() {
            const table = $('#bantuanTable');
            const tableContainer = table.parent();
            
            function checkTableOverflow() {
                if (table.width() > tableContainer.width()) {
                    tableContainer.addClass('table-overflow');
                } else {
                    tableContainer.removeClass('table-overflow');
                }
            }
            
            checkTableOverflow();
            $(window).on('resize', checkTableOverflow);
        }

        // Add styles for table overflow
        $(document).ready(function() {
            $('head').append(`
                <style>
                    .table-overflow {
                        overflow-x: auto;
                    }
                    
                    .table-overflow::after {
                        content: '';
                        position: absolute;
                        right: 10px;
                        bottom: 10px;
                        font-size: 12px;
                        color: #6c757d;
                    }
                </style>
            `);
            
            setupResponsiveTable();
        });

        // Handle chart responsive resize
        function setupChartResize() {
            let resizeTimer;
            
            $(window).on('resize', function() {
                clearTimeout(resizeTimer);
                resizeTimer = setTimeout(function() {
                    if (window.monthlyChartInstance) {
                        window.monthlyChartInstance.resize();
                    }
                    if (window.typeChartInstance) {
                        window.typeChartInstance.resize();
                    }
                    if (window.desaChartInstance) {
                        window.desaChartInstance.resize();
                    }
                }, 250);
            });
        }

        // Initialize chart resize handler
        $(document).ready(setupChartResize);

        // Handle app version update check
        function checkForUpdates() {
            const currentVersion = '2.1.0';
            const lastUpdateCheck = localStorage.getItem('lastUpdateCheck');
            const now = Date.now();
            
            // Check once per day
            if (lastUpdateCheck && (now - lastUpdateCheck) < 86400000) {
                return;
            }
            
            // Simulate update check (in a real app, this would call an API)
            setTimeout(() => {
                const hasUpdate = Math.random() > 0.8; // 20% chance of update for demo
                
                if (hasUpdate) {
                    showNotification('Versi baru tersedia! Klik untuk mempelajari lebih lanjut.', 'info');
                }
                
                localStorage.setItem('lastUpdateCheck', now.toString());
            }, 3000);
        }

        // Check for updates when app loads
        $(document).ready(function() {
            setTimeout(checkForUpdates, 5000);
        });

        // Handle app tour/intro
        function startAppTour() {
            const tourSteps = [
                {
                    element: '#dashboard',
                    title: 'Dashboard',
                    content: 'Lihat ringkasan data bantuan dan statistik penting di sini.',
                    placement: 'left'
                },
                {
                    element: '#inputData',
                    title: 'Input Data',
                    content: 'Tambahkan data bantuan baru melalui form ini.',
                    placement: 'left'
                },
                {
                    element: '#dataTable',
                    title: 'Tabel Data',
                    content: 'Kelola dan lihat semua data bantuan dalam format tabel.',
                    placement: 'left'
                },
                {
                    element: '#statistik',
                    title: 'Statistik',
                    content: 'Analisis data dengan grafik dan chart interaktif.',
                    placement: 'left'
                },
                {
                    element: '#pengaturan',
                    title: 'Pengaturan',
                    content: 'Kelola pengaturan aplikasi dan data Anda.',
                    placement: 'left'
                }
            ];
            
            // Show tour steps sequentially
            let currentStep = 0;
            
            function showNextStep() {
                if (currentStep >= tourSteps.length) {
                    // Tour finished
                    localStorage.setItem('appTourCompleted', 'true');
                    return;
                }
                
                const step = tourSteps[currentStep];
                
                // Show the section if not visible
                showSection(step.element.replace('#', ''));
                
                // Highlight the element
                $(step.element).addClass('tour-highlight');
                
                // Show tooltip
                const tooltip = $(`
                    <div class="tour-tooltip">
                        <div class="tour-tooltip-header">
                            <h5>${step.title}</h5>
                            <button type="button" class="btn-close tour-close"></button>
                        </div>
                        <div class="tour-tooltip-body">
                            <p>${step.content}</p>
                        </div>
                        <div class="tour-tooltip-footer">
                            <button class="btn btn-sm btn-outline-secondary tour-prev">Sebelumnya</button>
                            <button class="btn btn-sm btn-primary tour-next">${currentStep === tourSteps.length - 1 ? 'Selesai' : 'Selanjutnya'}</button>
                        </div>
                    </div>
                `);
                
                // Position the tooltip
                const element = $(step.element);
                const offset = element.offset();
                tooltip.css({
                    position: 'absolute',
                    top: offset.top + 20,
                    left: offset.left + element.outerWidth() + 20,
                    zIndex: 1060
                });
                
                $('body').append(tooltip);
                
                // Event handlers
                tooltip.find('.tour-next').on('click', function() {
                    tooltip.remove();
                    $(step.element).removeClass('tour-highlight');
                    currentStep++;
                    setTimeout(showNextStep, 300);
                });
                
                tooltip.find('.tour-prev').on('click', function() {
                    tooltip.remove();
                    $(step.element).removeClass('tour-highlight');
                    currentStep = Math.max(0, currentStep - 1);
                    setTimeout(showNextStep, 300);
                });
                
                tooltip.find('.tour-close').on('click', function() {
                    tooltip.remove();
                    $(step.element).removeClass('tour-highlight');
                    localStorage.setItem('appTourCompleted', 'true');
                });
            }
            
            // Start the tour
            showNextStep();
        }

        // Add tour styles
        $(document).ready(function() {
            $('head').append(`
                <style>
                    .tour-highlight {
                        box-shadow: 0 0 0 4px rgba(13, 71, 161, 0.5) !important;
                        border-radius: 4px;
                        position: relative;
                        z-index: 1050;
                    }
                    
                    .tour-tooltip {
                        background: white;
                        border-radius: 8px;
                        box-shadow: 0 4px 20px rgba(0,0,0,0.15);
                        width: 300px;
                        z-index: 1060;
                    }
                    
                    .tour-tooltip-header {
                        padding: 15px 15px 10px;
                        border-bottom: 1px solid #eee;
                        display: flex;
                        justify-content: space-between;
                        align-items: flex-start;
                    }
                    
                    .tour-tooltip-header h5 {
                        margin: 0;
                        font-size: 1.1rem;
                    }
                    
                    .tour-tooltip-body {
                        padding: 15px;
                    }
                    
                    .tour-tooltip-footer {
                        padding: 10px 15px;
                        border-top: 1px solid #eee;
                        display: flex;
                        justify-content: space-between;
                    }
                </style>
            `);
        });

        // Start tour if first time
        $(document).ready(function() {
            const tourCompleted = localStorage.getItem('appTourCompleted');
            if (!tourCompleted) {
                setTimeout(startAppTour, 2000);
            }
        });

        // Handle app performance monitoring
        function monitorPerformance() {
            // Track page load time
            window.addEventListener('load', function() {
                const loadTime = performance.timing.domContentLoadedEventEnd - performance.timing.navigationStart;
                console.log(`Page load time: ${loadTime}ms`);
                
                if (loadTime > 3000) {
                    console.warn('Page load time is slow. Consider optimizing.');
                }
            });
            
            // Track JavaScript errors
            window.addEventListener('error', function(e) {
                console.error('JavaScript error:', e.error);
                // In a real app, you might want to send this to a logging service
            });
            
            // Track unhandled promise rejections
            window.addEventListener('unhandledrejection', function(e) {
                console.error('Unhandled promise rejection:', e.reason);
            });
        }

        // Start performance monitoring
        $(document).ready(monitorPerformance);

        // Handle app analytics (basic)
        function trackAppUsage() {
            const trackEvent = (category, action, label) => {
                console.log(`Analytics: ${category} - ${action} - ${label}`);
                // In a real app, you would send this to Google Analytics or similar
            };
            
            // Track section views
            $('.nav-link').on('click', function() {
                const section = $(this).data('bs-target');
                trackEvent('Navigation', 'View Section', section);
            });
            
            // Track form submissions
            $('#bantuanForm').on('submit', function() {
                trackEvent('Form', 'Submit', 'Bantuan Data');
            });
            
            // Track data exports
            $('#exportExcel, #exportPDF').on('click', function() {
                const format = $(this).attr('id').replace('export', '').toLowerCase();
                trackEvent('Data', 'Export', format);
            });
            
            // Track data imports
            $('#importFile').on('change', function(e) {
                if (e.target.files.length > 0) {
                    trackEvent('Data', 'Import', 'Excel');
                }
            });
        }

        // Start analytics tracking
        $(document).ready(trackAppUsage);

        // Handle app accessibility improvements
        function improveAccessibility() {
            // Add aria-labels to icons
            $('i.fas').each(function() {
                const parent = $(this).parent();
                if (parent.is('button, a') && !parent.attr('aria-label')) {
                    const text = parent.text().trim();
                    if (text) {
                        parent.attr('aria-label', text);
                    }
                }
            });
            
            // Ensure all form inputs have labels
            $('input, select, textarea').each(function() {
                const id = $(this).attr('id');
                if (id && !$(`label[for="${id}"]`).length) {
                    const placeholder = $(this).attr('placeholder');
                    if (placeholder) {
                        $(this).before(`<label for="${id}" class="form-label">${placeholder}</label>`);
                    }
                }
            });
            
            // Improve keyboard navigation
            $('a, button, input, select, textarea').attr('tabindex', '0');
            
            // Add skip to content link
            $('body').prepend(`
                <a href="#main-content" class="skip-link">Skip to main content</a>
            `);
            
            $('#main-content').attr('id', 'main-content');
        }

        // Improve accessibility when document is ready
        $(document).ready(improveAccessibility);

        // Handle app theming
        function setupTheming() {
            const theme = localStorage.getItem('appTheme') || 'light';
            applyTheme(theme);
            
            // Add theme toggle button
            $('#pengaturan .card-body').append(`
                <div class="form-check form-switch mb-3">
                    <input class="form-check-input" type="checkbox" id="themeSwitch">
                    <label class="form-check-label" for="themeSwitch">Mode Gelap</label>
                </div>
            `);
            
            // Set initial state
            $('#themeSwitch').prop('checked', theme === 'dark');
            
            // Handle theme change
            $('#themeSwitch').on('change', function() {
                const newTheme = $(this).is(':checked') ? 'dark' : 'light';
                applyTheme(newTheme);
                localStorage.setItem('appTheme', newTheme);
            });
        }

        function applyTheme(theme) {
            if (theme === 'dark') {
                $('body').addClass('dark-theme');
            } else {
                $('body').removeClass('dark-theme');
            }
        }

        // Add dark theme styles
        $(document).ready(function() {
            $('head').append(`
                <style>
                    .dark-theme {
                        background: #121212;
                        color: #e0e0e0;
                    }
                    
                    .dark-theme .app-container {
                        background: #1e1e1e;
                        color: #e0e0e0;
                    }
                    
                    .dark-theme .bg-light {
                        background-color: #2d2d2d !important;
                    }
                    
                    .dark-theme .card {
                        background-color: #2d2d2d;
                        color: #e0e0e0;
                    }
                    
                    .dark-theme .form-control,
                    .dark-theme .form-select {
                        background-color: #2d2d2d;
                        color: #e0e0e0;
                        border-color: #444;
                    }
                    
                    .dark-theme .data-table {
                        color: #e0e0e0;
                    }
                    
                    .dark-theme .data-table th {
                        background: linear-gradient(135deg, #0d47a1, #082e5c);
                    }
                    
                    .dark-theme .data-table tr:nth-child(even) {
                        background-color: #2d2d2d;
                    }
                    
                    .dark-theme .data-table tr:hover {
                        background-color: #3d3d3d;
                    }
                    
                    .dark-theme .nav-pills .nav-link {
                        color: #e0e0e0;
                    }
                    
                    .dark-theme .nav-pills .nav-link:hover {
                        background-color: #3d3d3d;
                    }
                </style>
            `);
            
            setupTheming();
        });

        // Handle app localization (i18n)
        function setupLocalization() {
            const language = localStorage.getItem('appLanguage') || 'id';
            applyLanguage(language);
            
            // Add language selector
            $('#pengaturan .card-body').append(`
                <div class="mb-3">
                    <label class="form-label">Bahasa</label>
                    <select class="form-select" id="languageSelect">
                        <option value="id">Indonesia</option>
                        <option value="en">English</option>
                    </select>
                </div>
            `);
            
            // Set initial state
            $('#languageSelect').val(language);
            
            // Handle language change
            $('#languageSelect').on('change', function() {
                const newLanguage = $(this).val();
                applyLanguage(newLanguage);
                localStorage.setItem('appLanguage', newLanguage);
            });
        }

        function applyLanguage(language) {
            // This would load translations from language files in a real app
            // For demo purposes, we'll just toggle a few elements
            
            if (language === 'en') {
                // Translate a few key elements
                $('.app-title').text('BARJAS');
                $('.app-subtitle').text('Aid Distribution System');
                $('#dashboard .section-title').text('Dashboard');
                $('#inputData .section-title').text('Input Aid Data');
                $('#dataTable .section-title').text('Aid Data Table');
                $('#statistik .section-title').text('Statistics');
                $('#pengaturan .section-title').text('Settings');
            } else {
                // Restore Indonesian
                $('.app-title').text('BARJAS');
                $('.app-subtitle').text('Sistem Bantuan Terpadu');
                $('#dashboard .section-title').text('Dashboard');
                $('#inputData .section-title').text('Input Data Bantuan');
                $('#dataTable .section-title').text('Tabel Data Bantuan');
                $('#statistik .section-title').text('Statistik');
                $('#pengaturan .section-title').text('Pengaturan');
            }
        }

        // Setup localization when document is ready
        $(document).ready(setupLocalization);

        // Handle app data synchronization (simulated)
        function setupDataSync() {
            let lastSync = localStorage.getItem('lastDataSync');
            if (lastSync) {
                lastSync = new Date(parseInt(lastSync));
                $('#lastSyncTime').text(`Terakhir disinkronisasi: ${lastSync.toLocaleString('id-ID')}`);
            } else {
                $('#lastSyncTime').text('Belum pernah disinkronisasi');
            }
            
            // Add sync button
            $('#pengaturan .card-body').append(`
                <div class="d-grid gap-2 mt-3">
                    <button class="btn btn-outline-primary" id="syncData">
                        <i class="fas fa-sync-alt me-2"></i>Sinkronisasi Data
                    </button>
                    <div id="lastSyncTime" class="text-center small text-muted"></div>
                </div>
            `);
            
            // Handle sync
            $('#syncData').on('click', function() {
                const button = $(this);
                const originalText = button.html();
                
                button.prop('disabled', true);
                button.html('<i class="fas fa-sync-alt fa-spin me-2"></i>Menyinkronisasi...');
                
                // Simulate sync process
                setTimeout(() => {
                    const now = new Date();
                    localStorage.setItem('lastDataSync', now.getTime().toString());
                    $('#lastSyncTime').text(`Terakhir disinkronisasi: ${now.toLocaleString('id-ID')}`);
                    
                    button.prop('disabled', false);
                    button.html(originalText);
                    
                    showNotification('Data berhasil disinkronisasi.', 'success');
                }, 2000);
            });
        }

        // Setup data sync when document is ready
        $(document).ready(setupDataSync);

        // Handle app data validation on load
        function validateDataOnLoad() {
            // Check for data consistency
            let validDataCount = 0;
            let invalidDataCount = 0;
            
            bantuanData.forEach(item => {
                const isValid = item.nama && item.jenisKelamin && item.whatsapp && 
                               item.desa && item.tanggal && item.jenisBantuan && item.jumlah;
                
                if (isValid) {
                    validDataCount++;
                } else {
                    invalidDataCount++;
                }
            });
            
            if (invalidDataCount > 0) {
                console.warn(`Ditemukan ${invalidDataCount} data tidak valid.`);
                
                // Optionally, show a warning to the user
                if (invalidDataCount > 5) { // Only warn if significant invalid data
                    showNotification(`Peringatan: Ditemukan ${invalidDataCount} data tidak valid.`, 'warning');
                }
            }
            
            // Clean up invalid data if needed
            if (invalidDataCount > 0 && confirm(`Ditemukan ${invalidDataCount} data tidak valid. Bersihkan sekarang?`)) {
                bantuanData = bantuanData.filter(item => 
                    item.nama && item.jenisKelamin && item.whatsapp && 
                    item.desa && item.tanggal && item.jenisBantuan && item.jumlah
                );
                saveData();
                showNotification('Data tidak valid telah dibersihkan.', 'success');
            }
        }

        // Validate data when app loads
        $(document).ready(function() {
            if (bantuanData.length > 0) {
                setTimeout(validateDataOnLoad, 3000);
            }
        });

        // Handle app data compression (simulated)
        function compressData() {
            const originalSize = JSON.stringify(bantuanData).length;
            console.log(`Original data size: ${originalSize} bytes`);
            
            // Simple compression: remove unnecessary whitespace
            const compressedData = JSON.stringify(bantuanData);
            const compressedSize = compressedData.length;
            
            console.log(`Compressed data size: ${compressedSize} bytes`);
            console.log(`Compression ratio: ${((originalSize - compressedSize) / originalSize * 100).toFixed(1)}%`);
            
            // In a real app, you might use more advanced compression techniques
        }

        // Compress data periodically
        setInterval(compressData, 300000); // Every 5 minutes

        // Handle app data backup reminder
        function setupBackupReminder() {
            const lastBackup = localStorage.getItem('lastDataBackup');
            const now = Date.now();
            const oneDay = 24 * 60 * 60 * 1000;
            
            if (!lastBackup || (now - parseInt(lastBackup)) > oneDay) {
                // Show backup reminder
                setTimeout(() => {
                    if (confirm('Sudah lebih dari 1 hari sejak backup terakhir. Lakukan backup sekarang?')) {
                        backupData();
                        localStorage.setItem('lastDataBackup', now.toString());
                    }
                }, 10000); // Show after 10 seconds
            }
        }

        // Setup backup reminder when app loads
        $(document).ready(function() {
            if (bantuanData.length > 0) {
                setTimeout(setupBackupReminder, 5000);
            }
        });

        // Handle app data encryption (simulated)
        function encryptData() {
            // In a real app, you would use a proper encryption library
            // This is just a simulation for demonstration purposes
            
            console.log('Data encrypted (simulated)');
            return bantuanData;
        }

        function decryptData() {
            // In a real app, you would decrypt the data
            // This is just a simulation for demonstration purposes
            
            console.log('Data decrypted (simulated)');
            return bantuanData;
        }

        // Encrypt data before saving
        const originalSaveData = saveData;
        saveData = function() {
            const encryptedData = encryptData();
            localStorage.setItem('bantuanData', JSON.stringify(encryptedData));
        };

        // Decrypt data after loading
        const originalLoadData = loadData;
        loadData = function() {
            const savedData = localStorage.getItem('bantuanData');
            if (savedData) {
                bantuanData = decryptData(JSON.parse(savedData));
            }
        };

        // Handle app data migration
        function migrateData() {
            const dataVersion = localStorage.getItem('dataVersion') || '1.0';
            
            if (dataVersion === '1.0') {
                // Migrate from version 1.0 to 2.0
                console.log('Migrating data from version 1.0 to 2.0');
                
                // Add new fields to existing data
                bantuanData.forEach(item => {
                    if (!item.hasOwnProperty('kodeValidasi')) {
                        item.kodeValidasi = 'MIGRATED';
                    }
                    
                    if (!item.hasOwnProperty('timestamp')) {
                        item.timestamp = new Date().toISOString();
                    }
                });
                
                // Update version
                localStorage.setItem('dataVersion', '2.0');
                saveData();
                
                console.log('Data migration completed');
            }
        }

        // Migrate data when app loads
        $(document).ready(migrateData);

        // Handle app error boundary
        function setupErrorBoundary() {
            // Capture uncaught errors
            window.addEventListener('error', function(e) {
                console.error('Application error:', e.error);
                
                // Show user-friendly error message
                showNotification('Terjadi kesalahan dalam aplikasi. Silakan refresh halaman.', 'error');
                
                // In a real app, you might send this error to a logging service
            });
            
            // Capture unhandled promise rejections
            window.addEventListener('unhandledrejection', function(e) {
                console.error('Unhandled promise rejection:', e.reason);
                
                // Show user-friendly error message
                showNotification('Terjadi kesalahan dalam aplikasi. Silakan coba lagi.', 'error');
            });
        }

        // Setup error boundary when app loads
        $(document).ready(setupErrorBoundary);

        // Handle app memory management
        function manageMemory() {
            // Clean up unused data periodically
            setInterval(() => {
                // Remove old drafts
                const draft = localStorage.getItem('bantuanDraft');
                if (draft) {
                    const draftTime = JSON.parse(draft).timestamp;
                    if (draftTime && (Date.now() - draftTime) > 24 * 60 * 60 * 1000) {
                        localStorage.removeItem('bantuanDraft');
                        console.log('Cleaned up old draft');
                    }
                }
                
                // Remove old notifications
                $('.toast:not(.show)').remove();
                
                // Clean up chart instances if not in use
                if (!$('#dashboard').is(':visible') && window.monthlyChartInstance) {
                    window.monthlyChartInstance.destroy();
                    window.monthlyChartInstance = null;
                }
                
                if (!$('#dashboard').is(':visible') && window.typeChartInstance) {
                    window.typeChartInstance.destroy();
                    window.typeChartInstance = null;
                }
                
                if (!$('#statistik').is(':visible') && window.desaChartInstance) {
                    window.desaChartInstance.destroy();
                    window.desaChartInstance = null;
                }
            }, 300000); // Every 5 minutes
        }

        // Start memory management when app loads
        $(document).ready(manageMemory);

        // Handle app security features
        function enhanceSecurity() {
            // Prevent right-click (optional)
            $(document).on('contextmenu', function(e) {
                if ($('#preventRightClick').is(':checked')) {
                    e.preventDefault();
                    showNotification('Klik kanan dinonaktifkan untuk keamanan.', 'info');
                }
            });
            
            // Add security settings
            $('#pengaturan .card-body').append(`
                <div class="form-check form-switch mb-3">
                    <input class="form-check-input" type="checkbox" id="preventRightClick">
                    <label class="form-check-label" for="preventRightClick">Nonaktifkan klik kanan</label>
                </div>
                
                <div class="form-check form-switch mb-3">
                    <input class="form-check-input" type="checkbox" id="autoLogout">
                    <label class="form-check-label" for="autoLogout">Auto logout setelah 30 menit</label>
                </div>
            `);
            
            // Load saved settings
            $('#preventRightClick').prop('checked', localStorage.getItem('preventRightClick') === 'true');
            $('#autoLogout').prop('checked', localStorage.getItem('autoLogout') === 'true');
            
            // Save settings
            $('#preventRightClick, #autoLogout').on('change', function() {
                localStorage.setItem($(this).attr('id'), $(this).is(':checked').toString());
            });
            
            // Auto logout functionality
            let inactivityTimer;
            function resetInactivityTimer() {
                clearTimeout(inactivityTimer);
                if ($('#autoLogout').is(':checked')) {
                    inactivityTimer = setTimeout(() => {
                        if (confirm('Sesi Anda akan berakhir karena tidak aktif. Lanjutkan sesi?')) {
                            resetInactivityTimer();
                        } else {
                            localStorage.setItem('isLoggedIn', 'false');
                            $('#loginModal').modal('show');
                            $('.app-content-unauthenticated').hide();
                        }
                    }, 30 * 60 * 1000); // 30 minutes
                }
            }
            
            // Reset timer on user activity
            $(document).on('mousemove keypress click scroll', resetInactivityTimer);
            resetInactivityTimer();
        }

        // Enhance security when app loads
        $(document).ready(enhanceSecurity);

        // Handle app performance optimization
        function optimizePerformance() {
            // Lazy load images
            const lazyImages = $('img[data-src]');
            lazyImages.each(function() {
                const img = $(this);
                if (img.isInViewport()) {
                    img.attr('src', img.data('src'));
                    img.removeAttr('data-src');
                }
            });
            
            // Debounce resize events
            let resizeTimeout;
            $(window).on('resize', function() {
                clearTimeout(resizeTimeout);
                resizeTimeout = setTimeout(() => {
                    // Update charts and layouts
                    if (window.monthlyChartInstance) {
                        window.monthlyChartInstance.resize();
                    }
                    if (window.typeChartInstance) {
                        window.typeChartInstance.resize();
                    }
                    if (window.desaChartInstance) {
                        window.desaChartInstance.resize();
                    }
                }, 250);
            });
            
            // Throttle scroll events
            let scrollTimeout;
            $(window).on('scroll', function() {
                if (!scrollTimeout) {
                    scrollTimeout = setTimeout(() => {
                        // Check for lazy images in viewport
                        lazyImages.each(function() {
                            const img = $(this);
                            if (img.isInViewport()) {
                                img.attr('src', img.data('src'));
                                img.removeAttr('data-src');
                            }
                        });
                        scrollTimeout = null;
                    }, 100);
                }
            });
            
            // Optimize DOM manipulations
            const originalAppend = $.fn.append;
            $.fn.append = function() {
                // Batch DOM manipulations
                if (this.length > 0) {
                    const fragment = document.createDocumentFragment();
                    for (let i = 0; i < arguments.length; i++) {
                        const arg = arguments[i];
                        if (typeof arg === 'string') {
                            const tempDiv = document.createElement('div');
                            tempDiv.innerHTML = arg;
                            while (tempDiv.firstChild) {
                                fragment.appendChild(tempDiv.firstChild);
                            }
                        } else if (arg instanceof Node) {
                            fragment.appendChild(arg);
                        }
                    }
                    this[0].appendChild(fragment);
                }
                return this;
            };
        }

        // Check if element is in viewport
        $.fn.isInViewport = function() {
            const elementTop = $(this).offset().top;
            const elementBottom = elementTop + $(this).outerHeight();
            const viewportTop = $(window).scrollTop();
            const viewportBottom = viewportTop + $(window).height();
            return elementBottom > viewportTop && elementTop < viewportBottom;
        };

        // Optimize performance when app loads
        $(document).ready(optimizePerformance);

        // Handle app testing and debugging
        function setupTestingTools() {
            // Add debug menu (only in development)
            if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
                $('body').append(`
                    <div id="debugMenu" class="position-fixed top-0 end-0 m-3 p-2 bg-dark text-white rounded-3">
                        <button class="btn btn-sm btn-outline-light me-2" id="debugLogData">Log Data</button>
                        <button class="btn btn-sm btn-outline-light" id="debugAddTestData">Add Test Data</button>
                    </div>
                `);
                
                $('#debugLogData').on('click', function() {
                    console.log('Bantuan Data:', bantuanData);
                    showNotification('Data logged to console.', 'info');
                });
                
                $('#debugAddTestData').on('click', function() {
                    const testData = {
                        id: Date.now().toString(),
                        nama: 'Test User ' + Math.floor(Math.random() * 1000),
                        jenisKelamin: Math.random() > 0.5 ? 'Laki-laki' : 'Perempuan',
                        whatsapp: '8123456789',
                        desa: 'Desa ' + String.fromCharCode(65 + Math.floor(Math.random() * 5)),
                        tanggal: new Date().toLocaleDateString('id-ID'),
                        jenisBantuan: ['Tunai', 'Sembako', 'Pakaian'][Math.floor(Math.random() * 3)],
                        jumlah: (100000 + Math.floor(Math.random() * 900000)).toString(),
                        driveLink: '',
                        kodeValidasi: 'TEST' + Math.floor(Math.random() * 1000),
                        timestamp: new Date().toISOString()
                    };
                    
                    bantuanData.push(testData);
                    saveData();
                    renderTable();
                    updateDashboard();
                    
                    showNotification('Test data added.', 'success');
                });
            }
        }

        // Setup testing tools when app loads
        $(document).ready(setupTestingTools);

        // Final app initialization
        $(document).ready(function() {
            console.log('BARJAS Application initialized successfully');
            
            // Show welcome message
            setTimeout(() => {
                showNotification('Selamat datang di BARJAS - Sistem Bantuan Terpadu', 'success');
            }, 1000);
            
            // Check for updates
            checkForUpdates();
        });

    </script>
</body>
</html>
