<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CAFE & RESTO</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root {
            --primary: #28a745;
            --primary-light: #d4edda;
            --secondary: #218838;
            --success: #28a745;
            --danger: #dc3545;
            --warning: #ffc107;
            --info: #17a2b8;
            --light: #f8f9fa;
            --dark: #343a40;
            --gray: #6c757d;
            --white: #ffffff;
            --shadow-sm: 0 0.15rem 0.35rem rgba(0,0,0,0.1);
            --shadow: 0 0.5rem 1rem rgba(0,0,0,0.15);
            --rounded-sm: 0.35rem;
            --rounded: 0.75rem;
            --rounded-lg: 1rem;
            --donation: #6f42c1;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background-color: #f8f9fa;
            color: #212529;
            line-height: 1.5;
            touch-action: manipulation;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 12px;
        }

        /* Header Styles */
        .app-header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: var(--white);
            padding: 12px 16px;
            border-radius: var(--rounded);
            margin-bottom: 16px;
            box-shadow: var(--shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-title-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header-logo {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: var(--white);
            padding: 5px;
            box-shadow: var(--shadow-sm);
        }
        .header-logo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }

        .app-title {
            font-size: 1.4rem;
            font-weight: 600;
        }

        .header-info {
            text-align: right;
            font-size: 0.9rem;
        }

        .header-info p {
            margin: 2px 0;
        }

        /* Main Content Layout */
        .app-content {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        /* Panel Styles */
        .panel {
            background: var(--white);
            border-radius: var(--rounded);
            padding: 16px;
            box-shadow: var(--shadow-sm);
        }

        .panel-title {
            font-size: 1.2rem;
            margin-bottom: 12px;
            color: var(--dark);
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        /* Menu Grid */
        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 12px;
            margin-bottom: 16px;
        }

        .menu-card {
            background: var(--white);
            border-radius: var(--rounded-sm);
            padding: 12px;
            box-shadow: var(--shadow-sm);
            transition: all 0.2s;
            border: 1px solid #eee;
            cursor: pointer;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        .menu-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
            border-color: var(--primary);
        }

        .menu-image {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: var(--light);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 8px;
            overflow: hidden;
        }

        .menu-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .menu-image i {
            font-size: 1.5rem;
            color: var(--gray);
        }

        .menu-name {
            font-weight: 500;
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            width: 100%;
        }

        .menu-price {
            color: var(--primary);
            font-weight: 600;
            margin-bottom: 4px;
        }

        .menu-category {
            font-size: 0.7rem;
            color: var(--gray);
            background-color: var(--light);
            padding: 2px 6px;
            border-radius: 10px;
            margin-top: 4px;
        }

        /* Search and Filter */
        .search-container {
            position: relative;
            margin-bottom: 16px;
        }

        .search-container i {
            position: absolute;
            left: 14px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray);
        }

        .search-input {
            width: 100%;
            padding: 12px 16px 12px 40px;
            border: 1px solid #ddd;
            border-radius: var(--rounded-sm);
            font-size: 1rem;
        }

        .filter-row {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            overflow-x: auto;
            padding-bottom: 4px;
        }

        .filter-chip {
            padding: 8px 12px;
            background: var(--light);
            border-radius: 20px;
            font-size: 0.9rem;
            white-space: nowrap;
            cursor: pointer;
        }

        .filter-chip.active {
            background: var(--primary);
            color: var(--white);
        }

        /* Order Styles */
        .order-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #eee;
        }

        .order-item-info {
            flex: 1;
        }

        .order-item-name {
            font-weight: 500;
        }

        .order-item-price {
            color: var(--gray);
            font-size: 0.9rem;
        }

        .whatsapp-link {
            color: var(--primary);
            text-decoration: none;
            font-weight: 500;
        }
        .whatsapp-link:hover {
            text-decoration: underline;
        }

        .order-item-qty {
            display: flex;
            align-items: center;
        }

        .qty-btn {
            width: 32px;
            height: 32px;
            border: 1px solid #ddd;
            background: var(--light);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .qty-input {
            width: 40px;
            text-align: center;
            margin: 0 4px;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 6px;
        }

        .remove-btn {
            color: var(--danger);
            margin-left: 8px;
            cursor: pointer;
        }

        /* Summary Styles */
        .summary-container {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px dashed #ddd;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .total-row {
            font-weight: 600;
            font-size: 1.1rem;
            color: var(--primary);
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #ddd;
        }

        /* Button Styles */
        .btn {
            display: inline-block;
            padding: 12px 20px;
            background-color: var(--primary);
            color: var(--white);
            border: none;
            border-radius: var(--rounded-sm);
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            text-align: center;
            transition: all 0.2s;
            width: 100%;
        }
        
        .btn:disabled {
            background-color: var(--gray);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn:hover:not(:disabled) {
            background-color: var(--secondary);
            transform: translateY(-2px);
            box-shadow: var(--shadow-sm);
        }

        .btn:active:not(:disabled) {
            transform: translateY(0);
        }
        
        .btn .fa-spinner {
            margin-right: 8px;
        }

        .btn-sm {
            padding: 8px 12px;
            font-size: 0.9rem;
        }

        .btn-success {
            background-color: var(--success);
        }

        .btn-success:hover {
            background-color: #218838;
        }

        .btn-danger {
            background-color: var(--danger);
        }

        .btn-danger:hover {
            background-color: #c82333;
        }

        .btn-warning {
            background-color: var(--warning);
            color: #000;
        }

        .btn-warning:hover {
            background-color: #e0a800;
        }

        .btn-info {
            background-color: var(--info);
        }

        .btn-info:hover {
            background-color: #138496;
        }
        
        .btn-outline-primary {
            background-color: transparent;
            color: var(--primary);
            border: 1px solid var(--primary);
        }
        
        .btn-outline-primary:hover {
            background-color: var(--primary);
            color: var(--white);
        }

        .btn-donation {
            background-color: var(--donation);
        }

        .btn-donation:hover {
            background-color: #5a32a3;
        }

        /* Tab Styles */
        .tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 16px;
            overflow-x: auto;
        }

        .tab {
            padding: 12px 16px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            white-space: nowrap;
            text-align: center;
            flex: 1;
        }

        .tab.active {
            border-bottom: 3px solid var(--primary);
            color: var(--primary);
            font-weight: 600;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: var(--white);
            border-radius: var(--rounded-lg);
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow);
            animation: fadeIn 0.3s;
        }

        .modal-header {
            padding: 16px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.2rem;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray);
        }

        .modal-body {
            padding: 16px;
        }

        .modal-footer {
            padding: 16px;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: flex-end;
            gap: 8px;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .form-check {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .form-control {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: var(--rounded-sm);
            font-size: 1rem;
        }

        textarea.form-control {
            min-height: 100px;
            resize: vertical;
        }

        /* Login Styles */
        .login-container {
            max-width: 400px;
            margin: 20px auto;
            background: var(--white);
            border-radius: var(--rounded-lg);
            padding: 24px;
            box-shadow: var(--shadow);
        }

        .login-header {
            text-align: center;
            margin-bottom: 24px;
        }

        .login-logo {
            font-size: 3rem;
            color: var(--primary);
            margin-bottom: 12px;
        }

        .login-title {
            font-size: 1.8rem;
            color: var(--primary);
            font-weight: 600;
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 16px;
            background-color: var(--dark);
            color: var(--white);
            border-radius: var(--rounded-sm);
            box-shadow: var(--shadow);
            z-index: 1100;
            display: flex;
            align-items: center;
            transform: translateX(200%);
            transition: transform 0.3s;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.success {
            background-color: var(--success);
        }

        .toast.error {
            background-color: var(--danger);
        }

        .toast.warning {
            background-color: var(--warning);
            color: #000;
        }

        .toast i {
            margin-right: 8px;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 24px;
            color: var(--gray);
        }

        .empty-state i {
            font-size: 3rem;
            color: #ddd;
            margin-bottom: 12px;
        }

        /* Admin Panel */
        .admin-panel {
            display: block; /* Default to block, can be hidden via JS */
            margin-top: 16px;
            padding: 16px;
            background-color: var(--light);
            border-radius: var(--rounded);
        }
        
        .admin-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        /* Table Styles */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 16px;
        }

        .data-table th, .data-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .data-table th {
            background-color: var(--light);
            font-weight: 600;
        }

        .data-table tr:hover {
            background-color: #f9f9f9;
        }
        
        .data-table .actions-cell {
            display: flex;
            gap: 4px;
        }

        /* Menu Actions */
        .menu-actions {
            position: absolute;
            top: 8px;
            right: 8px;
            display: none;
            gap: 4px;
        }

        .menu-card:hover .menu-actions {
            display: flex;
        }

        .action-btn {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 0.7rem;
            color: white;
            border: none;
            background-color: var(--gray);
        }
        
        .action-btn.view-btn {
            background-color: var(--success);
        }

        .action-btn.edit-btn {
            background-color: var(--info);
        }

        .action-btn.delete-btn {
            background-color: var(--danger);
        }

        /* Note Input */
        .note-input {
            margin-top: 12px;
        }

        .note-input textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: var(--rounded-sm);
            resize: vertical;
            min-height: 60px;
        }

        /* Table Number */
        .table-number {
            margin-bottom: 16px;
        }

        .table-number select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: var(--rounded-sm);
        }

        /* Order Type */
        .order-type {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }

        .order-type-btn {
            flex: 1;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: var(--rounded-sm);
            text-align: center;
            cursor: pointer;
            background-color: var(--light);
        }

        .order-type-btn.active {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* Member Search */
        .member-search-container {
            position: relative;
        }

        .member-search-results {
            position: absolute;
            top: 100%;
            left: 0;
            width: 100%;
            max-height: 200px;
            overflow-y: auto;
            background: white;
            border: 1px solid #ddd;
            border-radius: 0 0 var(--rounded-sm) var(--rounded-sm);
            z-index: 100;
            display: none;
        }

        .member-search-item {
            padding: 8px 12px;
            cursor: pointer;
        }

        .member-search-item:hover {
            background-color: var(--light);
        }

        /* Kitchen Status */
        .kitchen-status {
            margin-top: 16px;
            padding: 12px;
            background-color: var(--light);
            border-radius: var(--rounded-sm);
        }

        .kitchen-status h4 {
            margin-bottom: 8px;
        }

        .status-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }

        .status-item:last-child {
            border-bottom: none;
        }

        .status-preparing {
            color: var(--danger);
            cursor: pointer;
        }

        .status-ready {
            color: var(--success);
        }

        .status-locked {
            color: var(--gray);
            cursor: default;
        }
        
        /* Payment Modal Enhancements */
        .payment-total-display {
            background: var(--primary-light);
            border-radius: var(--rounded);
            padding: 16px;
            text-align: center;
            margin-bottom: 16px;
        }
        
        .payment-total-display p {
            font-size: 1rem;
            color: var(--secondary);
            margin: 0;
        }
        
        .payment-total-display h3 {
            font-size: 2rem;
            color: var(--primary);
            margin: 0;
        }
        
        .quick-cash-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin: 16px 0;
        }

        /* Member Badge */
        .member-badge {
            background-color: var(--info);
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 0.7rem;
            margin-left: 6px;
        }

        /* Donation Badge */
        .donation-badge {
            background-color: var(--donation);
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 0.7rem;
            margin-left: 6px;
        }

        /* Responsive Adjustments */
        @media (min-width: 768px) {
            .app-content {
                flex-direction: row;
            }
            
            .menu-panel {
                flex: 2;
            }
            
            .order-panel {
                flex: 1;
            }
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }

        .modal-content {
            animation: fadeIn 0.3s;
        }

        /* Utility Classes */
        .text-center {
            text-align: center;
        }

        .mt-2 {
            margin-top: 8px;
        }

        .mt-3 {
            margin-top: 16px;
        }

        .mb-2 {
            margin-bottom: 8px;
        }

        .mb-3 {
            margin-bottom: 16px;
        }

        .d-flex {
            display: flex;
        }

        .justify-between {
            justify-content: space-between;
        }

        .align-center {
            align-items: center;
        }

        .gap-2 {
            gap: 8px;
        }
        
        /* Footer */
        .app-footer {
            text-align: center;
            margin-top: 20px;
            padding: 10px;
            color: var(--gray);
            font-size: 0.8rem;
        }

        .print-btn {
            background-color: var(--info);
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            margin-top: 10px;
            display: inline-block;
            cursor: pointer;
        }
        
        /* === PERBAIKAN & PENYEMPURNAAN KODE CETAK (REVISI FINAL) === */
        #receiptContent {
            font-family: 'Courier New', Courier, monospace;
            width: 300px; /* Lebar default untuk tampilan modal */
            margin: 0 auto;
            padding: 15px;
            font-size: 12px;
            line-height: 1.3;
            color: #000;
            background: white;
        }

        .receipt-header {
            text-align: center;
            margin-bottom: 8px;
        }
        
        .receipt-logo {
            width: 50px;
            height: 50px;
            margin: 0 auto 5px auto;
            object-fit: contain;
        }

        .receipt-title {
            font-weight: bold;
            font-size: 14px;
            margin-bottom: 3px;
        }

        .receipt-info {
            margin-bottom: 8px;
            font-size: 11px;
            border-top: 1px dashed #000;
            border-bottom: 1px dashed #000;
            padding: 5px 0;
        }
        
        .receipt-info div {
            display: flex;
            justify-content: space-between;
        }

        .receipt-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 2px;
        }
        
        .receipt-item-details {
            display: block;
        }
        
        .receipt-item-details .item-name {
            font-weight: bold;
        }
        .receipt-item-details .item-price-calc {
            font-size: 10px;
            padding-left: 5px;
        }
        
        #receiptItemsContainer {
             padding: 8px 0;
        }

        .receipt-total {
            font-weight: bold;
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px dashed #000;
        }

        .receipt-footer {
            margin-top: 12px;
            font-size: 10px;
            text-align: center;
        }
        
        @media print {
            body * {
                visibility: hidden;
            }
            
            #print-container, #print-container * {
                visibility: visible;
            }

            #print-container {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                margin: 0;
                padding: 0;
            }
            
            /* Memastikan hanya konten di dalam #print-container yang di-render */
            #print-container #receiptContent,
            #print-container #ktaCard {
                margin: 0;
                padding: 0;
                box-shadow: none !important;
                border: none !important;
            }
            
            /* Mengatur ukuran struk untuk printer thermal (misal: 72mm atau 58mm) */
            /* Sesuaikan 'width' di bawah ini dengan lebar kertas printer Anda */
            #print-container #receiptContent {
                width: 72mm !important; /* Ganti ke 58mm jika perlu */
                font-size: 9pt !important; /* Font diperkecil untuk cetak */
                padding: 2mm !important; /* Memberi sedikit margin di kertas */
            }
            
            .no-print {
                display: none !important;
            }
            
            @page {
                size: auto; /* Membiarkan browser menentukan ukuran berdasarkan konten */
                margin: 0mm; /* Menghapus margin halaman bawaan browser */
            }
        }
        /* === AKHIR DARI PERBAIKAN KODE CETAK === */


        /* Backup Restore Styles */
        .backup-actions {
            display: flex;
            gap: 8px;
            margin-top: 16px;
        }

        .backup-btn {
            flex: 1;
        }

        .file-input {
            display: none;
        }

        .file-label {
            display: block;
            padding: 12px;
            background-color: var(--info);
            color: white;
            border-radius: var(--rounded-sm);
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .file-label:hover {
            background-color: #138496;
        }
        
        
        /* === PERBAIKAN & PENYEMPURNAAN DESAIN KTA (REVISI) === */
        #ktaCard {
            width: 320px;
            height: 500px;
            margin: 0 auto;
            border-radius: 20px;
            background: radial-gradient(circle at top left, #feda75, #fa7e1e, #d62976, #962fbf, #4f5bd5);
            color: white;
            padding: 20px;
            display: flex;
            flex-direction: column;
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        #ktaCard::before {
            content: '';
            position: absolute;
            top: -80px;
            left: -80px;
            width: 200px;
            height: 200px;
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
            filter: blur(10px);
        }
        
        #ktaCard::after {
            content: '';
            position: absolute;
            bottom: -100px;
            right: -60px;
            width: 250px;
            height: 250px;
            background: rgba(255,255,255,0.15);
            border-radius: 45%;
            filter: blur(15px);
        }

        .kta-header {
            display: flex;
            align-items: center;
            gap: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.3);
            padding-bottom: 15px;
            margin-bottom: 25px;
            z-index: 1;
        }
        .kta-logo {
            width: 55px;
            height: 55px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid white;
            background-color: white;
        }
        .kta-store-info h3 {
            font-size: 18px;
            margin: 0;
            font-weight: 700;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.3);
        }
        .kta-store-info p {
            font-size: 11px;
            margin: 0;
            opacity: 0.9;
        }

        .kta-body {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            z-index: 1;
        }

        #ktaMemberName {
            font-size: 26px;
            font-weight: 600;
            margin-bottom: 8px;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.4);
        }
        
        #ktaMemberId {
            font-family: 'Courier New', monospace;
            font-size: 14px;
            background-color: rgba(0,0,0,0.3);
            padding: 4px 12px;
            border-radius: 20px;
            display: inline-block;
            margin-bottom: 20px;
            letter-spacing: 1px;
        }
        
        .kta-qrcode {
            background: white;
            padding: 10px;
            border-radius: 8px;
            min-height: 160px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .kta-qrcode img {
            width: 160px;
            height: auto;
            display: block;
        }

        .kta-footer {
            text-align: center;
            font-size: 11px;
            opacity: 0.8;
            padding-top: 15px;
            margin-top: 25px;
            border-top: 1px solid rgba(255,255,255,0.3);
            z-index: 1;
        }
        /* === AKHIR DARI PERBAIKAN KTA === */


    </style>
</head>
<body>
    <div id="toast" class="toast">
        <i class="fas fa-info-circle"></i>
        <span id="toast-message">Notification message</span>
    </div>

    <div id="loginModal" class="modal" style="display: flex;">
        <div class="login-container">
            <div class="login-header">
                <div class="login-logo">
                    <i class="fas fa-utensils"></i>
                </div>
                <h1 class="login-title">CAFE & RESTO</h1>
                <p>Aplikasi Penjualan Digital</p>
            </div>
            <form id="loginForm">
                <div class="form-group">
                    <label for="username" class="form-label">Username</label>
                    <input type="text" id="username" class="form-control" placeholder="Masukkan username" required>
                </div>
                <div class="form-group">
                    <label for="password" class="form-label">Password</label>
                    <input type="password" id="password" class="form-control" placeholder="Masukkan password" required>
                </div>
                <button type="submit" class="btn mt-3">Login</button>
            </form>
        </div>
    </div>

    <div class="container" id="mainApp" style="display: none;">
        <header class="app-header">
            <div class="header-title-container">
                <div class="header-logo">
                    <img src="" alt="Logo">
                </div>
                <div>
                    <h1 class="app-title" id="storeNameHeader">CAFE & RESTO</h1>
                    <p id="currentDate">Rabu, 24 September 2025</p>
                </div>
            </div>
            <div class="header-info">
                <p>Kasir: <span id="loggedInUser">Admin</span></p>
                <p><a href="#" id="logoutBtn" style="color: white;">Logout</a></p>
            </div>
        </header>

        <main class="app-content">
            <section class="panel menu-panel">
                <h2 class="panel-title">
                    <span>Daftar Menu</span>
                    <span id="menuCount">(0 menu)</span>
                </h2>
                
                <div class="search-container">
                    <i class="fas fa-search"></i>
                    <input type="text" id="menuSearch" class="search-input" placeholder="Cari menu...">
                </div>
                
                <div class="filter-row" id="categoryFilters">
                    </div>
                
                <div class="menu-grid" id="menuGrid">
                    </div>

                <div id="adminPanel" class="admin-panel">
                    <h3 class="panel-title">Admin Panel</h3>
                    <div class="admin-grid">
                        <button id="addMenuBtn" class="btn btn-sm">Tambah Menu</button>
                        <button id="manageCategoriesBtn" class="btn btn-sm">Kelola Kategori</button>
                        <button id="viewReportsBtn" class="btn btn-sm">Laporan</button>
                        <button id="kitchenDisplayBtn" class="btn btn-sm">Info Pesanan</button>
                        <button id="manageMembersBtn" class="btn btn-sm">Kelola Member</button>
                        <button id="manageStoreInfoBtn" class="btn btn-sm">Info Restoran</button>
                        <button id="controlPanelBtn" class="btn btn-sm btn-warning">Kontrol Panel</button>
                    </div>
                    
                    <div class="mt-3">
                        <h4 class="panel-title">Backup & Restore</h4>
                        <div class="backup-actions">
                            <button id="backupDataBtn" class="btn btn-sm backup-btn">Backup Data</button>
                            <label for="restoreFile" class="file-label">
                                <i class="fas fa-upload"></i> Restore
                            </label>
                            <input type="file" id="restoreFile" class="file-input" accept=".json">
                        </div>
                        <button id="resetDataBtn" class="btn btn-sm btn-danger mt-2" style="width: 100%;">Reset Data</button>
                    </div>
                </div>
            </section>

            <section class="panel order-panel">
                <h2 class="panel-title">
                    <span>Pesanan</span>
                    <span id="orderCount">(0 item)</span>
                </h2>
                
                <div class="order-type">
                    <div class="order-type-btn active" data-type="dinein">Makan di Tempat</div>
                    <div class="order-type-btn" data-type="takeaway">Bungkus</div>
                </div>
                
                <div class="table-number" id="tableNumberContainer">
                    <label class="form-label">Nomor Meja</label>
                    <select id="tableNumber" class="form-control">
                        <option value="1">Meja 1</option>
                        <option value="2">Meja 2</option>
                        <option value="3">Meja 3</option>
                        <option value="4">Meja 4</option>
                        <option value="5">Meja 5</option>
                    </select>
                </div>

                <div class="member-search-container">
                    <label class="form-label">Cari Member (Opsional)</label>
                    <input type="text" id="memberSearch" class="form-control" placeholder="Nama atau ID member">
                    <div id="memberSearchResults" class="member-search-results"></div>
                </div>
                
                <div id="orderItemsContainer">
                    <div class="empty-state">
                        <i class="fas fa-shopping-cart"></i>
                        <p>Belum ada pesanan</p>
                    </div>
                </div>
                
                <div class="note-input">
                    <label class="form-label">Catatan Pesanan (Opsional)</label>
                    <textarea id="orderNote" class="form-control" placeholder="Contoh: Pedas, tanpa bawang, dll."></textarea>
                </div>
                
                <div class="summary-container">
                    <div class="summary-row">
                        <span>Subtotal:</span>
                        <span id="subtotal">Rp 0</span>
                    </div>
                    <div class="summary-row">
                        <span>Diskon:</span>
                        <span id="discount">Rp 0</span>
                    </div>
                    <div class="summary-row">
                        <span>Pajak (10%):</span>
                        <span id="tax">Rp 0</span>
                    </div>
                    <div class="summary-row total-row">
                        <span>Total:</span>
                        <span id="total">Rp 0</span>
                    </div>
                </div>
                
                <button id="checkoutBtn" class="btn btn-success mt-3" disabled>
                    <i class="fas fa-credit-card"></i> Proses Pembayaran
                </button>
                <button id="clearOrderBtn" class="btn btn-outline-primary mt-2">
                    <i class="fas fa-trash"></i> Kosongkan Pesanan
                </button>
            </section>
        </main>

        <footer class="app-footer">
            <p>&copy; 2025 CAFE & RESTO - Aplikasi Kasir Digital</p>
        </footer>
    </div>

    <div id="menuModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="menuModalTitle">Tambah Menu</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="menuForm">
                    <input type="hidden" id="menuId">
                    <div class="form-group">
                        <label for="menuName" class="form-label">Nama Menu</label>
                        <input type="text" id="menuName" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="menuPrice" class="form-label">Harga</label>
                        <input type="number" id="menuPrice" class="form-control" min="0" required>
                    </div>
                    <div class="form-group">
                        <label for="menuCategory" class="form-label">Kategori</label>
                        <select id="menuCategory" class="form-control" required>
                            </select>
                    </div>
                    <div class="form-group">
                        <label for="menuImage" class="form-label">Gambar Menu (URL)</label>
                        <input type="text" id="menuImage" class="form-control" placeholder="Opsional">
                    </div>
                    <div class="form-group">
                        <label for="menuDescription" class="form-label">Deskripsi</label>
                        <textarea id="menuDescription" class="form-control" placeholder="Opsional"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="menuStock" class="form-label">Stok</label>
                        <input type="number" id="menuStock" class="form-control" min="0" value="0">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline-primary modal-close">Batal</button>
                <button class="btn" id="saveMenuBtn">Simpan</button>
            </div>
        </div>
    </div>

    <div id="paymentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Pembayaran</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="payment-total-display">
                    <p>Total yang harus dibayar:</p>
                    <h3 id="paymentTotal">Rp 0</h3>
                </div>
                
                <div class="form-group">
                    <label for="paymentMethod" class="form-label">Metode Pembayaran</label>
                    <select id="paymentMethod" class="form-control">
                        <option value="cash">Tunai</option>
                        <option value="transfer">Transfer Bank</option>
                        <option value="qris">QRIS</option>
                        <option value="debit">Kartu Debit</option>
                        <option value="credit">Kartu Kredit</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="amountPaid" class="form-label">Jumlah Bayar</label>
                    <input type="number" id="amountPaid" class="form-control" min="0" required>
                </div>
                
                <div class="quick-cash-buttons">
                    <button class="btn btn-sm" data-amount="50000">50K</button>
                    <button class="btn btn-sm" data-amount="100000">100K</button>
                    <button class="btn btn-sm" data-amount="150000">150K</button>
                    <button class="btn btn-sm" data-amount="200000">200K</button>
                    <button class="btn btn-sm" data-amount="250000">250K</button>
                    <button class="btn btn-sm" data-amount="500000">500K</button>
                </div>
                
                <div class="form-group">
                    <label for="changeAmount" class="form-label">Kembalian</label>
                    <input type="text" id="changeAmount" class="form-control" readonly>
                </div>
                
                <div class="form-group">
                    <label for="paymentNote" class="form-label">Catatan Pembayaran (Opsional)</label>
                    <textarea id="paymentNote" class="form-control" placeholder="Catatan tambahan untuk pembayaran"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline-primary modal-close">Batal</button>
                <button class="btn btn-success" id="confirmPaymentBtn" disabled>Konfirmasi Pembayaran</button>
            </div>
        </div>
    </div>

    <div id="receiptModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Struk Pembayaran</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div id="receiptContent">
                    <div class="receipt-header">
                        <img class="receipt-logo" src="" alt="Logo">
                        <h2 class="receipt-title" id="receiptStoreName">CAFE & RESTO</h2>
                        <p id="receiptStoreAddress">Jl. Contoh No. 123, Kota Contoh</p>
                        <p id="receiptStorePhone">Telp: (021) 123-4567</p>
                    </div>
                    
                    <div class="receipt-info">
                        <div>
                            <span>No. Transaksi:</span>
                            <span id="receiptTransactionId">TRX-001</span>
                        </div>
                        <div>
                            <span>Tanggal:</span>
                            <span id="receiptDate">24/09/2025 14:30</span>
                        </div>
                        <div>
                            <span>Kasir:</span>
                            <span id="receiptCashier">Admin</span>
                        </div>
                        <div>
                            <span>Tipe:</span>
                            <span id="receiptOrderType">Makan di Tempat</span>
                        </div>
                        <div id="receiptTableNumberRow" style="display: none;">
                            <span>Meja:</span>
                            <span id="receiptTableNumber">-</span>
                        </div>
                        <div id="receiptMemberRow" style="display: none;">
                            <span>Member:</span>
                            <span id="receiptMember">-</span>
                        </div>
                    </div>
                    
                    <div id="receiptItemsContainer">
                        </div>
                    
                    <div class="receipt-total">
                        <div class="receipt-item">
                            <span>Subtotal:</span>
                            <span id="receiptSubtotal">Rp 0</span>
                        </div>
                        <div class="receipt-item">
                            <span>Diskon:</span>
                            <span id="receiptDiscount">Rp 0</span>
                        </div>
                        <div class="receipt-item">
                            <span>Pajak (10%):</span>
                            <span id="receiptTax">Rp 0</span>
                        </div>
                        <div class="receipt-item">
                            <span>Total:</span>
                            <span id="receiptTotal">Rp 0</span>
                        </div>
                        <div class="receipt-item">
                            <span>Bayar:</span>
                            <span id="receiptPaid">Rp 0</span>
                        </div>
                        <div class="receipt-item">
                            <span>Kembali:</span>
                            <span id="receiptChange">Rp 0</span>
                        </div>
                    </div>
                    
                    <div class="receipt-footer">
                        <p>Terima kasih atas kunjungan Anda</p>
                        <p>*** Selamat Menikmati ***</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline-primary modal-close">Tutup</button>
                <button class="btn btn-info" id="printReceiptBtn">
                    <i class="fas fa-print"></i> Cetak Struk
                </button>
            </div>
        </div>
    </div>

    <div id="ktaModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Kartu Member</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div id="ktaCard">
                    <div class="kta-header">
                        <img class="kta-logo" src="" alt="Logo">
                        <div class="kta-store-info">
                            <h3 id="ktaStoreName">CAFE & RESTO</h3>
                            <p id="ktaStoreInfo">Member Loyalty Card</p>
                        </div>
                    </div>
                    <div class="kta-body">
                        <h2 id="ktaMemberName">Nama Member</h2>
                        <p id="ktaMemberId">ID: MEM-001</p>
                        <div class="kta-qrcode">
                            <img id="ktaQrCode" src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=MEM-001" alt="QR Code">
                        </div>
                    </div>
                    <div class="kta-footer">
                        <p>Kartu ini berlaku untuk mendapatkan promo dan diskon spesial</p>
                        <p>www.contohcafe.com</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline-primary modal-close">Tutup</button>
                <button class="btn btn-info" id="printKtaBtn">
                    <i class="fas fa-print"></i> Cetak KTA
                </button>
            </div>
        </div>
    </div>

    <div id="reportsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Laporan Penjualan</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="reportDate" class="form-label">Pilih Tanggal</label>
                    <input type="date" id="reportDate" class="form-control">
                </div>
                
                <div id="reportSummary">
                    <div class="summary-container">
                        <div class="summary-row">
                            <span>Total Transaksi:</span>
                            <span id="reportTransactionCount">0</span>
                        </div>
                        <div class="summary-row">
                            <span>Total Pendapatan:</span>
                            <span id="reportTotalRevenue">Rp 0</span>
                        </div>
                        <div class="summary-row">
                            <span>Rata-rata per Transaksi:</span>
                            <span id="reportAverageTransaction">Rp 0</span>
                        </div>
                    </div>
                </div>
                
                <div id="reportDetails" style="display: none;">
                    <h4 class="panel-title">Detail Transaksi</h4>
                    <div style="max-height: 300px; overflow-y: auto;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>No</th>
                                    <th>Waktu</th>
                                    <th>Total</th>
                                    <th>Kasir</th>
                                </tr>
                            </thead>
                            <tbody id="reportTransactions">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline-primary modal-close">Tutup</button>
                <button class="btn btn-info" id="generateReportBtn">Generate Laporan</button>
            </div>
        </div>
    </div>

    <div id="controlPanelModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Kontrol Panel</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="admin-grid">
                    <button class="btn btn-sm btn-warning" id="toggleAdminPanelBtn">Sembunyikan Panel Admin</button>
                    <button class="btn btn-sm btn-info" id="changePasswordBtn">Ganti Password</button>
                    <button class="btn btn-sm" id="viewTransactionsBtn">Lihat Semua Transaksi</button>
                    <button class="btn btn-sm" id="manageUsersBtn">Kelola Pengguna</button>
                    <button class="btn btn-sm" id="systemSettingsBtn">Pengaturan Sistem</button>
                    <button class="btn btn-sm btn-donation" id="donationBtn">Donasi</button>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline-primary modal-close">Tutup</button>
            </div>
        </div>
    </div>

    <div id="donationModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Donasi</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <p>Terima kasih telah menggunakan aplikasi ini. Jika Anda merasa terbantu, pertimbangkan untuk memberikan donasi untuk pengembangan lebih lanjut.</p>
                
                <div class="form-group">
                    <label class="form-label">Nominal Donasi</label>
                    <input type="number" id="donationAmount" class="form-control" min="1000" value="10000">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Metode Pembayaran</label>
                    <select id="donationMethod" class="form-control">
                        <option value="qris">QRIS</option>
                        <option value="transfer">Transfer Bank</option>
                    </select>
                </div>
                
                <div id="donationQrCode" style="text-align: center; display: none;">
                    <img src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=DONATION-APP" alt="QR Code Donasi">
                    <p>Scan QR code di atas untuk donasi</p>
                </div>
                
                <div id="donationBankInfo" style="display: none;">
                    <p><strong>Bank: BCA</strong></p>
                    <p><strong>No. Rekening: 1234 5678 9012</strong></p>
                    <p><strong>Atas Nama: Developer App</strong></p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline-primary modal-close">Batal</button>
                <button class="btn btn-donation" id="confirmDonationBtn">Konfirmasi Donasi</button>
            </div>
        </div>
    </div>

    <div id="storeInfoModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Informasi Restoran</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="storeInfoForm">
                    <div class="form-group">
                        <label for="storeName" class="form-label">Nama Restoran</label>
                        <input type="text" id="storeName" class="form-control" value="CAFE & RESTO">
                    </div>
                    <div class="form-group">
                        <label for="storeAddress" class="form-label">Alamat</label>
                        <textarea id="storeAddress" class="form-control">Jl. Contoh No. 123, Kota Contoh</textarea>
                    </div>
                    <div class="form-group">
                        <label for="storePhone" class="form-label">Telepon</label>
                        <input type="text" id="storePhone" class="form-control" value="(021) 123-4567">
                    </div>
                    <div class="form-group">
                        <label for="storeLogo" class="form-label">Logo (URL)</label>
                        <input type="text" id="storeLogo" class="form-control" placeholder="Masukkan URL gambar logo">
                        <small>Logo akan digunakan di struk, KTA, dan header aplikasi</small>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline-primary modal-close">Batal</button>
                <button class="btn" id="saveStoreInfoBtn">Simpan</button>
            </div>
        </div>
    </div>

    <div id="kitchenModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Info Pesanan Dapur</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="kitchen-status">
                    <h4>Pesanan Sedang Diproses</h4>
                    <div id="kitchenOrders">
                        </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline-primary modal-close">Tutup</button>
            </div>
        </div>
    </div>

    <div id="membersModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Kelola Member</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <button class="btn btn-sm mb-3" id="addMemberBtn">Tambah Member</button>
                
                <div style="max-height: 400px; overflow-y: auto;">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nama</th>
                                <th>Telepon</th>
                                <th>Poin</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="membersTable">
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline-primary modal-close">Tutup</button>
            </div>
        </div>
    </div>

    <div id="memberModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="memberModalTitle">Tambah Member</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="memberForm">
                    <input type="hidden" id="memberId">
                    <div class="form-group">
                        <label for="memberName" class="form-label">Nama Member</label>
                        <input type="text" id="memberName" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="memberPhone" class="form-label">Telepon</label>
                        <input type="text" id="memberPhone" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="memberEmail" class="form-label">Email</label>
                        <input type="email" id="memberEmail" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="memberAddress" class="form-label">Alamat</label>
                        <textarea id="memberAddress" class="form-control"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline-primary modal-close">Batal</button>
                <button class="btn" id="saveMemberBtn">Simpan</button>
            </div>
        </div>
    </div>

    <div id="categoriesModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Kelola Kategori</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="newCategoryName" class="form-label">Tambah Kategori Baru</label>
                    <div class="d-flex gap-2">
                        <input type="text" id="newCategoryName" class="form-control" placeholder="Nama kategori">
                        <button class="btn btn-sm" id="addCategoryBtn">Tambah</button>
                    </div>
                </div>
                
                <div style="max-height: 300px; overflow-y: auto;">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Nama Kategori</th>
                                <th>Jumlah Menu</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="categoriesTable">
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline-primary modal-close">Tutup</button>
            </div>
        </div>
    </div>

    <div id="print-container" style="display: none;"></div>

    <script>
        // Data aplikasi
        let appData = {
            menus: [],
            orders: [],
            transactions: [],
            members: [],
            categories: ['makanan', 'minuman', 'snack', 'lainnya'],
            storeInfo: {
                name: 'CAFE & RESTO',
                address: 'Jl. Contoh No. 123, Kota Contoh',
                phone: '(021) 123-4567',
                logo: ''
            },
            currentOrder: {
                items: [],
                type: 'dinein',
                tableNumber: '1',
                memberId: null,
                note: '',
                discount: 0
            },
            user: null,
            settings: {
                taxRate: 0.1,
                adminPassword: 'admin' // Password diubah agar lebih mudah diingat untuk demo
            }
        };

        // Inisialisasi data default jika tidak ada di localStorage
        function initializeData() {
            const savedData = localStorage.getItem('cafeRestoData');
            
            if (savedData) {
                appData = JSON.parse(savedData);
            } else {
                // Data menu default
                appData.menus = [
                    { id: 1, name: 'Nasi Goreng Spesial', price: 25000, category: 'makanan', image: 'https://via.placeholder.com/100?text=Nasgor', description: 'Nasi goreng dengan telur, ayam, dan sayuran', stock: 10 },
                    { id: 2, name: 'Mie Ayam', price: 20000, category: 'makanan', image: 'https://via.placeholder.com/100?text=MieAyam', description: 'Mie ayam dengan pangsit dan bakso', stock: 15 },
                    { id: 3, name: 'Es Teh Manis', price: 5000, category: 'minuman', image: 'https://via.placeholder.com/100?text=EsTeh', description: 'Es teh manis segar', stock: 50 },
                    { id: 4, name: 'Jus Jeruk', price: 12000, category: 'minuman', image: 'https://via.placeholder.com/100?text=JusJeruk', description: 'Jus jeruk segar tanpa gula', stock: 20 },
                    { id: 5, name: 'Kentang Goreng', price: 15000, category: 'snack', image: 'https://via.placeholder.com/100?text=Kentang', description: 'Kentang goreng renyah dengan saus', stock: 25 },
                    { id: 6, name: 'Donat', price: 8000, category: 'snack', image: 'https://via.placeholder.com/100?text=Donat', description: 'Donat dengan berbagai topping', stock: 30 }
                ];

                // Data member default
                appData.members = [
                    { id: 'MEM-001', name: 'Budi Santoso', phone: '081234567890', email: 'budi@email.com', address: 'Jl. Contoh No. 1', joinDate: new Date().toISOString(), points: 100 },
                    { id: 'MEM-002', name: 'Siti Rahayu', phone: '081298765432', email: 'siti@email.com', address: 'Jl. Contoh No. 2', joinDate: new Date().toISOString(), points: 50 }
                ];

                saveData();
            }
        }

        // Simpan data ke localStorage
        function saveData() {
            localStorage.setItem('cafeRestoData', JSON.stringify(appData));
        }

        // Tampilkan notifikasi
        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toast-message');
            
            toastMessage.textContent = message;
            toast.className = `toast ${type}`;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Format angka ke Rupiah
        function formatRupiah(amount) {
            return new Intl.NumberFormat('id-ID', {
                style: 'currency',
                currency: 'IDR',
                minimumFractionDigits: 0
            }).format(amount);
        }

        // Generate ID unik
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        // Buka modal
        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            if(modal) modal.style.display = 'flex';
        }

        // Tutup modal
        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if(modal) modal.style.display = 'none';
        }

        // === FUNGSI RENDER UI ===

        function renderFullAppUI() {
            updateStoreInfoUI();
            renderCategoryFilters();
            renderMenus();
            renderOrder();
        }
        
        function updateStoreInfoUI() {
            const { name, address, phone, logo } = appData.storeInfo;
            const logoUrl = logo || 'https://via.placeholder.com/100?text=LOGO';

            document.getElementById('storeNameHeader').textContent = name;
            document.querySelector('.header-logo img').src = logoUrl;
            document.querySelector('.header-logo img').alt = name;
            document.getElementById('receiptStoreName').textContent = name;
            document.getElementById('receiptStoreAddress').textContent = address;
            document.getElementById('receiptStorePhone').textContent = `Telp: ${phone}`;
            document.querySelector('.receipt-logo').src = logoUrl;
            document.getElementById('ktaStoreName').textContent = name;
            document.querySelector('.kta-logo').src = logoUrl;
        }

        // Render filter kategori secara dinamis
        function renderCategoryFilters() {
            const filterContainer = document.getElementById('categoryFilters');
            filterContainer.innerHTML = `<div class="filter-chip active" data-category="all">Semua</div>`;

            appData.categories.forEach(category => {
                const chip = document.createElement('div');
                chip.className = 'filter-chip';
                chip.dataset.category = category;
                chip.textContent = category.charAt(0).toUpperCase() + category.slice(1);
                filterContainer.appendChild(chip);
            });
            
            // Re-attach event listeners
            filterContainer.querySelectorAll('.filter-chip').forEach(chip => {
                chip.addEventListener('click', function() {
                    filterContainer.querySelector('.active').classList.remove('active');
                    this.classList.add('active');
                    renderMenus();
                });
            });
        }
        
        // Render menu di modal form
        function renderCategoryOptions() {
            const select = document.getElementById('menuCategory');
            select.innerHTML = '';
            appData.categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category.charAt(0).toUpperCase() + category.slice(1);
                select.appendChild(option);
            });
        }

        // Update tampilan menu
        function renderMenus() {
            const menuGrid = document.getElementById('menuGrid');
            const menuCount = document.getElementById('menuCount');
            const searchTerm = document.getElementById('menuSearch').value.toLowerCase();
            const activeCategoryFilter = document.querySelector('#categoryFilters .filter-chip.active');
            const activeCategory = activeCategoryFilter ? activeCategoryFilter.dataset.category : 'all';
            
            menuGrid.innerHTML = '';

            let filteredMenus = appData.menus.filter(menu => {
                const matchesSearch = menu.name.toLowerCase().includes(searchTerm);
                const matchesCategory = activeCategory === 'all' || menu.category === activeCategory;
                return matchesSearch && matchesCategory;
            });
            
            if (filteredMenus.length === 0) {
                menuGrid.innerHTML = `<div class="empty-state" style="grid-column: 1 / -1;"><i class="fas fa-utensils"></i><p>Tidak ada menu ditemukan</p></div>`;
            } else {
                filteredMenus.forEach(menu => {
                    const menuCard = document.createElement('div');
                    menuCard.className = 'menu-card';
                    menuCard.dataset.id = menu.id;
                    menuCard.innerHTML = `
                        <div class="menu-image">
                            ${menu.image ? `<img src="${menu.image}" alt="${menu.name}" onerror="this.src='https://via.placeholder.com/100?text=Error'">` : `<i class="fas fa-utensils"></i>`}
                        </div>
                        <div class="menu-name">${menu.name}</div>
                        <div class="menu-price">${formatRupiah(menu.price)}</div>
                        <div class="menu-category">${menu.category}</div>
                        <div class="menu-actions">
                            <button class="action-btn edit-btn" title="Edit"><i class="fas fa-edit"></i></button>
                            <button class="action-btn delete-btn" title="Hapus"><i class="fas fa-trash"></i></button>
                        </div>
                    `;
                    menuGrid.appendChild(menuCard);
                });
            }
            
            menuCount.textContent = `(${filteredMenus.length} menu)`;
        }

        // Update tampilan pesanan
        function renderOrder() {
            const orderItemsContainer = document.getElementById('orderItemsContainer');
            const orderCount = document.getElementById('orderCount');
            const checkoutBtn = document.getElementById('checkoutBtn');
            
            if (appData.currentOrder.items.length === 0) {
                orderItemsContainer.innerHTML = `<div class="empty-state"><i class="fas fa-shopping-cart"></i><p>Belum ada pesanan</p></div>`;
                checkoutBtn.disabled = true;
                orderCount.textContent = '(0 item)';
            } else {
                orderItemsContainer.innerHTML = '';
                
                appData.currentOrder.items.forEach((item, index) => {
                    const orderItem = document.createElement('div');
                    orderItem.className = 'order-item';
                    orderItem.innerHTML = `
                        <div class="order-item-info">
                            <div class="order-item-name">${item.name}</div>
                            <div class="order-item-price">${formatRupiah(item.price)}</div>
                        </div>
                        <div class="order-item-qty">
                            <button class="qty-btn minus-btn" data-index="${index}"><i class="fas fa-minus"></i></button>
                            <input type="number" class="qty-input" value="${item.quantity}" min="1" data-index="${index}">
                            <button class="qty-btn plus-btn" data-index="${index}"><i class="fas fa-plus"></i></button>
                            <button class="remove-btn" data-index="${index}"><i class="fas fa-times"></i></button>
                        </div>
                    `;
                    orderItemsContainer.appendChild(orderItem);
                });
                
                checkoutBtn.disabled = false;
                orderCount.textContent = `(${appData.currentOrder.items.length} item)`;
            }
            
            updateOrderSummary();
        }

        // Update ringkasan pesanan
        function updateOrderSummary() {
            const { items, discount } = appData.currentOrder;
            const subtotal = items.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const tax = subtotal * appData.settings.taxRate;
            const total = subtotal + tax - discount;
            
            document.getElementById('subtotal').textContent = formatRupiah(subtotal);
            document.getElementById('discount').textContent = formatRupiah(discount);
            document.getElementById('tax').textContent = formatRupiah(tax);
            document.getElementById('total').textContent = formatRupiah(total);
        }

        // === LOGIKA PESANAN ===
        
        function addToOrder(menuId) {
            const menu = appData.menus.find(m => m.id === menuId);
            if (!menu) return;

            const existingItem = appData.currentOrder.items.find(item => item.menuId === menu.id);
            
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                appData.currentOrder.items.push({ menuId: menu.id, name: menu.name, price: menu.price, quantity: 1 });
            }
            
            renderOrder();
            showToast(`${menu.name} ditambahkan ke pesanan`, 'success');
        }

        function updateQuantity(index, change, newQuantity = null) {
            const item = appData.currentOrder.items[index];
            if (!item) return;

            if (newQuantity !== null) {
                item.quantity = Math.max(1, newQuantity);
            } else {
                item.quantity = Math.max(1, item.quantity + change);
            }
            
            renderOrder();
        }
        
        function removeFromOrder(index) {
            const itemName = appData.currentOrder.items[index].name;
            appData.currentOrder.items.splice(index, 1);
            renderOrder();
            showToast(`${itemName} dihapus dari pesanan`, 'warning');
        }

        function resetOrder() {
            appData.currentOrder = { items: [], type: 'dinein', tableNumber: '1', memberId: null, note: '', discount: 0 };
            document.getElementById('memberSearch').value = '';
            document.getElementById('orderNote').value = '';
            document.querySelector('.order-type-btn.active').classList.remove('active');
            document.querySelector('.order-type-btn[data-type="dinein"]').classList.add('active');
            document.getElementById('tableNumberContainer').style.display = 'block';
            renderOrder();
        }

        // === LOGIKA PEMBAYARAN & STRUK ===

        function checkout() {
            if (appData.currentOrder.items.length === 0) {
                showToast('Tidak ada item dalam pesanan', 'error');
                return;
            }
            
            const total = parseFloat(document.getElementById('total').textContent.replace(/[^\d]/g, ''));
            
            document.getElementById('paymentTotal').textContent = formatRupiah(total);
            document.getElementById('amountPaid').value = '';
            document.getElementById('changeAmount').value = '';
            document.getElementById('confirmPaymentBtn').disabled = true;
            
            openModal('paymentModal');
        }

        function confirmPayment() {
            const amountPaid = parseFloat(document.getElementById('amountPaid').value);
            const { items, discount, type, tableNumber, memberId, note } = appData.currentOrder;

            const subtotal = items.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const tax = subtotal * appData.settings.taxRate;
            const total = subtotal + tax - discount;
            
            if (isNaN(amountPaid) || amountPaid < total) {
                showToast('Jumlah pembayaran kurang', 'error');
                return;
            }
            
            const transaction = {
                id: `TRX-${generateId()}`,
                date: new Date().toISOString(),
                items: JSON.parse(JSON.stringify(items)),
                subtotal, tax, discount, total,
                amountPaid: amountPaid,
                change: amountPaid - total,
                paymentMethod: document.getElementById('paymentMethod').value,
                paymentNote: document.getElementById('paymentNote').value,
                orderType: type,
                tableNumber, memberId, note,
                cashier: appData.user.username
            };
            
            appData.transactions.unshift(transaction);
            
            items.forEach(item => {
                const menu = appData.menus.find(m => m.id === item.menuId);
                if (menu) menu.stock -= item.quantity;
            });
            
            if (memberId) {
                const member = appData.members.find(m => m.id === memberId);
                if (member) member.points += Math.floor(total / 10000);
            }
            
            saveData();
            showReceipt(transaction);
            resetOrder();
            closeModal('paymentModal');
        }

        function showReceipt(transaction) {
            document.getElementById('receiptTransactionId').textContent = transaction.id;
            document.getElementById('receiptDate').textContent = new Date(transaction.date).toLocaleString('id-ID');
            document.getElementById('receiptCashier').textContent = transaction.cashier;
            document.getElementById('receiptOrderType').textContent = transaction.orderType === 'dinein' ? 'Makan di Tempat' : 'Bungkus';
            
            const tableRow = document.getElementById('receiptTableNumberRow');
            if (transaction.orderType === 'dinein') {
                tableRow.style.display = 'flex';
                document.getElementById('receiptTableNumber').textContent = transaction.tableNumber;
            } else {
                tableRow.style.display = 'none';
            }
            
            const memberRow = document.getElementById('receiptMemberRow');
            if (transaction.memberId) {
                const member = appData.members.find(m => m.id === transaction.memberId);
                memberRow.style.display = 'flex';
                document.getElementById('receiptMember').textContent = member ? member.name : transaction.memberId;
            } else {
                memberRow.style.display = 'none';
            }
            
            const itemsContainer = document.getElementById('receiptItemsContainer');
            itemsContainer.innerHTML = transaction.items.map(item => `
                <div class="receipt-item">
                    <div class="receipt-item-details">
                        <span class="item-name">${item.name}</span>
                        <div class="item-price-calc">${item.quantity} x ${formatRupiah(item.price)}</div>
                    </div>
                    <span>${formatRupiah(item.price * item.quantity)}</span>
                </div>
            `).join('');

            document.getElementById('receiptSubtotal').textContent = formatRupiah(transaction.subtotal);
            document.getElementById('receiptDiscount').textContent = formatRupiah(transaction.discount);
            document.getElementById('receiptTax').textContent = formatRupiah(transaction.tax);
            document.getElementById('receiptTotal').textContent = formatRupiah(transaction.total);
            document.getElementById('receiptPaid').textContent = formatRupiah(transaction.amountPaid);
            document.getElementById('receiptChange').textContent = formatRupiah(transaction.change);
            
            openModal('receiptModal');
        }

        function printContent(elementId) {
            const content = document.getElementById(elementId).cloneNode(true);
            const printContainer = document.getElementById('print-container');
            printContainer.innerHTML = '';
            printContainer.appendChild(content);
            window.print();
            printContainer.innerHTML = '';
        }

        // === LOGIKA ADMIN PANEL ===

        function openMenuForm(mode = 'add', menuId = null) {
            document.getElementById('menuForm').reset();
            renderCategoryOptions();
            
            if (mode === 'add') {
                document.getElementById('menuModalTitle').textContent = 'Tambah Menu';
                document.getElementById('saveMenuBtn').dataset.mode = 'add';
            } else {
                const menu = appData.menus.find(m => m.id === menuId);
                if (menu) {
                    document.getElementById('menuModalTitle').textContent = 'Edit Menu';
                    document.getElementById('saveMenuBtn').dataset.mode = 'edit';
                    document.getElementById('saveMenuBtn').dataset.id = menu.id;
                    document.getElementById('menuName').value = menu.name;
                    document.getElementById('menuPrice').value = menu.price;
                    document.getElementById('menuCategory').value = menu.category;
                    document.getElementById('menuImage').value = menu.image || '';
                    document.getElementById('menuDescription').value = menu.description || '';
                    document.getElementById('menuStock').value = menu.stock || 0;
                }
            }
            openModal('menuModal');
        }

        function saveMenu() {
            const mode = document.getElementById('saveMenuBtn').dataset.mode;
            const name = document.getElementById('menuName').value.trim();
            const price = parseFloat(document.getElementById('menuPrice').value);
            
            if (!name || isNaN(price) || price < 0) {
                showToast('Nama dan harga valid harus diisi', 'error');
                return;
            }
            
            const menuData = {
                name, price,
                category: document.getElementById('menuCategory').value,
                image: document.getElementById('menuImage').value.trim(),
                description: document.getElementById('menuDescription').value.trim(),
                stock: parseInt(document.getElementById('menuStock').value) || 0
            };

            if (mode === 'add') {
                const newId = appData.menus.length > 0 ? Math.max(...appData.menus.map(m => m.id)) + 1 : 1;
                appData.menus.push({ id: newId, ...menuData });
                showToast('Menu berhasil ditambahkan', 'success');
            } else {
                const menuId = parseInt(document.getElementById('saveMenuBtn').dataset.id);
                const menuIndex = appData.menus.findIndex(m => m.id === menuId);
                if (menuIndex !== -1) {
                    appData.menus[menuIndex] = { ...appData.menus[menuIndex], ...menuData };
                    showToast('Menu berhasil diperbarui', 'success');
                }
            }
            
            saveData();
            renderMenus();
            closeModal('menuModal');
        }

        function deleteMenu(menuId) {
            if (confirm('Apakah Anda yakin ingin menghapus menu ini?')) {
                appData.menus = appData.menus.filter(m => m.id !== menuId);
                saveData();
                renderMenus();
                showToast('Menu berhasil dihapus', 'success');
            }
        }
        
        // --- Kategori ---
        function manageCategories() {
            const tableBody = document.getElementById('categoriesTable');
            tableBody.innerHTML = appData.categories.map(category => {
                const menuCount = appData.menus.filter(m => m.category === category).length;
                return `
                    <tr>
                        <td>${category.charAt(0).toUpperCase() + category.slice(1)}</td>
                        <td>${menuCount} menu</td>
                        <td>
                            <div class="actions-cell">
                                <button class="action-btn edit-btn" data-category="${category}" title="Edit"><i class="fas fa-edit"></i></button>
                                <button class="action-btn delete-btn" data-category="${category}" title="Hapus"><i class="fas fa-trash"></i></button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
            openModal('categoriesModal');
        }

        function addCategory() {
            const input = document.getElementById('newCategoryName');
            const categoryName = input.value.trim().toLowerCase();
            
            if (!categoryName) {
                showToast('Nama kategori harus diisi', 'error');
                return;
            }
            if (appData.categories.includes(categoryName)) {
                showToast('Kategori sudah ada', 'error');
                return;
            }
            
            appData.categories.push(categoryName);
            saveData();
            input.value = '';
            manageCategories();
            renderCategoryFilters();
            showToast('Kategori berhasil ditambahkan', 'success');
        }

        function editCategory(oldName) {
            const newName = prompt('Masukkan nama kategori baru:', oldName);
            if (!newName || newName.trim() === '') return;

            const trimmedNewName = newName.trim().toLowerCase();
            if (trimmedNewName === oldName) return;

            if (appData.categories.includes(trimmedNewName)) {
                showToast('Nama kategori sudah ada.', 'error');
                return;
            }

            appData.categories = appData.categories.map(c => c === oldName ? trimmedNewName : c);
            appData.menus.forEach(menu => {
                if (menu.category === oldName) menu.category = trimmedNewName;
            });

            saveData();
            manageCategories();
            renderCategoryFilters();
            renderMenus();
            showToast('Kategori berhasil diperbarui', 'success');
        }

        function deleteCategory(categoryName) {
            if (appData.menus.some(m => m.category === categoryName)) {
                showToast('Tidak dapat menghapus kategori yang masih digunakan oleh menu.', 'error');
                return;
            }
            if (confirm(`Yakin ingin menghapus kategori "${categoryName}"?`)) {
                appData.categories = appData.categories.filter(c => c !== categoryName);
                saveData();
                manageCategories();
                renderCategoryFilters();
                showToast('Kategori berhasil dihapus', 'success');
            }
        }
        
        // --- Member ---
        function manageMembers() {
            const tableBody = document.getElementById('membersTable');
            tableBody.innerHTML = appData.members.map(member => `
                <tr>
                    <td>${member.id}</td>
                    <td>${member.name}</td>
                    <td>${member.phone}</td>
                    <td>${member.points}</td>
                    <td>
                        <div class="actions-cell">
                            <button class="action-btn view-btn" data-id="${member.id}" title="Lihat KTA"><i class="fas fa-id-card"></i></button>
                            <button class="action-btn edit-btn" data-id="${member.id}" title="Edit"><i class="fas fa-edit"></i></button>
                            <button class="action-btn delete-btn" data-id="${member.id}" title="Hapus"><i class="fas fa-trash"></i></button>
                        </div>
                    </td>
                </tr>
            `).join('');
            openModal('membersModal');
        }

        function openMemberForm(mode = 'add', memberId = null) {
            document.getElementById('memberForm').reset();
            const saveBtn = document.getElementById('saveMemberBtn');
            
            if (mode === 'add') {
                document.getElementById('memberModalTitle').textContent = 'Tambah Member';
                saveBtn.dataset.mode = 'add';
            } else {
                const member = appData.members.find(m => m.id === memberId);
                if (member) {
                    document.getElementById('memberModalTitle').textContent = 'Edit Member';
                    document.getElementById('memberName').value = member.name;
                    document.getElementById('memberPhone').value = member.phone;
                    document.getElementById('memberEmail').value = member.email;
                    document.getElementById('memberAddress').value = member.address;
                    saveBtn.dataset.mode = 'edit';
                    saveBtn.dataset.id = member.id;
                }
            }
            openModal('memberModal');
        }

        function saveMember() {
            const mode = document.getElementById('saveMemberBtn').dataset.mode;
            const name = document.getElementById('memberName').value.trim();
            if (!name) {
                showToast('Nama member harus diisi', 'error');
                return;
            }
            
            const memberData = {
                name,
                phone: document.getElementById('memberPhone').value.trim(),
                email: document.getElementById('memberEmail').value.trim(),
                address: document.getElementById('memberAddress').value.trim()
            };

            if (mode === 'add') {
                let newIdNum = 1;
                if(appData.members.length > 0) {
                    newIdNum = Math.max(...appData.members.map(m => parseInt(m.id.split('-')[1]))) + 1;
                }
                const newMember = {
                    ...memberData,
                    id: `MEM-${String(newIdNum).padStart(3, '0')}`,
                    joinDate: new Date().toISOString(),
                    points: 0
                };
                appData.members.push(newMember);
                showToast('Member berhasil ditambahkan', 'success');
            } else {
                const memberId = document.getElementById('saveMemberBtn').dataset.id;
                const memberIndex = appData.members.findIndex(m => m.id === memberId);
                if (memberIndex !== -1) {
                    appData.members[memberIndex] = { ...appData.members[memberIndex], ...memberData };
                    showToast('Member berhasil diperbarui', 'success');
                }
            }

            saveData();
            manageMembers();
            closeModal('memberModal');
        }

        function deleteMember(memberId) {
            if (confirm('Yakin ingin menghapus member ini?')) {
                appData.members = appData.members.filter(m => m.id !== memberId);
                saveData();
                manageMembers();
                showToast('Member berhasil dihapus', 'success');
            }
        }
        
        function showKta(memberId) {
            const member = appData.members.find(m => m.id === memberId);
            if (member) {
                document.getElementById('ktaMemberName').textContent = member.name;
                document.getElementById('ktaMemberId').textContent = `ID: ${member.id}`;
                document.getElementById('ktaQrCode').src = `https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${member.id}`;
                openModal('ktaModal');
            }
        }

        // --- Info Toko ---
        function manageStoreInfo() {
            document.getElementById('storeName').value = appData.storeInfo.name;
            document.getElementById('storeAddress').value = appData.storeInfo.address;
            document.getElementById('storePhone').value = appData.storeInfo.phone;
            document.getElementById('storeLogo').value = appData.storeInfo.logo;
            openModal('storeInfoModal');
        }

        function saveStoreInfo() {
            appData.storeInfo.name = document.getElementById('storeName').value;
            appData.storeInfo.address = document.getElementById('storeAddress').value;
            appData.storeInfo.phone = document.getElementById('storePhone').value;
            appData.storeInfo.logo = document.getElementById('storeLogo').value;
            saveData();
            updateStoreInfoUI();
            closeModal('storeInfoModal');
            showToast('Informasi restoran berhasil diperbarui', 'success');
        }
        
        // --- Backup & Restore ---
        function backupData() {
            const dataStr = JSON.stringify(appData);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            const exportFileName = `backup-cafe-resto-${new Date().toISOString().split('T')[0]}.json`;
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileName);
            linkElement.click();
            showToast('Backup data berhasil', 'success');
        }

        function restoreData(event) {
            const file = event.target.files[0];
            if (!file) return;

            if (!confirm('Yakin ingin memulihkan data? Semua data saat ini akan diganti.')) {
                event.target.value = '';
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const restoredData = JSON.parse(e.target.result);
                    if (restoredData.menus && restoredData.categories && restoredData.storeInfo) {
                        appData = restoredData;
                        saveData();
                        showToast('Data berhasil dipulihkan. Aplikasi akan dimuat ulang.', 'success');
                        setTimeout(() => location.reload(), 1500);
                    } else {
                        showToast('File backup tidak valid.', 'error');
                    }
                } catch (error) {
                    showToast('Gagal membaca file. File mungkin rusak.', 'error');
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }

        function resetData() {
            if (confirm('PERINGATAN! Anda yakin ingin mereset semua data? Tindakan ini tidak dapat dibatalkan!')) {
                localStorage.removeItem('cafeRestoData');
                showToast('Data berhasil direset. Aplikasi akan dimuat ulang.', 'success');
                setTimeout(() => location.reload(), 1500);
            }
        }
        
        // --- Autentikasi ---
        function login(event) {
            event.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (password === appData.settings.adminPassword) {
                appData.user = { username, role: 'admin' };
                document.getElementById('loggedInUser').textContent = username;
                document.getElementById('loginModal').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                document.getElementById('currentDate').textContent = new Date().toLocaleDateString('id-ID', {
                    weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'
                });
                showToast(`Selamat datang, ${username}!`, 'success');
            } else {
                showToast('Username atau Password salah', 'error');
            }
        }

        function logout() {
            if (confirm('Apakah Anda yakin ingin logout?')) {
                appData.user = null;
                document.getElementById('loginModal').style.display = 'flex';
                document.getElementById('mainApp').style.display = 'none';
                document.getElementById('loginForm').reset();
            }
        }
        
        // === INISIALISASI & EVENT LISTENERS ===
        
        document.addEventListener('DOMContentLoaded', function() {
            initializeData();
            renderFullAppUI();
            
            // --- Event Listeners Utama ---
            document.getElementById('loginForm').addEventListener('submit', login);
            document.getElementById('logoutBtn').addEventListener('click', logout);
            document.getElementById('menuSearch').addEventListener('input', renderMenus);
            document.getElementById('checkoutBtn').addEventListener('click', checkout);
            document.getElementById('clearOrderBtn').addEventListener('click', () => {
                if (appData.currentOrder.items.length > 0 && confirm('Yakin ingin mengosongkan pesanan?')) {
                    resetOrder();
                    showToast('Pesanan dikosongkan', 'warning');
                }
            });

            // --- Event Delegation ---
            document.getElementById('menuGrid').addEventListener('click', e => {
                const card = e.target.closest('.menu-card');
                if (!card) return;
                const menuId = parseInt(card.dataset.id);
                
                if (e.target.closest('.edit-btn')) {
                    openMenuForm('edit', menuId);
                } else if (e.target.closest('.delete-btn')) {
                    deleteMenu(menuId);
                } else {
                    addToOrder(menuId);
                }
            });
            
            document.getElementById('orderItemsContainer').addEventListener('click', e => {
                const target = e.target.closest('button, input');
                if (!target) return;
                const index = parseInt(target.dataset.index);

                if (target.classList.contains('minus-btn')) updateQuantity(index, -1);
                else if (target.classList.contains('plus-btn')) updateQuantity(index, 1);
                else if (target.classList.contains('remove-btn')) removeFromOrder(index);
                else if (target.classList.contains('qty-input')) {
                    target.addEventListener('change', () => updateQuantity(index, 0, parseInt(target.value)), { once: true });
                }
            });

            document.getElementById('categoriesTable').addEventListener('click', e => {
                const btn = e.target.closest('button');
                if (!btn) return;
                const category = btn.dataset.category;
                if (btn.classList.contains('edit-btn')) editCategory(category);
                else if (btn.classList.contains('delete-btn')) deleteCategory(category);
            });

            document.getElementById('membersTable').addEventListener('click', e => {
                const btn = e.target.closest('button');
                if (!btn) return;
                const memberId = btn.dataset.id;
                if (btn.classList.contains('view-btn')) showKta(memberId);
                else if (btn.classList.contains('edit-btn')) openMemberForm('edit', memberId);
                else if (btn.classList.contains('delete-btn')) deleteMember(memberId);
            });
            
            // --- Event Listeners Modal ---
            document.getElementById('addMenuBtn').addEventListener('click', () => openMenuForm('add'));
            document.getElementById('saveMenuBtn').addEventListener('click', saveMenu);

            document.getElementById('confirmPaymentBtn').addEventListener('click', confirmPayment);
            document.getElementById('printReceiptBtn').addEventListener('click', () => printContent('receiptContent'));
            document.getElementById('printKtaBtn').addEventListener('click', () => printContent('ktaCard'));

            document.getElementById('manageCategoriesBtn').addEventListener('click', manageCategories);
            document.getElementById('addCategoryBtn').addEventListener('click', addCategory);

            document.getElementById('manageMembersBtn').addEventListener('click', manageMembers);
            document.getElementById('addMemberBtn').addEventListener('click', () => openMemberForm('add'));
            document.getElementById('saveMemberBtn').addEventListener('click', saveMember);
            
            document.getElementById('manageStoreInfoBtn').addEventListener('click', manageStoreInfo);
            document.getElementById('saveStoreInfoBtn').addEventListener('click', saveStoreInfo);
            
            // --- Lainnya ---
            document.querySelectorAll('.order-type-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelector('.order-type-btn.active').classList.remove('active');
                    this.classList.add('active');
                    appData.currentOrder.type = this.dataset.type;
                    document.getElementById('tableNumberContainer').style.display = (this.dataset.type === 'dinein') ? 'block' : 'none';
                });
            });

            document.getElementById('tableNumber').addEventListener('change', e => { appData.currentOrder.tableNumber = e.target.value; });
            document.getElementById('orderNote').addEventListener('input', e => { appData.currentOrder.note = e.target.value; });

            document.getElementById('amountPaid').addEventListener('input', e => {
                const amountPaid = parseFloat(e.target.value) || 0;
                const total = parseFloat(document.getElementById('total').textContent.replace(/[^\d]/g, ''));
                document.getElementById('changeAmount').value = formatRupiah(amountPaid - total);
                document.getElementById('confirmPaymentBtn').disabled = amountPaid < total;
            });
            
            document.querySelectorAll('.quick-cash-buttons .btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.getElementById('amountPaid').value = this.dataset.amount;
                    document.getElementById('amountPaid').dispatchEvent(new Event('input'));
                });
            });

            document.getElementById('backupDataBtn').addEventListener('click', backupData);
            document.getElementById('restoreFile').addEventListener('change', restoreData);
            document.getElementById('resetDataBtn').addEventListener('click', resetData);

            document.querySelectorAll('.modal-close').forEach(btn => {
                btn.addEventListener('click', () => closeModal(btn.closest('.modal').id));
            });
            
            window.addEventListener('click', e => {
                if (e.target.classList.contains('modal')) closeModal(e.target.id);
            });
            
            document.getElementById('memberSearch').addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                const resultsContainer = document.getElementById('memberSearchResults');
                if (searchTerm.length < 1) {
                    resultsContainer.style.display = 'none';
                    return;
                }
                const results = appData.members.filter(m => m.name.toLowerCase().includes(searchTerm) || m.id.toLowerCase().includes(searchTerm));
                if (results.length > 0) {
                    resultsContainer.innerHTML = results.map(m => `<div class="member-search-item" data-id="${m.id}">${m.name} (${m.id})</div>`).join('');
                    resultsContainer.style.display = 'block';
                } else {
                    resultsContainer.style.display = 'none';
                }
            });

            document.getElementById('memberSearchResults').addEventListener('click', e => {
                if (e.target.classList.contains('member-search-item')) {
                    const memberId = e.target.dataset.id;
                    appData.currentOrder.memberId = memberId;
                    document.getElementById('memberSearch').value = e.target.textContent;
                    document.getElementById('memberSearchResults').style.display = 'none';
                }
            });

            document.getElementById('controlPanelBtn').addEventListener('click', () => openModal('controlPanelModal'));
            document.getElementById('viewReportsBtn').addEventListener('click', () => {
                document.getElementById('reportDate').value = new Date().toISOString().split('T')[0];
                openModal('reportsModal');
            });

        });
    </script>
</body>
</html>
