<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fortuna Prime 2.0 - Roda Undian Canggih</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Inter:wght@400;500;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg-color: #1a1a1a;
            --surface-color: #2c2c2c;
            --primary-color: #E0B841; /* Gold */
            --text-color: #F5F5F5;
            --text-secondary: #AAAAAA;
            --font-display: 'Playfair Display', serif;
            --font-body: 'Inter', sans-serif;
            --wheel-size: clamp(300px, 90vmin, 500px);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: var(--font-body);
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
        }

        .app-container {
            display: grid;
            grid-template-columns: var(--wheel-size) 1fr;
            gap: 40px;
            align-items: center;
            width: 100%;
            max-width: 1000px;
        }

        /* Wheel Section */
        .wheel-section {
            position: relative;
            display: grid;
            place-items: center;
        }

        #wheel-canvas {
            width: var(--wheel-size);
            height: var(--wheel-size);
            transition: transform 5s cubic-bezier(0.1, 0.5, 0.2, 1); /* Animasi putaran */
        }
        
        .wheel-pointer {
            width: 0;
            height: 0;
            border-left: 20px solid transparent;
            border-right: 20px solid transparent;
            border-top: 40px solid var(--primary-color);
            position: absolute;
            top: -15px;
            z-index: 10;
            transform: translateY(-50%);
            filter: drop-shadow(0px 2px 5px rgba(0,0,0,0.5));
        }

        /* Controls Section */
        .controls-section {
            background: var(--surface-color);
            padding: 30px;
            border-radius: 16px;
            border: 1px solid rgba(224, 184, 65, 0.2);
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }

        .controls-section h1 {
            font-family: var(--font-display);
            color: var(--primary-color);
            text-align: center;
            margin-bottom: 10px;
        }

        .controls-section p {
            text-align: center;
            color: var(--text-secondary);
            margin-bottom: 30px;
        }
        
        label {
            display: block;
            margin-bottom: 10px;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        #participants-textarea {
            width: 100%;
            height: 200px;
            background-color: #1f1f1f;
            border: 1px solid #444;
            border-radius: 8px;
            padding: 15px;
            color: var(--text-color);
            font-size: 1rem;
            resize: vertical;
            margin-bottom: 20px;
        }
        
        #spin-button {
            width: 100%;
            padding: 15px;
            font-size: 1.2rem;
            font-weight: 700;
            color: #1a1a1a;
            background: var(--primary-color);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        #spin-button:disabled {
            background: #555;
            cursor: not-allowed;
            color: #888;
        }

        #spin-button:not(:disabled):hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(224, 184, 65, 0.2);
        }

        /* Modal & Confetti */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }

        .modal-overlay.show { opacity: 1; visibility: visible; }
        
        .modal-content {
            background: var(--surface-color);
            padding: 40px;
            border-radius: 16px;
            text-align: center;
            transform: scale(0.7);
            transition: transform 0.3s;
            position: relative;
            z-index: 1001;
            border: 1px solid rgba(224, 184, 65, 0.3);
        }

        .modal-overlay.show .modal-content { transform: scale(1); }

        .modal-content h2 {
            color: var(--text-secondary);
            margin-bottom: 15px;
        }

        .winner-name {
            font-family: var(--font-display);
            font-size: 3rem;
            color: var(--primary-color);
            margin-bottom: 30px;
        }

        .modal-buttons { display: flex; gap: 15px; }
        
        .modal-button {
            padding: 10px 20px;
            border-radius: 8px;
            border: 2px solid var(--primary-color);
            background: transparent;
            color: var(--primary-color);
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s, color 0.2s;
        }
        
        .modal-button.primary {
            background: var(--primary-color);
            color: var(--bg-color);
        }
        .modal-button:hover {
             filter: brightness(1.2);
        }

        /* Confetti styles */
        #confetti-container {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            z-index: 2000;
        }
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #f00; /* Will be overridden by JS */
            opacity: 0;
            animation: fall 5s linear forwards;
        }
        @keyframes fall {
            0% { transform: translateY(-10vh) rotateZ(0deg); opacity: 1; }
            100% { transform: translateY(110vh) rotateZ(720deg); opacity: 0; }
        }

        /* Responsive Layout */
        @media (max-width: 900px) {
            .app-container {
                grid-template-columns: 1fr;
                gap: 50px;
                max-width: 500px;
            }
            .controls-section {
                order: 1; /* Pindah ke bawah */
            }
            .wheel-section {
                order: 0;
            }
        }
    </style>
</head>
<body>

    <div class="app-container">
        <section class="wheel-section">
            <div class="wheel-pointer"></div>
            <canvas id="wheel-canvas" width="500" height="500"></canvas>
        </section>

        <section class="controls-section">
            <h1>Fortuna Prime</h1>
            <p>Roda Undian Interaktif</p>
            <label for="participants-textarea">Masukkan Nama Peserta (satu per baris)</label>
            <textarea id="participants-textarea" placeholder="Budi&#10;Ani&#10;Citra&#10;Dewi"></textarea>
            <button id="spin-button">PUTAR RODA</button>
        </section>
    </div>

    <div class="modal-overlay" id="winner-modal">
        <div class="modal-content">
            <h2>ðŸŽ‰ Pemenangnya Adalah ðŸŽ‰</h2>
            <p class="winner-name" id="winner-name-display"></p>
            <div class="modal-buttons">
                <button class="modal-button" id="remove-winner-btn">Hapus Pemenang & Putar Lagi</button>
                <button class="modal-button primary" id="close-modal-btn">Tutup</button>
            </div>
        </div>
    </div>

    <div id="confetti-container"></div>
    
    <script>
        const canvas = document.getElementById('wheel-canvas');
        const ctx = canvas.getContext('2d');
        const spinButton = document.getElementById('spin-button');
        const participantsTextarea = document.getElementById('participants-textarea');
        const modal = document.getElementById('winner-modal');
        const winnerNameDisplay = document.getElementById('winner-name-display');
        const closeModalBtn = document.getElementById('close-modal-btn');
        const removeWinnerBtn = document.getElementById('remove-winner-btn');
        const confettiContainer = document.getElementById('confetti-container');

        let participants = [];
        let currentRotation = 0;
        let isSpinning = false;
        
        // Palet warna yang mewah
        const colors = ["#8E44AD", "#3498DB", "#1ABC9C", "#F1C40F", "#E74C3C", "#9B59B6", "#2980B9", "#16A085", "#F39C12", "#C0392B"];
        
        const getParticipants = () => {
            const lines = participantsTextarea.value.trim().split('\n').filter(p => p.trim() !== '');
            return lines;
        };
        
        const drawWheel = () => {
            participants = getParticipants();
            const numSegments = participants.length;
            if (numSegments === 0) {
                 // Gambar roda kosong jika tidak ada peserta
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.beginPath();
                ctx.arc(250, 250, 250, 0, 2 * Math.PI);
                ctx.fillStyle = '#333';
                ctx.fill();
                ctx.fillStyle = '#fff';
                ctx.font = '20px Inter';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText('Masukkan nama peserta', 250, 250);
                return;
            };

            const arcSize = (2 * Math.PI) / numSegments;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            for (let i = 0; i < numSegments; i++) {
                const angle = i * arcSize;
                ctx.beginPath();
                ctx.fillStyle = colors[i % colors.length];
                ctx.moveTo(250, 250);
                ctx.arc(250, 250, 250, angle, angle + arcSize);
                ctx.lineTo(250, 250);
                ctx.fill();

                // Draw text
                ctx.save();
                ctx.translate(250, 250);
                ctx.rotate(angle + arcSize / 2);
                ctx.textAlign = 'right';
                ctx.fillStyle = '#fff';
                ctx.font = 'bold 16px Inter';
                ctx.shadowColor = "rgba(0,0,0,0.4)";
                ctx.shadowBlur = 5;
                const text = participants[i].length > 15 ? participants[i].substring(0, 13) + '...' : participants[i];
                ctx.fillText(text, 230, 10);
                ctx.restore();
            }
        };

        participantsTextarea.addEventListener('input', drawWheel);

        spinButton.addEventListener('click', () => {
            if (isSpinning || getParticipants().length < 2) return;
            isSpinning = true;
            spinButton.disabled = true;

            const totalSpins = Math.floor(Math.random() * 5) + 5; // 5-9 putaran penuh
            const randomStopAngle = Math.random() * 2 * Math.PI; // Posisi berhenti acak
            const totalRotation = (totalSpins * 2 * Math.PI) + randomStopAngle;
            
            // Simpan rotasi saat ini
            const style = window.getComputedStyle(canvas);
            const matrix = new DOMMatrix(style.transform);
            currentRotation = Math.atan2(matrix.b, matrix.a);

            canvas.style.transition = 'transform 6s cubic-bezier(0.2, 0.8, 0.2, 1)';
            canvas.style.transform = `rotate(${currentRotation + totalRotation}rad)`;

            canvas.addEventListener('transitionend', () => {
                const actualRotation = (currentRotation + totalRotation) % (2 * Math.PI);
                const winningSegment = Math.floor((participants.length * (2 * Math.PI - actualRotation)) / (2 * Math.PI)) % participants.length;
                
                showWinner(participants[winningSegment]);
                
                // Reset untuk putaran selanjutnya
                canvas.style.transition = 'none';
                canvas.style.transform = `rotate(${actualRotation}rad)`;
                isSpinning = false;
                spinButton.disabled = false;
            }, { once: true });
        });
        
        let lastWinner = '';
        const showWinner = (winner) => {
            lastWinner = winner;
            winnerNameDisplay.textContent = winner;
            modal.classList.add('show');
            launchConfetti();
        };

        closeModalBtn.addEventListener('click', () => {
            modal.classList.remove('show');
        });

        removeWinnerBtn.addEventListener('click', () => {
            const currentParticipants = getParticipants();
            const newParticipants = currentParticipants.filter(p => p !== lastWinner);
            participantsTextarea.value = newParticipants.join('\n');
            drawWheel();
            modal.classList.remove('show');
        });

        const launchConfetti = () => {
            confettiContainer.innerHTML = '';
            for (let i = 0; i < 100; i++) {
                const confetti = document.createElement('div');
                confetti.classList.add('confetti');
                confetti.style.left = `${Math.random() * 100}vw`;
                confetti.style.animationDelay = `${Math.random() * 2}s`;
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confettiContainer.appendChild(confetti);
            }
        };

        // Initial draw
        drawWheel();
    </script>

</body>
</html>
